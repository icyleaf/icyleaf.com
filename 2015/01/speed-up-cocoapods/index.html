<!doctype html><html lang=zh><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>æé€ŸåŒ– CocoaPods | icyleaf</title><link rel=prev href=https://icyleaf.com/2014/01/moving-unicorn-to-puma-on-gitlab/><link rel=next href=https://icyleaf.com/2015/12/hexo-theme-next/><link rel=canonical href=https://icyleaf.com/2015/01/speed-up-cocoapods/><link rel=apple-touch-icon sizes=180x180 href=https://icyleaf.com/images/icyleaf-icon.png><link rel=icon type=image/png sizes=32x32 href=https://icyleaf.com/images/icyleaf-icon.png><link rel=icon type=image/png sizes=16x16 href=https://icyleaf.com/images/icyleaf-icon.png><link rel=stylesheet href=https://icyleaf.com/css/main.min.css><link rel=stylesheet href=https://icyleaf.com/font/iconfont.css><link rel=stylesheet href=https://icyleaf.com/font-ali/iconfont.css><link rel=stylesheet href=https://icyleaf.com/photoswipe/photoswipe.css><meta name=title content="æé€ŸåŒ– CocoaPods | icyleaf"><meta name=author content="icyleaf"><meta name=description content="æ—¥å¸¸å†™ä»£ç çƒ­çˆ±æˆ·å¤–çš„æ¢¦æƒ³å®¶"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/icyleaf.com\/"},"articleSection":"posts","name":"æé€ŸåŒ– CocoaPods","headline":"æé€ŸåŒ– CocoaPods","description":"Cocopods æœ¬èº«æ˜¯ä¸€ä¸ªä¼˜ç§€çš„ iOS å¼€å‘çš„åŒ…ç®¡ç†å·¥å…·ï¼Œæ¶µç›–äº† 7k\u002b çš„å¼€æºç»„ä»¶ï¼ŒåŒ…ç®¡ç†åº“æ˜¯æ‰˜ç®¡åœ¨ Githubã€‚ ä¼—æ‰€å‘¨çŸ¥çš„åŸå› å®ƒçš„é€Ÿåº¦æ—¥æ¸ç¼“æ…¢ï¼Œæœ‰æ—¶ä¼šé¢‘ç¹æŠ¥å¦‚ä¸‹é”™è¯¯","inLanguage":"zh","author":"icyleaf","creator":"icyleaf","publisher":"icyleaf","accountablePerson":"icyleaf","copyrightHolder":"icyleaf","copyrightYear":"2015","datePublished":"2015-01-20 12:34:56 \u002b0800 \u002b0800","dateModified":"2015-01-20 12:34:56 \u002b0800 \u002b0800","url":"https:\/\/icyleaf.com\/2015\/01\/speed-up-cocoapods\/","wordCount":"1658","keywords":["CocoaPods","iOS","icyleaf"]}</script></head><body><div class=wrapper><nav class=navbar><progress class=content_progress max=0 value=0></progress><div class=container><div class="navbar-header header-logo"><a href=https://icyleaf.com/>icyleaf</a></div><div class=navbar-right><span class=menu><a class=menu-item href=https://icyleaf.com/about title>About</a>
<a class=menu-item href=https://icyleaf.com/projects title>Projects</a>
<a class=menu-item href=https://icyleaf.com/index.xml title>Feed</a>
<span class=divide></span><a href=javascript:void(0); class=theme-switch><i class="iconfont icon-dark-mode"></i></a></span></div></div></nav><nav class=navbar-mobile id=nav-mobile style=display:none><progress class=content_progress max=0 value=0></progress><div class=container><div class=navbar><div class="navbar-header header-logo"><a href=https://icyleaf.com/>icyleaf</a></div><div class=navbar-right><div><a href=javascript:void(0); class=theme-switch><i class="iconfont icon-dark-mode"></i></a></div><div class=menu-toggle><span></span><span></span><span></span></div></div></div><div class=menu id=mobile-menu><nav class=mb-md><a class=menu-item href=https://icyleaf.com/about title><h3>About</h3><div class=menu-active></div></a><a class=menu-item href=https://icyleaf.com/projects title><h3>Projects</h3><div class=menu-active></div></a><a class=menu-item href=https://icyleaf.com/index.xml title><h3>Feed</h3><div class=menu-active></div></a></nav></div></div></nav><main class=main><div class=container><article class=post-warp itemscope itemtype=http://schema.org/Article><header class=post-header><h1 class=post-title itemprop="name headline">æé€ŸåŒ– CocoaPods</h1><div class=post-meta><time datetime=2015-01-20 itemprop=datePublished>January 20, 2015</time>
Â·
<span class=tags>CocoaPods, iOS</span>
Â·
<span class=post-word-count>1658 words Â· 7 minutes</span></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title></h2><div class="post-toc-content always-active"><nav id=TableOfContents><ul><li><ul><li><a href=#æŠ€æœ¯æ¦‚è¿°>æŠ€æœ¯æ¦‚è¿°</a></li><li><a href=#æŠ€æœ¯å‰–æ>æŠ€æœ¯å‰–æ</a></li><li><a href=#æ€»ç»“>æ€»ç»“</a></li><li><a href=#ç­”ç–‘è§£æƒ‘>ç­”ç–‘è§£æƒ‘</a></li></ul></li></ul></nav></div></div><div class=post-content><div id=post-gallery><p><a href=http://cocoapods.org/>Cocopods</a> æœ¬èº«æ˜¯ä¸€ä¸ªä¼˜ç§€çš„ iOS å¼€å‘çš„åŒ…ç®¡ç†å·¥å…·ï¼Œæ¶µç›–äº† 7k+ çš„å¼€æºç»„ä»¶ï¼ŒåŒ…ç®¡ç†åº“æ˜¯æ‰˜ç®¡åœ¨ Githubã€‚
ä¼—æ‰€å‘¨çŸ¥çš„åŸå› å®ƒçš„é€Ÿåº¦æ—¥æ¸ç¼“æ…¢ï¼Œæœ‰æ—¶ä¼šé¢‘ç¹æŠ¥å¦‚ä¸‹é”™è¯¯ï¼š</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=ln>1</span>$ pod install
<span class=ln>2</span>
<span class=ln>3</span>Cloning into <span class=s1>&#39;/path/to/ios/project/Pods/xxx&#39;</span>
<span class=ln>4</span>
<span class=ln>5</span>error: RPC failed<span class=p>;</span> <span class=nv>result</span><span class=o>=</span>52, HTTP <span class=nv>code</span> <span class=o>=</span> <span class=m>0</span>
<span class=ln>6</span>
<span class=ln>7</span>fatal: The remote end hung up unexpectedly
</code></pre></div><p>æœ¬æ–‡ä¸»è¦ä¸ºè§£å†³è¯¥é—®é¢˜è€Œè¯ç”Ÿçš„ï¼Œä»¥ä¸‹çš„åŠ é€Ÿæ–¹æ¡ˆä¸å±€é™äºç›®å‰å·²æµä¼ çš„ä¼˜åŒ–æ–¹æ¡ˆï¼Œè€Œæ˜¯åœ¨æ­¤åŸºç¡€ä¸Š<strong>å½»åº•çš„åŠ é€Ÿ</strong>ï¼</p><ul><li>ä½¿ç”¨æ·˜å® Ruby Gems æºï¼ˆCocoapods ä½¿ç”¨ ruby å¼€å‘ï¼‰</li><li><code>pod install</code> æ—¶ä¸è®¾ç½®åŒ…çš„æ›´æ–°ï¼š<a href=http://phatblat.com/blog/2014/07/30/pod-install/>å‚è€ƒæ–‡ç« </a></li><li>ä½¿ç”¨å›½å†… git æœåŠ¡å™¨é•œåƒ Cocoapods Spec: <a href=http://blog.devtang.com/blog/2014/05/25/use-cocoapod-to-manage-ios-lib-dependency/>å‚è€ƒæ–‡ç« </a></li></ul><p>å¦‚æœä½ å¯¹ Cocoapods æœ‰æ›´æ·±å±‚æ¬¡çš„ç†è§£ï¼Œè¯·å‚è§ï¼š<a href=http://www.objc.io/issue-6/cocoapods-under-the-hood.html>objc.io: Cocoapods under the hood</a> <a href=http://objccn.io/issue-6-4/>ä¸­æ–‡ç‰ˆæœ¬</a></p><p>ä»Šå¤©æ—©æ™¨çœ‹åˆ°å¾®åšä¼—å¤š iOS å¼€å‘è€…èµåŒè½¬å‘ã€Š<a href=http://weibo.com/p/1001603800875490492754>CocoaPodsæœ€ä½³å®è·µæ¢è®¨</a>ã€‹ä¸€æ–‡ï¼Œ
é’ˆå¯¹ <code>Pods</code> å»ºè®®çº³å…¥ç‰ˆæœ¬æ§åˆ¶ä¹Ÿæ˜¯æ— å¥ˆä¹‹ä¸¾ã€‚ä¹‹å‰å…¬å¸é¡¹ç›®ä¸­ä¹Ÿæ˜¯è¿™æ ·æ–½è¡Œå¾ˆé•¿ä¸€æ®µæ—¶é—´ï¼Œä¸æ’é™¤æ›´æ–°å¯èƒ½ä¼šé€ æˆå¾ˆå¤šæ— ç”¨ä¿¡æ¯"åˆ·å±"ï¼Œ
å¶å°”è¿˜ä¼šå› ä¸ºç‰ˆæœ¬å†²çªé€ æˆä¸€äº›æ··ä¹±çŠ¶å†µéœ€è¦å¤„ç†ã€‚ä¸ªäººè¿˜æ˜¯æ›´å€¾å‘äºç²¾ç®€åŸåˆ™ï¼Œéµå¾ª<a href=http://guides.cocoapods.org/using/using-cocoapods.html#should-i-ignore-the-pods-directory-in-source-control>å®˜æ–¹çš„å»ºè®®</a>ã€‚</p><p>å¤§å®¶éƒ½æ˜¯æŠ€æœ¯äººå‘˜ï¼Œå…¶å®è¿™äº›å°é—®é¢˜éš¾é“å› ä¸º github å€’ä¸‹å°±æ²¡æœ‰è§£å†³æ–¹æ¡ˆäº†å—ï¼Ÿï¼çœ‹æˆ‘å¦‚ä½•æ’•ç ´è¿™å±‚çº¸è€è™ï¼š</p><h3 id=æŠ€æœ¯æ¦‚è¿°>æŠ€æœ¯æ¦‚è¿°</h3><ul><li>Cocopods v0.34.0+</li><li>Gitlab: è‡ªå»ºç§æœ‰ git æœåŠ¡å™¨</li><li>gitlab-mirrors: ä¸“ç”¨äº github é•œåƒè‡³ gitlab å¹¶ä¿æŒå®šæœŸæ›´æ–°</li><li>rake: ruby çš„ä»£ç æ„å»ºå·¥å…·ï¼ˆä¸æ‡‚ ruby çš„å¯ä»¥æŠŠå®ƒç†è§£ä¸ºå‘½ä»¤èšåˆå·¥å…·ï¼‰</li></ul><h3 id=æŠ€æœ¯å‰–æ>æŠ€æœ¯å‰–æ</h3><p>Cocoapods è‡ªèº«æ”¯æŒ<a href=http://guides.cocoapods.org/making/private-cocoapods.html>ç§æœ‰ä»“åº“</a>ï¼Œ
æ°å¥½çš„æ˜¯å°±åœ¨å‰ä¸ä¹…å‘å¸ƒçš„ <a href=https://github.com/CocoaPods/CocoaPods/blob/master/CHANGELOG.md#0340>0.34.0</a> ç‰ˆæœ¬æ”¯æŒ <code>Podfile</code>
æ·»åŠ å¤šä¸ªçš„åŒ…æºä»“åº“ï¼Œä¸¾ä¸ªä¾‹å­ï¼š</p><div class=highlight><pre class=chroma><code class=language-ruby data-lang=ruby><span class=ln>1</span><span class=n>source</span> <span class=s1>&#39;https://github.com/artsy/Specs.git&#39;</span>
<span class=ln>2</span><span class=n>source</span> <span class=s1>&#39;https://github.com/CocoaPods/Specs.git&#39;</span>
<span class=ln>3</span>
<span class=ln>4</span><span class=n>pod</span> <span class=s1>&#39;AFNetworking&#39;</span>
<span class=ln>5</span><span class=n>pod</span> <span class=s1>&#39;Mantle&#39;</span>
</code></pre></div><p>è¿™ä¸ªç‰¹æ€§å…¶å®æ˜¯ä¸ºäº†æ‰©å……å®˜æ–¹ Spec çš„åŒæ—¶å¯ä»¥æ›´å¥½çš„è®©å¼€å‘è€…ç®¡ç†ç§æœ‰çš„å…¬å…±ç»„ä»¶ï¼Œé‚£æˆ‘åŒæ ·æ˜¯ä»è¿™é‡Œä¸‹æ‰‹ï¼š</p><blockquote><p>å‰ææ˜¯è‡ªå·±ä»¥åŠæ­å»ºå¥½ gitlab æœåŠ¡å™¨ï¼š<a href=https://about.gitlab.com/downloads/>å®˜æ–¹æ•™ç¨‹ ï¼ˆUbuntuï¼‰</a> | <a href=http://icyleaf.com/2013/09/how-to-install-gitlab-on-centos/>æœ¬äººæ•™ç¨‹ ï¼ˆCentOSï¼‰</a></p></blockquote><h4 id=è‡ªåŠ›æ›´ç”Ÿ>è‡ªåŠ›æ›´ç”Ÿ</h4><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªè‡ªå·±çš„ Spec ä»“åº“ï¼Œç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=ln>1</span>.
<span class=ln>2</span>â”œâ”€â”€ CocoaPods-version.yml
<span class=ln>3</span>â”œâ”€â”€ Specs/
<span class=ln>4</span>â”œâ”€â”€ README.md
<span class=ln>5</span>â”œâ”€â”€ Rakefile
<span class=ln>6</span>â””â”€â”€ Gemfile
</code></pre></div><p>é…ç½®ä¸åšè¯¦ç»†æè¿°ï¼Œè¿™é‡Œæ¯”å®˜æ–¹å¤šäº†ä¸¤ä¸ªæ–‡ä»¶ <code>Rakefile</code> å’Œ <code>Gemfile</code> éƒ½æ˜¯ rake æ‰€éœ€çš„æ–‡ä»¶ï¼Œè¿™ä¸ªåé¢ä¼šè®²åˆ°ã€‚
å†è€…å°±æ˜¯é…ç½® <a href=https://github.com/samrocketman/gitlab-mirrors#three-easy-steps>gitlab-mirrors</a>ï¼Œæ•™ç¨‹å¾ˆè¯¦ç»†ä¸å†é‡å¤ã€‚</p><div class=updated><header class=updated-header><h4 class=updated-title>æ›´æ–°</h4><p class=updated-meta>Apr 18, 2022</p></header><article class=updated-body>gitlab-mirrors çš„æœºåˆ¶é—®é¢˜å†ä½¿ç”¨å…¶ä»–ä¼šæœ‰å¾ˆå¤§çš„é™åˆ¶ï¼Œæˆ‘é‡æ–°é€ äº†ä¸€ä¸ªæ–°è½®å­ <a href=https://icyleaf.com/2018/04/intro-hpr/>hpr</a> é€šè¿‡ HTTP REST API + Docker éƒ¨ç½²çš„æ–¹å¼æ›´å¥½çš„è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚</article></div><h4 id=å·æ¢æ¢æŸ±>å·æ¢æ¢æŸ±</h4><p>åˆ©ç”¨ç§æœ‰ Spec ä»“åº“ç‰¹æ€§ï¼Œå¯ä»¥æŠŠå®˜æ–¹ <code>Spec</code> ç›®å½•ä¸‹é¢çš„åŒ…æŒ‰éœ€æˆ–å…¨éƒ¨é•œåƒè¿‡æ¥ï¼Œå†æ¬¡åŸºç¡€ä¸Š<strong>æŠŠé‡Œé¢æ¶‰åŠ github çš„åœ°å€æ›¿æ¢æˆ gitlab çš„åœ°å€</strong></p><p>ä½ æ²¡æœ‰çœ‹é”™ï¼Œè¿™æ˜¯æ ¸å¿ƒæ­¥éª¤ï¼Œå¦‚æœè¿™æ­¥æ²¡æœ‰åšé‚£ä¹ˆå’Œå›½å†…é•œåƒçš„åœ°å€æ²¡æœ‰ä»»ä½•å·®åˆ«ã€‚æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š</p><h5 id=rakefile>Rakefile</h5><div class=highlight><pre class=chroma><code class=language-ruby data-lang=ruby><span class=ln> 1</span><span class=nb>require</span> <span class=s1>&#39;uri&#39;</span>
<span class=ln> 2</span><span class=nb>require</span> <span class=s1>&#39;fileutils&#39;</span>
<span class=ln> 3</span><span class=nb>require</span> <span class=s1>&#39;multi_json&#39;</span>
<span class=ln> 4</span><span class=nb>require</span> <span class=s1>&#39;net/ssh&#39;</span>
<span class=ln> 5</span>
<span class=ln> 6</span><span class=n>desc</span> <span class=s1>&#39;é•œåƒä¸€ä¸ª github åŒ…è‡³ gitlab ä»“åº“&#39;</span>
<span class=ln> 7</span><span class=n>task</span> <span class=ss>:clone</span><span class=p>,</span> <span class=o>[</span><span class=ss>:name</span><span class=o>]</span> <span class=k>do</span> <span class=o>|</span><span class=n>t</span><span class=p>,</span> <span class=nb>p</span><span class=o>|</span>
<span class=ln> 8</span>  <span class=nb>name</span> <span class=o>=</span> <span class=nb>p</span><span class=o>[</span><span class=ss>:name</span><span class=o>]</span>
<span class=ln> 9</span>  <span class=n>current_path</span> <span class=o>=</span> <span class=no>Dir</span><span class=o>.</span><span class=n>pwd</span>
<span class=ln>10</span>
<span class=ln>11</span>  <span class=n>specs</span> <span class=o>=</span> <span class=no>Dir</span><span class=o>[</span><span class=no>File</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=no>File</span><span class=o>.</span><span class=n>expand_path</span><span class=p>(</span><span class=s1>&#39;~&#39;</span><span class=p>),</span> <span class=s1>&#39;.cocoapods/repos/master/Specs/*&#39;</span><span class=p>)</span><span class=o>]</span>
<span class=ln>12</span>
<span class=ln>13</span>  <span class=n>repo</span> <span class=o>=</span> <span class=n>specs</span><span class=o>.</span><span class=n>select</span> <span class=p>{</span> <span class=o>|</span><span class=n>s</span><span class=o>|</span> <span class=no>File</span><span class=o>.</span><span class=n>basename</span><span class=p>(</span><span class=n>s</span><span class=p>)</span> <span class=o>==</span> <span class=nb>name</span> <span class=p>}</span><span class=o>.</span><span class=n>first</span>
<span class=ln>14</span>
<span class=ln>15</span>  <span class=k>if</span> <span class=n>repo</span>
<span class=ln>16</span>    <span class=nb>puts</span> <span class=s2>&#34; * found repo, copy it here&#34;</span>
<span class=ln>17</span>    <span class=n>repo_store_path</span> <span class=o>=</span> <span class=no>File</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>current_path</span><span class=p>,</span> <span class=s1>&#39;Specs&#39;</span><span class=p>)</span>
<span class=ln>18</span>    <span class=no>FileUtils</span><span class=o>.</span><span class=n>cp_r</span> <span class=n>repo</span><span class=p>,</span> <span class=n>repo_store_path</span>
<span class=ln>19</span>
<span class=ln>20</span>    <span class=nb>puts</span> <span class=s2>&#34; * updating repo url&#34;</span>
<span class=ln>21</span>    <span class=no>Dir</span><span class=o>[</span><span class=s2>&#34;</span><span class=si>#{</span><span class=n>repo_store_path</span><span class=si>}</span><span class=s2>/</span><span class=si>#{</span><span class=nb>name</span><span class=si>}</span><span class=s2>/*&#34;</span><span class=o>].</span><span class=n>each</span> <span class=k>do</span> <span class=o>|</span><span class=n>f</span><span class=o>|</span>
<span class=ln>22</span>      <span class=n>pod_file</span> <span class=o>=</span> <span class=no>File</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>f</span><span class=p>,</span> <span class=s2>&#34;</span><span class=si>#{</span><span class=nb>name</span><span class=si>}</span><span class=s2>.podspec.json&#34;</span><span class=p>)</span>
<span class=ln>23</span>      <span class=n>json</span> <span class=o>=</span> <span class=no>File</span><span class=o>.</span><span class=n>read</span><span class=p>(</span><span class=n>pod_file</span><span class=p>)</span>
<span class=ln>24</span>      <span class=n>data</span> <span class=o>=</span> <span class=no>MultiJson</span><span class=o>.</span><span class=n>load</span> <span class=n>json</span>
<span class=ln>25</span>
<span class=ln>26</span>      <span class=k>if</span> <span class=n>data</span><span class=o>[</span><span class=s1>&#39;source&#39;</span><span class=o>][</span><span class=s1>&#39;git&#39;</span><span class=o>]</span>
<span class=ln>27</span>        <span class=nb>puts</span> <span class=s2>&#34; -&gt; </span><span class=si>#{</span><span class=n>data</span><span class=o>[</span><span class=s1>&#39;version&#39;</span><span class=o>]</span><span class=si>}</span><span class=s2>: git&#34;</span>
<span class=ln>28</span>        <span class=n>orginal_repo_url</span> <span class=o>=</span> <span class=n>data</span><span class=o>[</span><span class=s1>&#39;source&#39;</span><span class=o>][</span><span class=s1>&#39;git&#39;</span><span class=o>]</span>
<span class=ln>29</span>        <span class=n>coverted_repo_name</span> <span class=o>=</span>  <span class=no>URI</span><span class=o>.</span><span class=n>parse</span><span class=p>(</span><span class=n>orginal_repo_url</span><span class=p>)</span><span class=o>.</span><span class=n>path</span><span class=o>[</span><span class=mi>1</span><span class=o>..-</span><span class=mi>1</span><span class=o>].</span><span class=n>gsub</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span> <span class=s1>&#39;-&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>downcase</span>
<span class=ln>30</span>        <span class=n>data</span><span class=o>[</span><span class=s1>&#39;source&#39;</span><span class=o>][</span><span class=s1>&#39;git&#39;</span><span class=o>]</span> <span class=o>=</span> <span class=s2>&#34;http://gitlab.dev/mirrors/</span><span class=si>#{</span><span class=n>coverted_repo_name</span><span class=si>}</span><span class=s2>&#34;</span>
<span class=ln>31</span>
<span class=ln>32</span>        <span class=no>File</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>pod_file</span><span class=p>,</span> <span class=no>JSON</span><span class=o>.</span><span class=n>pretty_generate</span><span class=p>(</span><span class=n>data</span><span class=p>))</span>
<span class=ln>33</span>      <span class=k>else</span> <span class=n>data</span><span class=o>[</span><span class=s1>&#39;source&#39;</span><span class=o>][</span><span class=s1>&#39;http&#39;</span><span class=o>]</span>
<span class=ln>34</span>        <span class=nb>puts</span> <span class=s2>&#34; -&gt; </span><span class=si>#{</span><span class=n>data</span><span class=o>[</span><span class=s1>&#39;version&#39;</span><span class=o>]</span><span class=si>}</span><span class=s2>: http url, do you want speed up?&#34;</span>
<span class=ln>35</span>      <span class=k>else</span> <span class=n>data</span><span class=o>[</span><span class=s1>&#39;source&#39;</span><span class=o>][</span><span class=s1>&#39;svn&#39;</span><span class=o>]</span>
<span class=ln>36</span>        <span class=nb>puts</span> <span class=s2>&#34; -&gt; </span><span class=si>#{</span><span class=n>data</span><span class=o>[</span><span class=s1>&#39;version&#39;</span><span class=o>]</span><span class=si>}</span><span class=s2>: svn repo, do you want speed up?&#34;</span>
<span class=ln>37</span>      <span class=k>end</span>
<span class=ln>38</span>    <span class=k>end</span>
<span class=ln>39</span>  <span class=k>else</span>
<span class=ln>40</span>    <span class=nb>puts</span> <span class=s2>&#34;Not find spec named: </span><span class=si>#{</span><span class=nb>name</span><span class=si>}</span><span class=s2>&#34;</span>
<span class=ln>41</span>  <span class=k>end</span>
<span class=ln>42</span><span class=k>end</span>
<span class=ln>43</span>
<span class=ln>44</span><span class=n>desc</span> <span class=s1>&#39;gitlab æœåŠ¡å™¨é•œåƒ Cocoapod Spec&#39;</span>
<span class=ln>45</span><span class=n>task</span> <span class=ss>:mirror</span><span class=p>,</span> <span class=o>[</span><span class=ss>:repo</span><span class=o>]</span> <span class=k>do</span> <span class=o>|</span><span class=n>t</span><span class=p>,</span> <span class=nb>p</span><span class=o>|</span>
<span class=ln>46</span>  <span class=n>host</span>        <span class=o>=</span> <span class=s1>&#39;172..0.1&#39;</span>
<span class=ln>47</span>  <span class=n>user</span>        <span class=o>=</span> <span class=s1>&#39;icyleaf&#39;</span>
<span class=ln>48</span>  <span class=n>options</span>     <span class=o>=</span> <span class=p>{</span><span class=ss>:keys</span> <span class=o>=&gt;</span> <span class=s1>&#39;~/.ssh/keys/id_rsa.pub&#39;</span><span class=p>}</span>
<span class=ln>49</span>
<span class=ln>50</span>  <span class=nb>puts</span> <span class=s2>&#34;Connect gitlab server and mirror&#34;</span>
<span class=ln>51</span>  <span class=no>Net</span><span class=o>::</span><span class=no>SSH</span><span class=o>.</span><span class=n>start</span><span class=p>(</span><span class=n>host</span><span class=p>,</span> <span class=n>user</span><span class=p>,</span> <span class=n>options</span><span class=p>)</span> <span class=k>do</span> <span class=o>|</span><span class=n>ssh</span><span class=o>|</span>
<span class=ln>52</span>    <span class=n>gitmirror_path</span> <span class=o>=</span> <span class=s1>&#39;/home/gitmirror/gitlab-mirrors&#39;</span>
<span class=ln>53</span>    <span class=n>cmd</span> <span class=o>=</span> <span class=s2>&#34;sudo -u gitmirror -H rake </span><span class=se>\&#34;</span><span class=s2>add[</span><span class=si>#{</span><span class=nb>p</span><span class=o>[</span><span class=ss>:repo</span><span class=o>]</span><span class=si>}</span><span class=s2>]</span><span class=se>\&#34;</span><span class=s2>&#34;</span>
<span class=ln>54</span>    <span class=n>stdout</span> <span class=o>=</span> <span class=n>ssh</span><span class=o>.</span><span class=n>exec!</span><span class=p>(</span><span class=s2>&#34;echo &#39;cd </span><span class=si>#{</span><span class=n>gitmirror_path</span><span class=si>}</span><span class=s2> &amp;&amp; </span><span class=si>#{</span><span class=n>cmd</span><span class=si>}</span><span class=s2>&#39;&#34;</span><span class=p>)</span>
<span class=ln>55</span>    <span class=nb>puts</span> <span class=n>stdout</span>
<span class=ln>56</span>    <span class=n>ssh</span><span class=o>.</span><span class=n>loop</span>
<span class=ln>57</span>  <span class=k>end</span>
<span class=ln>58</span><span class=k>end</span>
</code></pre></div><h5 id=gemfile>Gemfile</h5><div class=highlight><pre class=chroma><code class=language-ruby data-lang=ruby><span class=ln>1</span><span class=n>source</span> <span class=s2>&#34;https://ruby.taobao.org&#34;</span>
<span class=ln>2</span>
<span class=ln>3</span><span class=n>gem</span> <span class=s1>&#39;rest_client&#39;</span>
<span class=ln>4</span><span class=n>gem</span> <span class=s1>&#39;multi_json&#39;</span>
<span class=ln>5</span><span class=n>gem</span> <span class=s1>&#39;rake&#39;</span>
<span class=ln>6</span><span class=n>gem</span> <span class=s1>&#39;net-ssh&#39;</span>
</code></pre></div><p><code>rake</code> é‡Œé¢æœ‰ä¸¤ä¸ª taskï¼š</p><ul><li>mirror: é•œåƒ iOS å¼€æºç»„ä»¶</li><li>clone: è´Ÿè´£æŠŠå®˜æ–¹ spec æŒ‡å®šåŒ…ï¼ˆå¼€æºç»„ä»¶çš„ç‰ˆæœ¬æ§åˆ¶ï¼‰æ›¿æ¢ gitlab åœ°å€å¹¶åŠ å…¥åˆ°ç§æœ‰åŒ…ä»“åº“</li></ul><h3 id=æ€»ç»“>æ€»ç»“</h3><p>é€šè¿‡å·¥å…·æ€»æœ‰åŠæ³•å¯ä»¥æ”¹è¿›å’Œæå‡å¼€å‘è€…çš„æ•ˆç‡å’Œè§£å†³å„ç§çš„é—®é¢˜ï¼Œå¸Œæœ›æœ¬æ–‡å¯ä»¥ç»™å¤§å®¶å¸¦æ¥æ›´å¤šçš„çµæ„Ÿï¼</p><h3 id=ç­”ç–‘è§£æƒ‘>ç­”ç–‘è§£æƒ‘</h3><h5 id=f-è¿™å¥—ç†è®ºé è°±å—>F: è¿™å¥—ç†è®ºé è°±å—ï¼Ÿ</h5><p>A: ç›®å‰æˆ‘ä»¬å›¢é˜Ÿå·²ç»é‡‡ç”¨å¹¶è¿è¡Œäº†å¾ˆé•¿ä¸€æ®µæ—¶é—´ï¼Œæ²¡æœ‰ä»»ä½•é£é™©ã€‚æœ€å¤§çš„ä¼˜åŠ¿åœ¨äºå…¼å®¹å®˜æ–¹çš„ä»“åº“ï¼Œ
å°±ç®—æ— æ³•é“¾æ¥è‡ªå·±çš„ç§æœ‰æœåŠ¡å™¨ï¼Œä½¿ç”¨å®˜æ–¹å’Œå›½å†…é•œåƒçš„éƒ½å¯ä»¥ç¬é—´åˆ‡æ¢ã€‚</p><h5 id=f-å¦‚æœæ²¡æœ‰æœåŠ¡å™¨å¯ä»¥å®ç°å—>F: å¦‚æœæ²¡æœ‰æœåŠ¡å™¨å¯ä»¥å®ç°å—ï¼Ÿ</h5><p>A: é†’é†’å§å­©å­ï¼Œå°±è¿å•çº¯çš„é•œåƒå®˜æ–¹ Cocoapods Spec è¿˜éœ€è¦ä¸€ä¸ªæœåŠ¡å™¨æ‰§è¡Œå®šæœŸåŒæ­¥è„šæœ¬å‘¢ã€‚</p><h5 id=f-å›½å†…-git-æ‰˜ç®¡æœåŠ¡å™¨èƒ½å¤Ÿæ”¯æŒå—>F: å›½å†… git æ‰˜ç®¡æœåŠ¡å™¨èƒ½å¤Ÿæ”¯æŒå—ï¼Ÿ</h5><p>A: æ®æˆ‘æ‰€çŸ¥å›½å†…å¤§éƒ¨åˆ† git æ‰˜ç®¡æœåŠ¡å™¨çš„è§£å†³æ–¹æ¡ˆéƒ½æ˜¯åŸºäº gitlab äºŒæ¬¡å¼€å‘çš„ï¼Œç†è®ºä¸Šå¯è¡Œï¼Œ
ä¸Šé¢æåˆ°çš„ gitlab-mirror æœ¬èº«ä¾èµ–äº gitlab çš„ api åœ¨é•œåƒçš„åŒæ—¶è‡ªåŠ¨æ–°å»ºä»“åº“ã€‚å¦‚æœæœ‰æˆåŠŸçš„æ¬¢è¿åé¦ˆã€‚</p><h5 id=f-æˆ‘ä»ä½ ä»£ç å‘ç°æœåŠ¡å™¨åŒæ ·è°ƒç”¨äº†ä¸€ä¸ª-rake-è„šæœ¬ä½ æ²¡æœ‰å¼€æº>F: æˆ‘ä»ä½ ä»£ç å‘ç°æœåŠ¡å™¨åŒæ ·è°ƒç”¨äº†ä¸€ä¸ª rake è„šæœ¬ï¼Œä½ æ²¡æœ‰å¼€æºï¼</h5><p>A: çœ¼ç›çœŸå¤Ÿæ•é”çš„ï¼Œä¸ªäººå¯¹ gitlab-mirror å†åšé•œåƒæ—¶åšäº†ä¸€ä¸ªçº¦æŸï¼Œæ–°å»ºä¸€ä¸ª <code>Rakefile</code> æ–‡ä»¶æ”¾åˆ°ä½ çš„ gitlab-mirror é¡¹ç›®æ ¹ç›®å½•å³å¯ï¼š</p><div class=highlight><pre class=chroma><code class=language-ruby data-lang=ruby><span class=ln> 1</span><span class=nb>require</span> <span class=s1>&#39;uri&#39;</span>
<span class=ln> 2</span>
<span class=ln> 3</span><span class=n>desc</span> <span class=s2>&#34;Adding repo to gitmirror&#34;</span>
<span class=ln> 4</span><span class=n>task</span> <span class=ss>:add</span><span class=p>,</span> <span class=o>[</span><span class=ss>:repo</span><span class=o>]</span> <span class=k>do</span> <span class=o>|</span><span class=n>t</span><span class=p>,</span> <span class=nb>p</span><span class=o>|</span>
<span class=ln> 5</span>  <span class=n>repo</span> <span class=o>=</span> <span class=nb>p</span><span class=o>[</span><span class=ss>:repo</span><span class=o>]</span>
<span class=ln> 6</span>
<span class=ln> 7</span>  <span class=k>begin</span>
<span class=ln> 8</span>    <span class=nb>name</span> <span class=o>=</span> <span class=no>URI</span><span class=o>.</span><span class=n>parse</span><span class=p>(</span><span class=n>repo</span><span class=p>)</span><span class=o>.</span><span class=n>path</span><span class=o>[</span><span class=mi>1</span><span class=o>..-</span><span class=mi>1</span><span class=o>].</span><span class=n>gsub</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span> <span class=s1>&#39;-&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>gsub</span><span class=p>(</span><span class=s1>&#39;.git&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span>
<span class=ln> 9</span>    <span class=k>if</span> <span class=nb>name</span>
<span class=ln>10</span>      <span class=sb>`./add_mirror.sh -f --git --project-name </span><span class=si>#{</span><span class=nb>name</span><span class=si>}</span><span class=sb> --mirror </span><span class=si>#{</span><span class=n>repo</span><span class=si>}</span><span class=sb>`</span>
<span class=ln>11</span>    <span class=k>end</span>
<span class=ln>12</span>  <span class=k>rescue</span> <span class=no>Error</span> <span class=o>=&gt;</span> <span class=n>e</span>
<span class=ln>13</span>    <span class=nb>puts</span> <span class=s1>&#39;not url&#39;</span>
<span class=ln>14</span>  <span class=k>end</span>
<span class=ln>15</span><span class=k>end</span>
</code></pre></div><h5 id=f-æˆ‘è¿˜æœ‰é—®é¢˜>F: æˆ‘è¿˜æœ‰é—®é¢˜ï¼</h5><p>A: éº»çƒ¦è¯·ç•™è¨€ï¼Œè°¢è°¢ï¼</p></div></div><div class=post-nav><a href=https://icyleaf.com/2014/01/moving-unicorn-to-puma-on-gitlab/ class=prev rel=prev title="Puma æ›¿æ¢ Unicorn è·‘ Gitlab"><i class="iconfont icon-left"></i>&nbsp;Puma æ›¿æ¢ Unicorn è·‘ Gitlab</a>
<a href=https://icyleaf.com/2015/12/hexo-theme-next/ class=next rel=next title="Hexo ä¸»é¢˜æ¨è NexT">Hexo ä¸»é¢˜æ¨è NexT&nbsp;<i class="iconfont icon-right"></i></a></div><div class=post-comment></div></article></div></main><footer class=footer><div class=copyright>&copy;
<span itemprop=copyrightYear>2005 - 2022</span>
<span>ğŸº</span>
<span class=author itemprop=copyrightHolder><a href=https://icyleaf.com/>icyleaf</a></span></div></footer><script src=https://fastly.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js crossorigin=anonymous></script><script defer src=https://icyleaf.com/js/vendor_main.min.js></script><script src=https://fastly.jsdelivr.net/npm/pangu@4.0.7/dist/browser/pangu.min.js integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin=anonymous></script><script>pangu.spacingPage()</script><script type=module>
  
  import PhotoSwipeLightbox from '\/photoswipe\/photoswipe-lightbox.esm.js';

  const lightbox = new PhotoSwipeLightbox({
    gallery: '#post-gallery',
    children: 'a.gallery-item',
    pswpModule: '\/photoswipe\/photoswipe.esm.js',
  });
  lightbox.init();
</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-TKQBZ7R259"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-TKQBZ7R259')</script></div></body></html>