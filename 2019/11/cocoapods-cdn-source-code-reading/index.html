<!doctype html><html lang=zh-cn></html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Cocoapods 新增 CDN 加速镜像源码解读 | icyleaf</title><meta name=keywords content="Ruby,iOS"><meta name=description content="通过代码剖析对比前后都发生了什么变化"><meta name=author content="icyleaf"><link rel=canonical href=https://icyleaf.com/2019/11/cocoapods-cdn-source-code-reading/><link rel=icon href=https://icyleaf.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://icyleaf.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://icyleaf.com/favicon-32x32.png><link rel=icon type=image/png sizes=192x192 href=https://icyleaf.com/android-chrome-192x192.png><link rel=icon type=image/png sizes=512x512 href=https://icyleaf.com/android-chrome-512x512.png><link rel=apple-touch-icon href=https://icyleaf.com/apple-touch-icon.png><link rel=mask-icon href=https://icyleaf.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=stylesheet href=https://icyleaf.com/css/main.min.css><link rel=stylesheet href=https://icyleaf.com/font/iconfont.min.css><link rel=stylesheet href=https://icyleaf.com/font-ali/iconfont.min.css><link rel=stylesheet href=https://icyleaf.com/photoswipe/photoswipe.min.css><link rel=canonical href=https://icyleaf.com/2019/11/cocoapods-cdn-source-code-reading/><meta property="og:title" content="Cocoapods 新增 CDN 加速镜像源码解读"><meta property="og:description" content="通过代码剖析对比前后都发生了什么变化"><meta property="og:type" content="article"><meta property="og:url" content="https://icyleaf.com/2019/11/cocoapods-cdn-source-code-reading/"><meta property="og:image" content="https://images.unsplash.com/photo-1570286424717-86d8a0082d0c?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1636&q=80"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-11-15T19:10:07+08:00"><meta property="article:modified_time" content="2019-11-15T19:10:07+08:00"><meta property="og:see_also" content="https://icyleaf.com/2022/11/cocoapods-cdn-speed-up-another-solution/"><meta property="og:see_also" content="https://icyleaf.com/2015/01/speed-up-cocoapods/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://images.unsplash.com/photo-1570286424717-86d8a0082d0c?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1636&q=80"><meta name=twitter:title content="Cocoapods 新增 CDN 加速镜像源码解读"><meta name=twitter:description content="通过代码剖析对比前后都发生了什么变化"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://icyleaf.com/posts/"},{"@type":"ListItem","position":2,"name":"Cocoapods 新增 CDN 加速镜像源码解读","item":"https://icyleaf.com/2019/11/cocoapods-cdn-source-code-reading/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Cocoapods 新增 CDN 加速镜像源码解读","name":"Cocoapods 新增 CDN 加速镜像源码解读","description":"通过代码剖析对比前后都发生了什么变化","keywords":["Ruby","iOS"],"articleBody":"Cocoapods 1.7.2 版本开始增加 CDN 支持但默认没有启用，1.8 版本的发布舍弃了原始完整克隆的 Specs 仓库改用 CDN 服务。CDN 利用的是免费且强大的 Netlify CDN 服务，该 CDN 网络在国内是有备案因此速度和稳定性都会有很好的保证。类似提案去年有人用 Cocoapods Plugin 实现并向社区贡献 PR。\n那么 CDN 支持相比之前的机制有啥优势呢？难道是把 Pods 的仓库和源码都托管到 CDN 网络了吗，其实并不是的。\n友情提醒：本文只重点分析 Pods 下载的机制，不展开其他方面，以下只是 pod install 执行顺序中的一部分，如果你想了解 Cocoapods 都干了什么可以前往这篇文章查阅。\n老的机制 第一步先检查本地 ~/.cocoapods/repo/master 目录是否存在，没有直接克隆 https://github.com/Cocoapods/Specs.git 仓库，这步在国内来说特别费时间正常下载下来目录应该是 2G+，如果有其他 source 源（比如私有源）会重复刚才的操作。\n第二步安装 Podfile 每个 Pod 去在各个源中寻找对应的版本，从版本的 .podspec 文件解析获取组件的地址，这个可能是 http、git、svn、hg 中的任意一个，获取到之后开始下载（默认是在 ~/Library/Caches/CocoaPods 做缓存目录）\n新的机制 第一步分析 Podfile 里面的 source ，如果没有走默认 Cocoapods 的配置（1.8 以上是 https://cdn.cocoapods.org ，之前的还是 Cocoapods/Spec）， 如果本地不存在官方 cdn 的 repo 名字是 trunk 的保留字，自己无法创建。如果有自定义的 source 会追加上去 sources 列表。\n1$ http HEAD https://cdn.cocoapods.org/all_pods.txt 2HTTP/1.1 200 OK 3Accept-Ranges: bytes 4Age: 0 5Cache-Control: public, max-age=0, must-revalidate 6Connection: keep-alive 7Content-Length: 924280 8Content-Type: text/plain; charset=UTF-8 9Date: Sat, 09 Nov 2019 07:06:15 GMT 10Etag: \"acf0d284f3a8e82e0d66ba1a91cd30b9-ssl\" 11Server: Netlify 12Strict-Transport-Security: max-age=31536000 13X-NF-Request-ID: 50b466cd-ce9e-4326-b5bb-0d29a193ae4b-7809449 第二步检查或下载每个 source，每个 source 会检查是否是 cdn 类型（使用 HEAD 请求检查是否包含 /all_pods.txt）文件：\ncdn 类型，下面详细解释 其他类型，走原来的老的逻辑，不再赘述 第三步，下载 Cocoapods-version.yml 并缓存 etag，下载 /Cocoapods-version.yml 并取 headers 的第一个 etag 的值存为 /Cocoapods-version.yml.etag，如果存在 etag 会比对一样就不需要下载， 链接支持根目录和其他目录，支持 301 跳转。\nCocoapods-version.yml\n1--- 2min: 1.0.0 3last: 1.8.4 4prefix_lengths: 5- 1 6- 1 7- 1 第四步，分析 Pod 并获取 pod 的版本信息，比如 Podfile 我增加了一个 pod \"AFNetworking\"，把 pod 名字做 MD5 后的值取 Cocoapods-version.yml 的 prefiex_length 数组长度的值单字母拆分用下划线分割按照规则拼成文件名 all_pods_versions(_{fragment}).txt (如果prefix_length 为 0 则只会去下载 /all_pods_versions.txt)\n比如：prefix_lengths 数组大小为 3，AFNetworking MD5 后 a75d452377f396bdc4b623a5df25820 则匹配前三位 a75 拆分后 a_7_5 后查找 cdn url 路径的 /all_pods_versions_a_7_5.txt 下载下来后的内容：\n1Fuse/0.1.0/0.2.0/1.0.0/1.1.0/1.2.0 2GXFlowView/1.0.0 3JFCountryPicker/0.0.1/0.0.2 4JVEmptyElement/0.1.0 第五步，下载 pod 的所有版本的 .podspec 文件，从上面的文件按照每行寻找第一段的名字，把后面的所有版本按照上面获取到的 prefix_lengths 的值（例如 AFNetworking 是 a, 7 , 5） /Specs/a/7/5/AFNetworking/{version}/AFNetworking.podspec.json 一次下载，并保存 etag 为 /Specs/a/7/5/AFNetworking/{version}/AFNetworking.podspec.json.etag，这个 etag 作用上面已经讲过，如果没有找到的话就会直接报错。\n1Adding spec repo `trunk` with CDN `https://cdn.cocoapods.org/` 2 CDN: trunk Relative path downloaded: CocoaPods-version.yml, save ETag: \"031c25b97a0aca21900087e355dcf663-ssl\" 3 CDN: trunk Relative path: CocoaPods-version.yml exists! Returning local because checking is only perfomed in repo update 4 CDN: trunk Relative path downloaded: all_pods_versions_a_7_5.txt, save ETag: \"5b32718ecbe82b0ae71ab3c77120213f-ssl\" 5 CDN: trunk Redirecting from https://cdn.cocoapods.org/Specs/a/7/5/AFNetworking/0.10.0/AFNetworking.podspec.json to https://raw.githubusercontent.com/CocoaPods/Specs/master/Specs/a/7/5/AFNetworking/0.10.0/AFNetworking.podspec.json 6 CDN: trunk Relative path downloaded: Specs/a/7/5/AFNetworking/0.10.0/AFNetworking.podspec.json, save ETag: W/\"a5f00eb1fdfdcab00b89e96bb81d48c110f09220063fdcf0b269290bffc18cf5\" Cocoapods trunk 源的目录结构：\n1.cocoapods 2 repo 3 trunk 4 .url #=\u003e https://cdn.cocoapods.org/ 5 Cocoapods-version.yml # =\u003e 从 https://cdn.cocoapods.org/CocoaPods-version.yml 下载的文件 6 Cocoapods-version.yml.etag # 上一个请求的第一个 etag 值存下来 7 all_pods_versions_a_7_5.txt # 参考上面的备注 8 all_pods_versions_a_7_5.txt.etag # 上一个请求的第一个 etag 值存下来 第六步和老的机制第二步一样同样最终还是会寻找 podspec 里面下载地址去下载， 也就是说真正 CDN 缓存加速的只有原有 Specs 必要的 podspec 文件，而不会加速 Pod 真正源地址，改机制只是减轻了本地更新官方 Specs 源的麻烦以及维护一个巨大的本地文件存储，这也是中心化机制的一个心结。\n结语 这个机制大大减少了本地需要占一个较大存储的问题，尤其是初次 pod install 时间长的情况，但 Pod 库本身还是各自的 地址本质上无法解决安装 Pod 消耗时间过长的问题。\n","wordCount":"1409","inLanguage":"zh-cn","image":"https://images.unsplash.com/photo-1570286424717-86d8a0082d0c?ixlib=rb-4.0.3\u0026ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8\u0026auto=format\u0026fit=crop\u0026w=1636\u0026q=80","datePublished":"2019-11-15T19:10:07+08:00","dateModified":"2019-11-15T19:10:07+08:00","author":{"@type":"Person","name":"icyleaf"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://icyleaf.com/2019/11/cocoapods-cdn-source-code-reading/"},"publisher":{"@type":"Organization","name":"icyleaf","logo":{"@type":"ImageObject","url":"https://icyleaf.com/favicon.ico"}}}</script></head><body><div class=wrapper><nav class=navbar><progress class=content_progress max=0 value=0></progress><div class=container><div class="navbar-header header-logo"><a href=https://icyleaf.com/>icyleaf</a></div><div class=navbar-right><span class=menu><a class=menu-item href=https://icyleaf.com/series/homelab title>homelab 系列</a>
<a class=menu-item href=https://icyleaf.com/projects title>开源项目</a>
<a class=menu-item href=https://icyleaf.com/gears title>我的设备</a>
<a class=menu-item href=https://icyleaf.com/about title>关于</a>
<span class=divide></span>
<a href=javascript:void(0); class=theme-switch><i class="iconfont icon-dark-mode"></i></a></span></div></div></nav><nav class=navbar-mobile id=nav-mobile style=display:none><progress class=content_progress max=0 value=0></progress><div class=container><div class=navbar><div class="navbar-header header-logo"><a href=https://icyleaf.com/>icyleaf</a></div><div class=navbar-right><div><a href=javascript:void(0); class=theme-switch><i class="iconfont icon-dark-mode"></i></a></div><div class=menu-toggle><span></span><span></span><span></span></div></div></div><div class=menu id=mobile-menu><nav class=mb-md><a class=menu-item href=https://icyleaf.com/series/homelab title><h3>homelab 系列</h3><div class=menu-active></div></a><a class=menu-item href=https://icyleaf.com/projects title><h3>开源项目</h3><div class=menu-active></div></a><a class=menu-item href=https://icyleaf.com/gears title><h3>我的设备</h3><div class=menu-active></div></a><a class=menu-item href=https://icyleaf.com/about title><h3>关于</h3><div class=menu-active></div></a></nav></div></div></nav><main class=main><div class=post-cover><img src="https://images.unsplash.com/photo-1570286424717-86d8a0082d0c?ixlib=rb-4.0.3&amp;ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;auto=format&amp;fit=crop&amp;w=1636&amp;q=80" loading=lazy><p class=cover-author>Photo by
<a href=https://unsplash.com/photos/j5s_uLajP2o>Chris Curry</a>
/
<a href=https://unsplash.com>Unsplash</a></p></div><div class=container><article class=post-warp itemscope itemtype=http://schema.org/Article><header class=post-header><h1 class=post-title itemprop=description>Cocoapods 新增 CDN 加速镜像源码解读</h1><div class=post-description>通过代码剖析对比前后都发生了什么变化</div><div class=post-meta><time datetime=2019-11-15 itemprop=datePublished>2019-11-15</time>
·
<span class=tags>Ruby, iOS</span>
·
<span class=post-word-count>1409 words · 6 minutes</span></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>目录</h2><div class="post-toc-content always-active"><nav id=TableOfContents><ul><li><ul><li><a href=#老的机制>老的机制</a></li><li><a href=#新的机制>新的机制</a></li><li><a href=#结语>结语</a></li></ul></li></ul></nav></div></div><div class=post-content><div class=post-series><h4 class=series-title><a href=https://icyleaf.com/series/cocoapods-collection/>Cocoapods 秘笈（3 篇）</a></h4><ol class=series-list><li class=series-item><a href=https://icyleaf.com/2015/01/speed-up-cocoapods/>极速化 CocoaPods</a></li><li class=series-item><span class=current-serie>Cocoapods 新增 CDN 加速镜像源码解读</span></li><li class=series-item><a href=https://icyleaf.com/2022/11/cocoapods-cdn-speed-up-another-solution/>Cocoapods CDN 加速新解</a></li></ol></div><div id=post-gallery><p>Cocoapods <a href=https://blog.cocoapods.org/CocoaPods-1.7.2/>1.7.2</a> 版本开始增加 CDN 支持但默认没有启用，<a href=http://blog.cocoapods.org/CocoaPods-1.8.0-beta/>1.8</a> 版本的发布舍弃了原始完整克隆的 Specs 仓库改用 CDN 服务。CDN 利用的是免费且强大的 <a href=https://github.com/CocoaPods/Core/pull/541>Netlify</a> CDN 服务，<del>该 CDN 网络在国内是有备案因此速度和稳定性都会有很好的保证</del>。类似提案去年有人用 Cocoapods Plugin 实现并向社区<a href=https://github.com/CocoaPods/CocoaPods/issues/8268>贡献 PR</a>。</p><p>那么 CDN 支持相比之前的机制有啥优势呢？难道是把 Pods 的仓库和源码都托管到 CDN 网络了吗，其实并不是的。</p><blockquote><p>友情提醒：本文只重点分析 Pods 下载的机制，不展开其他方面，以下只是 <code>pod install</code> 执行顺序中的一部分，如果你想了解 Cocoapods 都干了什么可以前往<a href=https://www.jianshu.com/p/84936d9344ff>这篇文章</a>查阅。</p></blockquote><h3 id=老的机制>老的机制</h3><p>第一步先检查本地 <code>~/.cocoapods/repo/master</code> 目录是否存在，没有直接克隆 <code>https://github.com/Cocoapods/Specs.git</code> 仓库，这步在国内来说特别费时间正常下载下来目录应该是 2G+，如果有其他 source 源（比如私有源）会重复刚才的操作。</p><p>第二步安装 Podfile 每个 Pod 去在各个源中寻找对应的版本，从版本的 .podspec 文件解析获取组件的地址，这个可能是 http、git、svn、hg 中的<a href=https://guides.cocoapods.org/syntax/podspec.html#source>任意一个</a>，获取到之后开始下载（默认是在 <code>~/Library/Caches/CocoaPods</code> 做缓存目录）</p><h3 id=新的机制>新的机制</h3><p>第一步分析 Podfile 里面的 source ，如果没有走默认 Cocoapods 的配置（1.8 以上是 <a href=https://cdn.cocoapods.org>https://cdn.cocoapods.org</a> ，之前的还是 Cocoapods/Spec），
如果本地不存在官方 cdn 的 repo 名字是 trunk 的保留字，自己无法创建。如果有自定义的 source 会追加上去 sources 列表。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=ln> 1</span><span class=cl>$ http HEAD https://cdn.cocoapods.org/all_pods.txt
</span></span><span class=line><span class=ln> 2</span><span class=cl>HTTP/1.1 200 OK
</span></span><span class=line><span class=ln> 3</span><span class=cl>Accept-Ranges: bytes
</span></span><span class=line><span class=ln> 4</span><span class=cl>Age: 0
</span></span><span class=line><span class=ln> 5</span><span class=cl>Cache-Control: public, max-age=0, must-revalidate
</span></span><span class=line><span class=ln> 6</span><span class=cl>Connection: keep-alive
</span></span><span class=line><span class=ln> 7</span><span class=cl>Content-Length: 924280
</span></span><span class=line><span class=ln> 8</span><span class=cl>Content-Type: text/plain; charset=UTF-8
</span></span><span class=line><span class=ln> 9</span><span class=cl>Date: Sat, 09 Nov 2019 07:06:15 GMT
</span></span><span class=line><span class=ln>10</span><span class=cl>Etag: &#34;acf0d284f3a8e82e0d66ba1a91cd30b9-ssl&#34;
</span></span><span class=line><span class=ln>11</span><span class=cl>Server: Netlify
</span></span><span class=line><span class=ln>12</span><span class=cl>Strict-Transport-Security: max-age=31536000
</span></span><span class=line><span class=ln>13</span><span class=cl>X-NF-Request-ID: 50b466cd-ce9e-4326-b5bb-0d29a193ae4b-7809449
</span></span></code></pre></div><p>第二步检查或下载每个 source，每个 source 会检查是否是 cdn 类型（使用 HEAD 请求检查是否包含 /all_pods.txt）文件：</p><ul><li>cdn 类型，下面详细解释</li><li>其他类型，走原来的老的逻辑，不再赘述</li></ul><p>第三步，下载 <code>Cocoapods-version.yml</code> 并缓存 etag，下载 <code>/Cocoapods-version.yml</code> 并取 headers 的第一个 etag 的值存为 <code>/Cocoapods-version.yml.etag</code>，如果存在 etag 会比对一样就不需要下载， 链接支持根目录和其他目录，支持 301 跳转。</p><p>Cocoapods-version.yml</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=ln>1</span><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=ln>2</span><span class=cl><span class=w></span><span class=nt>min</span><span class=p>:</span><span class=w> </span><span class=m>1.0.0</span><span class=w>
</span></span></span><span class=line><span class=ln>3</span><span class=cl><span class=w></span><span class=nt>last</span><span class=p>:</span><span class=w> </span><span class=m>1.8.4</span><span class=w>
</span></span></span><span class=line><span class=ln>4</span><span class=cl><span class=w></span><span class=nt>prefix_lengths</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=ln>5</span><span class=cl><span class=w></span>- <span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=ln>6</span><span class=cl><span class=w></span>- <span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=ln>7</span><span class=cl><span class=w></span>- <span class=m>1</span><span class=w>
</span></span></span></code></pre></div><p>第四步，分析 Pod 并获取 pod 的版本信息，比如 Podfile 我增加了一个 <code>pod "AFNetworking"</code>，把 pod 名字做 MD5 后的值取 Cocoapods-version.yml 的 prefiex_length 数组长度的值单字母拆分用下划线分割按照规则拼成文件名 <code>all_pods_versions(_{fragment}).txt</code> (如果prefix_length 为 0 则只会去下载 <code>/all_pods_versions.txt</code>)</p><p>比如：prefix_lengths 数组大小为 3，AFNetworking MD5 后 <code>a75d452377f396bdc4b623a5df25820</code> 则匹配前三位 a75 拆分后 a_7_5
后查找 cdn url 路径的 <code>/all_pods_versions_a_7_5.txt</code> 下载下来后的内容：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=ln>1</span><span class=cl>Fuse/0.1.0/0.2.0/1.0.0/1.1.0/1.2.0
</span></span><span class=line><span class=ln>2</span><span class=cl>GXFlowView/1.0.0
</span></span><span class=line><span class=ln>3</span><span class=cl>JFCountryPicker/0.0.1/0.0.2
</span></span><span class=line><span class=ln>4</span><span class=cl>JVEmptyElement/0.1.0
</span></span></code></pre></div><p>第五步，下载 pod 的所有版本的 .podspec 文件，从上面的文件按照每行寻找第一段的名字，把后面的所有版本按照上面获取到的 prefix_lengths 的值（例如 AFNetworking 是 a, 7 , 5） <code>/Specs/a/7/5/AFNetworking/{version}/AFNetworking.podspec.json</code> 一次下载，并保存 etag 为 <code>/Specs/a/7/5/AFNetworking/{version}/AFNetworking.podspec.json.etag</code>，这个 etag 作用上面已经讲过，如果没有找到的话就会直接报错。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=ln>1</span><span class=cl>Adding spec repo `trunk` with CDN `https://cdn.cocoapods.org/`
</span></span><span class=line><span class=ln>2</span><span class=cl>  CDN: trunk Relative path downloaded: CocoaPods-version.yml, save ETag: &#34;031c25b97a0aca21900087e355dcf663-ssl&#34;
</span></span><span class=line><span class=ln>3</span><span class=cl>  CDN: trunk Relative path: CocoaPods-version.yml exists! Returning local because checking is only perfomed in repo update
</span></span><span class=line><span class=ln>4</span><span class=cl>  CDN: trunk Relative path downloaded: all_pods_versions_a_7_5.txt, save ETag: &#34;5b32718ecbe82b0ae71ab3c77120213f-ssl&#34;
</span></span><span class=line><span class=ln>5</span><span class=cl>  CDN: trunk Redirecting from https://cdn.cocoapods.org/Specs/a/7/5/AFNetworking/0.10.0/AFNetworking.podspec.json to https://raw.githubusercontent.com/CocoaPods/Specs/master/Specs/a/7/5/AFNetworking/0.10.0/AFNetworking.podspec.json
</span></span><span class=line><span class=ln>6</span><span class=cl>  CDN: trunk Relative path downloaded: Specs/a/7/5/AFNetworking/0.10.0/AFNetworking.podspec.json, save ETag: W/&#34;a5f00eb1fdfdcab00b89e96bb81d48c110f09220063fdcf0b269290bffc18cf5&#34;
</span></span></code></pre></div><p>Cocoapods trunk 源的目录结构：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=ln>1</span><span class=cl>.cocoapods
</span></span><span class=line><span class=ln>2</span><span class=cl>  repo
</span></span><span class=line><span class=ln>3</span><span class=cl>    trunk
</span></span><span class=line><span class=ln>4</span><span class=cl>      .url   #=&gt; https://cdn.cocoapods.org/
</span></span><span class=line><span class=ln>5</span><span class=cl>      Cocoapods-version.yml  # =&gt; 从 https://cdn.cocoapods.org/CocoaPods-version.yml 下载的文件
</span></span><span class=line><span class=ln>6</span><span class=cl>      Cocoapods-version.yml.etag  # 上一个请求的第一个 etag 值存下来
</span></span><span class=line><span class=ln>7</span><span class=cl>      all_pods_versions_a_7_5.txt  # 参考上面的备注
</span></span><span class=line><span class=ln>8</span><span class=cl>      all_pods_versions_a_7_5.txt.etag # 上一个请求的第一个 etag 值存下来
</span></span></code></pre></div><p>第六步和老的机制第二步一样同样最终还是会寻找 podspec 里面下载地址去下载，
也就是说<strong>真正 CDN 缓存加速的只有原有 Specs 必要的 podspec 文件，而不会加速 Pod 真正源地址</strong>，改机制只是减轻了本地更新官方 Specs 源的麻烦以及维护一个巨大的本地文件存储，这也是中心化机制的一个心结。</p><h3 id=结语>结语</h3><p>这个机制大大减少了本地需要占一个较大存储的问题，尤其是初次 <code>pod install</code> 时间长的情况，但 Pod 库本身还是各自的
地址本质上无法解决安装 Pod 消耗时间过长的问题。</p></div></div><div class=post-nav><a href=https://icyleaf.com/2019/05/create-macos-nswindow-without-storyboard/ class=prev rel=prev title="创建无 Storyboard（xib） 的 macOS NSWindow"><i class="iconfont icon-left"></i>&nbsp;创建无 Storyboard（xib） 的 macOS NSWindow</a>
<a href=https://icyleaf.com/2021/12/intro-zealot/ class=next rel=next title=Zealot>Zealot&nbsp;<i class="iconfont icon-right"></i></a></div><div class=post-comment><script>var getTheme=window.localStorage&&window.localStorage.getItem("blog-dark-mode"),getTheme=getTheme??"github-light";let theme=getTheme==="dark"?"github-dark":"github-light",s=document.createElement("script");s.src="https://utteranc.es/client.js",s.setAttribute("repo","icyleaf/icyleaf.com"),s.setAttribute("issue-term","pathname"),s.setAttribute("theme",theme),s.setAttribute("crossorigin","anonymous"),s.setAttribute("async",""),document.querySelector("div.post-comment").innerHTML="",document.querySelector("div.post-comment").appendChild(s)</script></div></article></div></main><footer class=footer><div class=copyright>&copy;
<span itemprop=copyrightYear>2005 - 2023</span>
<span>🍺</span>
<span class=author itemprop=copyrightHolder><a href=https://icyleaf.com/>icyleaf</a></span></div></footer><script defer src=https://fastly.jsdelivr.net/npm/jquery@3.6.4/dist/jquery.min.js crossorigin=anonymous></script><script defer src=https://icyleaf.com/js/vendor_main.min.js></script>
<script type=module>
  
  import PhotoSwipeLightbox from '\/photoswipe\/photoswipe-lightbox.esm.js';

  const lightbox = new PhotoSwipeLightbox({
    gallery: '#post-gallery',
    children: 'a.gallery-item',
    pswpModule: () => import('\/photoswipe\/photoswipe.esm.js'),
  });
  lightbox.init();
</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-TKQBZ7R259"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-TKQBZ7R259")</script></div></body></html>