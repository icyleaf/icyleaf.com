<!doctype html><html lang=zh dir=auto></html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>创建无 Storyboard（xib） 的 macOS NSWindow | icyleaf</title><meta name=keywords content="macOS"><meta name=description content="macOS 开发和 iOS 差异真的很大"><meta name=author content="icyleaf"><link rel=canonical href=https://icyleaf.com/2019/05/create-macos-nswindow-without-storyboard/><link rel=icon href=https://icyleaf.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://icyleaf.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://icyleaf.com/favicon-32x32.png><link rel=icon type=image/png sizes=192x192 href=https://icyleaf.com/android-chrome-192x192.png><link rel=icon type=image/png sizes=512x512 href=https://icyleaf.com/android-chrome-512x512.png><link rel=apple-touch-icon href=https://icyleaf.com/apple-touch-icon.png><link rel=mask-icon href=https://icyleaf.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=stylesheet href=https://icyleaf.com/css/main.min.css><link rel=stylesheet href=https://icyleaf.com/font/iconfont.min.css><link rel=stylesheet href=https://icyleaf.com/font-ali/iconfont.min.css><link rel=stylesheet href=https://icyleaf.com/photoswipe/photoswipe.min.css><link rel=canonical href=https://icyleaf.com/2019/05/create-macos-nswindow-without-storyboard/><meta property="og:title" content="创建无 Storyboard（xib） 的 macOS NSWindow"><meta property="og:description" content="macOS 开发和 iOS 差异真的很大"><meta property="og:type" content="article"><meta property="og:url" content="https://icyleaf.com/2019/05/create-macos-nswindow-without-storyboard/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-05-23T22:45:07+08:00"><meta property="article:modified_time" content="2019-05-23T22:45:07+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="创建无 Storyboard（xib） 的 macOS NSWindow"><meta name=twitter:description content="macOS 开发和 iOS 差异真的很大"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://icyleaf.com/posts/"},{"@type":"ListItem","position":2,"name":"创建无 Storyboard（xib） 的 macOS NSWindow","item":"https://icyleaf.com/2019/05/create-macos-nswindow-without-storyboard/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"创建无 Storyboard（xib） 的 macOS NSWindow","name":"创建无 Storyboard（xib） 的 macOS NSWindow","description":"macOS 开发和 iOS 差异真的很大","keywords":["macOS"],"articleBody":"前言 历届 WWDC 众多和 macOS 开发相关的视频中只要涉及到 UI 部分必会牵扯上 Storyboard，它能帮你辅助画 UI，使用 Auto Layout 进行布局，甚至你可以不用写一行代码仅仅使用它和 Core Data 就能完成一个 CURD 的功能。苹果总是极力的推荐所有的开发者（尤其是初学者）使用 Storyboard，它给人最直观的感受，配置参数也都做了调教（有时候开启一个参数需要手敲好多行代码）。\n但总有那么一群人就是不爱使用 Storyboard（比如我），尤其 App 涉及比较多的界面和交互的时候感觉还是代码更可控，团队开发在代码仓库管理上也更为方便。\n何奈在网络上存在的绝大多数的教程和视频都是以 Storyboard 为主，稍不留神可能就忘记设置了哪里，再或者过段时间举一反三的时候总会忘记在 Storyboard 设置了什么而无法实现同样的效果。\n恰好我最近比较闲花了点时间在写 macOS App，过程中体会到了 macOS 和 iOS 两个体系存在了巨大的差异，可能是习惯了 iOS 框架的编码方式就感觉到 macOS 格格不入，想要完成一个在 iOS 上简单的界面但 macOS 上就要想尽各种办法来去实现，迫切期待在马上来临的 WWDC 2019 上宣布新的解决方案。\n开始教学 打开 Xcode 选择 macOS 下面的 Cocoa App 进行下一步，填写好项目名称后勾不勾选 Use Storyboard 都没有关系，勾选就会创建一个 Main.storyboard 的文件，不勾选也会创建一个 MainMenu.xib 的文件，选择项目保存的路径就创建好第一个项目了。\n无论默认的是 Main.storyboard 或 MainMenu.xib 都会一个 Main Menu 控件这里咱们先不管它，除此之外还会有一个 Window 控件，一个 macOS App 基础的层级关系是这样的\n1+--------------------------------------------------------------+ 2| NSWindow | 3| +--------------------------------------------------------+ | 4| | NSViewController | | 5| | +--------------------------------------------------+ | | 6| | | NSView | | | 7| | +--------------------------------------------------+ | | 8| +--------------------------------------------------------+ | 9+--------------------------------------------------------------+ 选中 Window 控件后后选择删除（Main.storyboard 还需要再删除默认生成的 ViewController 控件），删除后样子是这样的\n由于我们删除了默认的 NSWindow 因此需要在 Appdelegate.swift 文件创建一个：\n1import Cocoa 2 3@NSApplicationMain 4class AppDelegate: NSObject, NSApplicationDelegate { 5 6 // 创建默认的 Window 7 lazy var window: NSWindow = { 8 let w = NSWindow(contentRect: NSMakeRect(0, 0, 640, 480), 9 styleMask: [.titled, .resizable, .miniaturizable, .closable, .fullSizeContentView], 10 backing: .buffered, 11 defer: false) 12 13 // 设置最小尺寸 14 w.minSize = NSMakeSize(320, 240) 15 16 // 打开显示在屏幕的中心位置 17 w.center() 18 19 return w 20 }() 21} 默认的 window 设置好了，我们让他赶紧显示出来吧，在 applicationDidFinishLaunching 方法添加如下代码:\n1func applicationDidFinishLaunching(_ aNotification: Notification) { 2 // 设置为 mainWindow 这样我们才能通过下面的代码调用 3 window.makeKeyAndOrderFront(nil) 4 5 // 设置 mainWindow 的标题 6 NSApplication.shared.mainWindow?.title = \"Hello world\" 7} 注意看上面代码块的备注，这两行代码不能颠倒，否则 NSApplication.shared.mainWindow 返回的是 nil，我们来运行一下看看，是不是就能看到一个 640x480 的窗口，标题显示的 hello world\n用鼠标拖拽缩放大小看看是不是到一个保留尺寸就无法再缩小了，这个就是通过代码设置的最小尺寸。虽然 App 可以运行了内容还是空空的，根据上面画出来的层级关系还需要一个 NSViewController 充当 contentViewController，它相当于 iOS 的 rootViewController 这样说应该就很容易理解了吧。\n假设 App 需要完成这样一个功能，界面有一个 Label 和 Button，点击 Button 可以改变 Label 的文字内容：\n1+----------------------+ +----------------------+ 2| | | | 3| Click the button | | Yeah! | 4| | | | 5| +------------------+ | -------\u003e | +------------------+ | 6| | Click me | | | | Click me | | 7| +------------------+ | | +------------------+ | 8| | | | 9+----------------------+ +----------------------+ 我们用原生 Auto Layout 布局后的代码是这样的\n1import Cocoa 2 3class ViewController: NSViewController { 4 5 lazy var label: NSTextField = { 6 let v = NSTextField(labelWithString: \"Press the button\") 7 v.translatesAutoresizingMaskIntoConstraints = false 8 9 return v 10 }() 11 12 13 lazy var button: NSButton = { 14 let v = NSButton(frame: .zero) 15 v.translatesAutoresizingMaskIntoConstraints = false 16 17 return v 18 }() 19 20 override func viewDidLoad() { 21 super.viewDidLoad() 22 23 view.addSubview(label) 24 view.addSubview(button) 25 26 NSLayoutConstraint.activate([ 27 label.centerXAnchor.constraint(equalTo: view.centerXAnchor), 28 label.centerYAnchor.constraint(equalTo: view.centerYAnchor, constant: -20), 29 30 button.centerXAnchor.constraint(equalTo: view.centerXAnchor), 31 button.topAnchor.constraint(equalTo: label.bottomAnchor, constant: 20), 32 button.heightAnchor.constraint(equalToConstant: 30), 33 button.widthAnchor.constraint(equalToConstant: 100) 34 ]) 35 36 button.title = \"Click me\" 37 button.target = self 38 button.action = #selector(onClickme) 39 } 40 41 @objc func onClickme(_ sender: NSButton) { 42 label.textColor = .red 43 label.stringValue = \"Yeah!\" 44 } 45} 代码看着不错的样子，还差最后一步把 ViewController 添加到 NSWindow 里吧，返回 AppDelegate.swift 文件找到上次编辑的 applicationDidFinishLaunching 方法里面在代码的末尾添加最后的代码：\n1func applicationDidFinishLaunching(_ aNotification: Notification) { 2 // 设置为 mainWindow 这样我们才能通过下面的代码调用 3 window.makeKeyAndOrderFront(nil) 4 5 // 设置 mainWindow 的标题 6 NSApplication.shared.mainWindow?.title = \"Hello world\" 7 8 // 设置 contentViewController 9 let contentViewController = ViewController() // or ViewController(nibName:nil, bundle: nil) 10 window.contentViewController = contentViewController 11} 咦？！你这不对啊，NSViewController 代码在初始化的时候是不能这样的，必须通过 init(coder:) 或 init(nibName:bundle:) 这两种方法才行，这样写运行会提示 “could not load the nibName: WithoutStoryboard.ViewController in bundle (null).” 错误的！\n观察的不错嘛，这点小细节都你发现了，NSViewController 类通常都是通过 init(nibName:bundle:) 进行初始化来关联 xib 界面，既然我们抛弃了 Storyboard（xib) 那怎么办呢，这里理解 NSViewController 的生命周期 （macOS 10.10 之后版本)\n1+----------------------------------+ +------------------------------+ 2| init +--\u003e+ loadView() | 3+-----------------+----------------+ +---------------+--------------+ 4| Storyboard(xib) | code | | 5+----------------------------------+ v 6| init(coder:) | init(nibName: | +---------------+--------------+ 7| | bundle:) | | viewDidLoad() | 8+-----------------+----------------+ +---------------+--------------+ 9 | 10 v 11+----------------------------------+ +---------------+--------------+ 12| viewWillDisappear() +\u003c--+ viewWillAppear() | 13+-----------------+----------------+ +------------------------------+ 14 | | updateViewConstraints() | 15 | | | 16 v | viewWillLayout() | 17+-----------------+----------------+ | | 18| viewDidDisappear() | | viewDidLayout() | 19+----------------------------------+ +------------------------------+ 生命周期和 iOS 的 UIViewController 也差不多，从上面的生命周期来看只能覆写 loadView 方法才行：\n1class ViewController: NSViewController { 2 3 override func loadView() { 4 // 设置 ViewController 大小同 mainWindow 5 guard let windowRect = NSApplication.shared.mainWindow?.frame else { return } 6 view = NSView(frame: windowRect) 7 } 8 9} 看了上面代码也就明白了为什么在 AppDelegate.swift 设置 contentViewController 需要在代码块的末尾添加了吧，如果在最开始添加那就无法获取到 mainWindow 也就无法设置 ViewController 的 frame。这里还有个小提醒 macOS 10.10 之后版本在覆写该方法如果调用了 super.loadView() 方法就会自动加载同名的 xib 文件绝对不能填写。\n让我们在运行一次看看？\nTa-Da! 完成了！\n结语 这算是一个开篇，后续还会再继续整理，尽请期待。\n","wordCount":"1872","inLanguage":"zh","datePublished":"2019-05-23T22:45:07+08:00","dateModified":"2019-05-23T22:45:07+08:00","author":{"@type":"Person","name":"icyleaf"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://icyleaf.com/2019/05/create-macos-nswindow-without-storyboard/"},"publisher":{"@type":"Organization","name":"icyleaf","logo":{"@type":"ImageObject","url":"https://icyleaf.com/favicon.ico"}}}</script></head><body><div class=wrapper><nav class=navbar><progress class=content_progress max=0 value=0></progress><div class=container><div class="navbar-header header-logo"><a href=https://icyleaf.com/>icyleaf</a></div><div class=navbar-right><span class=menu><a class=menu-item href=https://icyleaf.com/about title>About</a>
<a class=menu-item href=https://icyleaf.com/projects title>Projects</a>
<a class=menu-item href=https://icyleaf.com/index.xml title>Feed</a>
<span class=divide></span>
<a href=javascript:void(0); class=theme-switch><i class="iconfont icon-dark-mode"></i></a></span></div></div></nav><nav class=navbar-mobile id=nav-mobile style=display:none><progress class=content_progress max=0 value=0></progress><div class=container><div class=navbar><div class="navbar-header header-logo"><a href=https://icyleaf.com/>icyleaf</a></div><div class=navbar-right><div><a href=javascript:void(0); class=theme-switch><i class="iconfont icon-dark-mode"></i></a></div><div class=menu-toggle><span></span><span></span><span></span></div></div></div><div class=menu id=mobile-menu><nav class=mb-md><a class=menu-item href=https://icyleaf.com/about title><h3>About</h3><div class=menu-active></div></a><a class=menu-item href=https://icyleaf.com/projects title><h3>Projects</h3><div class=menu-active></div></a><a class=menu-item href=https://icyleaf.com/index.xml title><h3>Feed</h3><div class=menu-active></div></a></nav></div></div></nav><main class=main><div class=container><article class=post-warp itemscope itemtype=http://schema.org/Article><header class=post-header><h1 class=post-title itemprop=description>创建无 Storyboard（xib） 的 macOS NSWindow</h1><div class=post-description>macOS 开发和 iOS 差异真的很大</div><div class=post-meta><time datetime=2019-05-23 itemprop=datePublished>2019-05-23</time>
·
<span class=tags>macOS</span>
·
<span class=post-word-count>1872 words · 8 minutes</span></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>目录</h2><div class="post-toc-content always-active"><nav id=TableOfContents><ul><li><ul><li><a href=#前言>前言</a></li><li><a href=#开始教学>开始教学</a></li><li><a href=#结语>结语</a></li></ul></li></ul></nav></div></div><div class=post-content><div id=post-gallery><h3 id=前言>前言</h3><p>历届 WWDC 众多和 macOS 开发相关的视频中只要涉及到 UI 部分必会牵扯上 Storyboard，它能帮你辅助画 UI，使用 Auto Layout 进行布局，甚至你可以不用写一行代码仅仅使用它和 Core Data 就能完成一个 CURD 的功能。苹果总是极力的推荐所有的开发者（尤其是初学者）使用 Storyboard，它给人最直观的感受，配置参数也都做了调教（有时候开启一个参数需要手敲好多行代码）。</p><p>但总有那么一群人就是不爱使用 Storyboard（比如我），尤其 App 涉及比较多的界面和交互的时候感觉还是代码更可控，团队开发在代码仓库管理上也更为方便。</p><p>何奈在网络上存在的绝大多数的教程和视频都是以 Storyboard 为主，稍不留神可能就忘记设置了哪里，再或者过段时间举一反三的时候总会忘记在 Storyboard 设置了什么而无法实现同样的效果。</p><p>恰好我最近比较闲花了点时间在写 macOS App，过程中体会到了 macOS 和 iOS 两个体系存在了巨大的差异，可能是习惯了 iOS 框架的编码方式就感觉到 macOS 格格不入，想要完成一个在 iOS 上简单的界面但 macOS 上就要想尽各种办法来去实现，迫切期待在马上来临的 WWDC 2019 上宣布新的解决方案。</p><h3 id=开始教学>开始教学</h3><p>打开 Xcode 选择 macOS 下面的 Cocoa App 进行下一步，填写好项目名称后勾不勾选 <strong>Use Storyboard</strong> 都没有关系，勾选就会创建一个 <code>Main.storyboard</code> 的文件，不勾选也会创建一个 <code>MainMenu.xib</code> 的文件，选择项目保存的路径就创建好第一个项目了。</p><p>无论默认的是 <code>Main.storyboard</code> 或 <code>MainMenu.xib</code> 都会一个 Main Menu 控件这里咱们先不管它，除此之外还会有一个 Window 控件，一个 macOS App 基础的层级关系是这样的</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=ln>1</span><span class=cl>+--------------------------------------------------------------+
</span></span><span class=line><span class=ln>2</span><span class=cl>|                           NSWindow                           |
</span></span><span class=line><span class=ln>3</span><span class=cl>|  +--------------------------------------------------------+  |
</span></span><span class=line><span class=ln>4</span><span class=cl>|  |                    NSViewController                    |  |
</span></span><span class=line><span class=ln>5</span><span class=cl>|  |  +--------------------------------------------------+  |  |
</span></span><span class=line><span class=ln>6</span><span class=cl>|  |  |                      NSView                      |  |  |
</span></span><span class=line><span class=ln>7</span><span class=cl>|  |  +--------------------------------------------------+  |  |
</span></span><span class=line><span class=ln>8</span><span class=cl>|  +--------------------------------------------------------+  |
</span></span><span class=line><span class=ln>9</span><span class=cl>+--------------------------------------------------------------+
</span></span></code></pre></div><p>选中 Window 控件后后选择删除（<code>Main.storyboard</code> 还需要再删除默认生成的 ViewController 控件），删除后样子是这样的</p><p><img loading=lazy src=https://icyleaf.com/tutorials/macos-app-without-storyboard/001/shot001-xcode-storyboard.png alt="Storyboard and xib in Xcode"></img></p><p>由于我们删除了默认的 NSWindow 因此需要在 <code>Appdelegate.swift</code> 文件创建一个：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-swift data-lang=swift><span class=line><span class=ln> 1</span><span class=cl><span class=kd>import</span> <span class=nc>Cocoa</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=kr>@NSApplicationMain</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=kd>class</span> <span class=nc>AppDelegate</span><span class=p>:</span> <span class=n>NSObject</span><span class=p>,</span> <span class=n>NSApplicationDelegate</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>
</span></span><span class=line><span class=ln> 6</span><span class=cl>    <span class=c1>// 创建默认的 Window</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>    <span class=kr>lazy</span> <span class=kd>var</span> <span class=nv>window</span><span class=p>:</span> <span class=n>NSWindow</span> <span class=p>=</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>       <span class=kd>let</span> <span class=nv>w</span> <span class=p>=</span> <span class=n>NSWindow</span><span class=p>(</span><span class=n>contentRect</span><span class=p>:</span> <span class=n>NSMakeRect</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>640</span><span class=p>,</span> <span class=mi>480</span><span class=p>),</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>                        <span class=n>styleMask</span><span class=p>:</span> <span class=p>[.</span><span class=n>titled</span><span class=p>,</span> <span class=p>.</span><span class=n>resizable</span><span class=p>,</span> <span class=p>.</span><span class=n>miniaturizable</span><span class=p>,</span> <span class=p>.</span><span class=n>closable</span><span class=p>,</span> <span class=p>.</span><span class=n>fullSizeContentView</span><span class=p>],</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>                        <span class=n>backing</span><span class=p>:</span> <span class=p>.</span><span class=n>buffered</span><span class=p>,</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>                        <span class=k>defer</span><span class=p>:</span> <span class=kc>false</span><span class=p>)</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>
</span></span><span class=line><span class=ln>13</span><span class=cl>        <span class=c1>// 设置最小尺寸</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>        <span class=n>w</span><span class=p>.</span><span class=n>minSize</span> <span class=p>=</span> <span class=n>NSMakeSize</span><span class=p>(</span><span class=mi>320</span><span class=p>,</span> <span class=mi>240</span><span class=p>)</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>
</span></span><span class=line><span class=ln>16</span><span class=cl>        <span class=c1>// 打开显示在屏幕的中心位置</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>        <span class=n>w</span><span class=p>.</span><span class=n>center</span><span class=p>()</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>
</span></span><span class=line><span class=ln>19</span><span class=cl>        <span class=k>return</span> <span class=n>w</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>    <span class=p>}()</span>
</span></span><span class=line><span class=ln>21</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>默认的 window 设置好了，我们让他赶紧显示出来吧，在 <code>applicationDidFinishLaunching</code> 方法添加如下代码:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-swift data-lang=swift><span class=line><span class=ln>1</span><span class=cl><span class=kd>func</span> <span class=nf>applicationDidFinishLaunching</span><span class=p>(</span><span class=kc>_</span> <span class=n>aNotification</span><span class=p>:</span> <span class=n>Notification</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>    <span class=c1>// 设置为 mainWindow 这样我们才能通过下面的代码调用</span>
</span></span><span class=line><span class=ln>3</span><span class=cl>    <span class=n>window</span><span class=p>.</span><span class=n>makeKeyAndOrderFront</span><span class=p>(</span><span class=kc>nil</span><span class=p>)</span>
</span></span><span class=line><span class=ln>4</span><span class=cl>
</span></span><span class=line><span class=ln>5</span><span class=cl>    <span class=c1>// 设置 mainWindow 的标题</span>
</span></span><span class=line><span class=ln>6</span><span class=cl>    <span class=n>NSApplication</span><span class=p>.</span><span class=n>shared</span><span class=p>.</span><span class=n>mainWindow</span><span class=p>?.</span><span class=n>title</span> <span class=p>=</span> <span class=s>&#34;Hello world&#34;</span>
</span></span><span class=line><span class=ln>7</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>注意看上面代码块的备注，这两行代码不能颠倒，否则 <code>NSApplication.shared.mainWindow</code> 返回的是 <code>nil</code>，我们来运行一下看看，是不是就能看到一个 640x480 的窗口，标题显示的 hello world</p><p><img loading=lazy src=https://icyleaf.com/tutorials/macos-app-without-storyboard/001/shot002-nswindow.png alt="NSWindow App"></img></p><p>用鼠标拖拽缩放大小看看是不是到一个保留尺寸就无法再缩小了，这个就是通过代码设置的最小尺寸。虽然 App 可以运行了内容还是空空的，根据上面画出来的层级关系还需要一个 NSViewController 充当 contentViewController，它相当于 iOS 的 rootViewController 这样说应该就很容易理解了吧。</p><p>假设 App 需要完成这样一个功能，界面有一个 Label 和 Button，点击 Button 可以改变 Label 的文字内容：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=ln>1</span><span class=cl>+----------------------+          +----------------------+
</span></span><span class=line><span class=ln>2</span><span class=cl>|                      |          |                      |
</span></span><span class=line><span class=ln>3</span><span class=cl>|   Click the button   |          |         Yeah!        |
</span></span><span class=line><span class=ln>4</span><span class=cl>|                      |          |                      |
</span></span><span class=line><span class=ln>5</span><span class=cl>| +------------------+ | -------&gt; | +------------------+ |
</span></span><span class=line><span class=ln>6</span><span class=cl>| |     Click me     | |          | |     Click me     | |
</span></span><span class=line><span class=ln>7</span><span class=cl>| +------------------+ |          | +------------------+ |
</span></span><span class=line><span class=ln>8</span><span class=cl>|                      |          |                      |
</span></span><span class=line><span class=ln>9</span><span class=cl>+----------------------+          +----------------------+
</span></span></code></pre></div><p>我们用原生 Auto Layout 布局后的代码是这样的</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-swift data-lang=swift><span class=line><span class=ln> 1</span><span class=cl><span class=kd>import</span> <span class=nc>Cocoa</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=kd>class</span> <span class=nc>ViewController</span><span class=p>:</span> <span class=n>NSViewController</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>
</span></span><span class=line><span class=ln> 5</span><span class=cl>    <span class=kr>lazy</span> <span class=kd>var</span> <span class=nv>label</span><span class=p>:</span> <span class=n>NSTextField</span> <span class=p>=</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>        <span class=kd>let</span> <span class=nv>v</span> <span class=p>=</span> <span class=n>NSTextField</span><span class=p>(</span><span class=n>labelWithString</span><span class=p>:</span> <span class=s>&#34;Press the button&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>        <span class=n>v</span><span class=p>.</span><span class=n>translatesAutoresizingMaskIntoConstraints</span> <span class=p>=</span> <span class=kc>false</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>
</span></span><span class=line><span class=ln> 9</span><span class=cl>        <span class=k>return</span> <span class=n>v</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>    <span class=p>}()</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>
</span></span><span class=line><span class=ln>12</span><span class=cl>
</span></span><span class=line><span class=ln>13</span><span class=cl>    <span class=kr>lazy</span> <span class=kd>var</span> <span class=nv>button</span><span class=p>:</span> <span class=n>NSButton</span> <span class=p>=</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>        <span class=kd>let</span> <span class=nv>v</span> <span class=p>=</span> <span class=n>NSButton</span><span class=p>(</span><span class=n>frame</span><span class=p>:</span> <span class=p>.</span><span class=n>zero</span><span class=p>)</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>        <span class=n>v</span><span class=p>.</span><span class=n>translatesAutoresizingMaskIntoConstraints</span> <span class=p>=</span> <span class=kc>false</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>
</span></span><span class=line><span class=ln>17</span><span class=cl>        <span class=k>return</span> <span class=n>v</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>    <span class=p>}()</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>
</span></span><span class=line><span class=ln>20</span><span class=cl>    <span class=kr>override</span> <span class=kd>func</span> <span class=nf>viewDidLoad</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>        <span class=kc>super</span><span class=p>.</span><span class=n>viewDidLoad</span><span class=p>()</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>
</span></span><span class=line><span class=ln>23</span><span class=cl>        <span class=n>view</span><span class=p>.</span><span class=n>addSubview</span><span class=p>(</span><span class=n>label</span><span class=p>)</span>
</span></span><span class=line><span class=ln>24</span><span class=cl>        <span class=n>view</span><span class=p>.</span><span class=n>addSubview</span><span class=p>(</span><span class=n>button</span><span class=p>)</span>
</span></span><span class=line><span class=ln>25</span><span class=cl>
</span></span><span class=line><span class=ln>26</span><span class=cl>        <span class=n>NSLayoutConstraint</span><span class=p>.</span><span class=n>activate</span><span class=p>([</span>
</span></span><span class=line><span class=ln>27</span><span class=cl>            <span class=n>label</span><span class=p>.</span><span class=n>centerXAnchor</span><span class=p>.</span><span class=n>constraint</span><span class=p>(</span><span class=n>equalTo</span><span class=p>:</span> <span class=n>view</span><span class=p>.</span><span class=n>centerXAnchor</span><span class=p>),</span>
</span></span><span class=line><span class=ln>28</span><span class=cl>            <span class=n>label</span><span class=p>.</span><span class=n>centerYAnchor</span><span class=p>.</span><span class=n>constraint</span><span class=p>(</span><span class=n>equalTo</span><span class=p>:</span> <span class=n>view</span><span class=p>.</span><span class=n>centerYAnchor</span><span class=p>,</span> <span class=n>constant</span><span class=p>:</span> <span class=o>-</span><span class=mi>20</span><span class=p>),</span>
</span></span><span class=line><span class=ln>29</span><span class=cl>
</span></span><span class=line><span class=ln>30</span><span class=cl>            <span class=n>button</span><span class=p>.</span><span class=n>centerXAnchor</span><span class=p>.</span><span class=n>constraint</span><span class=p>(</span><span class=n>equalTo</span><span class=p>:</span> <span class=n>view</span><span class=p>.</span><span class=n>centerXAnchor</span><span class=p>),</span>
</span></span><span class=line><span class=ln>31</span><span class=cl>            <span class=n>button</span><span class=p>.</span><span class=n>topAnchor</span><span class=p>.</span><span class=n>constraint</span><span class=p>(</span><span class=n>equalTo</span><span class=p>:</span> <span class=n>label</span><span class=p>.</span><span class=n>bottomAnchor</span><span class=p>,</span> <span class=n>constant</span><span class=p>:</span> <span class=mi>20</span><span class=p>),</span>
</span></span><span class=line><span class=ln>32</span><span class=cl>            <span class=n>button</span><span class=p>.</span><span class=n>heightAnchor</span><span class=p>.</span><span class=n>constraint</span><span class=p>(</span><span class=n>equalToConstant</span><span class=p>:</span> <span class=mi>30</span><span class=p>),</span>
</span></span><span class=line><span class=ln>33</span><span class=cl>            <span class=n>button</span><span class=p>.</span><span class=n>widthAnchor</span><span class=p>.</span><span class=n>constraint</span><span class=p>(</span><span class=n>equalToConstant</span><span class=p>:</span> <span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=ln>34</span><span class=cl>            <span class=p>])</span>
</span></span><span class=line><span class=ln>35</span><span class=cl>
</span></span><span class=line><span class=ln>36</span><span class=cl>        <span class=n>button</span><span class=p>.</span><span class=n>title</span> <span class=p>=</span> <span class=s>&#34;Click me&#34;</span>
</span></span><span class=line><span class=ln>37</span><span class=cl>        <span class=n>button</span><span class=p>.</span><span class=n>target</span> <span class=p>=</span> <span class=kc>self</span>
</span></span><span class=line><span class=ln>38</span><span class=cl>        <span class=n>button</span><span class=p>.</span><span class=n>action</span> <span class=p>=</span> <span class=k>#selector</span><span class=p>(</span><span class=n>onClickme</span><span class=p>)</span>
</span></span><span class=line><span class=ln>39</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln>40</span><span class=cl>
</span></span><span class=line><span class=ln>41</span><span class=cl>    <span class=kr>@objc</span> <span class=kd>func</span> <span class=nf>onClickme</span><span class=p>(</span><span class=kc>_</span> <span class=n>sender</span><span class=p>:</span> <span class=n>NSButton</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>42</span><span class=cl>        <span class=n>label</span><span class=p>.</span><span class=n>textColor</span> <span class=p>=</span> <span class=p>.</span><span class=n>red</span>
</span></span><span class=line><span class=ln>43</span><span class=cl>        <span class=n>label</span><span class=p>.</span><span class=n>stringValue</span> <span class=p>=</span> <span class=s>&#34;Yeah!&#34;</span>
</span></span><span class=line><span class=ln>44</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln>45</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>代码看着不错的样子，还差最后一步把 ViewController 添加到 NSWindow 里吧，返回 <code>AppDelegate.swift</code> 文件找到上次编辑的 <code>applicationDidFinishLaunching</code> 方法里面在代码的末尾添加最后的代码：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-swift data-lang=swift><span class=line><span class=ln> 1</span><span class=cl><span class=kd>func</span> <span class=nf>applicationDidFinishLaunching</span><span class=p>(</span><span class=kc>_</span> <span class=n>aNotification</span><span class=p>:</span> <span class=n>Notification</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>    <span class=c1>// 设置为 mainWindow 这样我们才能通过下面的代码调用</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>    <span class=n>window</span><span class=p>.</span><span class=n>makeKeyAndOrderFront</span><span class=p>(</span><span class=kc>nil</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>
</span></span><span class=line><span class=ln> 5</span><span class=cl>    <span class=c1>// 设置 mainWindow 的标题</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>    <span class=n>NSApplication</span><span class=p>.</span><span class=n>shared</span><span class=p>.</span><span class=n>mainWindow</span><span class=p>?.</span><span class=n>title</span> <span class=p>=</span> <span class=s>&#34;Hello world&#34;</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>
</span></span><span class=line><span class=ln> 8</span><span class=cl>    <span class=c1>// 设置 contentViewController</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>    <span class=kd>let</span> <span class=nv>contentViewController</span> <span class=p>=</span> <span class=n>ViewController</span><span class=p>()</span> <span class=c1>// or ViewController(nibName:nil, bundle: nil)</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>    <span class=n>window</span><span class=p>.</span><span class=n>contentViewController</span> <span class=p>=</span> <span class=n>contentViewController</span>
</span></span><span class=line><span class=ln>11</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><blockquote><p>咦？！你这不对啊，<code>NSViewController</code> 代码在初始化的时候是不能这样的，必须通过 <code>init(coder:)</code> 或 <code>init(nibName:bundle:)</code> 这两种方法才行，这样写运行会提示 &ldquo;could not load the nibName: WithoutStoryboard.ViewController in bundle (null).&rdquo; 错误的！</p></blockquote><p>观察的不错嘛，这点小细节都你发现了，NSViewController 类通常都是通过 <code>init(nibName:bundle:)</code> 进行初始化来关联 xib 界面，既然我们抛弃了 Storyboard（xib) 那怎么办呢，这里理解 NSViewController 的<a href=https://developer.apple.com/documentation/appkit/nsviewcontroller>生命周期</a> （macOS 10.10 之后版本)</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=ln> 1</span><span class=cl>+----------------------------------+   +------------------------------+
</span></span><span class=line><span class=ln> 2</span><span class=cl>|               init               +--&gt;+           loadView()         |
</span></span><span class=line><span class=ln> 3</span><span class=cl>+-----------------+----------------+   +---------------+--------------+
</span></span><span class=line><span class=ln> 4</span><span class=cl>| Storyboard(xib) |      code      |                   |
</span></span><span class=line><span class=ln> 5</span><span class=cl>+----------------------------------+                   v
</span></span><span class=line><span class=ln> 6</span><span class=cl>|  init(coder:)   | init(nibName:  |   +---------------+--------------+
</span></span><span class=line><span class=ln> 7</span><span class=cl>|                 |      bundle:)  |   |          viewDidLoad()       |
</span></span><span class=line><span class=ln> 8</span><span class=cl>+-----------------+----------------+   +---------------+--------------+
</span></span><span class=line><span class=ln> 9</span><span class=cl>                                                       |
</span></span><span class=line><span class=ln>10</span><span class=cl>                                                       v
</span></span><span class=line><span class=ln>11</span><span class=cl>+----------------------------------+   +---------------+--------------+
</span></span><span class=line><span class=ln>12</span><span class=cl>|        viewWillDisappear()       +&lt;--+         viewWillAppear()     |
</span></span><span class=line><span class=ln>13</span><span class=cl>+-----------------+----------------+   +------------------------------+
</span></span><span class=line><span class=ln>14</span><span class=cl>                  |                    |    updateViewConstraints()   |
</span></span><span class=line><span class=ln>15</span><span class=cl>                  |                    |                              |
</span></span><span class=line><span class=ln>16</span><span class=cl>                  v                    |       viewWillLayout()       |
</span></span><span class=line><span class=ln>17</span><span class=cl>+-----------------+----------------+   |                              |
</span></span><span class=line><span class=ln>18</span><span class=cl>|         viewDidDisappear()       |   |        viewDidLayout()       |
</span></span><span class=line><span class=ln>19</span><span class=cl>+----------------------------------+   +------------------------------+
</span></span></code></pre></div><p>生命周期和 iOS 的 UIViewController 也差不多，从上面的生命周期来看只能覆写 loadView 方法才行：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-swift data-lang=swift><span class=line><span class=ln>1</span><span class=cl><span class=kd>class</span> <span class=nc>ViewController</span><span class=p>:</span> <span class=n>NSViewController</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>
</span></span><span class=line><span class=ln>3</span><span class=cl>    <span class=kr>override</span> <span class=kd>func</span> <span class=nf>loadView</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>4</span><span class=cl>        <span class=c1>// 设置 ViewController 大小同 mainWindow</span>
</span></span><span class=line><span class=ln>5</span><span class=cl>        <span class=k>guard</span> <span class=kd>let</span> <span class=nv>windowRect</span> <span class=p>=</span> <span class=n>NSApplication</span><span class=p>.</span><span class=n>shared</span><span class=p>.</span><span class=n>mainWindow</span><span class=p>?.</span><span class=n>frame</span> <span class=k>else</span> <span class=p>{</span> <span class=k>return</span> <span class=p>}</span>
</span></span><span class=line><span class=ln>6</span><span class=cl>        <span class=n>view</span> <span class=p>=</span> <span class=n>NSView</span><span class=p>(</span><span class=n>frame</span><span class=p>:</span> <span class=n>windowRect</span><span class=p>)</span>
</span></span><span class=line><span class=ln>7</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln>8</span><span class=cl>
</span></span><span class=line><span class=ln>9</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>看了上面代码也就明白了为什么在 <code>AppDelegate.swift</code> 设置 contentViewController 需要在代码块的末尾添加了吧，如果在最开始添加那就无法获取到 mainWindow 也就无法设置 ViewController 的 frame。这里还有个小提醒 macOS 10.10 之后版本在覆写该方法如果调用了 <code>super.loadView()</code> 方法就会自动加载同名的 xib 文件<strong>绝对不能填写</strong>。</p><p>让我们在运行一次看看？</p><p><img loading=lazy src=https://icyleaf.com/tutorials/macos-app-without-storyboard/001/shot003-final-app.png alt="Final App"></img></p><p>Ta-Da! 完成了！</p><h3 id=结语>结语</h3><p>这算是一个开篇，后续还会再继续整理，尽请期待。</p></div></div><div class=post-nav><a href=https://icyleaf.com/2019/04/apply-thailand-evisa/ class=prev rel=prev title=申请泰国电子落地签答疑解惑><i class="iconfont icon-left"></i>&nbsp;申请泰国电子落地签答疑解惑</a>
<a href=https://icyleaf.com/2019/11/cocoapods-cdn-source-code-reading/ class=next rel=next title="Cocoapods 新增 CDN 加速镜像源码解读">Cocoapods 新增 CDN 加速镜像源码解读&nbsp;<i class="iconfont icon-right"></i></a></div><div class=post-comment><script src=https://utteranc.es/client.js repo=icyleaf/icyleaf.com issue-term=pathname theme=github-light label=✨💬✨ crossorigin=anonymous async></script></div></article></div></main><footer class=footer><div class=copyright>&copy;
<span itemprop=copyrightYear>2005 - 2023</span>
<span>🍺</span>
<span class=author itemprop=copyrightHolder><a href=https://icyleaf.com/>icyleaf</a></span></div></footer><script defer src=https://fastly.jsdelivr.net/npm/jquery@3.6.1/dist/jquery.min.js crossorigin=anonymous></script>
<script defer src=https://icyleaf.com/js/vendor_main.min.js></script>
<script type=module>
  
  import PhotoSwipeLightbox from '\/photoswipe\/photoswipe-lightbox.esm.js';

  const lightbox = new PhotoSwipeLightbox({
    gallery: '#post-gallery',
    children: 'a.gallery-item',
    pswpModule: () => import('\/photoswipe\/photoswipe.esm.js'),
  });
  lightbox.init();
</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-TKQBZ7R259"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-TKQBZ7R259")</script></div></body></html>