<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/"><channel><title>icyleaf</title><link>https://icyleaf.com/</link><description>Recent content on icyleaf</description><language>zh</language><lastBuildDate>Tue, 31 Jan 2023 19:28:50 +0800</lastBuildDate><atom:link href="https://icyleaf.com/index.xml" rel="self" type="application/rss+xml"/><item><title>如何搭建家用 homelab: 硬件和架构</title><link>https://icyleaf.com/2023/01/how-to-homelab-part-1-hardware-and-architecture/</link><pubDate>Tue, 31 Jan 2023 19:28:50 +0800</pubDate><guid>https://icyleaf.com/2023/01/how-to-homelab-part-1-hardware-and-architecture/</guid><description>家庭设备架构和考虑因素是根据实际需求不断地演变、试错和总结</description><content:encoded><![CDATA[<p>前面<a href="https://icyleaf.com/2022/02/how-to-homelab-part-0-intro/">先导篇</a>全面性介绍了搭建家用 homelab 软硬件的可能性，实际操作上每个人的室内环境，网络布线都不太一样，钞能力的不同也有会千万种解法。我无法给出一个 100% 的解决方案，但我给大家回顾自己设备架构演变的过程在每个阶段是什么需求，遇到什么问题以及如何应对的，在文章末尾也会给出一些搭建 homelab 中不容忽视的因素。</p>
<h2 id="我的设备架构">我的设备架构</h2>
<blockquote>
<p>首先声明个人设备架构并不代表这是最佳的方案，只是当前符合我要求的结果，随着需求和技术变化而迭代更新。我的梦想就是有间下图的<a href="https://blog.cavelab.dev/2021/02/new-home-office/">地下室</a>能够给我随意折腾就好了。</p>
</blockquote>













  
  
    
      <figure data-pswp="2066x1444" data-size="800x"><a href="/tutorials/how-to-homelab/part-1/memo-devices-changes.png" class="gallery-item" target="_blank" data-pswp-width="2066" data-pswp-height="1444"><img src="/tutorials/how-to-homelab/part-1/memo-devices-changes_hu3bba97879b6716d3588d1f721fb7294f_2449304_800x0_resize_box_3.png"
      alt="创意来源"/></a><figcaption><p class="source">创意来源<a href="https://twitter.com/featherye/status/1619863195145089025">@HCocoa@twitter</a>
    </p>

    <p>homelab 梦想预期</p></figcaption></figure>

<p>当时房子装修是一切从简<span class="spoiler">（没有钱）</span>
造成网络线路设计不太合理：</p>
<ul>
<li>电视墙，卧室和工作室虽预埋 6 类网线但都是单根</li>
<li>弱电箱<a href="https://twitter.com/icyleaf/status/1591070791646744576">太小</a>无法扩展，前期很多设备都堆积到电视后面</li>
<li>房子不大无法设置散热友好的独立机柜</li>
<li>房间有 WIFI 死角</li>
</ul>
<p>新增家庭成员后原工作室改成了儿童房，部分设备又做了迁移，只能基于现有的结构进行优化和改进，以下请目睹我的血泪史。</p>
<h3 id="设备架构演变">设备架构演变</h3>
<h4 id="2014--2016">2014 ~ 2016</h4>













  
  
    
      <figure data-pswp="1204x750" data-size="800x"><a href="/tutorials/how-to-homelab/part-1/homelab-diagram-v0.png" class="gallery-item" target="_blank" data-pswp-width="1204" data-pswp-height="750"><img src="/tutorials/how-to-homelab/part-1/homelab-diagram-v0_hubc530f3d7645fc4772a55310c300252b_67594_800x0_resize_box_3.png"/></a><figcaption>

    <p>v0 设备架构拓扑图</p></figcaption></figure>

<p>这个期间换了新工作上班通勤每天都较长回家也不太折腾网络，路由器是从租房时代沿用过来的网件 WGR614。电视图便宜买了当时乐视出的第一代智能电视满足打开听个响的需求结果不到半年时间系统卡成翔，以至于之后再也没考虑过 Android 系统电视，头两年为了省钱明知在北京应该用联通还是莽了北方电信，那网速真是垃圾啊。还捡了一些不太靠谱的垃圾件就不提了。</p>
<h4 id="2016--2018">2016 ~ 2018</h4>













  
  
    
      <figure data-pswp="2212x1038" data-size="800x"><a href="/tutorials/how-to-homelab/part-1/homelab-diagram-v0.1.png" class="gallery-item" target="_blank" data-pswp-width="2212" data-pswp-height="1038"><img src="/tutorials/how-to-homelab/part-1/homelab-diagram-v0.1_hu562ce67ca2d67a9ae9a7ee2c39c04fc1_157961_800x0_resize_box_3.png"/></a><figcaption>

    <p>v0.1 设备架构拓扑图</p></figcaption></figure>

<p>托工作福利政策出国旅游频次逐渐变多，拍摄的照片越来越多需要存储，2016 年从<a href="https://post.smzdm.com/p/399864/">什么值得买</a>了解后德淘了一台 HP Microserver Gen8。这是一台拥有 4 盘位，双千兆网口还带 iLO 管理功能的服务器，我却给它只安装了黑群晖算是成为了最早的 NAS 服务器设备架构，5.x 版本的群晖还不支持 Docker 算是一台单纯的 NAS 服务用来存储照片、视频、替代 Dropbox 的 Drive 服务，从上图也能看到我当时完全不了解什么是链路聚合，要不然我肯定给黑群晖接入双网口了。</p>
<p>路由器升级到了网件 6300v2 并刷入了 KoolCenter 定制化的<a href="https://twitter.com/icyleaf/status/887209662012989440">梅林固件</a>方便畅游网络，内网穿透这个时候被迫在使用，黑群晖升级后没法完全洗白之前的 Connect 服务被废从联通那要了公网 IP 后才进行实时，我记得公网 IP 上报用的还是<a href="https://twitter.com/zhmocean">糖醋鼻子</a>提供的脚本。</p>
<p>电视更换成了索尼 4K 60 寸互联网电视，外接了一个晶晨 S912 外贸盒子安装了 Kodi 和 Youtube 成为家庭影音系统。</p>
<p>PS 4 应该是在某一年黑五美亚捆绑赠送了 GTA5 和最后生还者的版本。</p>
<h4 id="2018--2019">2018 ~ 2019</h4>













  
  
    
      <figure data-pswp="2284x1662" data-size="800x"><a href="/tutorials/how-to-homelab/part-1/homelab-diagram-v1.0.png" class="gallery-item" target="_blank" data-pswp-width="2284" data-pswp-height="1662"><img src="/tutorials/how-to-homelab/part-1/homelab-diagram-v1.0_hu16a6d641ca5084c17972231b4497bef7_264511_800x0_resize_box_3.png"/></a><figcaption>

    <p>v1 设备架构拓扑图</p></figcaption></figure>

<p>2018 年我在推上吐槽梅林固件刷机太难被 <a href="https://twitter.com/icyleaf/status/1100322141914853376">anbutu</a> 安利 openwrt 系统并赠送了一台 <a href="https://cn.v2ex.com/t/659602">N270 x86 32 位双网口工控机</a>让我了解了新领域：软路由。</p>
<p>黑群晖升级到了支持 Docker 的 6.x 版本，开始尝试跑一些基础服务，比如 <a href="https://aria2.github.io/">aria2</a>，<a href="https://www.home-assistant.io/">home assistant</a>，<a href="https://github.com/AdguardTeam/AdGuardHome">Adguard home</a> 等。不知道什么时候小区会莫名其妙突然停电几分钟后再恢复，有一次硬盘被群晖的检测爆出来好多坏道，吓得我立刻买了<a href="https://twitter.com/icyleaf/status/1096386681907798017">施耐德 APC BK650</a> 带通讯协议，接入群晖保证断电后安全关机。</p>
<p>2019 年初开始学习拍摄视频，采购了<a href="https://icyleaf.com/2019/01/itx-coffee-lake-hackintosh-build-for-4k-video-editing/">新的 Intel 主机</a>在时隔 <a href="https://twitter.com/icyleaf/status/11322513061580800">9 年</a>后后重新学习安装<a href="https://icyleaf.com/2019/03/asrock-z390-gaming-itx-install-hackintosh-tutorial/">黑苹果</a>来代替年迈的 Macbook Pro 2015 款，期间不升级后续版本主要是因为 Intel 太拉，Apple 把硬件全焊死升级顶配不值得。</p>
<h4 id="2020--2021">2020 ~ 2021</h4>













  
  
    
      <figure data-pswp="4644x3004" data-size="800x"><a href="/tutorials/how-to-homelab/part-0/homelab-diagram-v2.0.png" class="gallery-item" target="_blank" data-pswp-width="4644" data-pswp-height="3004"><img src="/tutorials/how-to-homelab/part-0/homelab-diagram-v2.0_hud6b13e642cdec1b76e4883675cc1f0da_933051_800x0_resize_box_3.png"
      alt="首发"/></a><figcaption><p class="source">首发<a href="https://twitter.com/icyleaf/status/1472036769742745603">@icyleaf@twitter</a>
    </p>

    <p>v2 设备架构拓扑图</p></figcaption></figure>

<p>2020 年末实际上才是我正式踏入 homelab 元年，之前只是满足存储需求的 NAS 服务。</p>
<p>软路由升级了至 <a href="https://twitter.com/icyleaf/status/1242070362839330817">E3845 四口工控机</a>（代号 <a href="https://starcraft.fandom.com/wiki/Larva_(StarCraft_II)">Larva</a>）它只承担最基础服务比如拨号，DNS 服务、屏蔽广告，DDNS 等。</p>
<p>交换机迷之自信选择网件 GS105 4 口非网管版，当时很多人问我为什么不选 8 口，我没有意识到后面的变化只是考虑弱电箱只能塞下 4 口。</p>
<p>应用服务由当时新爆出来的<a href="https://twitter.com/icyleaf/status/1339568737083527169">蜜獾超存</a>（代号 <a href="https://starcraft.fandom.com/wiki/Corruptor">Corruptor</a>）矿机<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>承担：6 盘位 / 双千兆网口 / J1900 CPU /8G 内存 / 64G MSATA，我主要是看中了它的机箱体积和设计，比蜗牛星际之类的好看太多。在它身上分别调研尝试下列系统：</p>
<ul>
<li>Debian: 直接跑 Docker 服务有点心不甘</li>
<li><a href="https://maxiee.github.io/post/mihuan1md/">OMV</a>: 最简单的 NAS 系统提供 Docker/Proxmox 内核，但任何操作都要 Apply 好久，实在没法接受</li>
<li><a href="https://www.proxmox.com">Proxmox</a>: 跑十几个不太吃性能系统及服务勉强可接受</li>
<li><a href="https://www.rancher.com/products/harvester">harvester</a>: Rancher 开源的基于 k8s 提供完全集成的存储和虚拟化功能的<a href="https://mp.weixin.qq.com/s?__biz=MzkyNzM4Nzk1NQ==&amp;mid=2247500683&amp;idx=1&amp;sn=2a30a79313c6b51b41a39c6618ccef1b">超融合基础架构软件</a>，万万没想到 <a href="https://twitter.com/icyleaf/status/1429100937499447296">J1900 带不动</a>&hellip;</li>
</ul>
<p>或许你会问为什么不利用好 Gen 8 服务器？原因是 G1610T 性能太弱带不起 ESXI 虚拟化，可升级 CPUs 比如 E3 1265L v2 之类的价格都虚高。我从一开始就把它当做纯粹的 NAS 服务器。四盘位上设置两两硬盘组成 RAID 1。一组 RAID 3T 作为照片存储，第二组 3T 是提供给蜜獾超存安装的服务提供数据存储服务，光驱位扩展一个 SSD 充当缓存盘就完事了。</p>
<p>经过一番折腾倔强的 J1900 扛不住压力，从咸鱼分别入了 17x17 豆希 ITX 主板，定制了 flex 电源，<a href="https://www.bilibili.com/read/cv9438621#reply149844420272">改了静音风扇</a>，配上 8700es CPU，PDD 入的单条 32G 内存和<a href="https://twitter.com/icyleaf/status/1416395829858869249">酷兽 256G M2 SSD</a>，复用蜜獾超存的机箱但它机身宽度较窄符合要求的只有利民 AXP90 x36，机箱后出风用都是酷冷的漩涡 80 静音风扇。</p>
<p>系统继续使用 Proxmox 设置备份还原工具<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>后用 VMs 跑 <a href="https://github.com/jellyfin/jellyfin">jellyfin</a>, <a href="https://github.com/portainer/portainer">portainer</a>, <a href="https://github.com/dani-garcia/vaultwarden">vaultwarden</a>, <a href="https://github.com/louislam/uptime-kuma">uptime kuma</a>, <a href="https://github.com/traefik/traefik">traefik</a> 等监控、数据库、应用服务，存储方面酷兽 SSD 作为系统盘，<a href="https://twitter.com/icyleaf/status/1228626720489537537">闲置的 4 块硬盘</a>组了 btrfs RAID 10，第五块做 3T 做电影、电视剧下载盘，最后一块是备用。</p>
<p>通过两次硬件升级淘汰的主机也都没有失去价值</p>
<ul>
<li>J1900 板 U 卖了也不值几个钱，干脆新套了<a href="https://twitter.com/icyleaf/status/1561341317778575363/">MAXT 小机箱</a>用于测试新的试验田捣腾其他稀奇古怪的系统、服务，并赋予新代号 <a href="https://en.wikipedia.org/wiki/Deadpool">Deadpool</a></li>
<li>N270 软路由在爆发疫情初期寄给了需要的武汉朋友</li>
</ul>
<h4 id="2022--2023">2022 ~ 2023</h4>
<blockquote>
<p>实际上是 2022 整年的版本，后续有变化会再更新。</p>
</blockquote>













  
  
    
      <figure data-pswp="4644x3342" data-size="800x"><a href="/tutorials/how-to-homelab/part-1/homelab-diagram-v2.1.png" class="gallery-item" target="_blank" data-pswp-width="4644" data-pswp-height="3342"><img src="/tutorials/how-to-homelab/part-1/homelab-diagram-v2.1_hu2e07676c2790f7a793b80a519fce3f89_1014582_800x0_resize_box_3.png"
      alt="首发"/></a><figcaption><p class="source">首发<a href="https://twitter.com/icyleaf/status/1619228928685801474">@icyleaf@twitter</a>
    </p>

    <p>v2.1 设备架构拓扑图</p></figcaption></figure>

<p>原计划是可以安心跑个 1 - 2 年不太可能会有什么大变化，只需要在基于 Proxmox 系统继续试验并搞定多 VMs 跑 k8s/k3s 集群后就能安心养老，两次事故打乱了我的规划。一次是升级至 64G 内存后<a href="https://twitter.com/icyleaf/status/1534419122427408385">挂了块硬盘</a>，幸好从 RAID 移除后还能<a href="https://twitter.com/icyleaf/status/1534543188333297665">正常工作</a>；第二次直接 All in one boom 原因是 <a href="https://twitter.com/icyleaf/status/1583461623179509761">CPU 散热风扇无法工作</a>。在采购风扇和优化机箱风道期间给了我反思的过程，我明明是排斥 All in one 设计的结果自己主力开发机也是这样的设计，服务越多则越要保证服务可用性，那就要新添至少 1 - 2 新主机但家里真的没有更多的地方，翻阅国内外的资料目标锁定了几个目标：</p>
<ul>
<li><a href="https://homelab.khuedoan.com/">NEC M700</a>: 6 代，魔改支持 7/8/9 代</li>
<li><a href="https://rpi4cluster.com/">树莓派 4B</a>: 有丰富的成功案例但价格简直一个离谱<sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup></li>
<li><a href="https://v2ex.com/t/878188">荣品 king3399</a>: RK3399 性能强但我没赶上车价格被炒上去且 2G 内存有点小</li>
</ul>
<p>某天在闲鱼刷推荐线看到一个比荣品 king3399 更好的 <a href="https://twitter.com/icyleaf/status/1586636664457551872">EAIDK 610</a> RK3399 开发板 4G 内存价格才 200 出头，尝试买了两个又在 <a href="https://twitter.com/icyleaf/status/1598302816938127360">anbutu</a> 和社区 <a href="https://gitee.com/e190/armbian/">eaidk-610 armbian-build 项目</a>的帮助下成功编译并烧录了 armbian 系统，跑通 k3s 服务后又入了两个和 Proxmox 的 VMs 组成了 amd86 和 arm86 的混合集群。</p>













  
  
    
      <figure data-pswp="1536x2048" data-size="800x"><a href="/tutorials/how-to-homelab/part-1/eaidk-610.jpg" class="gallery-item" target="_blank" data-pswp-width="1536" data-pswp-height="2048"><img src="/tutorials/how-to-homelab/part-1/eaidk-610_hu074222726f2aa0440c99e8e5bdbae569_466590_800x0_resize_q75_box.jpg"
      alt="首发"/></a><figcaption><p class="source">首发<a href="https://twitter.com/icyleaf/status/1585792876235005953">@icyleaf@twitter</a>
    </p>

    <p>EAIDK 610 开发板</p></figcaption></figure>

<p>就这上面集群测试跑通的同时 J1900 主机也完成了对 <a href="https://twitter.com/icyleaf/status/1579499063577554945">nomad</a> 服务的试水并逐步稳定下来，后面也可以和 Proxmox VMs 组成混合集群。</p>
<p>内网穿透方面除了公网加端口之外多了 <a href="https://twitter.com/icyleaf/status/1539849981598740480">traefik hub</a> 方案。作为最早一批内测用户还额外拥有更多的免费额度，现在免费版限制最大 5 个公网服务。</p>
<h2 id="我的设备选择">我的设备选择</h2>
<blockquote>
<p>用了很长的篇幅介绍了我的设备演变史，从文字和拓扑图大家已经了解了七七八八，为了方便理解这里会再汇总一份供大家赏阅。在软硬件的折腾方面我总能想起<a href="https://www.gracecode.com/posts/3191.html">明城</a>大哥。</p>
</blockquote>
<p>软硬件我采用的是 <a href="https://www.thoughtworks.com/zh-cn/radar">thoughtworks 技术雷达</a> 的策略把任何一个方案划分成<code>评估</code>、<code>试验</code>、<code>采纳</code>和<code>暂缓</code> 4 个阶段，因此会包含很多解决方案，标记<code>采纳</code>的可安心服用。</p>
<h3 id="硬件">硬件</h3>
<div >
  
<table>
<thead><tr><th>主机代号</th>
<th>系统</th>
<th>阶段</th>
<th>数量</th>
<th>用途</th>
</tr></thead>
<tbody>
<tr>
<td>
  <a href="https://starcraft.fandom.com/wiki/Immortal">Immortal</a> <sup>amd64</sup>
  <br />9700k/32G/6TB/6600xt
</td>
<td>macOS<br />Windows</td>
<td><span class="badge bg-success">采纳</span></td>
<td>1</td>
<td>个人生产力工具</td>
</tr>
<tr>
<td>
  <a href="https://starcraft.fandom.com/wiki/Queen_(StarCraft_II)">Queen</a> <sup>amd64</sup><br />
  HP Gen8 (1230v2/8G/40TB)
</td>
<td>群晖</td>
<td><span class="badge bg-success">采纳</span></td>
<td>1</td>
<td>NAS</td>
</tr>
<tr>
<td>
  <a href="https://starcraft.fandom.com/wiki/Corruptor">Corruptor</a> <sup>amd64</sup><br />
  蜜獾超存 (8700es/64G/10TB)
</td>
<td>Promox</td>
<td><span class="badge bg-success">采纳</span></td>
<td>1</td>
<td>虚拟开发机</td>
</tr>
<tr>
<td>
  <a href="https://starcraft.fandom.com/wiki/Bunker">Bunker</a> <sup>amd64</sup><br />
  J1900/8G/1TB
</td>
<td>Debian</td>
<td><span class="badge bg-success">采纳</span></td>
<td>1</td>
<td>Nomad 集群成员</td>
</tr>
<tr>
<td>
  <a href="https://starcraft.fandom.com/wiki/Larva_(StarCraft_II)">Larva</a> <sup>amd64</sup><br />
  E3845/2G/16GB/i211<small>x4</small>
</td>
<td>Openwrt</td>
<td><span class="badge bg-success">采纳</span></td>
<td>1</td>
<td>软路由</td>
</tr>
<tr>
<td>
  <a href="https://starcraft.fandom.com/wiki/Splitter">Splitter</a> <sup>arm64</sup><br />
  EAIDK610 (RK3399/4G/128GB)
</td>
<td>Armbian</td>
<td><span class="badge bg-warning">试验</span></td>
<td>4</td>
<td>k3s 集群</td>
</tr>
<tr>
<td>
  <a href="https://starcraft.fandom.com/wiki/Lair">Lair</a> <sup>armv8</sup><br />
  H96 Pro+ (S912/4G/32GB)
</td>
<td>Android TV</td>
<td><span class="badge bg-success">采纳</span></td>
<td>1</td>
<td>影音电视盒子</td>
</tr>
<tr>
<td>
  <a href="https://starcraft.fandom.com/wiki/Drone">Drone</a> <sup>arm64</sup><br />
  Orange Pi 3 LTS
</td>
<td>Armbian</td>
<td><span class="badge bg-notice">评估</span></td>
<td>1</td>
<td>未完成的 IP KVM</td>
</tr>
</tbody></table>

</div>

<p>当主机出现故障需要维护时需要单独的显示器和键鼠，更好的解决方案是 <a href="https://github.com/stars/icyleaf/lists/ip-kvm">IP KVM</a>。现有方案要么仅支持树莓派 4B，要么需要两个开发板。我曾使用树莓派 3B 和 <a href="https://twitter.com/icyleaf/status/1539975823670710274">香橙派 3LTS</a> 刷入 <a href="https://github.com/tiny-pilot/tinypilot">tinypilot</a> 只能开启 HDMI 画面采集，无法模拟键鼠操作。</p>
<p>偏向底层及硬件一直是我的弱项，我想世界末日了我们这些写软件服务的都会在第一时间挂了吧，哈哈哈。</p>
<h4 id="硬盘">硬盘</h4>
<p>在个人能力范围内优先级考虑：<code>M2 SSD</code> &gt; <code>SATA SSD</code> &gt; <code>氦气盘</code> &gt; <code>非叠瓦盘</code>，这方面我也看着大家的建议买，建议是硬盘太多做好整理，尤其是购买时间，购买渠道，购买数量，硬盘编号，保质年限，过保时间以及定期的 SMART 检测数据记录。</p>













  
  
    
      <figure data-pswp="949x1253" data-size="800x"><a href="/tutorials/how-to-homelab/part-1/harddisk-2022-full.png" class="gallery-item" target="_blank" data-pswp-width="949" data-pswp-height="1253"><img src="/tutorials/how-to-homelab/part-1/harddisk-2022-full_hu04a2dabdf73291bf2078d685bd542bb0_847668_800x0_resize_box_3.png"/></a><figcaption>

    <p>硬盘大军</p></figcaption></figure>














  
  
    
      <figure data-pswp="1512x1538" data-size="800x"><a href="/tutorials/how-to-homelab/part-1/harddisk-category.png" class="gallery-item" target="_blank" data-pswp-width="1512" data-pswp-height="1538"><img src="/tutorials/how-to-homelab/part-1/harddisk-category_hudc0352c8205a256a2ea382889711a8c3_301266_800x0_resize_box_3.png"/></a><figcaption>

    <p>硬盘分布情况</p></figcaption></figure>

<h4 id="ups-电源">UPS 电源</h4>
<p>一次电力的闪断更有可能让服务器硬件（尤其是的硬盘）就会出现故障而坏掉，保证硬件和数据的安全性 UPS 电源是必备的，优先考虑支持通讯的，因为停电虽然有 UPS 可以用电池模式继续保持运行，电池电量是有限的服务器如果知道当前的状态进行安全关机。</p>
<div >
  
<table>
<thead><tr>
<th>UPS 设备</th>
<th>辐射范围</th>
<th>描述</th>
</tr></thead>
<tbody>
<tr>
<td>APC BK650</td>
<td>Proxmox + 黑群晖 + WIFI AP</a></td>
<td>连接 Proxmox 并开启 NUT 服务和<br /> apcupsd 数据接入 Prometheus</td>
</tr>
<tr>
<td>APC BK650</td>
<td>黑苹果 + Armbian 集群 + Nomad</a></td>
<td>连接 Nomad 并开启 NUT 服务<br /> apcupsd 数据接入 Prometheus</td>
</tr>
<tr>
<td><a href="https://twitter.com/icyleaf/status/1590351704020910080">弱电箱 UPS</a></td>
<td>光猫 + 软路由 + 交换机</a></td>
<td>软路由接受其他两个 NUT 通知<br />四口 12V 还富裕一个</td>
</tr>
</tbody></table>

</div>

<p>我只使用过施耐德 APC 带有通讯协议的 UPS 基本上可通过 <a href="http://www.apcupsd.org/">apcupsd</a> 或 NUT（绝大多数 NAS 系统比如群晖、威联通等都支持）通过该服务可以让没有直接插通讯线的设备也能过接收到通知并执行安全关机操作<sup id="fnref:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">4</a></sup>。详细请看[使用NUT和apcupsd将群晖NAS接入UPS不间断电源]获得配置教程。</p>
<h3 id="软件">软件</h3>
<h4 id="操作系统">操作系统</h4>
<div >
  
<table>
<thead><tr><th>操作系统</th>
<th>阶段</th>
<th>描述</th>
</tr></thead>
<tbody>
<tr>
<td><a href="https://www.proxmox.com/">proxmox</a></td>
<td><span class="badge bg-success">采纳</span></td>
<td>高可玩性且兼具自动化管理的虚拟机系统</td>
</tr>
<tr>
<td><a href="https://www.debian.org/">debian</a></td>
<td><span class="badge bg-success">采纳</span></td>
<td>作为服务器个人最熟悉的基础 amd64 OS</td>
</tr>
<tr>
<td><a href="https://www.armbian.com/">armbian</a></td>
<td><span class="badge bg-success">采纳</span></td>
<td>ARM 版本的 Debian，理由同上</td>
</tr>
<tr>
<td><a href="https://openwrt.org/">openwrt</a></td>
<td><span class="badge bg-success">采纳</span></td>
<td>可玩性很高的开源软路由系统</td>
</tr>
<tr>
<td><a href="https://www.talos.dev/">talos</a></td>
<td><span class="badge bg-warning">试验</span></td>
<td>100% API 管理且支持多部署环境的基于 k8s 实现的发行版</td>
</tr>
<tr>
<td><a href="https://pi-hole.net/">pi-hole</a></td>
<td><span class="badge bg-warning">试验</span></td>
<td>国外非常流行的 DNS 管理系统，界面友好</td>
</tr>
<tr>
<td><a href="https://rockstor.com/">rockstor</a></td>
<td><span class="badge bg-notice">评估</span></td>
<td>基于 openSUSE + btrfs 的 NAS 系统，支持 SMART 和 NUT<br />注意<a href="https://twitter.com/icyleaf/status/1610885440961404929">不兼容 Asia/Beijing 时区</a></td>
</tr>
<tr>
<td><a href="https://kairos.io/">kairos</a></td>
<td><span class="badge bg-notice">评估</span></td>
<td>新发布的容器化系统，感兴趣但还没成功跑通</td>
</tr>
<tr>
<td><a href="https://www.openmediavault.org/">omv</a></td>
<td><span class="badge bg-danger">暂缓</span></td>
<td>完成度高的 NAS 系统但个人无爱</td>
</tr>
<tr>
<td><a href="https://vmware.github.io/photon/">photonOS</a></td>
<td><span class="badge bg-danger">暂缓</span></td>
<td>Vmware 虚拟化优化但嫌弃 redhat 系统</td>
</tr>
<tr>
<td><a href="https://www.tritondatacenter.com/smartos">smarterOS</a></td>
<td><span class="badge bg-danger">暂缓</span></td>
<td>支持虚拟化和 ZFS 但依赖高内存成度的 NAS 系统但个人无爱</td>
</tr>
</tbody></table>

</div>

<p>性能强大的机器以 Proxmox 作为宿主机内部套 Debian 或 Armbian 来跑所需的服务或基于容器化技术的编排管理服务或容器化系统（Linux Container OS<sup id="fnref:5"><a href="#fn:5" class="footnote-ref" role="doc-noteref">5</a></sup>）</p>
<h4 id="文件系统">文件系统</h4>
<div >
  
<table>
<thead><tr><th>类型</th>
<th>阶段</th>
<th>描述</th>
</tr></thead>
<tbody>
<tr>
<td>btrfs</td>
<td><span class="badge bg-success">采纳</span></td>
<td>磁盘管理方便，支持快照和 COW</td>
</tr>
<tr>
<td>ext4</td>
<td><span class="badge bg-success">采纳</span></td>
<td>最保险的文件系统</td>
</tr>
<tr>
<td>zfs</td>
<td><span class="badge bg-notice">评估</span></td>
<td>强健可靠、可伸缩、易于管理就是吃内存</td>
</tr>
<tr>
<td>xfs</td>
<td><span class="badge bg-notice">评估</span></td>
<td>据说速度很快，个人没有太多研究<br />talos <a href="https://www.talos.dev/v1.3/learn-more/architecture/">默认文件系统</a></td>
</tr>
</tbody></table>

</div>

<p>个人优先级选择 <code>btrfs</code> &gt; <code>ext4</code> &gt; <code>zfs</code> &gt; <code>xfs</code>。注意的是 btrfs 现阶段不建议使用 <a href="https://btrfs.wiki.kernel.org/index.php/Status#RAID56">RAID 5/6</a>，不太考虑 zfs 是组 RAID 后新增硬盘麻烦且有成本。xfs 真不了解，感兴趣的可以看下以上文件系统<a href="https://www.dimoulis.net/posts/benchmark-of-postgresql-with-ext4-xfs-btrfs-zfs/">在 PostgreSQL 的基准测试</a>。</p>
<p>对于 btrfs 我个人的看法是只有自己尝试过才知道结果，尽管 Promox <a href="https://www.proxmox.com/en/news/press-releases/proxmox-virtual-environment-7-0">7.0</a> 第一把 btrfs 作为<a href="https://pve.proxmox.com/wiki/BTRFS">技术预览</a>的情况下发布，我也做了小白鼠使用它在将近 2 年的时间内基本正常，只有一次小故障还是因淘宝买的垃圾硬盘质量太差出现太多的坏道。btrfs 在 RAID10 最低 4 块磁盘的前提下移除掉坏盘也能过正常工作（删减都做一次 <a href="https://btrfs.readthedocs.io/en/latest/Balance.html">balance</a> 即可），除此之外我并没有遇到任何问题。虽然 COW 特性会拖累磁盘 IO 现状也都能接受。</p>
<p>对 btrfs 感兴趣的小伙伴推荐看 <a href="https://twitter.com/Houge_Langley">@Houge</a> 的<a href="https://www.bilibili.com/video/BV1Fh411e7Wk/">教学视频</a>或者 openSUSE 官方推出的<a href="https://www.bilibili.com/video/BV115411u7bU/">入门教学视频</a>。用过或已入门 btrfs 的可深入阅读 <a href="https://farseerfc.me/zhs/btrfs-vs-zfs-difference-in-implementing-snapshots.html">btrfs 与 zfs 快照实现差异</a>，<a href="https://linuxhint.com/btrfs-vs-xfs-brief-comparison/">btrfs 与 xfs 对比</a>，<a href="https://markmcb.com/2020/01/07/five-years-of-btrfs/">Five Years of Btrfs</a> 和 <a href="https://it-notes.dragas.net/2018/10/13/btrfs-best-pratices/">BTRFS Best Practices</a> 做到心中有数。</p>
<h4 id="存储服务">存储服务</h4>
<div >
  
<table>
<thead><tr><th>服务</th>
<th>阶段</th>
<th>描述</th>
</tr></thead>
<tbody>
<tr>
<td>samba</td>
<td><span class="badge bg-success">采纳</span></td>
<td>兼容性和实用性最高，仅建议手动文件挂载使用</td>
</tr>
<tr>
<td>nfs</td>
<td><span class="badge bg-success">采纳</span></td>
<td>可作为最低保障数据挂载</td>
</tr>
<tr>
<td><a href="https://min.io/">minos</a></td>
<td><span class="badge bg-success">采纳</span></td>
<td>兼容 S3 应用的开源存储服务</td>
</tr>
<tr>
<td><a href="https://juicefs.com/">juicefs</a></td>
<td><span class="badge bg-warning">试验</span></td>
<td>S3 兼容且 POSIX 兼容性高的开源存储服务</td>
</tr>
<tr>
<td><a href="https://longhorn.io/">longhorn</a></td>
<td><span class="badge bg-warning">试验</span></td>
<td>简单好用的块存储开源服务，磁盘迁移<a href="https://twitter.com/icyleaf/status/1607372383245172737">很容易</a></td>
</tr>
<tr>
<td><a href="https://rook.github.io/">rook ceph</a></td>
<td><span class="badge bg-notice">评估</span></td>
<td>当下具有很大潜力的云原生存储服务</td>
</tr>
<tr>
<td><a href="https://github.com/openebs/Mayastor">mayastor</a></td>
<td><span class="badge bg-notice">评估</span></td>
<td>针对 NVME 优化的块存储服务</td>
</tr>
</tbody></table>

</div>

<p>存储方面之前都是 Samba、NFS 甚至只用 APF，直到 2022 年才正式开始在生产环境试验，尤其是针对 k8s 的存储我还是一个小白。</p>
<h4 id="容器化管理及编排服务">容器化管理及编排服务</h4>
<p><div >
  
<table>
<thead><tr><th>服务</th>
<th>阶段</th>
<th>描述</th>
</tr></thead>
<tbody>
<tr>
<td><a href="https://www.portainer.io/">portainer</a></td>
<td><span class="badge bg-success">采纳</span></td>
<td>支持 Docker/k3s/nomad 多种编排服务的管理服务
</div>
<sup id="fnref:6"><a href="#fn:6" class="footnote-ref" role="doc-noteref">6</a></sup><div >
  </td>
</tr>
<tr>
<td><a href="https://kubesphere.io/">kubesphere</a></td>
<td><span class="badge bg-danger">暂缓</span></td>
<td>新手和企业友好的 k8s 前端容器管理服务，整体来说有点重</td>
</tr>
<tr>
<td><a href="https://www.nomadproject.io/">nomad</a></td>
<td><span class="badge bg-success">采纳</span></td>
<td>入门门槛较低但缺乏教学资料的编排服务</td>
</tr>
<tr>
<td><a href="https://k3s.io/">k3s</a></td>
<td><span class="badge bg-warning">试验</span></td>
<td>针对边缘计算、物联网等场景进行了高度优化轻量级的 k8s 发行版</td>
</tr>
<tr>
<td><a href="https://kubernetes.io/">kubernetes</a></td>
<td><span class="badge bg-notice">评估</span></td>
<td>100% 正统血缘 k8s，不敢靠近 :D</td>
</tr>
<tr>
<td><a href="https://docs.docker.com/engine/swarm/">docker swarm</a></td>
<td><span class="badge bg-danger">暂缓</span></td>
<td>官方自己都快弃权的编排服务，不推荐</td>
</tr>
</tbody></table>

</div>
</p>
<p>Portainer 是一款新人友好的容器管理工具，至今我现在也还在用。k3s 也是最容易跨进 k8s 世界且 edge 友好的编排服务。</p>
<h4 id="网关">网关</h4>
<div >
  
<table>
<thead><tr><th>服务</th>
<th>阶段</th>
<th>描述</th>
</tr></thead>
<tbody>
<tr>
<td><a href="https://doc.traefik.io/traefik/">traefik</a></td>
<td><span class="badge bg-success">采纳</span></td>
<td>个人认为最好用的网关服务</td>
</tr>
<tr>
<td><a href="https://caddyserver.com/">caddy</a></td>
<td><span class="badge bg-success">采纳</span></td>
<td>简单好用的支持 Let's Encrypt 的网关服务</td>
</tr>
<tr>
<td><a href="https://www.nginx.com/">nginx</a></td>
<td><span class="badge bg-success">采纳</span></td>
<td>管理多域名可考虑 <a href="https://nginxproxymanager.com">nginx manager</a></td>
</tr>
</tbody></table>

</div>

<p>虽然都是标记的<code>采纳</code>，我主要用前两个，网关首推 traefik，简单使用 caddy，前两个简单好用功能还强大我想不出来理由用第三个。</p>
<h4 id="自动化部署">自动化部署</h4>
<div >
  
<table>
<thead><tr><th>服务</th>
<th>阶段</th>
<th>描述</th>
</tr></thead>
<tbody>
<tr>
<td><a href="https://www.ansible.com/">ansible</a></td>
<td><span class="badge bg-success">采纳</span></td>
<td>无代理（利用 SSH）就能自动化部署的配置工具</td>
</tr>
<tr>
<td><a href="https://www.terraform.io/">terraform</a></td>
<td><span class="badge bg-success">采纳</span></td>
<td>只要有接口管理的服务都能自动化部署的工具<br />还是 ansible 最佳排挡</td>
</tr>
<tr>
<td><a href="https://fluxcd.io/flux/">fluxcd</a></td>
<td><span class="badge bg-warning">试验</span></td>
<td>最好用的 gitops 里对 k8s 自动配置部署工具</td>
</tr>
<tr>
<td><a href="https://argo-cd.readthedocs.io/">argocd</a></td>
<td><span class="badge bg-danger">试验</span></td>
<td>gitops 里对 k8s 自动配置部署还有可视化拓扑图</td>
</tr>
<tr>
<td><a href="https://www.pulumi.com/">pulumi</a></td>
<td><span class="badge bg-warning">试验</span></td>
<td>支持多种原生语言配置版本的 terraform<br />实现架构优秀，使用者友好，插件开发者痛苦</td>
</tr>
<tr>
<td><a href="https://saltproject.io/">salt</a></td>
<td><span class="badge bg-danger">暂缓</span></td>
<td>有代理，当初一经面世就要碾压 ansible 的方案<br />看看市场的选择，它也不咋地嘛</td>
</tr>
</tbody></table>

</div>

<p>只要是跟操作系统打交道的 ansible + terraform 打遍天下无敌手！fluxcd 在对 k8s 服务配置和部署上确实找不出毛病，门槛有就看你能不能入门，建议在熟悉 k8s 基础概念和有一定实际部署经验后再使用。</p>
<h2 id="不容忽视的因素">不容忽视的因素</h2>
<p>大量的篇幅介绍了我个人 homelab 设备架构演变和软硬件的选择，还有什么容易忽略的因素呢？</p>
<p>如果把设备比做核心建筑，不容忽视的因素那就是基础建设。两手都要抓这样才能以确保 homelab 能够发挥最大的效能，谁也不想性能无法 100% 压榨或意外故障的发生。</p>
<h3 id="网线规格">网线规格</h3>
<p><strong><code>务必保证所有 homelab 的设备都接入千兆以上有线网络</code></strong>，WIFI 会收到周围信道干扰、传输衰减等不稳定性问题，以下是网线的规格汇总：</p>
<p><div >
  
<table>
<thead>
<tr>
<th>规格</th>
<th>命名</th>
<th>速率</th>
<th>接口</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>CAT 5</td>
<td>五类线</td>
<td>100Mbps</td>
<td>RJ45</td>
<td>不推荐</td>
</tr>
<tr>
<td>CAT 5E</td>
<td>超五类线</td>
<td>1000Mbps</td>
<td>RJ45</td>
<td>最低限度</td>
</tr>
<tr>
<td>CAT 6</td>
<td>六类线</td>
<td>1Gbps/10Gbps
</div>
<sup id="fnref:7"><a href="#fn:7" class="footnote-ref" role="doc-noteref">7</a></sup><div >
  </td>
<td>RJ45</td>
<td>万兆网络仅限 50 米内</td>
</tr>
<tr>
<td>CAT 6A</td>
<td>超六类线</td>
<td>10Gbps</td>
<td>RJ45</td>
<td>200 米内可达万兆网络<br />没有 6E 标准</td>
</tr>
<tr>
<td>CAT 7</td>
<td>七类线</td>
<td>10Gbps</td>
<td>GG45/TERA</td>
<td>带着遮蔽</td>
</tr>
<tr>
<td>-</td>
<td>光纤</td>
<td></td>
<td></td>
<td>不懂，详见<a href="https://zh.wikipedia.org/zh-cn/%E5%85%89%E7%BA%96%E9%80%9A%E8%A8%8A">维基百科</a></td>
</tr>
</tbody>
</table>

</div>
</p>
<p>再次重申 <strong><code>千兆以上网络是不可或缺的</code></strong>，推荐使用 CAT 6/6A 规格，土豪们 CAT 7 或光纤随意。</p>
<p>假如你不知道家里网络的状态提供两种方法检查：</p>
<ol>
<li>查看网线上面的印字会有网线规格标识</li>
<li>过 <a href="https://github.com/esnet/iperf">iperf3</a> 在两台任意可连接有线的设备充当服务器端和客户端进行检测。</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1"># 一台开启服务端，假设服务器 IP 是 192.168.1.100</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">iperf3 -s
</span></span><span class="line"><span class="ln">3</span><span class="cl">
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1"># 一台开客户端，连接服务端进行测试</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">iperf3 -c 192.168.1.100
</span></span></code></pre></div><h3 id="噪音和散热">噪音和散热</h3>
<ul>
<li>硬件
<ul>
<li>机械硬盘读写盘的噪音（有钱就全 SSD 或等待 <a href="https://twitter.com/icyleaf/status/1619937731777556486">EDSFF E1/E3 卡</a>民用）</li>
<li>风扇的轴承、转速和大小也会产生噪音（CPU 散热、显卡、机箱、电源等）</li>
<li>主板 DEBUG 蜂鸣器（有的可关闭或<a href="https://twitter.com/icyleaf/status/1432343002765139968">拆除</a>）</li>
</ul>
</li>
<li>软件
<ul>
<li>群晖为保障系统稳定性默认会全盘写入系统作为 backup 若要解决噪音问题建议<a href="https://twitter.com/icyleaf/status/1620093653791436800">策略性移除</a></li>
<li>Linux 系统可考虑使用 <a href="https://wiki.archlinux.org/title/fan_speed_control">lm-sensors</a> 侦测配置</li>
</ul>
</li>
<li>空间
<ul>
<li>摆放位置决定噪音耐受度和散热效率</li>
</ul>
</li>
</ul>
<h3 id="省电和功率">省电和功率</h3>
<p>CPU 的待机 TPW 只是参考，还需要考虑硬盘，内存和显卡整体，还需要考虑峰值功率，这块没有太多可展开的。要考虑能效但也不过分的在意，尤其是为了降低 5 - 10w TPW 而购买溢价过高的产品，这个在前篇的小结也有提到。</p>
<!-- raw HTML omitted -->
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>我记得是在<a href="https://bbs.nas66.com/">矿渣社区</a>看到的发车，后来看的<a href="https://post.smzdm.com/p/andr83k3/">阿文菌</a>的文章。&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>官方提供<a href="https://pve.proxmox.com/wiki/Backup_and_Restore">备份和恢复</a>方法，Github Gist 也有<a href="https://gist.github.com/mrpeardotnet/6bdc4b504f43ce57fa7eaee96d376edf">备份脚本</a>&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3">
<p>以疫情为由成本上升，国内市场 4B 最高能卖到 1200，我吃灰的 3B 都卖了 600 块&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:4">
<p><a href="https://blog.irain.in/archives/NUT_apcupsd_Synology_DSM_UPS.html">配置教程</a>和关机方案 <a href="https://blog.k8s.li/apcupsd-on-openwrt-with-esxi.html">1</a>、<a href="https://github.com/mingcheng/apcupsd_guarder">2</a>&#160;<a href="#fnref:4" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:5">
<p>关于容器化 OS 可选性可以看看 <a href="https://blog.k8s.li/Photon-OS.html">Reimu 的博文</a>&#160;<a href="#fnref:5" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:6">
<p>Nomad 支持需要付费增值服务，可免费申请试用 License&#160;<a href="#fnref:6" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:7">
<p>带宽是 1000 进制，1Gbps = 1000Mbps = 千兆网络, 10Gbps = 万兆网络&#160;<a href="#fnref:7" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>
]]></content:encoded></item><item><title>Cocoapods CDN 加速新解</title><link>https://icyleaf.com/2022/11/cocoapods-cdn-speed-up-another-solution/</link><pubDate>Thu, 10 Nov 2022 15:30:07 +0800</pubDate><guid>https://icyleaf.com/2022/11/cocoapods-cdn-speed-up-another-solution/</guid><description>官方 CDN 不稳定，Git 源又太大，还要其他解决方案吗？</description><content:encoded><![CDATA[<p>距离 Cocoapods 支持 CDN 源已经 3 年，期间不断有开发者从 CDN 源切回了最初 Git 源的方案，Cocoapods 也没有更多的改进措施。</p>
<p>当初写<a href="https://icyleaf.com/2019/11/cocoapods-cdn-source-code-reading/">CDN 加速镜像源码解读</a>还是用的 jsdelivr 没想到过了 2 个小版本改 Netlify 了。从国内几大 DNS 解析结果来看总会到 cloudflare 上面。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln"> 1</span><span class="cl">$ doggo cdn.cocoapods.org CNAME @202.106.0.20
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">NAME          	TYPE	CLASS	TTL 	ADDRESS                       	NAMESERVER
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">cocoapods.org.	SOA 	IN   	303s	betty.ns.cloudflare.com.      	202.106.0.20:53
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">              	    	     	    	dns.cloudflare.com. <span class="m">2280316554</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">              	    	     	    	<span class="m">10000</span> <span class="m">2400</span> <span class="m">604800</span> <span class="m">3600</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">$ doggo cdn.cocoapods.org CNAME @114.114.114.114
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">NAME          	TYPE	CLASS	TTL 	ADDRESS                       	NAMESERVER
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">cocoapods.org.	SOA 	IN   	277s	betty.ns.cloudflare.com.      	114.114.114.114:53
</span></span><span class="line"><span class="ln">10</span><span class="cl">              	    	     	    	dns.cloudflare.com. <span class="m">2280316554</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">              	    	     	    	<span class="m">10000</span> <span class="m">2400</span> <span class="m">604800</span> <span class="m">3600</span>
</span></span></code></pre></div><p>jsdelir 的 CDN 是全球覆盖相对比较广的，中国地区用的是网宿节点，但<a href="https://www.v2ex.com/t/823281">证书问题</a>现在流量都切到了 Fastly</p>













  
  
    
      <figure data-pswp="2270x1316" data-size="800x"><a href="/uploads/2022/11/10/jsdelivr-network.png" class="gallery-item" target="_blank" data-pswp-width="2270" data-pswp-height="1316"><img src="/uploads/2022/11/10/jsdelivr-network_hu35ca8d8b89ce669a90db33b84e39dea8_282272_800x0_resize_box_3.png"/></a><figcaption>

    <p>jsdelivr network</p></figcaption></figure>

<p>国内 DNS 解析的结果可以看出来：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ doggo cdn.jsdelivr.net CNAME @114.114.114.114
</span></span><span class="line"><span class="ln">2</span><span class="cl">NAME             	TYPE 	CLASS	TTL  	ADDRESS                 	NAMESERVER
</span></span><span class="line"><span class="ln">3</span><span class="cl">cdn.jsdelivr.net.	CNAME	IN   	1529s	jsdelivr.map.fastly.net.	114.114.114.114:53
</span></span><span class="line"><span class="ln">4</span><span class="cl">
</span></span><span class="line"><span class="ln">5</span><span class="cl">15:38:53 in ~
</span></span><span class="line"><span class="ln">6</span><span class="cl">$ doggo cdn.jsdelivr.net CNAME @202.106.0.20
</span></span><span class="line"><span class="ln">7</span><span class="cl">NAME             	TYPE 	CLASS	TTL  	ADDRESS                 	NAMESERVER
</span></span><span class="line"><span class="ln">8</span><span class="cl">cdn.jsdelivr.net.	CNAME	IN   	1515s	jsdelivr.map.fastly.net.	202.106.0.20:53
</span></span></code></pre></div><p>jsdelivr 支持 Github 仓库代码的 CDN 加速，利用本机制可以把 CDN 源加速到 jsdelivr。</p>
<p>官方 CDN 源的源码仓库是 <a href="https://github.com/CocoaPods/cdn.cocoapods.org">Cocoapods/cdn.cocoapods.org</a>，主分支是同步脚本，<code>gh-pages</code> 分支是源的真实数据。</p>













  
  
    
      <figure data-pswp="1698x582" data-size="800x"><a href="/uploads/2022/11/10/jsdelivr-github-demo.png" class="gallery-item" target="_blank" data-pswp-width="1698" data-pswp-height="582"><img src="/uploads/2022/11/10/jsdelivr-github-demo_huaeafff840bedf588ce827c05ae754f76_40041_800x0_resize_box_3.png"/></a><figcaption><p class="source"><a href="https://www.jsdelivr.com/github">生成工具</a>
    </p>

    <p>Cocoapods github 仓库和 jsdelivr CDN 生成结果</p></figcaption></figure>

<p>打开 <code>Podfile</code> 修改或添加新的地址：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-diff" data-lang="diff"><span class="line"><span class="ln">1</span><span class="cl"><span class="gd">- source &#34;https://cdn.cocoapods.org&#34;
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="gd"></span><span class="gi">+ source &#34;https://cdn.jsdelivr.net/gh/CocoaPods/cdn.cocoapods.org@gh-pages&#34;
</span></span></span></code></pre></div><p>也可以手动指定 jsdelivr 不同的 CDN 供应商</p>
<ul>
<li>fastly.jsdelivr.net</li>
<li>testingcf.jsdelivr.net</li>
<li>quantil.jsdelivr.net (目前不可用)</li>
</ul>
<p>利用这个原理可以套到任何支持 Github 仓库作为 CDN 加速的服务。</p>
]]></content:encoded></item><item><title>使用 CSS 支持图片黑暗模式动态切换</title><link>https://icyleaf.com/2022/11/how-to-render-image-between-light-and-dark-mode-with-css/</link><pubDate>Tue, 01 Nov 2022 11:24:24 +0800</pubDate><guid>https://icyleaf.com/2022/11/how-to-render-image-between-light-and-dark-mode-with-css/</guid><description>不用 Javascript 就不用 Javascript（傲娇）</description><content:encoded><![CDATA[<p><a href="https://github.com/tryzealot/zealot">Zealot</a> 项目是我个人长期以来的 Side Project，<a href="https://zealot.ews.im/zh-Hans/docs/user-guide/changelog#450-2022-08-19">4.5.0</a> 版本开始支持了黑暗模式并提供明亮、黑暗和随系统自动切换三种设置，前两种非常明确可以强制设定，随系统自动切换略微棘手 Javascript 一直是我的弱项，还好 CSS 提供 <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/@media/prefers-color-scheme">prefers-color-scheme</a> 能够很容易的判断系统主题。受益于 <a href="https://github.com/ColorlibHQ/AdminLTE/releases/tag/v3.2.0">AdminLTE</a> 支持黑暗模式，我只需要把用户设定的值传递给 Javascript 并动态<a href="https://github.com/tryzealot/zealot/blob/4.5.0/app/javascript/controllers/global_controller.js#L26-L37">设置特定的 CSS class 变量</a>。</p>
<h2 id="效果">效果</h2>
<p>尝试修改系统设置的主题，切换明亮和黑暗模式下面的结果有什么变化：</p>






<script
  data-slug-hash="mdKVOMy"
  data-user="your_username"
  data-height="500"
  data-default-tab="result"
  data-theme-id="8862"
  class='codepen'
  async
  src="//codepen.io/assets/embed/ei.js"
></script>

<p>如果看不到上面的演示，请<a href="https://codepen.io/icyleaf/pen/mdKVOMy">点击这里</a>打开新窗口预览。</p>
<h2 id="原理">原理</h2>
<h3 id="样式适配">样式适配</h3>
<p>CSS 样式的模式切换使用的是额外添加的 <code>@media (prefers-color-scheme: dark)</code> 作用域，在它里面对样式重新设置就可以完成对黑暗模式的修改：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-css" data-lang="css"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nt">body</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="k">font-family</span><span class="p">:</span> <span class="n">system-ui</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">background</span><span class="p">:</span> <span class="mh">#FFFFFF</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="k">text-align</span><span class="p">:</span> <span class="kc">center</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="c">/* 黑暗模式作用域 */</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="p">@</span><span class="k">media</span> <span class="o">(</span><span class="nt">prefers-color-scheme</span><span class="o">:</span> <span class="nt">dark</span><span class="o">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="nt">body</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="k">background</span><span class="p">:</span> <span class="mh">#000000</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>默认情况下 body 会设置系统字体、白色背景色和字体居中，黑暗模式下会覆盖背景色为黑色。</p>
<h3 id="图片适配">图片适配</h3>
<p>根据 CSS 样式的规则理论上可以把图片设置为 <code>background-image</code> ：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-css" data-lang="css"><span class="line"><span class="ln">1</span><span class="cl"><span class="p">.</span><span class="nc">intro-image</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="k">background-image</span><span class="p">:</span> <span class="nb">url</span><span class="p">(</span><span class="sx">intro-light.png</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="p">@</span><span class="k">media</span> <span class="o">(</span><span class="nt">prefers-color-scheme</span><span class="o">:</span> <span class="nt">dark</span><span class="o">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">  <span class="p">.</span><span class="nc">intro-image</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">    <span class="k">background-image</span><span class="p">:</span> <span class="nb">url</span><span class="p">(</span><span class="sx">intro-dark.png</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">9</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这个方案能实现却多了额外的设置，设置图片大小和缩放方式，也不太符合 HTML 的规范，图片建议设置到 HTML 标签中，<a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/picture"><!-- raw HTML omitted --></a> 标签就出现了。</p>
<p>它允许设置多个源 <code>source</code> 来应对不同的环境变量，如果都没有匹配或浏览器不支持再通过 img 标签兜底，利用该特性把 <code>prefers-color-scheme: dark</code> 添加到 <code>source</code> 中：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="ln">1</span><span class="cl"><span class="p">&lt;</span><span class="nt">picture</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="c">&lt;!-- 如果是黑暗模式使用该地址 --&gt;</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="p">&lt;</span><span class="nt">source</span> <span class="na">srcset</span><span class="o">=</span><span class="s">&#34;https://zealot.ews.im/img/showcase-dark.png&#34;</span> <span class="na">media</span><span class="o">=</span><span class="s">&#34;(prefers-color-scheme: dark)&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="c">&lt;!-- 兜底方案 --&gt;</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">  <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;https://zealot.ews.im/img/showcase-light.png&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="p">&lt;/</span><span class="nt">picture</span><span class="p">&gt;</span>
</span></span></code></pre></div><h2 id="实践">实践</h2>
<p>Zealot 在对图片适配手动设置和自动匹配黑暗模式是<a href="https://github.com/tryzealot/zealot/commit/b48573ce439c07be2eed305a4aac91f4475c2b27">这么做的</a>。项目主要适配的只有图片二维码，简单分解下实现步骤：</p>
<ol>
<li>动态二维码生成支持黑暗模式</li>
<li>判断系统是指定明亮或黑暗模式直接强制设定二维码图片对应的主题</li>
<li>随系统自动切换的情况下，追加 <code>picture</code> 标签做判断区分两种主题的图片地址</li>
</ol>
]]></content:encoded></item><item><title>Rails 产品环境配置加密凭证的完美方案</title><link>https://icyleaf.com/2022/09/perfect-solution-to-steup-rails-encrypted-credentials/</link><pubDate>Fri, 16 Sep 2022 13:58:31 +0800</pubDate><guid>https://icyleaf.com/2022/09/perfect-solution-to-steup-rails-encrypted-credentials/</guid><description>面向用户的项目如何保证数据安全的情况下给用户提供一个便捷部署方式</description><content:encoded><![CDATA[<p>续接上文，项目已经构建镜像后下一步大概率就要开始面向受众人群去传播使用。你有想过让用户自建服务时他要踩的坑吗？那绝对就是加密凭证的配置。</p>
<h2 id="rails-教你这么做">Rails 教你这么做</h2>
<p>很遗憾除了 Rails 寥寥几笔的配置以外你几乎找不到任何不一样的文章。加密凭证的文件结构如下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="ln">1</span><span class="cl">├── config
</span></span><span class="line"><span class="ln">2</span><span class="cl">│  ├── master.key           <span class="c1"># 核心私钥</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">│  ├── credentials.yml.enc  <span class="c1"># 加密凭证</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">│  └── ...
</span></span></code></pre></div><p><code>master.key</code> 是某种算法随机生成的加密串，<code>credentials.yml.enc</code> 是存储了各种 key、token、secret value 的 YAML 数据加密后的凭证数据。</p>
<p>Rails 以安全为由（我猜的）对开发者也“封闭”了加密过程，只能通过 <code>rails credentials:edit</code> 命令解密 YAML 数据才能编辑和保存。最致命的该命令是使用 <code>EDITOR</code> 环境变量配置的文本编辑器，这个通常是 vim, nano 等终端文本编辑器。</p>
<p>这就需要在部署项目的时候无法一键部署，必须在部署前让使用者敲一堆的命令、还要在终端的文本编辑器再敲一堆需要配置的数据。</p>
<p>我想不仅使用者会疯掉，很多 Rails 开发者或许也会发怵。</p>
<h2 id="我的最佳实践">我的最佳实践</h2>
<blockquote>
<p>截止 2022-10-20 为止适用于 Rails 7.x 版本。</p>
</blockquote>
<p>上面提到的“封闭”的意思是使用者不可见加解密过程，但可通过<a href="https://github.com/rails/rails/blob/7-0-stable/railties/lib/rails/commands/credentials/credentials_command.rb">开源代码</a>一探究竟。</p>
<p>我的思路很简单，不提前生成和挂载上面两个文件，通过设置 <code>RAILS_MASTER_KEY</code> 和 <code>RAILS_ENCRYPTED_CREDENTIALS</code> 两个环境变量再变相实现。</p>
<ul>
<li>
<p><code>RAILS_MASTER_KEY</code> 是 Rails 内置的变量，它会<a href="https://github.com/rails/rails/blob/7-0-stable/activesupport/lib/active_support/encrypted_file.rb#L53">优先读取</a>最后才会读取 <code>config/master.key</code>。</p>
</li>
<li>
<p><code>RAILS_ENCRYPTED_CREDENTIALS</code> 环境变量保存 <code>credentials.yml.enc</code> 文件的加密凭证数据，项目启动阶段通过脚本预处理。</p>
</li>
</ul>
<h3 id="加密凭证生成器">加密凭证生成器</h3>
<p>面向用户自动化配置，这就意味着需要项目开发者提供傻瓜式的配置工具。</p>













  
  
    
      <figure data-pswp="2278x1206" data-size="800x"><a href="/uploads/2022/09/16/generate-encrypted-credentials-tools.png" class="gallery-item" target="_blank" data-pswp-width="2278" data-pswp-height="1206"><img src="/uploads/2022/09/16/generate-encrypted-credentials-tools_hu53cdae0c645814fab78a15ed8fe0af52_167183_800x0_resize_box_3.png"/></a><figcaption>

    <p>加密凭证生成器</p></figcaption></figure>

<p>上面是一个实现功能的基础版本，如果部署方式是 Docker 或 docker-compose 也可以提供生成对应的部署脚本或文件。</p>
<h4 id="核心源码">核心源码</h4>
<p>生成规则均借鉴 Rails 内部 <code>ActiveSupport::EncryptedFile</code> 和 <code>ActiveSupport::EncryptedConfiguration</code> 逻辑，数据库加密参考 <a href="https://github.com/rails/rails/blob/7-0-stable/activerecord/lib/active_record/railties/databases.rake#L531">database.rake</a>：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">def</span> <span class="nf">create</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="n">env_key</span> <span class="o">=</span> <span class="s2">&#34;TEMP_MASTER_KEY&#34;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="no">ENV</span><span class="o">[</span><span class="n">env_key</span><span class="o">]</span> <span class="o">=</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">EncryptedConfiguration</span><span class="o">.</span><span class="n">generate_key</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="n">generator</span> <span class="o">=</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">EncryptedConfiguration</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="ss">config_path</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="ss">key_path</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="ss">env_key</span><span class="p">:</span> <span class="n">env_key</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="ss">raise_if_missing_key</span><span class="p">:</span> <span class="kp">false</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="p">)</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="n">master_key</span> <span class="o">=</span> <span class="n">generator</span><span class="o">.</span><span class="n">key</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="n">contents</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="s2">&#34;secret_key_base&#34;</span> <span class="o">=&gt;</span> <span class="no">SecureRandom</span><span class="o">.</span><span class="n">alphanumeric</span><span class="p">(</span><span class="mi">64</span><span class="p">),</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="s2">&#34;active_record_encryption&#34;</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">      <span class="s2">&#34;primary_key&#34;</span> <span class="o">=&gt;</span> <span class="no">SecureRandom</span><span class="o">.</span><span class="n">alphanumeric</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">      <span class="s2">&#34;deterministic_key&#34;</span> <span class="o">=&gt;</span> <span class="no">SecureRandom</span><span class="o">.</span><span class="n">alphanumeric</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">      <span class="s2">&#34;key_derivation_salt&#34;</span> <span class="o">=&gt;</span> <span class="no">SecureRandom</span><span class="o">.</span><span class="n">alphanumeric</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">
</span></span><span class="line"><span class="ln">21</span><span class="cl">  <span class="no">ENV</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">env_key</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">  <span class="n">render</span> <span class="ss">json</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="ss">master_key</span><span class="p">:</span> <span class="n">master_key</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="ss">encrypted_credentials</span><span class="p">:</span> <span class="n">generator</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="ss">:encrypt</span><span class="p">,</span> <span class="no">YAML</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">contents</span><span class="p">)),</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="ss">contents</span><span class="p">:</span> <span class="n">contents</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="k">end</span>
</span></span></code></pre></div><h3 id="自动化处理脚本">自动化处理脚本</h3>
<p>环境变量配置的 <code>RAILS_ENCRYPTED_CREDENTIALS</code> 变量并不会被 Rails 识别，必须在依赖 Rails 相关服务运行前（包括 Sidekiq）把变量的值转换成对应的文件即可。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="n">namespace</span> <span class="ss">:app</span> <span class="k">do</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="n">task</span> <span class="ss">:credentials</span> <span class="k">do</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="n">master_key_path</span> <span class="o">=</span> <span class="no">Rails</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;config&#39;</span><span class="p">,</span> <span class="s1">&#39;credentials&#39;</span><span class="p">,</span> <span class="s1">&#39;production.key&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="n">encrypted_file_path</span> <span class="o">=</span> <span class="no">Rails</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;config&#39;</span><span class="p">,</span> <span class="s1">&#39;credentials&#39;</span><span class="p">,</span> <span class="s1">&#39;production.yml.enc&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="n">encrypted_credentials</span> <span class="o">=</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;RAILS_ENCRYPTED_CREDENTIALS&#39;</span><span class="o">].</span><span class="n">presence</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="k">if</span> <span class="n">encrypted_credentials</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="n">encrypted_file_path</span><span class="p">)</span> <span class="o">||</span> <span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">encrypted_file_path</span><span class="p">)</span><span class="o">.</span><span class="n">empty?</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">      <span class="nb">puts</span> <span class="s2">&#34;Write encrypted data into </span><span class="si">#{</span><span class="n">encrypted_file_path</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">      <span class="no">File</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">encrypted_file_path</span><span class="p">,</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;RAILS_ENCRYPTED_CREDENTIALS&#39;</span><span class="o">]</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="k">end</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="n">encrypted</span> <span class="o">=</span> <span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">encrypted</span><span class="p">(</span><span class="n">encrypted_file_path</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="k">if</span> <span class="n">encrypted</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">nil?</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">      <span class="nb">fail</span> <span class="o">[</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="s2">&#34;Missing `RAILS_MASTER_KEY` enviroment value and not found file in </span><span class="si">#{</span><span class="n">master_key_path</span><span class="si">}</span><span class="s2">.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="s2">&#34;Make sure generate one first and store it in a safe place.&#34;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">      <span class="o">].</span><span class="n">join</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="k">end</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="k">next</span> <span class="k">if</span> <span class="n">encrypted_credentials</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="k">begin</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">      <span class="n">data</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">empty?</span><span class="p">(</span><span class="n">encrypted_file_path</span><span class="p">)</span> <span class="p">?</span> <span class="p">{}</span> <span class="p">:</span> <span class="p">(</span><span class="no">YAML</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">encrypted</span><span class="o">.</span><span class="n">read</span><span class="p">)</span> <span class="o">||</span> <span class="p">{})</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">      <span class="nb">puts</span> <span class="s2">&#34;Preparing encrypted keys: secret_key_base, active_record_encryption ...&#34;</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">
</span></span><span class="line"><span class="ln">26</span><span class="cl">      <span class="c1"># Priority: environment &gt; rails builtin &gt; credentials.yml.enc data</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">      <span class="n">data</span><span class="o">[</span><span class="s1">&#39;secret_key_base&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;SECRET_TOKEN&#39;</span><span class="o">].</span><span class="n">presence</span> <span class="o">||</span> <span class="n">data</span><span class="o">[</span><span class="s1">&#39;secret_key_base&#39;</span><span class="o">]</span> <span class="o">||</span> <span class="no">SecureRandom</span><span class="o">.</span><span class="n">alphanumeric</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">
</span></span><span class="line"><span class="ln">29</span><span class="cl">      <span class="c1"># Support encrypted_key in model</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">      <span class="n">data</span><span class="o">[</span><span class="s1">&#39;active_record_encryption&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">        <span class="s1">&#39;primary_key&#39;</span> <span class="o">=&gt;</span> <span class="no">SecureRandom</span><span class="o">.</span><span class="n">alphanumeric</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">        <span class="s1">&#39;deterministic_key&#39;</span> <span class="o">=&gt;</span> <span class="no">SecureRandom</span><span class="o">.</span><span class="n">alphanumeric</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">        <span class="s1">&#39;key_derivation_salt&#39;</span> <span class="o">=&gt;</span> <span class="no">SecureRandom</span><span class="o">.</span><span class="n">alphanumeric</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">
</span></span><span class="line"><span class="ln">36</span><span class="cl">      <span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">encrypted</span><span class="p">(</span><span class="n">encrypted_file_path</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="no">YAML</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">    <span class="k">rescue</span> <span class="no">OpenSSL</span><span class="o">::</span><span class="no">Cipher</span><span class="o">::</span><span class="no">CipherError</span><span class="p">,</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">MessageEncryptor</span><span class="o">::</span><span class="no">InvalidMessage</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">      <span class="nb">puts</span> <span class="s2">&#34;Couldn&#39;t decrypt </span><span class="si">#{</span><span class="n">encrypted_file_path</span><span class="si">}</span><span class="s2">. Perhaps `RAILS_MASTER_KEY` enviroment value is incorrect?&#34;</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">    <span class="k">end</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">  <span class="k">end</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl"><span class="k">end</span>
</span></span></code></pre></div><h3 id="docker-配置">Docker 配置</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="ln">1</span><span class="cl">docker run -d <span class="se">\
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="se"></span>  -e <span class="nv">RAILS_MASTER_KEY</span><span class="o">=</span><span class="s2">&#34;[master_key]&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="se"></span>  -e <span class="nv">RAILS_ENCRYPTED_CREDENTIALS</span><span class="o">=</span><span class="s2">&#34;[encrypted]&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="se"></span>  <span class="o">[</span>image_name<span class="o">]</span>
</span></span></code></pre></div><p>我的最佳实践并不代表是最完美的解决方案，最起码能够让用户避免碰触代码也能够很轻松的部署才是前提，不是吗？</p>
]]></content:encoded></item><item><title>Rails 构建镜像安全处理加密凭证</title><link>https://icyleaf.com/2022/09/rails-build-docker-image-handle-encrypted-credentials-securely/</link><pubDate>Thu, 15 Sep 2022 13:58:31 +0800</pubDate><guid>https://icyleaf.com/2022/09/rails-build-docker-image-handle-encrypted-credentials-securely/</guid><description>Docker 构建镜像该如何正确处理 master key 和 credentials.yml.enc</description><content:encoded><![CDATA[<p>最近在做一个小的 Side Project 作为公共服务首要是需要保证用户数据的绝对安全，这就需要对数据库数据做加密处理。</p>
<p>Rails <a href="https://qiita.com/NaokiIshimura/items/2a179f2ab910992c4d39">5.2</a> 开始支持 <code>credentials.yml.enc</code> 加密凭证，
<a href="https://blog.saeloun.com/2019/10/10/rails-6-adds-support-for-multi-environment-credentials.html">6.0</a> 支持多环境的 credentials 加密凭证，
<a href="https://blog.saeloun.com/2021/06/09/rails-7-add-encryption-to-active-record.html">7.0</a> 支持对 model 数据库表字段加密处理，但我从 5.1 支持 <code>secrets.yml</code> 开始就没使用过。
最近一周开发加摸索下来，总结一句话：<strong>一直加密一直爽，容器化奔赴火葬场。</strong></p>
<h2 id="机制原理">机制原理</h2>
<p>初始化一个 Rails 5.2+ 项目会在项目根目录 <code>config</code> 生成 <code>master.key</code> 和 <code>credentials.yml.enc</code> 两个文件，前者可以理解为核心密钥，后者是用核心密钥通过
<a href="https://github.com/rails/rails/blob/7-0-stable/activesupport/lib/active_support/encrypted_configuration.rb">ActiveSupport::EncryptedConfiguration</a> 加密类生成的加密后的数据文件。</p>
<p>只需要保证 <code>master.key</code> 不会泄露，通过 <code>rails credentials:edit</code> 配置服务所需的各自私密 token、secret key 之类也可以安全的提交到 Git 仓库中。</p>
<h3 id="存储路径">存储路径</h3>
<p>密钥和加密后的文件会存在如下目录：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1"># 缺省</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">config/master.key
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">config/credentials.yml.enc
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="c1"># Rails 生产环境决定 (6.0 开始支持)</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="c1"># 如下分别对应 development 和 production 环境</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">config/credentials/development.key
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">config/credentials/development.yml.enc
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl">config/credentials/production.key
</span></span><span class="line"><span class="ln">11</span><span class="cl">config/credentials/production.yml.enc
</span></span></code></pre></div><h3 id="触发机制">触发机制</h3>
<p>只要运行的代码会涉及 <code>config/environment.rb</code> 文件解密流程就会自动被触发，比如：</p>
<ul>
<li><code>rails server</code></li>
<li><code>rails console</code></li>
<li><code>Rakefile</code> 附加 <code>:environment</code> 参数的所有 tasks</li>
</ul>
<h3 id="常见加解密报错">常见加解密报错</h3>
<p>解密机制被触发的那一刻，它会从存储路径从缺省到当前生产环境去寻找对应的文件，master key 会优先读取 <code>RAILS_MASTER_KEY</code> 环境变量的值，没有才会去存储文件读取，都没有找到就报错 <code>MissingKeyError</code> 错误。</p>
<p>master key 在 Rails 5.2 ~ 7 版本密钥的长度必须符合 aes-128-gcm 也就是 32 字节，设置错误会得到 <code>InvalidKeyLengthError</code> 错误。</p>
<p><code>*.enc</code> 文件不存在会触发 <code>MissingContentError</code> 错误。</p>
<p>其他的错误还有可能是：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1"># 通常是 credentials.yml.enc 文件缺失或未设置 secret_key_base (SECRET_KEY_BASE) 的值</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">ArgumentError: Missing <span class="sb">`</span>secret_key_base<span class="sb">`</span> <span class="k">for</span> <span class="s1">&#39;production&#39;</span> environment, <span class="nb">set</span> this string with <span class="sb">`</span>bin/rails credentials:edit<span class="sb">`</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1"># master key 密钥不正确无法解密</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">Unable to load application: ActiveSupport::MessageEncryptor::InvalidMessage: ActiveSupport::MessageEncryptor::InvalidMessage
</span></span><span class="line"><span class="ln">6</span><span class="cl">
</span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="c1"># 错误同上</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl">OpenSSL::Cipher::CipherError
</span></span></code></pre></div><p>成就大体都列出来了，至于你能到哪步就看你的造化了（开玩笑）。</p>
<h2 id="数据库字段加密">数据库字段加密</h2>
<p>Rails 默认并不会对数据库字段加密，在 7.0 开始允许开发者定义加密字段也允许自定义加解密方法。这个不是本文的讨论范围不再展开。</p>
<p>初始化需要通过如下命令生成一个随机的 Keys：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ rails db:encryption:init
</span></span><span class="line"><span class="ln">2</span><span class="cl">Add this entry to the credentials of the target environment:
</span></span><span class="line"><span class="ln">3</span><span class="cl">
</span></span><span class="line"><span class="ln">4</span><span class="cl">active_record_encryption:
</span></span><span class="line"><span class="ln">5</span><span class="cl">  primary_key: KMw07GoiPScVwtmoNxlBv7YibFCnB4dU
</span></span><span class="line"><span class="ln">6</span><span class="cl">  deterministic_key: CTttlez04KZcy3MCMFtZ8FUEopSAmJOr
</span></span><span class="line"><span class="ln">7</span><span class="cl">  key_derivation_salt: FwUgrDWHX3wN7kKw5gYSsYEgzxRnYBWh
</span></span></code></pre></div><p>在通过 <code>rails credentials:edit</code> 把上端加密串加到 credentials 里面保存即可，<strong>不同的加密串是无法解密已经存在数据库中的数据的，切记！切记！切记！</strong>
否则你会再获得一个成就 <code>ActiveRecord::Encryption::Errors::Decryption</code> 报错。</p>
<h2 id="镜像构建处理">镜像构建处理</h2>
<blockquote>
<p>恭喜你，从现在开始你本应当直面恐惧，可惜你发现了我这篇文章缺少了点悲惨的经历。</p>
</blockquote>
<p>制作 Docker 镜像无论什么情况都要保证不会包含任何私密数据，Rails 绕不开的点主要是 <code>rails assets:complie</code>。
上面我也说了只要涉及 <code>:environment</code> 参数的所有 tasks 都会走解密流程，它也不例外。</p>
<p>构建方面我通过三种方式来解析如果从不安全到安全的构建过程：</p>
<h3 id="-最不安全的方式">🚫 最不安全的方式</h3>
<p>镜像构建允许设置 <a href="https://docs.docker.com/engine/reference/commandline/build/#set-build-time-variables---build-arg">build-arg</a> 传递：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">FROM</span><span class="s"> ruby:3.0.3</span><span class="err">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="err"></span><span class="k">ARG</span> master_key<span class="err">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="err"></span><span class="k">ENV</span> <span class="nv">RAILS_MASTER_KEY</span><span class="o">=</span><span class="nv">$master_key</span><span class="err">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="err"></span><span class="k">ENV</span> <span class="nv">RAILS_ENV</span><span class="o">=</span>production
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="c"># 省略</span><span class="err">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="err"></span>...<span class="err">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="err"></span><span class="k">RUN</span> bin/rails assets:complie<span class="err">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="err"></span><span class="c"># 或者</span><span class="err">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="err"></span><span class="k">RUN</span> <span class="nv">RAILS_MASTER_KEY</span><span class="o">=</span><span class="nv">$master_key</span> bin/rails assets:complie<span class="err">
</span></span></span></code></pre></div><p>执行构建命令 <code>docker build -t app --build-arg master_key=[32bits-length-key] .</code> 构建后虽然可以获得镜像，但构建时设置的值也被封装在了容器中，就算没有封装到容器中使用 <code>docker history</code> 也可以看到，因此这种方式是绝对不可取的。</p>
<h3 id="-改进版">⭕️ 改进版</h3>
<p>你可能会看到有些镜像的 Dockerfile 里面会包含多个 <code>FROM</code> 的<a href="https://docs.docker.com/develop/develop-images/multistage-build/">多阶段构建</a>。这个是为了利用隔离资源，重复利用缓存机制的方式使得最终的容器极可能的小和安全。我们可以利用它把私密数据隔离在前面的临时镜像中。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">FROM</span><span class="s"> ruby:3.0.3 as builder</span><span class="err">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="err"></span><span class="k">ARG</span> <span class="nv">workspace</span><span class="o">=</span>/app<span class="err">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="err"></span><span class="k">ARG</span> master_key<span class="err">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="err"></span><span class="k">ENV</span> <span class="nv">RAILS_MASTER_KEY</span><span class="o">=</span><span class="nv">$master_key</span><span class="err">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="err"></span><span class="k">ENV</span> <span class="nv">RAILS_ENV</span><span class="o">=</span>production
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="c"># 省略</span><span class="err">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="err"></span>...<span class="err">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="err"></span><span class="k">WORKDIR</span><span class="s"> $workspace</span><span class="err">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="err"></span><span class="k">RUN</span> bin/rails assets:complie<span class="err">
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="err"></span><span class="c"># 省略</span><span class="err">
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="err"></span>...<span class="err">
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> ruby:3.0.3-slim</span><span class="err">
</span></span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="err"></span><span class="c"># 省略</span><span class="err">
</span></span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="err"></span>...<span class="err">
</span></span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="err"></span><span class="k">COPY</span> --from<span class="o">=</span>builder <span class="nv">$workspace</span> <span class="nv">$workspace</span><span class="err">
</span></span></span></code></pre></div><p>镜像存在 <code>builder</code> 和一个缺省名字（通常是 <code>stage-N</code>, N 是数字从 1 开始）两个阶段，第一阶段是最不安全方式的实现方式，这里在最后一个阶段通过一个干净安全的镜像把上一个阶段的结果文件复制过来就达成了第一个阶段中私密数据泄露的问题。</p>
<p>这种方式也是当前大多数人会应用的方式，尤其利用 Github Action 的 <a href="https://docs.github.com/en/actions/security-guides/encrypted-secrets">Encrypted secrets</a> 功能从某种程度上杜绝了隐私数据的泄露。</p>
<h3 id="-加强版">✅ 加强版</h3>
<p><a href="https://docs.docker.com/develop/develop-images/build_enhancements/">Buildkit</a> 是 Docker 新一代镜像构建工具，启用可以通过配置环境变量 <code>DOCKER_BUILDKIT=1</code> 或在 Docker 配置文件的 features 字典增加 <code>&quot;buildkit&quot; : &quot;true&quot;</code>。</p>
<p>由于采用新的构建工具，额外还需要在 Dockerfile 头部显性声明新的语法：<code>syntax = docker/dockerfile:1.2</code> 配合
<a href="https://docs.docker.com/develop/develop-images/build_enhancements/#new-docker-build-secret-information">新的构建 secret </a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c"># syntax = docker/dockerfile:1.2</span><span class="err">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> ruby:3.0.3</span><span class="err">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="err"></span><span class="k">ARG</span> <span class="nv">workspace</span><span class="o">=</span>/app<span class="err">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="err"></span><span class="k">WORKDIR</span><span class="s"> $workspace</span><span class="err">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="err"></span><span class="c"># 省略</span><span class="err">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="err"></span>...<span class="err">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>master_key,target<span class="o">=</span>config/master.key,required<span class="o">=</span><span class="nb">true</span> <span class="se">\
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="se"></span>    bin/rails assets:precompile<span class="err">
</span></span></span></code></pre></div><p>构建命令执行需要通过 <a href="https://docs.docker.com/build/buildx/install/">buildx</a> CLI 子命令来完成：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ docker buildx build <span class="se">\
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="se"></span>  --secret <span class="nv">id</span><span class="o">=</span>master_key,src<span class="o">=</span>config/master.key <span class="se">\
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="se"></span>  -t app .
</span></span></code></pre></div><p>结合 <a href="https://github.com/moby/buildkit/blob/master/frontend/dockerfile/docs/reference.md#run---mounttypesecret">&ndash;mount-type=secret</a> 支持的参数:</p>
<table>
<thead>
<tr>
<th>参数名</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>密钥的唯一 id，默认是 target 参数的值的文件名</td>
</tr>
<tr>
<td>target</td>
<td>镜像内挂载的路径，默认是 <code>/run/secrets/</code> + <code>id</code></td>
</tr>
<tr>
<td>required</td>
<td>设置 <code>true</code> 当密钥不存在时报错，默认是 <code>false</code></td>
</tr>
<tr>
<td>mode</td>
<td>挂载后的文件权限，默认是 <code>0400</code></td>
</tr>
<tr>
<td>uid</td>
<td>设置密钥文件的用户 ID，默认是 <code>0</code></td>
</tr>
<tr>
<td>gid</td>
<td>设置密钥文件的用户组 ID，默认是 <code>0</code></td>
</tr>
</tbody>
</table>
<p><code>id</code> 关联 CLI 传参和构建镜像中执行步骤，CLI 入参设置 secret 的输入文件，构建镜像则需要把 secret 导出到镜像中具体的路径，其实就是这么简单。极少数支持 Docker
部署的云服务，比如 <a href="https://render.com/docs/docker-secrets">Render</a> 支持这种方式。部署到云服务上还需要重新考量下。</p>
<h2 id="本篇小结">本篇小结</h2>
<p>折腾一圈终于获得了一个干净、安全的镜像，等到部署时又傻眼了。面向技术人员或公司的项目倒还好，初始化时通过命令一通操作配置完也不需要处理 master key 不匹配的情况。
无论使用上面改进版还是加强版都能过顺利跑起来。如果 Docker 镜像是要面向客户的话，怎么让他们初始化一个属于他们自己的 master key 和加密数据呢？开始挠头了吧。</p>
<p><del>未完待续&hellip;</del> <a href="https://icyleaf.com/2022/09/perfect-solution-to-steup-rails-encrypted-credentials/">翻看答案</a>。</p>
<h2 id="参考资源">参考资源</h2>
<ul>
<li><a href="https://techblog.lclco.com/entry/2021/07/27/110000">Railsのcredentials.yml.encとmaster keyをDockerで安全に扱う</a></li>
<li><a href="https://pythonspeed.com/articles/docker-build-secrets/">Don’t leak your Docker image’s build secrets</a></li>
</ul>
]]></content:encoded></item><item><title>小新 Pad Pro 2021</title><link>https://icyleaf.com/gears/xiaoxin-pad-pro-2021/</link><pubDate>Fri, 12 Aug 2022 19:29:06 +0800</pubDate><guid>https://icyleaf.com/gears/xiaoxin-pad-pro-2021/</guid><description>Android 平板到底是生产力工具还是沦为看视频的最终归宿</description><content:encoded><![CDATA[



<div class="updated">
  <header class="updated-header">
    <h4 class="updated-title">更新</h4>
    
    <p class="updated-meta">1月 28, 2023</p>
    
  </header>
  <article class="updated-body">
    <ul>
<li>补充外接电源不稳定的解决方案</li>
<li>补充 Android 最近一段时间在用的独家应用和修复错误名称</li>
<li>补充 ZUI 14 体验</li>
</ul>

  </article>
</div>


<blockquote>
<p>不说需求无脑采购耍流氓，绝对不要没有需求创造需求。</p>
</blockquote>
<p>我曾经拥有过 2 台 iPad 2 <sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>，1 台 iPad Air 1 代，相继淘汰给了父母之后就再也没有考虑过购买任何平板，最核心的原因吃灰率太高，没法真正作为一个生产力工具，况且作为 iPhone 和 Android 双机型用户日常搭配使用基本覆盖 80% 的场景。</p>
<p>真正发生转变在每次外出游玩都要带很多的摄影器材，大量的素材需要备份，在那么重的情况下还要再背负一台很沉的 2015 年 Macbook Pro ，我急需一个便携外带方便，支持高速读写外部存储设备，还能快速预览素材、修修图的解决方案，还能看漫画或作为一些开发等生产力辅助工具。</p>
<p>在我写完本篇的那一刻联想刚刚发布了 2022 款，还是一样的骁龙 870 只是多了 120Hz 和快充，心安了。</p>
<h2 id="ipad-不是首选">iPad 不是首选？</h2>
<p>自己也没想到我最终入手了一台 Android 平板，竟然还是联想小新平板。</p>
<p>家里只有一台 iPad Pro M1 版口头上是给娃开发智力和娱乐使用实际上长期被妈妈霸占。硬件性能满足需求再经过测试<a href="https://twitter.com/icyleaf/status/1542320229568483328">无情淘汰</a>。iOS 14 自带的 File 文件管理工具太弱鸡，拷贝外部设备连个速率都没有还经常会断，只有一个第三方 <a href="https://www.youtube.com/watch?v=UtQ2Ymcp-zk">FE File Explorer</a> 应用还能打一些，但再入手一台 M1 说实话我舍不得，后来又出的 iPad Mini 6 和 iPad Air 5 都不是雷电 4 接口。</p>
<blockquote>
<p>再写本文时在最新的 iOS 15.5 上面测试自带 File 应用已经会显示速率，复制大文件的时候依然会卡几秒，但真正进入拷贝过程速度非常快！</p>
</blockquote>
<p>iPad 被排除后依次考虑过 Linux 平板<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>、Surface 和 Android 平板，时隔多年小米平板 5 <a href="https://twitter.com/icyleaf/status/1446034323136679939">不但沉</a> USB 还是 2.0，联想小新 Pad 有稍微关注过，我把重心放到了 2022 年新平板（<a href="https://weibo.com/1642632024/Lf64Y3kYH?refer_flag=1001030103_">爆料</a>），年初刷到<a href="https://twitter.com/oasisfeng/status/1481541399359389696">推友分享小新 Pad Pro</a>让我有点心动，可直接安装 Google 全家桶、USB 3.1、90Hz，可刷国际版，决定 4 月份新平板出来不合适就入手它。</p>













  
  
    
      <figure data-pswp="1973x1015" data-size="800x"><a href="/uploads/2022/08/12/xiaoxin-pads-compare.jpg" class="gallery-item" target="_blank" data-pswp-width="1973" data-pswp-height="1015"><img src="/uploads/2022/08/12/xiaoxin-pads-compare_hu9f0b77db774b36a991eecec9ea6d013c_427253_800x0_resize_q75_box.jpg"
      alt="图片来源"/></a><figcaption><p class="source">图片来源<a href="https://www.ithome.com/0/584/056.htm">IT 之家</a>
    </p>

    <p>小新 Pad 各个版本对比图</p></figcaption></figure>

<h2 id="选择它的理由">选择它的理由</h2>
<p>2021 年是国内 Android 平板重新回归的一年，也是<a href="https://www.qualcomm.com/products/application/smartphones/snapdragon-8-series-mobile-platforms/snapdragon-870-5g-mobile-platform">骁龙 870</a> 霸占 Android 平板最多的一年，直到 2022 年无论是 4 月份新出的 VIVO 平板，还是雷军良心发现小米平板 5 的硬件太过于吝啬 8 月赶紧补出的<a href="https://twitter.com/icyleaf/status/1558408826889519105">小米平板 5 Pro</a> 都是用的它。</p>
<p>综合分析下来小新 Pad Pro 2021 最最抗打的一个选择：USB 3.1 的接口协议；仅次于 MiniLED 的最好屏幕材质，配合 2K 分辨率，日常 420 尼特，峰值 600 尼特在一些非强光环境下画面是非常优秀的，看视频配合 4 扬声器能提高观看体验；它最牛皮的是支持外接最高 1TB Micro SD 卡；8600 的电池容量看着也不高，日常使用看视频下来 2 天还是没什么问题的。</p>
<blockquote class="twitter-tweet"><p lang="zh" dir="ltr">出去一下午3个小时的续航很抗打 <a href="https://t.co/1aFjg0O3bg">pic.twitter.com/1aFjg0O3bg</a></p>&mdash; icyleaf 🍺 (@icyleaf) <a href="https://twitter.com/icyleaf/status/1538545947608723457?ref_src=twsrc%5Etfw">June 19, 2022</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>配套键盘和笔我没买没资格讲这款，网上有很多说触控笔延迟有多高从 <a href="https://www.youtube.com/watch?v=LjlYQIAUV1Y">Youtuber 画画</a>好像也没什么太大问题，键盘后面会考虑入。</p>
<h2 id="喜欢的原因">喜欢的原因</h2>
<p>发布 1 年多来官方价格从来没有跳水，我在 2022 年 618 期间找了 PDD 在全网最低 1639 购入，比去年双 11 价格的价格竟然还要高一点。疫情让所有的硬件疯狂的涨价。当我拿到它的第一印象 11.5 寸屏幕果然还是有一点点大，背部有点丑需要一个保护壳把它遮挡住。</p>
<h3 id="满意的屏幕音响">满意的屏幕音响</h3>
<p>OLED 是仅次于 MiniLED 的最好屏幕材质，在配合 2K 分辨率和日常 420 尼特，峰值 600 尼特加持下，看漫画真的爽歪歪：</p>













  
  
    <figure data-pswp="1536x2048" data-size="1920x1080"><a href="/uploads/2022/08/12/tachiyomi-on-xiaoxin-pad-pro-2021.jpg" class="gallery-item" target="_blank" data-pswp-width="1536" data-pswp-height="2048"><img src="/uploads/2022/08/12/tachiyomi-on-xiaoxin-pad-pro-2021_hucbc89598ac49f5f0f14f62fb5b24d87e_411181_1920x1080_crop_q75_box_smart1.jpg"/></a><figcaption>

    <p>小新 Pad Pro 2021 上看漫画</p></figcaption></figure>

<p>在一些非强光环境下画面是非常优秀的，看视频配合 JBL 4 扬声器能提高观看体验，看视频我主要用到的是 Youtube、Bilibili、Jellyfin 和 Netflix 这四个 App，</p>
<p>平板支持 Dolby Vision 用 Youtube 和 B 站在大会员加持下最高画质，Jellyfin 升级 10.8 看片源和转码效率通常情况下不会太差，唯独 Netflix 因没有认证只有最高 1080p HD 画质，联想认证 HDR 的只有 Tab P11-12 Pro 和 Yoga Tab 13。</p>













  
  
    
      <figure data-pswp="2560x1600" data-size="800x"><a href="/uploads/2022/08/12/xiaoxin-video-encoder.jpg" class="gallery-item" target="_blank" data-pswp-width="2560" data-pswp-height="1600"><img src="/uploads/2022/08/12/xiaoxin-video-encoder_hu93fe9c789c7778a62a70f0bfd07f3965_1725089_800x0_resize_q75_box.jpg"
      alt="视频来源"/></a><figcaption><p class="source">视频来源<a href="https://www.bilibili.com/video/BV1tY4y1w7GQ">Linksphotograph</a>
    </p>

    <p>B 站的杜比视界和 Netflix 解码信息</p></figcaption></figure>

<p>骁龙 870 支持的视频解码器有 <code>Dolby Vision, HDR10+, HDR10, HLG, H.264 (AVC), H.265 (HEVC), VP8, VP9</code>。Netflix 媒体信息显示不支持 HDR 应该就是没有去认证的原因。</p>
<h3 id="开放的系统">开放的系统</h3>
<p>开源的 Android 系统在过去是一把双刃剑，趋于现在 Android 和 iOS 系统相互借鉴也越来越成熟，
它们直接的差距除了原生系统的交互体验外，更多的需要考察开发者及应用生态。通常情况下一个成熟的商业应用会同时考虑跨端赚取用户群体，以下我会在双端安装：</p>
<ul>
<li>Chrome: 浏览器</li>
<li>Lightroom: 修图必备</li>
<li>Kiwi: 人类知识离线大全</li>
<li>Jellyfin: 配合服务器 Jellyfin 的客户端版本</li>
<li>he.net: 网管专用</li>
<li>Pocket Casts: 个人喜爱的泛用型播客客户端</li>
<li>Spark: 邮件客户端</li>
<li>kubenav: Kubernetes 管理工具</li>
<li>Termius: 服务器 SSH/Mosh 管理工具</li>
<li>Brewfather: 家酿啤酒必备</li>
</ul>
<p>如果 iOS 生态有独占的优势，Android 在生产力方面有独特的优势<sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup>：</p>
<ul>
<li><a href="https://github.com/tachiyomiorg/tachiyomi">Tachiyomi</a>: 开源的看漫画神器，支持多图源聚合，还有很多<span class="spoiler">绅士图源</span>
 <img loading="lazy" src="https://jaywcjlove.github.io/sb/ico/min-oss.svg"
  
  
  alt="Open-Source Software"></img>
</li>
<li><a href="https://play.google.com/store/apps/details?id=pl.solidexplorer2&amp;hl=zh&amp;gl=US">Solid Explorer</a>: 最好用的文件管理器，没有之一 <img loading="lazy" src="/images/icons/playstore.png"
  
  
  alt="Play Store"></img>
 <img loading="lazy" src="https://jaywcjlove.github.io/sb/ico/min-free.svg"
  
  
  alt="Freeware"></img>
</li>
<li><a href="https://github.com/devgianlu/Aria2App">Aria2App</a>: 支持本机和远程的 Aria2 下载管理客户端 <img loading="lazy" src="https://jaywcjlove.github.io/sb/ico/min-oss.svg"
  
  
  alt="Open-Source Software"></img>
</li>
<li><a href="https://play.google.com/store/apps/details?id=dev.reimu.proxmon&amp;hl=zh&amp;gl=US">ProxMon</a>: Proxmox (PVE) 客户端管理工具 <img loading="lazy" src="/images/icons/playstore.png"
  
  
  alt="Play Store"></img>
 <img loading="lazy" src="https://jaywcjlove.github.io/sb/ico/min-free.svg"
  
  
  alt="Freeware"></img>
</li>
<li><span class="spoiler"><a href="https://cn.pornhub.com/apps/android">Pornhub</a></span>
: 知名 P 站 <img loading="lazy" src="https://jaywcjlove.github.io/sb/ico/min-free.svg"
  
  
  alt="Freeware"></img>
</li>
<li><span class="spoiler"><a href="https://github.com/bdvajstudio/javdb">JavDB</a></span>
: 番号资源和磁力资源，配合 Aria2App 无敌 <img loading="lazy" src="https://jaywcjlove.github.io/sb/ico/min-oss.svg"
  
  
  alt="Open-Source Software"></img>
</li>
<li><span class="spoiler"><a href="https://play.google.com/store/apps/details?id=com.github.kr328.clash">Clash for Android</a></span>
: 一个会挖洞的可爱猫咪 <img loading="lazy" src="/images/icons/playstore.png"
  
  
  alt="Play Store"></img>
 <img loading="lazy" src="https://jaywcjlove.github.io/sb/ico/min-oss.svg"
  
  
  alt="Open-Source Software"></img>
</li>
<li><a href="https://play.google.com/store/apps/details?id=com.dev47apps.droidcam">DroidCam</a>: 把 Android 相机当做 PC/macOS 摄像头 <img loading="lazy" src="/images/icons/playstore.png"
  
  
  alt="Play Store"></img>
</li>
<li><a href="https://play.google.com/store/apps/details?id=de.kai_morich.serial_usb_terminal">Serial USB Terminal</a>: USB 串口模拟器 <img loading="lazy" src="/images/icons/playstore.png"
  
  
  alt="Play Store"></img>
</li>
</ul>
<h3 id="外接数据备份">外接数据备份</h3>
<p>接口 3.1 协议允许外接扩展坞用于连接显示器，鼠标键盘开启电脑模式，这也是这个产品的卖点我一点也不看好，实际测试中系统反应迟钝，应用窗口显示比例不对，尽可能忘记这个功能。</p>
<p>外接设备对数据备份才是我的核心需求，我做过两次尝试：</p>
<ol>
<li>双 Type-C 直插平板和 SSD 移动硬盘，支持两者之间的数据拷贝</li>
<li>扩展坞连接 SD、micro SD 卡，支持两者之间的数据拷贝</li>
<li>扩展坞连接 SD 卡和 SSD 移动硬盘，支持三者之间的数据拷贝</li>
</ol>
<p>功能上确实满足我的需求，可惜这有几个致命的缺陷且很大几率我还没法正常工作，首先是外接设备识别成功率很低，经常性直插去都没有提示或是有提示没有任何后续反应，在 Solid Explorer 和系统文件应用都看不到外接设备，看到设备打开应用会闪退，这一点让我很沮丧。</p>
<p>就算是成功连接了，外部设备的访问权限反复提醒，我不确定这是 Android 11 的问题还是 ZUI 移植后的适配问题。</p>













  
  
    
      <figure data-pswp="1280x800" data-size="800x"><a href="/uploads/2022/08/12/xiaoxin-pad-filesystem-role.jpg" class="gallery-item" target="_blank" data-pswp-width="1280" data-pswp-height="800"><img src="/uploads/2022/08/12/xiaoxin-pad-filesystem-role_hufd965a5646fcac3bf759d723011481ba_52527_800x0_resize_q75_box.jpg"/></a><figcaption>

    <p>令人烦恼的外部设备访问权限</p></figcaption></figure>

<p>终于能操作了，数据拷贝的速度如果不是双 Type-C，尽管扩展坞支持 USB 3.0 但速度上限只有 70MB/s 这还是瞬时整个拷贝过程 IO 非常不稳定。</p>













  
  
    
      <figure data-pswp="1280x800" data-size="800x"><a href="/uploads/2022/08/12/xiaoxin-pad-copy-tf-photo.jpg" class="gallery-item" target="_blank" data-pswp-width="1280" data-pswp-height="800"><img src="/uploads/2022/08/12/xiaoxin-pad-copy-tf-photo_hua774598b8262a8b6461e699a789dd2a1_39461_800x0_resize_q75_box.jpg"/></a><figcaption>

    <p>使用 Solid Explorer 拷贝 TF 卡到平板</p></figcaption></figure>

<p>经过长时间的使用和观察，外接硬盘建议使用扩展坞 + 外部电源（支持 PD 协议充电宝也行）对操作外部存储设备稳定性有很大的帮助。</p>
<h3 id="zui-的问题">ZUI 的问题</h3>
<p>小新 Pad 使用的是自研的 ZUI，截至目前 13 版本只能说堪用，系统提供自由浮窗，分屏功能，但应用支不支持又是另外一回事，偶尔用一下看到应用不分屏肯定会暗地不爽。系统级别的应用几乎不怎么使用，都由上面我说的代替了，输入法需要说下 <a href="https://play.google.com/store/apps/details?id=com.google.android.inputmethod.latin">Gboard</a> 在 99% 的情况下都是非常好用的，<del>剩下的 1% 是它不支持隐藏键盘的功能</del>（触发返回动作隐藏）。</p>













  
  
    
      <figure data-pswp="1280x800" data-size="800x"><a href="/uploads/2022/08/12/xiaoxin-pad-dual-screens.jpg" class="gallery-item" target="_blank" data-pswp-width="1280" data-pswp-height="800"><img src="/uploads/2022/08/12/xiaoxin-pad-dual-screens_hu7b5f7f1053e7051437caf6b8c5b8c076_195282_800x0_resize_q75_box.jpg"/></a><figcaption>

    <p>分屏模式</p></figcaption></figure>

<p>我基本上把它的个人安全功能设置了关闭，在安装一些被认为是有风险的应用都非常顺畅，不像 MIUI 时不时就让你登录小米账号来验证。在这样的情况下无障碍功能功能总会被关闭，造成李跳跳、Bitwarden 无法长期保持开启的状态。不杀后台应用也会触发关闭，非常的莫名其妙。</p>
<p><del>我只希望今年年底要发布的 ZUI 14 能够解决我上面说的问题， 让我拭目以待吧</del></p>
<p>ZUI 14 的发布后第一时间升级，使用下来让人非常失望，870 U 有点点力不从心，系统的 Dock 栏新增了最近打开应用的功能鸡肋打开多了状态栏变小很不适用，自发布后大半年了连个小更新都没有，最恶心的是应用商店把 Play Store 应用标记为不兼容，需要重新关闭再打开设置，应用管理里面的&quot;谷歌基础服务&quot;开关。</p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p><a href="https://twitter.com/icyleaf/status/123008427495657473">第一台丢在了下飞机的座位上</a>，<a href="https://twitter.com/icyleaf/status/166714788649504769">第二台至今还会被母上拿出来凑合用一下</a>&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>也有刷到推友入手 chromebook duet 咨询和搜索后都没了解到 USB 接口协议版本，没敢入手&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3">
<p>部分图标版权均来自<a href="https://github.com/jaywcjlove/awesome-mac">awesome-mac</a>:<br>
<img loading="lazy" src="https://jaywcjlove.github.io/sb/ico/min-oss.svg"
  
  
  alt="Open-Source Software"></img>
意思是<strong>代码开源</strong>;<br>
<img loading="lazy" src="https://jaywcjlove.github.io/sb/ico/min-free.svg"
  
  
  alt="Freeware"></img>
意思是免费使用或个人免费授权;<br>
<img loading="lazy" src="/images/icons/playstore.png"
  
  
  alt="Play Store"></img>
意思是谷歌应用商店的应用&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>
]]></content:encoded></item><item><title>如何搭建家用 homelab: 先导篇</title><link>https://icyleaf.com/2022/02/how-to-homelab-part-0-intro/</link><pubDate>Sat, 12 Feb 2022 20:00:00 +0800</pubDate><guid>https://icyleaf.com/2022/02/how-to-homelab-part-0-intro/</guid><description>搭建 homelab 之前都需要了解哪些背景</description><content:encoded><![CDATA[<h2 id="前言">前言</h2>
<p>这将会是一个持续系列的主题文章，你将会从最基础的家庭 homelab 搭建开始循序渐进到一些进阶的系统、网络、服务层面的学习。我尽可能以新人的角色描述简单易懂的语言，系列文章会涉及家庭网络、路由器、Linux、数据储存、NAS、服务化等等，如果你在过程中又遇到任何问题，欢迎给我留言。</p>













  
  
    
      <figure data-pswp="4644x3004" data-size="800x"><a href="/tutorials/how-to-homelab/part-0/homelab-diagram-v2.0.png" class="gallery-item" target="_blank" data-pswp-width="4644" data-pswp-height="3004"><img src="/tutorials/how-to-homelab/part-0/homelab-diagram-v2.0_hud6b13e642cdec1b76e4883675cc1f0da_933051_800x0_resize_box_3.png"
      alt="图片来源"/></a><figcaption><p class="source">图片来源<a href="https://twitter.com/icyleaf/status/1472036769742745603">@icyleaf@twitter.com</a>
    </p>

    <p>2021 年底 v2.0 镇楼用的网络拓扑图</p></figcaption></figure>

<h2 id="搭建-homelab-起因">搭建 homelab 起因</h2>
<blockquote>
<p>homelab: a laboratory of (usually slightly outdated) awesome in the domicile</p>
</blockquote>
<p>从语言直译来看可以说是家庭 homelab，把这个事情延展到网络及服务上面那就可以干很多有意思的事情，比如：</p>
<ul>
<li>NAS 存储：资源下载、存放任何的数据（照片、小姐姐、学习资料、代码等）</li>
<li>影视库：从最简单的网络共享文件夹到可以托管影视管理、播放、转码为一体的 Jellyfin、Plex 服务</li>
<li>网络管理：设备限流、流量审计、防火墙策略</li>
<li>应用开发：做一些 side projects 需要开发环境、缓存、数据存储等</li>
<li>DevOps：ansible、salt、k8s 来操作维护多个服务器、VM 或者是 lxc</li>
</ul>
<p>如果您恰好是一名软件应用开发者，homelab 是最佳的扩展你的技能的很好的实验田，学习网络拓扑、Linux 系统、安全管理等。
对于大部分人来说或许多多少少都会听说过 NAS 服务器，其实他也是 homelab 的实践应用之一。</p>
<p>不要被它的名字吓到，本质上它就是在一个操作系统上面跑一堆上面提到和没提到的服务而已。</p>
<h2 id="自建考虑的点">自建考虑的点</h2>
<p>无论上面提到的点有多么吸引你想要组件自己的家庭 homelab，您还要慎重考虑是否真的需要，毕竟真的整一套也会投入很大的精力和一些资金，千万不要没有需求创造需求。</p>
<blockquote>
<p>本系列的内容会优先考虑使用开源、免费的解决方案，如果真的无法满足会分享一些商业的解决方案。</p>
</blockquote>
<h2 id="商业成品方案">商业成品方案</h2>
<p>商业成品主要是售卖软件服务来提供类网络管理、数据存储等的解决方案，市面上主流的主要是：</p>
<ul>
<li><a href="https://www.synology.com/">群晖</a>: 搭配硬件售卖，各方面都非常令人满意的软件系统，对小白非常友好</li>
<li><a href="https://www.qnap.com/">威联通</a>: 搭配硬件售卖的软件，价格比群晖有优势，软件系统相对群晖要逊色不少</li>
<li><a href="https://unraid.net/">UnRaid</a>: 一款商业的 NAS 系统，但提供快速扩容、Docker 和 VM 管理</li>
<li><a href="https://store.ui.com/collections/unifi-network-unifi-os-consoles">UniFi OS</a>: 主要是 Dream Machine 搭载的系统，整体下来价格非常昂贵</li>
</ul>
<p>通常情况下商业成品是一站式的解决方案，采购的话费用也会比自建要投入更多的资金，这个就不再 homelab 的考虑范围，这里就一笔带过。</p>
<h2 id="开源免费方案">开源&amp;免费方案</h2>
<p>自建 homelab 必然会从硬件、软件下手，准备好了再决定网络拓扑结构。</p>
<h2 id="硬件筛选">硬件筛选</h2>
<p>国内和国外的硬件环境有非常大的不同，国内有很多的洋垃圾、魔改硬件的讨论，比如您可能听说过的 E3/E5 神教、垃圾佬之类的名词。
若你是这个领域的行家恭喜你会省不少钱；若你不是也不用沮丧踏踏实实的花钱买数据安全，切记也不要盲目入手垃圾佬的硬件，捡垃圾有风险，有些硬件会被超的很高这样的性价比也会很低而不值得入手。</p>
<p>最关键的几个部分：CPU、内存、主板、网络和硬盘。</p>
<ul>
<li>CPU 和内存很好理解，CPU 核心数量、内存容量越多越能造，如果对于影视播放有要求就需要 CPU 有好的核心支持。</li>
<li>主板对网口数量、扩展槽会有依赖，网口数量和硬盘数量支持不多就要靠扩展槽来凑。</li>
<li>网络状况至关重要，WiFi 6 传输速度还是不如千兆有线，评估下自己家里猫和路由器最低要求千兆网络，有线也尽量是 CAT5e/CAT6 规格</li>
<li>NAS 应用场景对硬盘容量和规格要求比较高，SSD 不是强需求，如果不差钱全上 SSD 也不是不行。</li>
</ul>
<p>这里每一个展开聊都是非常大的话题，我可能会整理一些外部资源供您去补充这方面的知识。市面上也有一些成品硬件的解决方案，您也可以考虑：</p>
<ul>
<li>英特尔 NUC：小巧的机型并不代表他的性能很弱，最新 12 代的 NUC 从各方面都是很好的选择</li>
<li>联想 ThinkCentre 系列：比 NUC 稍微大点，这个系列体系非常的庞大且悠久，也有不少价格合适的二手和改装件，但会折腾一些</li>
<li>惠普 MicroServer Gen 系列：Gen8/Gen10 都是目前主流的 homelab 解决方案，正统服务器规格和特性。（我有一台 Gen 8 正在服役）</li>
<li>各种开发板：比如树莓派从 3B 开始它也能做一些 homelab 的应用场景，国内外资料丰富，配件众多。唯一的缺点受新冠影响它的价格在国内居高不下，可以考虑一些其他成熟的开发板。</li>
<li>各种矿渣主机：区块链盛行的挖矿行业充斥着很多挖矿主机，比如星际蜗牛、绿盘、蜜獾超存等，有些硬件参数还不错到手之后需要调节或改下静音风扇就可用。</li>
</ul>
<p>最简单的版本就是可以找一个可以长期运行的不再使用的笔记本电脑、台式电脑就能起步（功耗太高的话就真的算了）</p>
<h2 id="软件部署方案">软件部署方案</h2>
<p>硬件准备完备之后，我们来考虑搭配哪种软件部署方案，通常会被划分为三大类：</p>
<ul>
<li>传统部署（Traditional Deployment）</li>
<li>虚拟化部署（Virutalization Deployment）</li>
<li>容器化部署（Containerd Deployment）</li>
</ul>












<figure data-pswp="1800x650" data-size="0x0"><a href="/tutorials/how-to-homelab/part-0/container-evolution.svg" class="gallery-item" target="_blank" data-pswp-width="1800" data-pswp-height="650"><img src="/tutorials/how-to-homelab/part-0/container-evolution.svg"
      alt="图片来源"/></a><figcaption><p class="source">图片来源<a href="https://kubernetes.io/zh/docs/concepts/overview/what-is-kubernetes/">Kubernetes 是什么？</a>
    </p>

    <p>部署方式的演变</p></figcaption></figure>

<p>通常在硬件性能还算不错情况下都不会采用传统部署的方案，单主机的优先级：容器化 &gt; 虚拟化 &gt; 传统部署，机器性能不错且有技术兴趣度的优先级：虚拟化 &gt; 容器化 &gt; 传统部署。</p>
<h3 id="传统部署">传统部署</h3>
<p>传统部署通常是在 Bare-metal 机器上面进行的，因此我把它俩划为等号，它使用硬件主机安装操作系统如 Window、macOS 和 *nix (Unix/Linux) 后直接安装和部署服务，听起来没什么特别的，
市面上也会有很多的运维工具用于解决安装系统、配置环境、后期维护、数据备份的工作，比如 Salt、Ansible、Puppet 等有一定的学习成本，没法做到开箱即用， 100% 发挥硬件机能也会是一个问题。</p>













  
  
    
      <figure data-pswp="1920x1080" data-size="800x"><a href="/tutorials/how-to-homelab/part-0/bare-metal.jpg" class="gallery-item" target="_blank" data-pswp-width="1920" data-pswp-height="1080"><img src="/tutorials/how-to-homelab/part-0/bare-metal_hu4b369ced3c986b922f395ae6ff16aca0_920504_800x0_resize_q75_box.jpg"
      alt="图片来源"/></a><figcaption><p class="source">图片来源<a href="https://thecloudgirl.dev/BareMetal.html">The Cloud Girl</a>
    </p>

    <p>Bare metal 方案</p></figcaption></figure>

<h3 id="虚拟化部署">虚拟化部署</h3>
<ul>
<li><a href="https://www.vmware.com/products/esxi-and-esx.html">ESXi</a>: VMware 公司开发的硬件虚拟化解决方案，界面简单易用，自身功能较强，付费使用</li>
<li><a href="https://www.proxmox.com">Proxomx</a>: 基于 Debian 开发企业级虚拟化系统，支持硬件直通，可扩展集群，上手难度略高，简称 PVE</li>
</ul>
<p>基于开源解决方案实在没有太多可选性，PVE 是市面上最成熟、社区活跃也很高的方案，
就算遇到奇奇怪怪的问题善用搜索引擎代替上都可以解决。</p>
<h3 id="容器化部署">容器化部署</h3>
<ul>
<li><a href="https://www.docker.com/">Docker</a>: 现代容器化的开山鼻祖，自己比较作引发了大叛逃就有了下面两个解决方案</li>
<li><a href="https://containerd.io/">Containerd</a>: 始于 Docker 母公司，壮大在 CNCF 基金会，提供 nerdctl 代替 docker CLI</li>
<li><a href="https://podman.io/">Podman</a>: Red Hat 公司领导的兼容 Docker 的解决方案</li>
</ul>
<p>一句话总结没看懂就用 docker 就行。</p>
<h2 id="基础系统">基础系统</h2>
<p>如果选择传统部署随便用一个你熟悉且满足你需求的操作系统即可</p>
<h2 id="应用服务">应用服务</h2>
<p>定好软硬件的基础后您需要面对非常庞大的应用服务来扩展和丰富 homelab</p>
<h3 id="初阶方案">初阶方案</h3>
<h4 id="软路由">软路由</h4>
<ul>
<li><a href="https://github.com/openwrt/openwrt">openwrt</a>: 国内最近今年非常主流的解决方案，国内有个 <a href="https://github.com/immortalwrt/immortalwrt">immortalwrt</a> 分支版本</li>
<li><a href="https://www.asuswrt-merlin.net/">梅林</a>: 华硕开源的路由器固件，同样国内有个 <a href="https://www.koolcenter.com/">koolcenter</a> 改版</li>
<li><a href="https://dd-wrt.com/">dd-wrt</a>: 在流行刷路由器初期的懵懂的固件，受限于硬件支持度和更新频率渐行渐远，当时支持多 wan 的 tomato</li>
</ul>
<h4 id="网关">网关</h4>
<ul>
<li><a href="https://www.nginx.com/">nginx</a>: 老牌传统网关，用于托管或反向代理网站服务</li>
<li><a href="https://caddyserver.com/">caddy v2</a>: 现代化设计的 HTTP/2 且支持 <a href="https://letsencrypt.org/">Let’s encrypt</a> 的网关</li>
</ul>
<h4 id="dns">DNS</h4>
<ul>
<li><a href="https://dnsmasq.org/">dnsmasq</a>: 一切的基础，用于配置 DNS 和 DHCP 服务</li>
<li><a href="https://pi-hole.net/">pi-hole</a>: 主打保护隐私和过滤广告的路由系统，常用海外用户</li>
<li><a href="https://adguard.com/zh_cn/adguard-home/overview.html">adguard home</a>: 专注保护隐私和过滤广告全网广告拦截的服务，提供用户友善的 UI 界面</li>
<li><a href="https://github.com/pymumu/smartdns">smartDNS</a>: 加速 DNS 解析分流的 DNS 服务</li>
<li><a href="https://github.com/IrineSistiana/mosdns">mosdns</a>: 集 smartDNS 和 adguard home 优点并存的 DNS 服务但配置麻烦</li>
</ul>
<h4 id="防火墙">防火墙</h4>
<ul>
<li><a href="https://www.netfilter.org/projects/iptables/index.html">iptables</a>: Linux 常见的内置防火墙</li>
<li><a href="https://www.netfilter.org/projects/nftables/index.html">nftables</a>: iptables 的官方增强版，未来的趋势都会慢慢迁移过来</li>
<li><a href="https://www.pfsense.org/">pfSense</a>: 国外普遍使用的一款开源防火墙</li>
</ul>
<h4 id="nas">NAS</h4>
<ul>
<li><a href="">OpenMediaValut</a>: 硬件依赖低门槛的综合性 NAS 系统</li>
</ul>
<h4 id="服务部署">服务部署</h4>
<ul>
<li><a href="https://www.portainer.io/">portainer</a>: 简单容易上手的容器化部署解决方案</li>
</ul>
<h4 id="影音">影音</h4>
<ul>
<li><a href="https://jellyfin.org/">Jellyfin</a>: 影视剧、电影等媒体播放服务，支持片源资料搜刮和看过数据同步服务</li>
</ul>
<h4 id="应用">应用</h4>
<ul>
<li><a href="https://bitwarden.com/">Bitwarden</a>: 开源且完全可代替 1 Password 的全平台密码生成管理服务，推荐使用开发者用 Rust 重写的 <a href="https://github.com/dani-garcia/vaultwarden">vaultwarden</a></li>
<li><a href="https://zoneminder.com/">ZoneMinder</a>: 开源多路摄像头&amp;录像管理服务</li>
</ul>
<p>更多的应用可以关注我的<a href="https://github.com/stars/icyleaf/lists/self-host-services">自建服务集合</a></p>
<h3 id="高级进阶">高级进阶</h3>
<p>下面介绍的也仅限于我个人能力范围内目前想到的点，能力有限也请手下留情。</p>
<h4 id="网关-1">网关</h4>
<ul>
<li><a href="https://traefik.io/traefik/">traefik</a>: 一款开源的反向代理与负载均衡综合性工具</li>
</ul>
<h4 id="nas-1">NAS</h4>
<ul>
<li><a href="https://www.truenas.com/">TrueNAS</a>: 国外做数据存储的首选，基于 ZFS 文件系统内存大小决定磁盘容量的上限，前身叫 FreeNAS</li>
</ul>
<h4 id="服务部署-1">服务部署</h4>
<ul>
<li><a href="https://kubernetes.io/">Kubernetes</a>: 现代容器化编排系统，所谓的云 YAML 工程师终极工具 😆</li>
</ul>
<h2 id="小结">小结</h2>
<p>homelab 玩法的可能性是无限的，不要把想象力局限在这几年国内流行的所谓 AIO Boom：
使用 pve 部署一切，更甚者用 openwrt + docker 部署各自服务出现问题先不说，
真遇到服务器宕机一波全带走。</p>
<p>另外不要太过于计较服务器的功耗情况，只要不是电耗子 35W 还是 65W 没省多少电费，
下面是一个正面例子，虽然用的是 X99-T8D + E5 2696V3*2 + 金河田 6100 双路电源
但开发者主要用于适合自己场景的使用，那就不是浪费。</p>
<blockquote class="twitter-tweet"><p lang="zh" dir="ltr">太牛逼了！今天把 <a href="https://twitter.com/wey_gu?ref_src=twsrc%5Etfw">@wey_gu</a> 哥哥送给我的 NUMA Server 弄好了，这是我人生中第一次拥有 NUMA，看到配置的时候直接惊住了，大半夜微信骚扰 Wey 哥哥表达自己的震惊和感谢，心想我何德何能可以拥有这么豪华的配置！在上面起了几个 VM 组了个 k8s 集群，终于不用紧张兮兮地在我的 MBP 上起 k8s 了！开心！ <a href="https://t.co/B9uwSiQXxK">pic.twitter.com/B9uwSiQXxK</a></p>&mdash; yetone (@yetone) <a href="https://twitter.com/yetone/status/1540235004495921152?ref_src=twsrc%5Etfw">June 24, 2022</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>下面这个图中的例子是一个反面教材，要么哗众取宠要么非蠢即坏。</p>
<blockquote class="twitter-tweet"><p lang="zh" dir="ltr">待机 100W 的低性能 NAS，这是图什么😂 <a href="https://t.co/WgphSsjobb">pic.twitter.com/WgphSsjobb</a></p>&mdash; taresky (@taresky) <a href="https://twitter.com/taresky/status/1555752846334705666?ref_src=twsrc%5Etfw">August 6, 2022</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>最后的忠告，国内各自信息咨询站的 OpenWrt，NAS 文章看看就行，别太认真。
有那时间不如多看看官方文档，官方社区讨论 :D</p>
]]></content:encoded></item><item><title>Zealot</title><link>https://icyleaf.com/2021/12/intro-zealot/</link><pubDate>Wed, 22 Dec 2021 18:45:06 +0800</pubDate><guid>https://icyleaf.com/2021/12/intro-zealot/</guid><description>一个为开发者提供快速测试应用核心的应用分发平台</description><content:encoded><![CDATA[



<div class="updated">
  <header class="updated-header">
    <h4 class="updated-title">更新</h4>
    
    <p class="updated-meta">1月 28, 2023</p>
    
  </header>
  <article class="updated-body">
    Zealot 4.6.0 是 2023 年春节前最新发布的版本，支持了 Arm 平台部署，正文部分做了对应的更新。
  </article>
</div>


<p>Zealot 是一个为开发者提供快速测试应用核心的应用分发平台，可通过网页、接口（ CI 、CD 服务）上传 iOS 、Android 甚至是 macOS 的应用文件，甚至是连微软 AppCenter 2021 年底还都不支持的 Android aab 格式，全网独一份，撒花！服务会自动解析应用的元数据等信息，上传版本还可以显示丰富的变更日志、甚至是提供给内部看的自定义字段。针对 iOS 测试者提供除了基本获取设备 UDID 的基础上还会提示测试者是否已经有关联的应用可以安装。</p>













  
  
    
      <figure data-pswp="2798x2080" data-size="800x"><a href="/uploads/2021/12/22/zealot-showcase.png" class="gallery-item" target="_blank" data-pswp-width="2798" data-pswp-height="2080"><img src="/uploads/2021/12/22/zealot-showcase_hu129f59bbb7a9006df1d1d4dae982d4a2_298971_800x0_resize_box_3.png"/></a><figcaption>

    <p>Zealot 服务样图</p></figcaption></figure>

<h2 id="特性">特性</h2>
<ul>
<li>🌏 <strong>多平台应用支持</strong>: macOS、iOS、甚至是 APK 和 AAB 格式的 Android 应用上传、安装（支持 ARM 的 macOS）和下载</li>
<li>🗄 <strong>多渠道分类管理</strong>: Debug、AdHoc、Enterprise 还是 Android 应用渠道管理统统没问题</li>
<li>📱 <strong>测试设备一网打进</strong>: 自动同步 iOS 测试设备信息，允许一键注册新设备到苹果开发者</li>
<li>🧑‍💻 <strong>丰富开发者套件</strong>: 提供 REST API、[iOS][zealot-ios-sdk]、[Android][android-android-sdk] SDK 以及 [fastlane][fastlane-plugin-zealot] 自动化构建插件</li>
<li>💥 <strong>剖析应用内部的秘密</strong>: 解读 iOS、Android 应用或 iOS 描述文件的元信息</li>
<li>🎳 <strong>多架构部署</strong>: amd86、arm64 和 armv7 任君选择（支持 ARM 的 macOS）</li>
<li>🚨 <strong>内置多种事件通知</strong>: 数据可自定义 Income WebHook 到任意通知服务</li>
<li>🔑 <strong>第三方登录</strong>: 飞书、Gitlab、Google 和 LDAP 一键授权</li>
<li>🌑 <strong>黑暗模式</strong>: 黑夜白昼自由切换</li>
</ul>
<h2 id="开发者的自言自语">开发者的自言自语</h2>
<p>Zealot 虽然可能最近半年才慢慢有少部分人接触并使用，实际上历时 7 年的磨练，吸取了多家公司内场景和经验地演变，专注于应用的托管和分发服务，是目前国内外唯一一个支持几乎全平台（Windows/Linux 除外）的应用分发托管平台；唯一支持 Android aab 格式解析的平台；唯一提供 iOS/Android SDK ，fastlane 插件等为开发者、测试者友好的开源项目，希望大家用的开心！ En Taro Adun! 🖖</p>
<h2 id="项目地址">项目地址</h2>
<p><a href="https://github.com/tryzealot/zealot/">https://github.com/tryzealot/zealot/</a></p>
<h2 id="在线演示">在线演示</h2>
<blockquote>
<p>注意: 数据每日都会重新初始化，不对用户上传的应用承担任何法律风险，后果自负！</p>
</blockquote>
<ul>
<li>演示地址: <a href="https://tryzealot.herokuapp.com/">https://tryzealot.herokuapp.com/</a></li>
<li>电子邮箱: <a href="mailto:admin@zealot.com">admin@zealot.com</a></li>
<li>登录密码: <span class="spoiler">ze@l0t</span>
</li>
</ul>
]]></content:encoded></item><item><title>Cocoapods 新增 CDN 加速镜像源码解读</title><link>https://icyleaf.com/2019/11/cocoapods-cdn-source-code-reading/</link><pubDate>Fri, 15 Nov 2019 19:10:07 +0800</pubDate><guid>https://icyleaf.com/2019/11/cocoapods-cdn-source-code-reading/</guid><description>通过代码剖析对比前后都发生了什么变化</description><content:encoded><![CDATA[<p>Cocoapods <a href="https://blog.cocoapods.org/CocoaPods-1.7.2/">1.7.2</a> 版本开始增加 CDN 支持但默认没有启用，<a href="http://blog.cocoapods.org/CocoaPods-1.8.0-beta/">1.8</a> 版本的发布舍弃了原始完整克隆的 Specs 仓库改用 CDN 服务。CDN 利用的是免费且强大的 <a href="https://github.com/CocoaPods/Core/pull/541">Netlify</a> CDN 服务，<del>该 CDN 网络在国内是有备案因此速度和稳定性都会有很好的保证</del>。类似提案去年有人用 Cocoapods Plugin 实现并向社区<a href="https://github.com/CocoaPods/CocoaPods/issues/8268">贡献 PR</a>。</p>
<p>那么 CDN 支持相比之前的机制有啥优势呢？难道是把 Pods 的仓库和源码都托管到 CDN 网络了吗，其实并不是的。</p>
<blockquote>
<p>友情提醒：本文只重点分析 Pods 下载的机制，不展开其他方面，以下只是 <code>pod install</code> 执行顺序中的一部分，如果你想了解 Cocoapods 都干了什么可以前往<a href="https://www.jianshu.com/p/84936d9344ff">这篇文章</a>查阅。</p>
</blockquote>
<h3 id="老的机制">老的机制</h3>
<p>第一步先检查本地 <code>~/.cocoapods/repo/master</code> 目录是否存在，没有直接克隆 <code>https://github.com/Cocoapods/Specs.git</code> 仓库，这步在国内来说特别费时间正常下载下来目录应该是 2G+，如果有其他 source 源（比如私有源）会重复刚才的操作。</p>
<p>第二步安装 Podfile 每个 Pod 去在各个源中寻找对应的版本，从版本的 .podspec 文件解析获取组件的地址，这个可能是 http、git、svn、hg 中的<a href="https://guides.cocoapods.org/syntax/podspec.html#source">任意一个</a>，获取到之后开始下载（默认是在 <code>~/Library/Caches/CocoaPods</code> 做缓存目录）</p>
<h3 id="新的机制">新的机制</h3>
<p>第一步分析 Podfile 里面的 source ，如果没有走默认 Cocoapods 的配置（1.8 以上是 <a href="https://cdn.cocoapods.org">https://cdn.cocoapods.org</a> ，之前的还是 Cocoapods/Spec），
如果本地不存在官方 cdn 的 repo 名字是 trunk 的保留字，自己无法创建。如果有自定义的 source 会追加上去 sources 列表。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="ln"> 1</span><span class="cl">$ http HEAD https://cdn.cocoapods.org/all_pods.txt
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">HTTP/1.1 200 OK
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">Accept-Ranges: bytes
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">Age: 0
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">Cache-Control: public, max-age=0, must-revalidate
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">Connection: keep-alive
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">Content-Length: 924280
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">Content-Type: text/plain; charset=UTF-8
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">Date: Sat, 09 Nov 2019 07:06:15 GMT
</span></span><span class="line"><span class="ln">10</span><span class="cl">Etag: &#34;acf0d284f3a8e82e0d66ba1a91cd30b9-ssl&#34;
</span></span><span class="line"><span class="ln">11</span><span class="cl">Server: Netlify
</span></span><span class="line"><span class="ln">12</span><span class="cl">Strict-Transport-Security: max-age=31536000
</span></span><span class="line"><span class="ln">13</span><span class="cl">X-NF-Request-ID: 50b466cd-ce9e-4326-b5bb-0d29a193ae4b-7809449
</span></span></code></pre></div><p>第二步检查或下载每个 source，每个 source 会检查是否是 cdn 类型（使用 HEAD 请求检查是否包含 /all_pods.txt）文件：</p>
<ul>
<li>cdn 类型，下面详细解释</li>
<li>其他类型，走原来的老的逻辑，不再赘述</li>
</ul>
<p>第三步，下载 <code>Cocoapods-version.yml</code> 并缓存 etag，下载 <code>/Cocoapods-version.yml</code> 并取 headers 的第一个 etag 的值存为 <code>/Cocoapods-version.yml.etag</code>，如果存在 etag 会比对一样就不需要下载， 链接支持根目录和其他目录，支持 301 跳转。</p>
<p>Cocoapods-version.yml</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="ln">1</span><span class="cl"><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w"></span><span class="nt">min</span><span class="p">:</span><span class="w"> </span><span class="m">1.0.0</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w"></span><span class="nt">last</span><span class="p">:</span><span class="w"> </span><span class="m">1.8.4</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w"></span><span class="nt">prefix_lengths</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="w"></span>- <span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="w"></span>- <span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="w"></span>- <span class="m">1</span><span class="w">
</span></span></span></code></pre></div><p>第四步，分析 Pod 并获取 pod 的版本信息，比如 Podfile 我增加了一个 <code>pod &quot;AFNetworking&quot;</code>，把 pod 名字做 MD5 后的值取 Cocoapods-version.yml 的 prefiex_length 数组长度的值单字母拆分用下划线分割按照规则拼成文件名 <code>all_pods_versions(_{fragment}).txt</code> (如果prefix_length 为 0 则只会去下载 <code>/all_pods_versions.txt</code>)</p>
<p>比如：prefix_lengths 数组大小为 3，AFNetworking MD5 后 <code>a75d452377f396bdc4b623a5df25820</code> 则匹配前三位 a75 拆分后 a_7_5
后查找 cdn url 路径的 <code>/all_pods_versions_a_7_5.txt</code> 下载下来后的内容：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="ln">1</span><span class="cl">Fuse/0.1.0/0.2.0/1.0.0/1.1.0/1.2.0
</span></span><span class="line"><span class="ln">2</span><span class="cl">GXFlowView/1.0.0
</span></span><span class="line"><span class="ln">3</span><span class="cl">JFCountryPicker/0.0.1/0.0.2
</span></span><span class="line"><span class="ln">4</span><span class="cl">JVEmptyElement/0.1.0
</span></span></code></pre></div><p>第五步，下载 pod 的所有版本的 .podspec 文件，从上面的文件按照每行寻找第一段的名字，把后面的所有版本按照上面获取到的 prefix_lengths 的值（例如 AFNetworking 是 a, 7 , 5） <code>/Specs/a/7/5/AFNetworking/{version}/AFNetworking.podspec.json</code> 一次下载，并保存 etag 为 <code>/Specs/a/7/5/AFNetworking/{version}/AFNetworking.podspec.json.etag</code>，这个 etag 作用上面已经讲过，如果没有找到的话就会直接报错。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="ln">1</span><span class="cl">Adding spec repo `trunk` with CDN `https://cdn.cocoapods.org/`
</span></span><span class="line"><span class="ln">2</span><span class="cl">  CDN: trunk Relative path downloaded: CocoaPods-version.yml, save ETag: &#34;031c25b97a0aca21900087e355dcf663-ssl&#34;
</span></span><span class="line"><span class="ln">3</span><span class="cl">  CDN: trunk Relative path: CocoaPods-version.yml exists! Returning local because checking is only perfomed in repo update
</span></span><span class="line"><span class="ln">4</span><span class="cl">  CDN: trunk Relative path downloaded: all_pods_versions_a_7_5.txt, save ETag: &#34;5b32718ecbe82b0ae71ab3c77120213f-ssl&#34;
</span></span><span class="line"><span class="ln">5</span><span class="cl">  CDN: trunk Redirecting from https://cdn.cocoapods.org/Specs/a/7/5/AFNetworking/0.10.0/AFNetworking.podspec.json to https://raw.githubusercontent.com/CocoaPods/Specs/master/Specs/a/7/5/AFNetworking/0.10.0/AFNetworking.podspec.json
</span></span><span class="line"><span class="ln">6</span><span class="cl">  CDN: trunk Relative path downloaded: Specs/a/7/5/AFNetworking/0.10.0/AFNetworking.podspec.json, save ETag: W/&#34;a5f00eb1fdfdcab00b89e96bb81d48c110f09220063fdcf0b269290bffc18cf5&#34;
</span></span></code></pre></div><p>Cocoapods trunk 源的目录结构：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="ln">1</span><span class="cl">.cocoapods
</span></span><span class="line"><span class="ln">2</span><span class="cl">  repo
</span></span><span class="line"><span class="ln">3</span><span class="cl">    trunk
</span></span><span class="line"><span class="ln">4</span><span class="cl">      .url   #=&gt; https://cdn.cocoapods.org/
</span></span><span class="line"><span class="ln">5</span><span class="cl">      Cocoapods-version.yml  # =&gt; 从 https://cdn.cocoapods.org/CocoaPods-version.yml 下载的文件
</span></span><span class="line"><span class="ln">6</span><span class="cl">      Cocoapods-version.yml.etag  # 上一个请求的第一个 etag 值存下来
</span></span><span class="line"><span class="ln">7</span><span class="cl">      all_pods_versions_a_7_5.txt  # 参考上面的备注
</span></span><span class="line"><span class="ln">8</span><span class="cl">      all_pods_versions_a_7_5.txt.etag # 上一个请求的第一个 etag 值存下来
</span></span></code></pre></div><p>第六步和老的机制第二步一样同样最终还是会寻找 podspec 里面下载地址去下载，
也就是说<strong>真正 CDN 缓存加速的只有原有 Specs 必要的 podspec 文件，而不会加速 Pod 真正源地址</strong>，改机制只是减轻了本地更新官方 Specs 源的麻烦以及维护一个巨大的本地文件存储，这也是中心化机制的一个心结。</p>
<h3 id="结语">结语</h3>
<p>这个机制大大减少了本地需要占一个较大存储的问题，尤其是初次 <code>pod install</code> 时间长的情况，但 Pod 库本身还是各自的
地址本质上无法解决安装 Pod 消耗时间过长的问题。</p>
]]></content:encoded></item><item><title>创建无 Storyboard（xib） 的 macOS NSWindow</title><link>https://icyleaf.com/2019/05/create-macos-nswindow-without-storyboard/</link><pubDate>Thu, 23 May 2019 22:45:07 +0800</pubDate><guid>https://icyleaf.com/2019/05/create-macos-nswindow-without-storyboard/</guid><description>macOS 开发和 iOS 差异真的很大</description><content:encoded><![CDATA[<h3 id="前言">前言</h3>
<p>历届 WWDC 众多和 macOS 开发相关的视频中只要涉及到 UI 部分必会牵扯上 Storyboard，它能帮你辅助画 UI，使用 Auto Layout 进行布局，甚至你可以不用写一行代码仅仅使用它和 Core Data 就能完成一个 CURD 的功能。苹果总是极力的推荐所有的开发者（尤其是初学者）使用 Storyboard，它给人最直观的感受，配置参数也都做了调教（有时候开启一个参数需要手敲好多行代码）。</p>
<p>但总有那么一群人就是不爱使用 Storyboard（比如我），尤其 App 涉及比较多的界面和交互的时候感觉还是代码更可控，团队开发在代码仓库管理上也更为方便。</p>
<p>何奈在网络上存在的绝大多数的教程和视频都是以 Storyboard 为主，稍不留神可能就忘记设置了哪里，再或者过段时间举一反三的时候总会忘记在 Storyboard 设置了什么而无法实现同样的效果。</p>
<p>恰好我最近比较闲花了点时间在写 macOS App，过程中体会到了 macOS 和 iOS 两个体系存在了巨大的差异，可能是习惯了 iOS 框架的编码方式就感觉到 macOS 格格不入，想要完成一个在 iOS 上简单的界面但 macOS 上就要想尽各种办法来去实现，迫切期待在马上来临的 WWDC 2019 上宣布新的解决方案。</p>
<h3 id="开始教学">开始教学</h3>
<p>打开 Xcode 选择 macOS 下面的 Cocoa App 进行下一步，填写好项目名称后勾不勾选 <strong>Use Storyboard</strong> 都没有关系，勾选就会创建一个 <code>Main.storyboard</code> 的文件，不勾选也会创建一个 <code>MainMenu.xib</code> 的文件，选择项目保存的路径就创建好第一个项目了。</p>
<p>无论默认的是 <code>Main.storyboard</code> 或 <code>MainMenu.xib</code> 都会一个 Main Menu 控件这里咱们先不管它，除此之外还会有一个 Window 控件，一个 macOS App 基础的层级关系是这样的</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="ln">1</span><span class="cl">+--------------------------------------------------------------+
</span></span><span class="line"><span class="ln">2</span><span class="cl">|                           NSWindow                           |
</span></span><span class="line"><span class="ln">3</span><span class="cl">|  +--------------------------------------------------------+  |
</span></span><span class="line"><span class="ln">4</span><span class="cl">|  |                    NSViewController                    |  |
</span></span><span class="line"><span class="ln">5</span><span class="cl">|  |  +--------------------------------------------------+  |  |
</span></span><span class="line"><span class="ln">6</span><span class="cl">|  |  |                      NSView                      |  |  |
</span></span><span class="line"><span class="ln">7</span><span class="cl">|  |  +--------------------------------------------------+  |  |
</span></span><span class="line"><span class="ln">8</span><span class="cl">|  +--------------------------------------------------------+  |
</span></span><span class="line"><span class="ln">9</span><span class="cl">+--------------------------------------------------------------+
</span></span></code></pre></div><p>选中 Window 控件后后选择删除（<code>Main.storyboard</code> 还需要再删除默认生成的 ViewController 控件），删除后样子是这样的</p>
<p><img loading="lazy" src="/tutorials/macos-app-without-storyboard/001/shot001-xcode-storyboard.png"
  
  
  alt="Storyboard and xib in Xcode"></img>
</p>
<p>由于我们删除了默认的 NSWindow 因此需要在 <code>Appdelegate.swift</code> 文件创建一个：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kd">import</span> <span class="nc">Cocoa</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="kr">@NSApplicationMain</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="kd">class</span> <span class="nc">AppDelegate</span><span class="p">:</span> <span class="n">NSObject</span><span class="p">,</span> <span class="n">NSApplicationDelegate</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="c1">// 创建默认的 Window</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="kr">lazy</span> <span class="kd">var</span> <span class="nv">window</span><span class="p">:</span> <span class="n">NSWindow</span> <span class="p">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">       <span class="kd">let</span> <span class="nv">w</span> <span class="p">=</span> <span class="n">NSWindow</span><span class="p">(</span><span class="n">contentRect</span><span class="p">:</span> <span class="n">NSMakeRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">640</span><span class="p">,</span> <span class="mi">480</span><span class="p">),</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">                        <span class="n">styleMask</span><span class="p">:</span> <span class="p">[.</span><span class="n">titled</span><span class="p">,</span> <span class="p">.</span><span class="n">resizable</span><span class="p">,</span> <span class="p">.</span><span class="n">miniaturizable</span><span class="p">,</span> <span class="p">.</span><span class="n">closable</span><span class="p">,</span> <span class="p">.</span><span class="n">fullSizeContentView</span><span class="p">],</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">                        <span class="n">backing</span><span class="p">:</span> <span class="p">.</span><span class="n">buffered</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">                        <span class="k">defer</span><span class="p">:</span> <span class="kc">false</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl">        <span class="c1">// 设置最小尺寸</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">        <span class="n">w</span><span class="p">.</span><span class="n">minSize</span> <span class="p">=</span> <span class="n">NSMakeSize</span><span class="p">(</span><span class="mi">320</span><span class="p">,</span> <span class="mi">240</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="c1">// 打开显示在屏幕的中心位置</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="n">w</span><span class="p">.</span><span class="n">center</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl">        <span class="k">return</span> <span class="n">w</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="p">}()</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>默认的 window 设置好了，我们让他赶紧显示出来吧，在 <code>applicationDidFinishLaunching</code> 方法添加如下代码:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="ln">1</span><span class="cl"><span class="kd">func</span> <span class="nf">applicationDidFinishLaunching</span><span class="p">(</span><span class="kc">_</span> <span class="n">aNotification</span><span class="p">:</span> <span class="n">Notification</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">    <span class="c1">// 设置为 mainWindow 这样我们才能通过下面的代码调用</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">    <span class="n">window</span><span class="p">.</span><span class="n">makeKeyAndOrderFront</span><span class="p">(</span><span class="kc">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">
</span></span><span class="line"><span class="ln">5</span><span class="cl">    <span class="c1">// 设置 mainWindow 的标题</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">    <span class="n">NSApplication</span><span class="p">.</span><span class="n">shared</span><span class="p">.</span><span class="n">mainWindow</span><span class="p">?.</span><span class="n">title</span> <span class="p">=</span> <span class="s">&#34;Hello world&#34;</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>注意看上面代码块的备注，这两行代码不能颠倒，否则 <code>NSApplication.shared.mainWindow</code> 返回的是 <code>nil</code>，我们来运行一下看看，是不是就能看到一个 640x480 的窗口，标题显示的 hello world</p>
<p><img loading="lazy" src="/tutorials/macos-app-without-storyboard/001/shot002-nswindow.png"
  
  
  alt="NSWindow App"></img>
</p>
<p>用鼠标拖拽缩放大小看看是不是到一个保留尺寸就无法再缩小了，这个就是通过代码设置的最小尺寸。虽然 App 可以运行了内容还是空空的，根据上面画出来的层级关系还需要一个 NSViewController 充当 contentViewController，它相当于 iOS 的 rootViewController 这样说应该就很容易理解了吧。</p>
<p>假设 App 需要完成这样一个功能，界面有一个 Label 和 Button，点击 Button 可以改变 Label 的文字内容：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="ln">1</span><span class="cl">+----------------------+          +----------------------+
</span></span><span class="line"><span class="ln">2</span><span class="cl">|                      |          |                      |
</span></span><span class="line"><span class="ln">3</span><span class="cl">|   Click the button   |          |         Yeah!        |
</span></span><span class="line"><span class="ln">4</span><span class="cl">|                      |          |                      |
</span></span><span class="line"><span class="ln">5</span><span class="cl">| +------------------+ | -------&gt; | +------------------+ |
</span></span><span class="line"><span class="ln">6</span><span class="cl">| |     Click me     | |          | |     Click me     | |
</span></span><span class="line"><span class="ln">7</span><span class="cl">| +------------------+ |          | +------------------+ |
</span></span><span class="line"><span class="ln">8</span><span class="cl">|                      |          |                      |
</span></span><span class="line"><span class="ln">9</span><span class="cl">+----------------------+          +----------------------+
</span></span></code></pre></div><p>我们用原生 Auto Layout 布局后的代码是这样的</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kd">import</span> <span class="nc">Cocoa</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="kd">class</span> <span class="nc">ViewController</span><span class="p">:</span> <span class="n">NSViewController</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="kr">lazy</span> <span class="kd">var</span> <span class="nv">label</span><span class="p">:</span> <span class="n">NSTextField</span> <span class="p">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">        <span class="kd">let</span> <span class="nv">v</span> <span class="p">=</span> <span class="n">NSTextField</span><span class="p">(</span><span class="n">labelWithString</span><span class="p">:</span> <span class="s">&#34;Press the button&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">        <span class="n">v</span><span class="p">.</span><span class="n">translatesAutoresizingMaskIntoConstraints</span> <span class="p">=</span> <span class="kc">false</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">        <span class="k">return</span> <span class="n">v</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="p">}()</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="kr">lazy</span> <span class="kd">var</span> <span class="nv">button</span><span class="p">:</span> <span class="n">NSButton</span> <span class="p">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">        <span class="kd">let</span> <span class="nv">v</span> <span class="p">=</span> <span class="n">NSButton</span><span class="p">(</span><span class="n">frame</span><span class="p">:</span> <span class="p">.</span><span class="n">zero</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="n">v</span><span class="p">.</span><span class="n">translatesAutoresizingMaskIntoConstraints</span> <span class="p">=</span> <span class="kc">false</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">
</span></span><span class="line"><span class="ln">17</span><span class="cl">        <span class="k">return</span> <span class="n">v</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="p">}()</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="kr">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">        <span class="kc">super</span><span class="p">.</span><span class="n">viewDidLoad</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">
</span></span><span class="line"><span class="ln">23</span><span class="cl">        <span class="n">view</span><span class="p">.</span><span class="n">addSubview</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">        <span class="n">view</span><span class="p">.</span><span class="n">addSubview</span><span class="p">(</span><span class="n">button</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">
</span></span><span class="line"><span class="ln">26</span><span class="cl">        <span class="n">NSLayoutConstraint</span><span class="p">.</span><span class="n">activate</span><span class="p">([</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">            <span class="n">label</span><span class="p">.</span><span class="n">centerXAnchor</span><span class="p">.</span><span class="n">constraint</span><span class="p">(</span><span class="n">equalTo</span><span class="p">:</span> <span class="n">view</span><span class="p">.</span><span class="n">centerXAnchor</span><span class="p">),</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">            <span class="n">label</span><span class="p">.</span><span class="n">centerYAnchor</span><span class="p">.</span><span class="n">constraint</span><span class="p">(</span><span class="n">equalTo</span><span class="p">:</span> <span class="n">view</span><span class="p">.</span><span class="n">centerYAnchor</span><span class="p">,</span> <span class="n">constant</span><span class="p">:</span> <span class="o">-</span><span class="mi">20</span><span class="p">),</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">
</span></span><span class="line"><span class="ln">30</span><span class="cl">            <span class="n">button</span><span class="p">.</span><span class="n">centerXAnchor</span><span class="p">.</span><span class="n">constraint</span><span class="p">(</span><span class="n">equalTo</span><span class="p">:</span> <span class="n">view</span><span class="p">.</span><span class="n">centerXAnchor</span><span class="p">),</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">            <span class="n">button</span><span class="p">.</span><span class="n">topAnchor</span><span class="p">.</span><span class="n">constraint</span><span class="p">(</span><span class="n">equalTo</span><span class="p">:</span> <span class="n">label</span><span class="p">.</span><span class="n">bottomAnchor</span><span class="p">,</span> <span class="n">constant</span><span class="p">:</span> <span class="mi">20</span><span class="p">),</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">            <span class="n">button</span><span class="p">.</span><span class="n">heightAnchor</span><span class="p">.</span><span class="n">constraint</span><span class="p">(</span><span class="n">equalToConstant</span><span class="p">:</span> <span class="mi">30</span><span class="p">),</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">            <span class="n">button</span><span class="p">.</span><span class="n">widthAnchor</span><span class="p">.</span><span class="n">constraint</span><span class="p">(</span><span class="n">equalToConstant</span><span class="p">:</span> <span class="mi">100</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">            <span class="p">])</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">
</span></span><span class="line"><span class="ln">36</span><span class="cl">        <span class="n">button</span><span class="p">.</span><span class="n">title</span> <span class="p">=</span> <span class="s">&#34;Click me&#34;</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">        <span class="n">button</span><span class="p">.</span><span class="n">target</span> <span class="p">=</span> <span class="kc">self</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">        <span class="n">button</span><span class="p">.</span><span class="n">action</span> <span class="p">=</span> <span class="k">#selector</span><span class="p">(</span><span class="n">onClickme</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">
</span></span><span class="line"><span class="ln">41</span><span class="cl">    <span class="kr">@objc</span> <span class="kd">func</span> <span class="nf">onClickme</span><span class="p">(</span><span class="kc">_</span> <span class="n">sender</span><span class="p">:</span> <span class="n">NSButton</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">        <span class="n">label</span><span class="p">.</span><span class="n">textColor</span> <span class="p">=</span> <span class="p">.</span><span class="n">red</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">        <span class="n">label</span><span class="p">.</span><span class="n">stringValue</span> <span class="p">=</span> <span class="s">&#34;Yeah!&#34;</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>代码看着不错的样子，还差最后一步把 ViewController 添加到 NSWindow 里吧，返回 <code>AppDelegate.swift</code> 文件找到上次编辑的 <code>applicationDidFinishLaunching</code> 方法里面在代码的末尾添加最后的代码：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kd">func</span> <span class="nf">applicationDidFinishLaunching</span><span class="p">(</span><span class="kc">_</span> <span class="n">aNotification</span><span class="p">:</span> <span class="n">Notification</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">    <span class="c1">// 设置为 mainWindow 这样我们才能通过下面的代码调用</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="n">window</span><span class="p">.</span><span class="n">makeKeyAndOrderFront</span><span class="p">(</span><span class="kc">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="c1">// 设置 mainWindow 的标题</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="n">NSApplication</span><span class="p">.</span><span class="n">shared</span><span class="p">.</span><span class="n">mainWindow</span><span class="p">?.</span><span class="n">title</span> <span class="p">=</span> <span class="s">&#34;Hello world&#34;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="c1">// 设置 contentViewController</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="kd">let</span> <span class="nv">contentViewController</span> <span class="p">=</span> <span class="n">ViewController</span><span class="p">()</span> <span class="c1">// or ViewController(nibName:nil, bundle: nil)</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="n">window</span><span class="p">.</span><span class="n">contentViewController</span> <span class="p">=</span> <span class="n">contentViewController</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><blockquote>
<p>咦？！你这不对啊，<code>NSViewController</code> 代码在初始化的时候是不能这样的，必须通过 <code>init(coder:)</code> 或 <code>init(nibName:bundle:)</code> 这两种方法才行，这样写运行会提示 &ldquo;could not load the nibName: WithoutStoryboard.ViewController in bundle (null).&rdquo; 错误的！</p>
</blockquote>
<p>观察的不错嘛，这点小细节都你发现了，NSViewController 类通常都是通过 <code>init(nibName:bundle:)</code> 进行初始化来关联 xib 界面，既然我们抛弃了 Storyboard（xib) 那怎么办呢，这里理解 NSViewController 的<a href="https://developer.apple.com/documentation/appkit/nsviewcontroller">生命周期</a> （macOS 10.10 之后版本)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="ln"> 1</span><span class="cl">+----------------------------------+   +------------------------------+
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">|               init               +--&gt;+           loadView()         |
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">+-----------------+----------------+   +---------------+--------------+
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">| Storyboard(xib) |      code      |                   |
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">+----------------------------------+                   v
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">|  init(coder:)   | init(nibName:  |   +---------------+--------------+
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">|                 |      bundle:)  |   |          viewDidLoad()       |
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">+-----------------+----------------+   +---------------+--------------+
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">                                                       |
</span></span><span class="line"><span class="ln">10</span><span class="cl">                                                       v
</span></span><span class="line"><span class="ln">11</span><span class="cl">+----------------------------------+   +---------------+--------------+
</span></span><span class="line"><span class="ln">12</span><span class="cl">|        viewWillDisappear()       +&lt;--+         viewWillAppear()     |
</span></span><span class="line"><span class="ln">13</span><span class="cl">+-----------------+----------------+   +------------------------------+
</span></span><span class="line"><span class="ln">14</span><span class="cl">                  |                    |    updateViewConstraints()   |
</span></span><span class="line"><span class="ln">15</span><span class="cl">                  |                    |                              |
</span></span><span class="line"><span class="ln">16</span><span class="cl">                  v                    |       viewWillLayout()       |
</span></span><span class="line"><span class="ln">17</span><span class="cl">+-----------------+----------------+   |                              |
</span></span><span class="line"><span class="ln">18</span><span class="cl">|         viewDidDisappear()       |   |        viewDidLayout()       |
</span></span><span class="line"><span class="ln">19</span><span class="cl">+----------------------------------+   +------------------------------+
</span></span></code></pre></div><p>生命周期和 iOS 的 UIViewController 也差不多，从上面的生命周期来看只能覆写 loadView 方法才行：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="ln">1</span><span class="cl"><span class="kd">class</span> <span class="nc">ViewController</span><span class="p">:</span> <span class="n">NSViewController</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl">    <span class="kr">override</span> <span class="kd">func</span> <span class="nf">loadView</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">        <span class="c1">// 设置 ViewController 大小同 mainWindow</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">        <span class="k">guard</span> <span class="kd">let</span> <span class="nv">windowRect</span> <span class="p">=</span> <span class="n">NSApplication</span><span class="p">.</span><span class="n">shared</span><span class="p">.</span><span class="n">mainWindow</span><span class="p">?.</span><span class="n">frame</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">        <span class="n">view</span> <span class="p">=</span> <span class="n">NSView</span><span class="p">(</span><span class="n">frame</span><span class="p">:</span> <span class="n">windowRect</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl">
</span></span><span class="line"><span class="ln">9</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>看了上面代码也就明白了为什么在 <code>AppDelegate.swift</code> 设置 contentViewController 需要在代码块的末尾添加了吧，如果在最开始添加那就无法获取到 mainWindow 也就无法设置 ViewController 的 frame。这里还有个小提醒 macOS 10.10 之后版本在覆写该方法如果调用了 <code>super.loadView()</code> 方法就会自动加载同名的 xib 文件<strong>绝对不能填写</strong>。</p>
<p>让我们在运行一次看看？</p>
<p><img loading="lazy" src="/tutorials/macos-app-without-storyboard/001/shot003-final-app.png"
  
  
  alt="Final App"></img>
</p>
<p>Ta-Da! 完成了！</p>
<h3 id="结语">结语</h3>
<p>这算是一个开篇，后续还会再继续整理，尽请期待。</p>
]]></content:encoded></item><item><title>申请泰国电子落地签答疑解惑</title><link>https://icyleaf.com/2019/04/apply-thailand-evisa/</link><pubDate>Wed, 10 Apr 2019 13:12:07 +0800</pubDate><guid>https://icyleaf.com/2019/04/apply-thailand-evisa/</guid><description>电子签证期间入境神速（大家还未意识到时）</description><content:encoded><![CDATA[



<div class="updated">
  <header class="updated-header">
    <h4 class="updated-title">更新</h4>
    
    <p class="updated-meta">3月 28, 2019</p>
    
  </header>
  <article class="updated-body">
    拿着打印的 eVISA 到达曼谷机场后填写玩出入境申请表去专门的 eVISA 通道（可能有路障，工作人员知道是办理 eVISA 会放行）到那边几乎没有人在排队，我们附带的照片（没贴上去）给了也没要（建议最好还是带着），5 分钟时间入境！
  </article>
</div>


<p>3月初购买了去泰国曼谷的机票，泰国的签证自 2018 年末增加了第四种在线申请电子落地签（E-Visa），赶上泰国免签证费延期到 2019 年 4 月底的好事情，还需要收第三方机构的手续费（这个后面展开）一家三口办下来比淘宝找中介要便宜好多，也不用落地排 1-2 小时队当场办落地签（据说落地入境走的是独立通道）</p>
<p>签证办理渠道对比表</p>
<table>
<thead>
<tr>
<th>渠道</th>
<th>办理机构</th>
<th>费用</th>
<th>停留时长</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>自己递签</td>
<td>泰国大使馆</td>
<td>签证费</td>
<td>60天</td>
<td>资料要求多，耗时 7 天，婴儿同大人</td>
</tr>
<tr>
<td>代办</td>
<td>旅行社或淘宝</td>
<td>230 人民币签证费+中介费</td>
<td>60天</td>
<td>资料要求少，耗时 7 天，婴儿同大人</td>
</tr>
<tr>
<td>落地签</td>
<td>机场入境处</td>
<td>签证费</td>
<td>60天</td>
<td>排队办理耗时 1-2 小时</td>
</tr>
<tr>
<td>电子落地签</td>
<td>网站办理</td>
<td>签证费+手续费 525 泰铢</td>
<td>15天，不可延期</td>
<td>资料整理比较蛋疼，下签时间未知</td>
</tr>
</tbody>
</table>
<p>上面三种要么要么自己跑大使馆，要么需要费用比较高，办理电子落地签每人也就收 525 泰铢。当时查了一些资料说是申请有好多坑，如果被拒签有一次修改的机会，再被拒签不退钱。</p>
<blockquote>
<p>一句话总结：是 2019 年 4 月底前最佳申请途径，费用低廉只要资料没有任何问题出发前肯定下签。唯一缺点是只有 15 天停留期且不可延期。</p>
</blockquote>
<h3 id="申请攻略">申请攻略</h3>
<p>泰国电子落地签申请入口：<a href="https://www.evisathailand.com/">https://www.evisathailand.com/</a></p>
<p>通过我申请的过程来看我猜这是一个第三方机构委托，他们只负责资料的审核，通过后再递交泰国出入境管理局，因此是商业域名。具体申请步骤大家参考<a href="https://bbs.qyer.com/thread-3121710-1.html">2019泰国电子落地签申请亲妈式教学</a>。</p>
<h3 id="注意事项">注意事项</h3>
<ul>
<li>姓名填写参照护照（名是多字的中间不要有空格）</li>
<li>上传附件支持 PNG/JPG/GIF/PDF 大于 100KB 总体小于 2MB</li>
<li>机票行程单和酒店预订单建议是英文版本</li>
<li>机票行程单往返在一个 PDF 文件的上传两次</li>
<li>酒店预订单接受 Booking 和 Airbnb（在邮件酒店预订单有打印功能，跳转网页后打开浏览器隐私模式切换英文打印就是纯英文版本）</li>
</ul>
<p>泰国电子落地签网站也在不断版本迭代中，以上办理中可能出现的问题后续可能会改善。</p>
<h3 id="查询进度">查询进度</h3>
<p>网址：<a href="https://www.evisathailand.com/check">https://www.evisathailand.com/check</a></p>
<p>输入 Application id 和护照号即可。</p>
<p>技术党这么做：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">curl <span class="s1">&#39;https://www.evisathailand.com/check?q=check&#39;</span> --data <span class="s1">&#39;reference_code={application_id}&amp;passport_number={passport_number}&#39;</span>
</span></span></code></pre></div><p>解析结果用 html 解析器解析 css 查询路径 <code>.container ul li</code> 数组里 h5 是标题，input 的 value 值为数值。</p>
<p>我是用了一个 telegram bot 可以发送命令查询结果，你也可以直接写一个定时脚本有结果了直接发邮件。</p>
<h3 id="咨询渠道">咨询渠道</h3>
<ul>
<li>发英文邮件至 <code>contact@evisathailand.com</code> 回复频率未知，我是 6 天后得到的官腔答复。</li>
<li>加微信 <code>泰国电子落地签eVISA</code> 直接中文留言，回复频率几分钟内繁体中文官腔回复（我猜又是一个客服委托机构）。</li>
<li>泰国电子落地签网站最底部 <code>LIVE CHAT 即时聊天</code> 英文沟通，秒回复，当场给你审查资料并递交给泰国出入境管理局。（可能需要翻墙）</li>
</ul>
<h3 id="何时下签">何时下签</h3>
<p>办理电子签除了便宜以外，我另外看中的据说是 24 - 48 小时下签，然而我太年轻&hellip;</p>
<p>我是 3 月 28 日晚上申请，真正下签是 4 月 10 日，耗时 13 天，期间我尝试了三种咨询渠道，只有最后一种最有效，资料审核后递交泰国出入境管理局后端状态是不可催的，我是从他们审查后递交泰国出入境管理局又花了 3 天才拿到 evisa，不过他们客服给我的答复是只要我这递交泰国出入境管理局了肯定在你出发前给你下签。</p>
]]></content:encoded></item><item><title>华擎 Z390 Gaming ITX 黑苹果安装教程</title><link>https://icyleaf.com/2019/03/asrock-z390-gaming-itx-install-hackintosh-tutorial/</link><pubDate>Thu, 28 Mar 2019 17:12:07 +0800</pubDate><guid>https://icyleaf.com/2019/03/asrock-z390-gaming-itx-install-hackintosh-tutorial/</guid><description>安装黑苹果只需要注意那几步</description><content:encoded><![CDATA[



<div class="updated">
  <header class="updated-header">
    <h4 class="updated-title">更新</h4>
    
    <p class="updated-meta">4月 14, 2021</p>
    
  </header>
  <article class="updated-body">
    <ul>
<li>系统升级至 Big Sur 之后已经从 Clover 该用 OpenCore 可从 <a href="https://github.com/icyleaf/EFI-ASRock-Z390-Phantom-Gaming-ITX">EFI 仓库</a>查看历史变更。</li>
<li>更新疑惑解答无线网络慢的解决方案。</li>
</ul>

  </article>
</div>


<p>春节前购入一台式机挖坑要写黑苹果安装教程，本来计划是 3 月初整理完毕期间赶上辞职彻底放飞自我，加上无法忍受编辑视频的龟毛速度购入一块 rx580 矿卡使用一周后良好，立马开始填坑。</p>
<blockquote>
<p>封图是博通网卡模块替换原由的分解图。</p>
</blockquote>
<h1 id="硬件清单">硬件清单</h1>
<p>参见 <a href="http://icyleaf.com/2019/01/itx-coffee-lake-hackintosh-build-for-4k-video-editing/">攒了一台 4K 视频剪辑黑苹果</a>。更新了后续更换的硬件和说明。</p>
<h1 id="名词解释">名词解释</h1>
<ul>
<li><code>BIOS</code> - <strong><em>B</em></strong><em>asic <strong>I</strong>nput/<strong>O</strong>utput <strong>S</strong>ystem</em> 缩写，它是主板上标准的固件接口，负责在开机时做硬件启动和检测等工作，并且担任操作系统控制硬件时的中介角色。</li>
<li><code>(U)EFI</code> - <em>(<strong>U</strong>nified) <strong>E</strong>xtensible <strong>F</strong>irmware <strong>I</strong>nterface</em> 缩写，它是代替 BIOS 的升级方案，(U)EFI 是模块化，支持图形化界面和鼠标操作。UEFI 是基于 Intel EFI 1.1 发展而来的归属国际组织管理，本质上还是 EFI。<a href="https://www.zhihu.com/question/21672895">BIOS 和 UEFI 的区别</a>，它会以一个名为 EFI 独立分区存在里面是其配置数据。</li>
<li><code>ACPI</code> - <strong><em>A</em></strong><em>dvanced <strong>C</strong>onfiguration and <strong>P</strong>ower <strong>I</strong>nterface</em> 缩写。它是 BIOS 中&quot;电源管理”和“配置管理”的接口，它由很多表组成，包括 RSDP, SDTH, RSDT, FADT, FACS, DSDT, SSDT, MADT, SBST, XSDT, ECDT, SLIT, SRAT 等。</li>
<li><code>DSDT</code> - <em>The <strong>D</strong>ifferentiated <strong>S</strong>ystem <strong>D</strong>escription <strong>T</strong>able</em> 缩写，它是主板 BIOS 中 ACPI 的一个表，包含了所有除基本系统以外所有不同设备的信息，也就是每台计算机设备的基本系统是相同的，而不相同的设备用 DSDT 来描述。macOS 不完整支持 ACPI 规范，仅支持它的子集 DSDT。因此这个在黑苹果配置中会经常提到。</li>
<li><code>AML</code> - <strong><em>A</em></strong><em>CPI <strong>M</strong>achine <strong>L</strong>anguage</em> 缩写，它是 ACPI 描述语言，用来编辑 ACPI 各种表的代码。</li>
<li><code>Kext(s)</code> - <strong><em>K</em></strong><em>ernel <strong>Ext</strong>ension</em> 缩写，你可以简单的理解为它是 macOS 的驱动文件（内核扩展）。</li>
<li><code>Clover</code> - 我们使用的启动引导器。Mac 主机使用了自定义固件来启动 macOS。 PC 硬件本身无法做到而 Clover 可以帮我们实现。同时它还提供 kext 注入，ACPI 重命名，kext 补丁和一些其他功能。更多请看黑果小兵的<a href="http://blog.daliansky.net/clover-user-manual.html">使用教程</a>。</li>
<li><code>config.plist</code> - 这个文件用来告诉 Clover 该怎么去做。它是一个 XML 格式的属性列表文件（有点类似 HTML）其中最核心的部分是配置黑苹果才能正常运行。你可以使用文本编辑器或者 Clover Configuration App 编辑。</li>
</ul>
<blockquote>
<p>多说一句，有时候大家再说到 BIOS 实际上是指 UEFI，只不过为了兼容性主板会在 UEFI 中兼容 BIOS。</p>
</blockquote>
<h1 id="安装环境">安装环境</h1>
<p>本教程提到的环境和版本信息、Clover 配置和 Kexts 均公开到个人 Github 仓库：<a href="https://github.com/icyleaf/EFI-ASRock-Z390-Phantom-Gaming-ITX">EFI-ASRock-Z390-Phantom-Gaming-ITX</a> 。</p>
<h1 id="安装前的准备工作">安装前的准备工作</h1>
<h2 id="配置-kexts">配置 Kexts</h2>
<ul>
<li>启动必备
<ul>
<li>FakeSMC.kext</li>
<li>Lilu.kext</li>
<li>WhateverGreen.kext</li>
</ul>
</li>
<li>显卡
<ul>
<li>NoVPAJpeg.kext（独立显卡需要，解决无法预览和打开 JPG 图片）</li>
</ul>
</li>
<li>声卡
<ul>
<li>AppleALC.kext</li>
</ul>
</li>
<li>有线网卡
<ul>
<li>IntelMausiEthernet.kext</li>
</ul>
</li>
<li>无线网卡
<ul>
<li>AirportBrcmFixup.kext</li>
</ul>
</li>
<li>蓝牙(配合 Kext Utility/KextBeast 安装到系统)
<ul>
<li>BrcmFirmwareRepo.kext</li>
<li>BrcmPatchRAM2.kext</li>
</ul>
</li>
</ul>
<h2 id="启动盘">启动盘</h2>
<blockquote>
<p>如果你的 OS 是 macOS 请参考如下步骤，否则请去黑果小兵博客下载 macOS 镜像并自行烧录。</p>
</blockquote>
<p>准备一个 8G 以上容量的 U 盘使用系统自带磁盘工具 App 格式化为 GUID 分区图 MacOS 扩展（日志式）分区并重命名 USB，接着把从 App Store 下载 macOS Majave 10.14 安装 App，使用其安装包命令创建启动安装盘：</p>
<pre><code>sudo &quot;/Applications/Install macOS Mojave.app/Contents/Resources/createinstallmedia&quot; --volume /Volumes/USB
</code></pre>
<p>这一步会花费 30-40 分钟的时间期间可能也没用任何状态更新，请耐心等待，等到完成后启动盘就制作完成了。</p>
<h2 id="clover">Clover</h2>
<p>上一步获得了启动 U 盘，在保证没有推出（Eject）和拔出 U 盘的情况下还需要讲 Clover 安装到上面。</p>
<ol>
<li>安装 <a href="https://github.com/Dids/clover-builder/releases">Clover</a>（建议使用上面我采用的版本）点击下一步至看到 “Change Install Location&quot; 选择启动 U 盘</li>
<li>点击左下角的 &ldquo;Customize&rdquo; 开始定制特定的驱动：</li>
</ol>
<ul>
<li>勾选 &ldquo;仅安装 UEFI 开机版本（Clover for UEFI booting only）&rdquo;</li>
<li>勾选 &ldquo;安装 Clover 到 EFI 系统区（Install Clover in the ESP）&rdquo;</li>
<li>勾选 &ldquo;UEFI drivers&rdquo; 下面的 &ldquo;ApfsDriverLoader-64.efi&rdquo;, &ldquo;AptioMemoryFix-64.efi&rdquo;, &ldquo;EmuVariableUefi-64&rdquo;, &ldquo;FSInject-64.efi&rdquo;</li>
<li>勾选 &ldquo;安装 RC scripts 到目标磁盘&rdquo;（启动 U 盘不用勾选，安装成后再次安装 Clover 到硬盘时需要勾选）</li>
<li>其他的选项都不勾选</li>
</ul>
<ol>
<li>清理 EFI 目录</li>
</ol>
<ul>
<li>使用 <a href="https://mackie100projects.altervista.org/download-clover-configurator/">Clover Configurator</a> 挂载 EFI 分区</li>
<li>打开 EFI 分区删除 &ldquo;EFI/CLOVER&rdquo; 下面的 &ldquo;driver64&rdquo; 目录（使用 UEFI 启动不需要）</li>
<li>把下载的必备驱动全部复制到 &ldquo;EFI/CLOVER/kexts/Ohter&rdquo; 目录下面（该目录存在其他的 kexts 的话就全部删除掉）</li>
<li>删除 &ldquo;EFI/CLOVER/kexts/10.x.x&rdquo; 目录</li>
</ul>
<ol>
<li>如果使用 USB3 安装，你可能需要 <a href="https://www.tonymacx86.com/attachments/aaron-usb-config-zip.378128/">aaron-usb-config.aml</a> 补丁来激活主板上的
USB3 端口</li>
</ol>
<h2 id="替换网络模块">替换网络模块</h2>
<p>原有 Intel® Wireless-AC 9560 无线模块（集成无线 802.11ac 方案并提供蓝牙 5.0 和 2x2 802.11ac 2.4/5Ghz Wi-Fi 模块）在主板后部面部的顶部，需要拧下前后两颗螺丝，再拔掉 CMOS 电池的插头，嗯，没错尾部圆圆被塑料包裹的是 CMOS 电池。拆下模块后需要再把金属遮蔽盒拆下来就看到 Intel 无线模块的样子，小心把上面的两个天线拔掉再把模块也拆下放一边，我就得到了框架。</p>













  
  
    
      <figure data-pswp="720x720" data-size="800x"><a href="/uploads/2019/03/28/m2-vs-boardcom-vs-dadapter.jpg" class="gallery-item" target="_blank" data-pswp-width="720" data-pswp-height="720"><img src="/uploads/2019/03/28/m2-vs-boardcom-vs-dadapter_hu00e81ee142ef13662d8a12eecfc18be1_119676_800x0_resize_q75_box.jpg"/></a><figcaption>

    <p>M2 VS 博通 VS 转换器</p></figcaption></figure>

<p>避免广告的嫌疑，淘宝自行搜 <code>BCM94360CS2 NGFF M.2 转接卡</code>，买回来的博通网卡 + 转接卡可能是固定好的，我们需要把它拆开。转接卡要固定在框架上面后再把博通网卡插上拧上螺丝，框架上的两个天线随便接博通顶部两侧的插口上。转接卡高度超出框架最初拆下来的金属遮蔽盒不能再装回去。最好把框架固定到主板上就完成了。</p>













  
  
    
      <figure data-pswp="1920x1920" data-size="800x"><a href="/uploads/2019/03/28/install-boardcom-module-to-motherboard.jpg" class="gallery-item" target="_blank" data-pswp-width="1920" data-pswp-height="1920"><img src="/uploads/2019/03/28/install-boardcom-module-to-motherboard_hu3990a80f62d04c441c56fcf5f23b96d1_903689_800x0_resize_q75_box.jpg"/></a><figcaption>

    <p>博通网卡更换步骤图</p></figcaption></figure>

<h2 id="bios">BIOS</h2>
<p>开机 F2 进入 BIOS 再按 F6 切换高级模式，至少需要做如下修改具体情况还需要看硬件情况：</p>
<ul>
<li>高级（Advanced） &gt; 芯片配置（Chipset Configuration） &gt; VT-d -&gt; Disabled</li>
<li>高级（Advanced） &gt; USB 配置（USB Configuration） &gt; XHCI Hand-off -&gt; Enabled</li>
</ul>
<h2 id="安装黑苹果">安装黑苹果</h2>
<p>以<a href="https://www.tonymacx86.com/threads/guide-asrock-z390-phantom-gaming-itx-ac-i9-9900k-rx-580.268992/">ASRock Z390 Phantom Gaming-ITX/ac, i9-9900K, RX 580</a>为基础进行安装。</p>
<p>插入 U 盘到机箱后部主板的插口开机 F12 选择启动 U 盘（如果没有认出来试试其他插口），接着你会看到 Clover 的启动引导界面选择 U 盘启动，之后就是标准的 macOS 安装步骤（格式化硬盘分区为 GUID 分区图 MacOS 扩展（日志式）等等），我就不再多说，其中安装过程中会需要重启，重启进去 Clover 引导界面时选择硬盘启动，而不是启动 U 盘。</p>
<p>黑苹果安装好再次安装 Clover 这次是安装到硬盘上面（步骤和勾选选项同上）。</p>
<h2 id="clover-配置">Clover 配置</h2>
<p>根据我的 <a href="https://github.com/icyleaf/EFI-ASRock-Z390-Phantom-Gaming-ITX/blob/master/EFI/CLOVER/config.plist">config.plist</a> 进行参考配置：</p>
<ol>
<li>使用 Clover Configurator 挂载硬盘的 EFI 分区</li>
<li>复制启动 U 盘的 driver64UEFI 和 kexts 目录到硬盘对应位置</li>
<li>使用 Clover Configurator 打开 &ldquo;EFI/CLOVER/config.plist&rdquo;</li>
</ol>
<ul>
<li>在 SMBIOS 选项界面生成 Serial Number 和 SMUUID（点击 Generate New）</li>
<li>点击右侧 &ldquo;Check Coverage&rdquo; 会打开一个浏览器输入验证码（可能需要翻墙）确保 Serial Number 是<strong>无效的</strong>，这样才能伪装这台机器是台新机器。如果是有效的话就再次重新生成即可。</li>
</ul>
<ol>
<li>Intel Coffee Lake 架构<a href="https://hackintosh.gitbook.io/-r-hackintosh-vanilla-desktop-guide/config.plist-per-hardware/coffee-lake">通用配置</a></li>
</ol>
<h2 id="无线及蓝牙驱动">无线及蓝牙驱动</h2>
<p>对于所谓的“免驱”博通网卡其实并不代表了不需要 kext 的帮助，尤其是我自以为是 Apple 钦点的插上就可以用结果毛都没认出来。按照 tonymacx86 <a href="https://www.tonymacx86.com/threads/broadcom-wifi-bluetooth-guide.242423/">无线及蓝牙安装教程</a> 操作
没有什么大的问题，直接使用 把 <code>Lilu.kext',</code>AirportBrcmFixup.kext<code>,</code>BrcmFirmwareRepo.kext<code>和</code>BrcmPatchRAM2.kext<code>安装到</code>/Library/Extensions/` 路径下重启即可。</p>
<blockquote>
<p>这里多说一句，理论上把上面的 kexts 放在 EFI 下也是可用的，放在 <code>/Library/Extensions/</code> 下是为了防止  Clover 加载 kexts 失败，直接缓存到系统中。</p>
</blockquote>
<h2 id="疑难杂症">疑难杂症</h2>
<h3 id="u-盘无法引导">U 盘无法引导</h3>
<p>使用 USB 3.0 的 U 盘需要打补丁才能使用，tonymacx86 的 <a href="https://www.tonymacx86.com/threads/guide-asrock-z390-phantom-gaming-itx-ac-i9-9900k-rx-580.268992/">ammulder</a> 提供了补丁下载 aaron-usb-config.zip（首帖的末尾） 解压缩后把里面的文件复制到放到 <code>EFI/CLOVER/ACPI/patched/</code> 目录下面。</p>
<h3 id="引导卡在-apfs_module_init-引导使用-verbose-模式提示该问题">引导卡在 <code>apfs_module_init</code> （引导使用 verbose 模式提示该问题）</h3>
<p>这个问题是说华擎 BIOS 升级至 1.3 版后 Device(RTC) 没有初始化变量使得 OSX DSDT 解析异常造成的。如果这种方式对你也不管用的话只能降级 BIOS 到 1.2 版本。</p>
<p>tonymacx86 的 <a href="https://www.tonymacx86.com/threads/asrock-z390-phantom-gaming-itx-ac.265245/#post-1854444">pupin</a> 给出了解决方案，需要在 config.plist 的 ACPI\DSDT\Patches 数组下面添加：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nt">&lt;dict&gt;</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="nt">&lt;key&gt;</span>Comment<span class="nt">&lt;/key&gt;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="nt">&lt;string&gt;</span>Fix AsRock Z390 BIOS DSDT Device(RTC) bug. If BIOS &gt; 1.2<span class="nt">&lt;/string&gt;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="nt">&lt;key&gt;</span>Disabled<span class="nt">&lt;/key&gt;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="nt">&lt;false/&gt;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="nt">&lt;key&gt;</span>Find<span class="nt">&lt;/key&gt;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="nt">&lt;data&gt;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  oAqTU1RBUwE=
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="nt">&lt;/data&gt;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="nt">&lt;key&gt;</span>Replace<span class="nt">&lt;/key&gt;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="nt">&lt;data&gt;</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  oAqRCv8L//8=
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="nt">&lt;/data&gt;</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nt">&lt;/dict&gt;</span>
</span></span></code></pre></div><p>或者使用 Clover Configuration 在 DSDT 的 Patches 单独打一个补丁，Comment 为 <code>Fix AsRock Z390 BIOS DSDT Device(RTC) bug. If BIOS &gt; 1.2</code>，Find 为 <code>A00A9353 54415301</code>，Replace 为 <code>A00A910A FF0BFFFF</code>、</p>
<h3 id="核显uhd-630花屏">核显（UHD 630）花屏</h3>
<p>这是闪屏的解决方案，待测试：安装好之后能驱动 4K@60Hz 但是闪屏，其实还是显卡驱动的问题，爬帖发现改机型就可以，于是我试了iMac 18,1、iMac 17,3、iMac 17,1等机型仍然闪屏，期间重启了很多次，甚是烦恼。继续爬帖看到某位网友说将SMBIOS里面的信息全部删掉只保留 ProductName 即可，试了下果然起作用了，再也不闪了。后来才得知原理就是 Clover 会根据机型自己推算剩下的值，所以能正常驱动。</p>
<h3 id="核显插-hdmi-显示器黑屏无反应">核显插 HDMI 显示器黑屏无反应</h3>
<p>由于我直接使用的 DP 接口没有遇到该问题，请参考如下链接：</p>
<ul>
<li><a href="http://blog.daliansky.net/CoffeeLake-UHD-630-black-screen-direct-bright-screen-and-correct-adjustment-of-brightness-adjustment.html">http://blog.daliansky.net/CoffeeLake-UHD-630-black-screen-direct-bright-screen-and-correct-adjustment-of-brightness-adjustment.html</a></li>
<li><a href="https://www.tonymacx86.com/threads/guide-general-framebuffer-patching-guide-hdmi-black-screen-problem.269149/">https://www.tonymacx86.com/threads/guide-general-framebuffer-patching-guide-hdmi-black-screen-problem.269149/</a></li>
</ul>
<h3 id="关于本机-cpu-信息显示-unknown">关于本机 CPU 信息显示 Unknown</h3>
<p>macOS 没有支持 9 代 CPU 这里会显示 Unknown 属于正常情况不影响使用，假若你特别想要修改的话请看这里：<a href="https://www.idownloadblog.com/2017/01/13/how-to-modify-about-this-mac-hackintosh/">https://www.idownloadblog.com/2017/01/13/how-to-modify-about-this-mac-hackintosh/</a></p>
<h3 id="显示器的声音无法识别和输出">显示器的声音无法识别和输出</h3>
<p>如果你安装了 VoodooHDA.kext 请删除，默认 AppleALC.kext 即可驱动，另外需要注意的是机箱前置和后置声音输出无法同时使用。</p>
<h3 id="机箱-usb-无法识别">机箱 USB 无法识别</h3>
<p>macOS 10.11 之后由于 Apple USB 驱动重写后造成默认 USB 端口映射会出现不正常需要 DSDT 来打补丁，具体的可参考相关教程。我直接采用的现成的 DSDT 文件可把 <a href="https://github.com/icyleaf/EFI-ASRock-Z390-Phantom-Gaming-ITX/raw/master/EFI/CLOVER/ACPI/patched/SSDT-UIAC-ALL.aml">SSDT-UIAC-ALL.aml</a> 文件放到 EFI/CLOVER/ACPI/patches 下面接口，或者使用 hackintool 工具和<a href="https://github.com/bydavy/EFI-ASRock-Z390-Phantom-Gaming-data">模板文件</a>自己尝试定制。</p>
<h3 id="使用博通-bcm94360cs2-无法使用蓝牙">使用博通 BCM94360CS2 无法使用蓝牙</h3>
<p>原因可能有两个原因：</p>
<ol>
<li>上面提到的 <code>BrcmFirmwareRepo.kext</code> 和 <code>BrcmPatchRAM2.kext</code> 这两个驱动需要使用 <a href="http://cvad-mac.narod.ru/index/0-4">Kext Utility</a> 或 <a href="https://www.tonymacx86.com/resources/kextbeast-2-0-2.399/">KextBeast</a> 安装到系统驱动目录。(推荐使用前者更简单，后者可能需要注册 tonymacx86 才可以下载)</li>
<li>第一步已经完成还不能用的话，那就是 USB 的 DSDT 映射文件出问题了，使用上面<strong>机箱 USB 无法识别</strong>提到的文件即可解决。</li>
</ol>
<h3 id="无线网络wifi速度特别慢">无线网络（WIFI）速度特别慢</h3>
<p>我在写完本教程后让我遇到的诡异问题，我是双系统在 Windows 下无线网络是正常的。经过这几天的分析和推友大神 <a href="https://twitter.com/shellexy/status/1112272600141582337">@shellexy</a> 的帮助下，总结解决方案如下：</p>
<ol>
<li>如果你是唯一的黑苹果系统，那么请在&quot;系统偏好设置&quot;的&quot;节能&quot;取消勾选&quot;唤醒以供网络访问&quot;</li>
<li>如果你是 Windows 和黑苹果双系统，完成上面一步后你还需要在 Windows 系统资源管理器 &ldquo;管理&rdquo; 的 &ldquo;设备管理器&rdquo; 找到博通无线模块切换到最后一个选项卡取消勾选”允许计算机关闭此设备以节约电源”</li>
</ol>
<p>如果上面两个方法都无效的话可以再试试：</p>
<ol>
<li>黑苹果系统是否开启了无线网卡随机化 MAC 地址，尝试关闭</li>
<li>更改 WIFI 天线的方向，如果带线的天线那就尝试换换位置。</li>
</ol>
<h3 id="无法登录-app-store-或登录后无法下载-app">无法登录 App Store 或登录后无法下载 App</h3>
<p>请尝试如下操作：</p>
<ol>
<li>清除 <code>$TMPDIR../C/com.apple.appstore</code> 目录下的所有临时文件</li>
<li>config.plist 保留三个 SMBIOS 后重启，重新登录 iCloud 账户</li>
<li>进系统设置移除现有网络所有配置并重启后重新添加</li>
</ol>
<h3 id="其他疑难杂症">其他疑难杂症</h3>
<p>这里有个其他博主分享的总结<a href="https://www.bugprogrammer.me/2018/11/05/Z390+9900K_Hackintosh.html">Hackintosh for ASRock Z390 Phantom Gaming-ITX/ac+i9-9900K相关问题解决方案</a> 可以看看有没有你遇到的，倘若都没有发现也可以给我<a href="https://github.com/icyleaf/EFI-ASRock-Z390-Phantom-Gaming-ITX/issues/new">提 Issue</a> 我会尝试帮助你。</p>
<h2 id="参考资料">参考资料</h2>
<ul>
<li><a href="https://www.kancloud.cn/chandler/mac_os/480611">Mac OS 之程序员</a></li>
<li><a href="http://blog.daliansky.net/clover-user-manual.html">clover使用教程</a></li>
<li><a href="https://hackintosh.gitbook.io/-r-hackintosh-vanilla-desktop-guide">Hackintosh Vanilla</a></li>
<li><a href="https://macpc.hidemess.com/?thread-145.htm">ASRock華擎Z370M-ITX/AC集成顯卡10.14EFI分享</a></li>
<li><a href="https://catty-house.blogspot.com/2018/10/hackintosh.html">安装黑苹果教程</a></li>
<li><a href="https://www.tonymacx86.com/threads/guide-asrock-z390-phantom-gaming-itx-ac-i9-9900k-rx-580.268992">[Guide] ASRock Z390 Phantom Gaming-ITX/ac, i9-9900K, RX 580</a></li>
<li><a href="https://www.tonymacx86.com/threads/success-asrock-z390-phantom-gaming-6-i7-9700k-amd-vega-56.270501/">[Success] ASRock Z390 Phantom Gaming 6 - i7 9700K - AMD Vega 56</a></li>
<li><a href="https://www.tonymacx86.com/threads/asrock-z390-phantom-gaming-itx-ac.265245/#post-1854444">ASRock Z390 Phantom Gaming-ITX/ac</a></li>
<li><a href="https://www.hackintosh-forum.de/forum/thread/40613-1st-hackintosh-beginner-asrock-z390-phantom-gaming-itx-ac/">ASROCK Z390 PHANTOM GAMING-ITX/AC</a></li>
</ul>
]]></content:encoded></item><item><title>攒了一台 4K 视频剪辑黑苹果</title><link>https://icyleaf.com/2019/01/itx-coffee-lake-hackintosh-build-for-4k-video-editing/</link><pubDate>Wed, 30 Jan 2019 10:30:07 +0800</pubDate><guid>https://icyleaf.com/2019/01/itx-coffee-lake-hackintosh-build-for-4k-video-editing/</guid><description>台式机还是生产力工具吗？</description><content:encoded><![CDATA[<h2 id="装机清单">装机清单</h2>
<blockquote>
<p>台式机借鉴国外 $1000k 攒机思路在不考虑显示器预算为 6000 元人民币。</p>
</blockquote>
<table>
<thead>
<tr>
<th>名称</th>
<th>品牌型号</th>
<th>价格</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>CPU</td>
<td>Intel i7 9700k</td>
<td>2550</td>
<td></td>
</tr>
<tr>
<td>主板</td>
<td>华擎 Z390 Phantom Gaming itx/ac</td>
<td>1399</td>
<td></td>
</tr>
<tr>
<td>散热器</td>
<td>九州风神 船长 240 EX White RGB</td>
<td>453</td>
<td></td>
</tr>
<tr>
<td>内存</td>
<td>海盗船 Vengeance LPX DDR4 3000 16G x 1</td>
<td>719</td>
<td></td>
</tr>
<tr>
<td>SSD</td>
<td>三星 970 EVO 250G</td>
<td>489</td>
<td></td>
</tr>
<tr>
<td>机箱</td>
<td>追风者 215P ITX 侧透 RGB</td>
<td>489</td>
<td>支持大风冷和全尺寸显卡</td>
</tr>
<tr>
<td>电源</td>
<td>讯景 XTR550</td>
<td>354</td>
<td></td>
</tr>
<tr>
<td>无线网卡/蓝牙</td>
<td>博通 BCM94360CS2</td>
<td>95 元</td>
<td>需转接卡</td>
</tr>
<tr>
<td>显卡</td>
<td>蓝宝石 RX580 8G 1411MHz Nitro+ 超白金</td>
<td>750</td>
<td>后期预算，闲鱼二手矿卡</td>
</tr>
<tr>
<td>显示器</td>
<td>LG 27UL600 4k HDR400 IPS</td>
<td>后期单独预算</td>
<td></td>
</tr>
<tr>
<td>总价</td>
<td></td>
<td>6075<!-- raw HTML omitted -->6825(独立显卡)</td>
<td></td>
</tr>
</tbody>
</table>




<div class="updated">
  <header class="updated-header">
    <h4 class="updated-title">更新</h4>
    
    <p class="updated-meta">7月 9, 2020</p>
    
  </header>
  <article class="updated-body">
    <ul>
<li>6月份采购了一个 LG 面板的 DIY 4k 显示器，价格很香 1500 元，就是驱动板固件差点，单摇臂换了双摇臂来挂两个 4k 显示器。具体请看<a href="https://gist.github.com/icyleaf/b09d70da0a7c368fe550338088b5dbc3">我买过的显示器</a>。</li>
<li>购入矿卡显卡整 2 个月的时间目前没有翻车，macOS 下用于视频剪辑速度确实快了很多！在 Windows 用显卡超频检测风扇偶尔会提示风扇有问题但玩 Apex 英雄最高画质渲染除了显卡风扇噪音比较大以外没有任何问题。一般来说矿卡日常使用没有太大问题，后续会考虑换个显卡风扇。</li>
<li>购入独立显卡蓝宝石 RX580 8G 1411MHz Nitro+ 超白金(矿卡），更新相关内容，尾部加上<a href="http://icyleaf.com/2019/03/asrock-z390-gaming-itx-install-hackintosh-tutorial/">黑苹果安装教程</a>。</li>
<li>修改无线网卡的最终选择和价格，更新博通网卡部分的内容。</li>
</ul>

  </article>
</div>


<h2 id="为什么要台式机">为什么要台式机</h2>
<p>堂堂一个长期苹果用户的码农咋想起来要组装台式机了？这个计划其实我已经盘算好久好久，要不是库克这两年的出价策略我还真把这个念头打消了。 对于现在入一台能用好几年的 Mac 设备基本上都是要顶配了，价格能又不忍直视。</p>
<p>以我现有几台笔记本为例，只有内存和硬盘可更换的加持下 MBP 2011 Late 低配我现在拿来用 VSCode 写代码跑服务也没啥太大问题。而手里的 MBP 2013 Mid 低配因为内存和硬盘全焊丝经常性内存不足卡死，硬盘不足，就连我老婆都恨不得把它扔了，主力机器 MBP 2015 Mid 中配后期更换 SSD 又可以再战 3 年。</p>
<p>当我说要组装台式机的时候不少朋友反问现在还需要用台式机吗，虽然我嘴上只是说说攒着玩啊，现在外出基本上手机可以满足要求，带着笔记本其实也就是存下照片（是的我知道有种东西叫数码伴侣），其实我就是想要一台可配置的机器，不乏有这样想法的开发者，这也是为什么 MacBook Pro（后面简称 MBP）2015 版本的二手机器畅销的原因。</p>
<p>以上的配置因为预算上限没买独立显卡和无线网卡/蓝牙的情况下总花费正好 6000 元整一分不多一分不少让我自己都特别吃惊（显示器是后批的预算），购买渠道主要是哪里便宜去哪里，大部分淘宝，极个别京东（比如有漏液风险度水冷）。其性价比完爆 2018 年新换代的 Mac mini（不考虑体积和接口种类），加上显示器虽然比不上 5k iMac 但其他方面可不差，再加上攒机配置基本上属于顶配（虽然没上 9900k）除了内存以外都不是瓶颈。</p>
<h2 id="视频剪辑">视频剪辑</h2>
<p>业余兴趣爱好一直没有行动。之前出去玩攒了不少的视频素材，只有在结婚前花了三个月用 iMovie 剪了一个婚礼上播放的<a href="https://v.youku.com/v_show/id_XOTQyNTg0ODA4.html?sharefrom=iphone&amp;sharekey=9aa274d71e8a3ba95e2fcf03efbc9e8e0">视频</a>之后也有想学 Final Cut Pro（简称 FCP） 主要还是因为硬件不达标搁浅。</p>
<p>题外话，经过慎重考虑我选择了 <del>Adobe Premiere</del> <strong>达芬奇</strong>真香！，支持 Windows 和 macOS 系统而且它也支持和 FCP 一样对独立显卡的渲染优化，反正这俩 App 对我来说都是新的。</p>
<h2 id="黑苹果的理由">黑苹果的理由</h2>
<blockquote>
<p>请不要鄙视和职责用黑苹果的用户，现在 macOS 系统已经是免费安装也都是 <a href="https://en.wikipedia.org/wiki/Vanilla_software">Vanilla</a> 方式。安装黑苹果尤其是自己动手这也是符合黑客精神。我认为自己来安装黑苹果是一种充满冒险和兴奋的事情。</p>
</blockquote>
<p>兼容黑苹果也是选择硬件的很重要的指标之一，虽然我会安装 Windows 系统，长期我更倾向于 macOS 系统。这也是一个长期 Mac 用户最舒服的使用方式，减少各方面的迁移成本，听说某大厂的游戏部门程序员全部采用黑苹果方案。附上一份<a href="https://dortania.github.io/Anti-Hackintosh-Buyers-Guide/">黑苹果绝对不要采购硬件指南</a>。</p>
<h2 id="cpu">CPU</h2>
<p>本来是要买 8 代 8700k 的，我买的时候（2019年初）8700k 价格溢价太高！稍微加点钱就能上 9 代 9700k 了！尽管市面上的 Mac 主机还都没有 9 代或许今年内应该能够发售再加上 tonymacx86 已经有很多 9 代的成功案例，何乐而不为呢，大不了在 Apple 在支持 9 代之前我先用 Windows 嘛。</p>
<p>为什么要带 <code>k</code>？可以超频啊！目前默频的情况基本满足，后面无论是视频剪辑还是玩游戏的话可以适当超频，配合华擎主板只要 CPU 不踩雷轻松上 5Ghz。 当然还是要考虑黑苹果的兼容性 AMD 在这方面真 YES 不起来。</p>
<h2 id="主板">主板</h2>
<blockquote>
<p>CPU 都上 9700k 了。为什么主板还要限制在 Z370 平台（虽然 9 代兼容），直接上 Z390 啊！价格也合适！</p>
</blockquote>
<p>都说技嘉是黑苹果首选的主板，其次是华硕、微星一二线大厂，一说起华擎可能在十几年前可能都没听过这个牌子（比如我，毕竟十几年没在台式机混过了）或者是华擎出妖板，这些确实没错。</p>
<p>我选择华擎的主板主要有三大原因：第一在 Z390 系列里面它足够便宜（价格屠夫），第二是主板供电相对可靠且硬件种类非常强大（残血雷电口除外），第三在 hackintosher 看到 <a href="https://hackintosher.com/blog/best-motherboard-brand-hackintoshing-2017-kabylake/">2017 年评出的最佳黑苹果主板</a>第一名就是华擎，原因是该主板很容易找到解决方案，还能够很好的支持睡眠唤醒。最近在 tonymacx86 华擎主板成功的案例也非常多。如果非要说缺点就是 BIOS 功能太弱版本更新不太稳定。</p>
<p>再说说我为什么选择<a href="https://www.asrock.com/mb/Intel/Z390%20Phantom%20Gaming-ITXac/index.cn.asp">华擎 Z390 Phantom Gaming itx/ac</a>，<a href="https://www.chiphell.com/thread-1936969-1-1.html">超频利器</a>，双 Ultra M.2（PCIe Gen3 x4 &amp; SATA3）接口（前支持 2260/2280，后支持 2280），4 SATA 3 接口（支持 RAID)和热插拔，DisplayPort 1.2 和 HDMI 2.0，板载 Intel 802.11ac 无线网卡和蓝牙 5.0模块（但不支持黑苹果，伤心），4 口 USB 3.1 Gen2，同时还有 Polychrome Sync RGB 灯控同步方案（虽然我不 care）。不足的地方也有啦，比如最大 32G 内存（支持 64G 就好了），残血雷电3接口（20G/s）再接 eGPU 会比较惨。</p>
<p>如果你想要大板的话可以考虑华擎 Z390 Extreme 4 或 Taiji，大厂信仰和不差钱的忽略。</p>
<p>最后附上一个<a href="https://zhuanlan.zhihu.com/p/50199792">Z390 主板简单横屏</a>的文章，对我也很有启发。</p>
<h3 id="散热扇">散热扇</h3>
<blockquote>
<p>为什么选择众多漏液全赔的九州风神水冷？购买水冷散热器和 9700k 把最初打算购买独立显卡（RX560）的预算花了，计划集显运行一段时间后续有预算在购入。</p>
</blockquote>
<p>攒机的时候没有考虑散热器的预算本以为如果买 Intel 盒装的版本会带一个小风扇或者随便买个 100 左右的散热器，真正研究配置的时候发现没有自带风扇，可能便宜的风冷 9700k 会压不住，超频就不要想。高塔的风冷（比如大霜塔）会有会挡内存槽和显卡的风险（据说大镰刀有错位设计）毕竟 itx 只有俩内存和一个 PCIe，权衡下来踩这个坑不如考虑水冷的划算。</p>
<p>起初看海盗船 H100i v2 用的人挺多，瞅了眼价格直接自我劝退，更何况早期有漏液情况就没敢买，在 pcpartpicker 上筛选水冷散热器排名第二代就是<a href="http://www.gamerstorm.com/product/CPULIQUIDCOOLER/2017-08/1286_6878.shtml">九州风神船长 240 White</a>，尽管也有很多漏液问题但基本上是 2017 年到 2018 年初，后续就再也没有看到漏液爆出（海盗船的现在也没有了）加上价格合适和京东客服再三确认质量保证（质保三年）和漏液全赔之后还是入了一个最便宜的船长 240 特别定制白色 RGB 的版本，结果买回来发现白色的水排和全黑的机箱搭配起来也很不和谐在侧透机箱一览无遗，谁让这个特别版（和国外同步，国内官网没有描述）价格比正常 240 便宜一百块呢。</p>
<p>关于灯控，散热器自带一个 RGB 控制器同时也支持主板 RGB 同步，插在华擎 Z390 主板 RGB 同步插口上也是可用的（虽然商品描述没有标注支持华擎）</p>
<p>九州风神作为一个国产品牌说明书是全英文我要给差评，尤其是在第一次接触水冷加 RGB 灯控的菜鸟来说。</p>
<h3 id="itx-机箱">ITX 机箱</h3>
<p>说实话选择这台主机我已经限定了必须是 itx 主板和机箱，中塔以上机箱家里条件不允许而且也不太喜欢较大的体积。选择<a href="http://www.phanteks.com/Enthoo-Evolv-ITX-TemperedGlass.html">追风者 215P</a> 其实是我在找 <a href="https://bartechtv.com/1000-mini-itx-coffee-lake-hackintosh-build-for-4k-video-editing/">4k 视频剪辑配置</a>发现的，国内恰好也有卖，规格还支持高塔风冷、全尺寸显卡以及 280 水冷，价格还合适（虽然不是最低价）没看具体尺寸就买了侧透 RGB 同款，买回来发现恰巧它的优势把机箱宽度拉大，预想的位置宽度正好不够。</p>
<p>这个机箱的说明书实在是特别的简陋，建议下载国外官方的中文说明书。不知道是不是国内版本减配，没有硬盘灯线和重启线（国外版本说明书是有的），没有也没关系反正机箱也没对于的硬盘灯和重启键，你看到的以为是重启键按钮（国内一些评测也这么认为）实际上是机箱灯控的控制键。</p>
<p>关于灯控，之前也没接触过灯效也就忽略了京东商品详情的 RGB 灯控的图标标识，一直以为这是一个普通的机箱，后来在看国外商品描述的时候提示是支持华硕，技嘉和微星主板 RGB 同步，看油管说是如果要和主板同步就要拆了机箱前面板把里面的控制版拆掉把 4pin 接口接入到主板的灯控口才行。写这篇博文的时候因为各种不确定我又扒了一遍所有商品的描述，在国外商品详情描述上看到了一行在说明书都没有提到的文字 <code>RGB Montherboard adapter required(sold separately)</code>，也就是说需要主板 RGB 同步的用户们来掏钱单独买<a href="http://www.phanteks.com/PH-CB_RGB4P.html">适配器</a>。</p>
<p>关于水冷，支持分体式水冷系统。</p>
<h3 id="内存">内存</h3>
<p>不是我不想上双通道，双条 8G 的价格和单条 16G 的价格基本保持一致，在现有预算情况下只是恰巧 DDR4 3000 16G 的价格符合我的要求，不用考虑二手卖掉旧内存直接上新，要知道几年后卖二手内存就太廉价了。</p>
<p>品牌的话海盗船、芝奇、镁光、威刚、金士顿都可以考虑，需要注意带马甲的内存条是否挡风冷散热器。</p>
<h3 id="显卡">显卡</h3>
<p><del>视频剪辑其实并不太吃显卡，主要还是 CPU，CPU 不足的晴朗下才会选择显卡。国外众多兼容黑苹果的配置中大多没用更好的显卡。</del> 自我打脸，视频编辑软件其实是 CPU 和显卡都会用到的，再强的 CPU 也拯救不了。</p>
<blockquote>
<p>虽然部分 NVIDIA 显卡有 Web Driver 驱动但据说性能大大折扣，这里推荐黑果小兵整理的 <a href="https://blog.daliansky.net/Mojave-Hardware-Support-List.html">macOS 10.14 Majave 硬件支持列表</a>。</p>
</blockquote>
<p>AMX RX 500 系列和更好的 R9 系列全系 macOS 免驱的，AMD 和 Apple 已经达成长期合作伙伴。免驱动是安装黑苹果抉择的最重要的原因，其次选择 RX 500 系列价格实惠，<del>尤其考虑 RX 560</del>，在没有独立显卡的日子里日常使用其实是够用的，
涉及图片处理和视频编辑的话必须要上独立显卡，无论是看 <a href="https://bartechtv.com/the-best-graphics-cards-for-hackintosh-in-2018/">2018</a> 或 <a href="https://bartechtv.com/the-best-hackintosh-graphics-cards-for-2019/">2019</a> 最佳显卡
列表 rx560 都是垫底的，我的预算其实是还是 rx560 的预算（800 左右）而全新的 rx580 价格实在感人，我也盯了很久的矿卡感觉可以尝试下，于是在闲鱼花了 750 包邮买了一块 2017 年份的蓝宝石 RX580 8G 1411MHz Nitro+ 超白金。特别注意如果你确实想从闲鱼买请不要相信卖家所说的网吧淘汰，全新，用钱急出等关键词。因为这类的 99% 其实都是矿卡，如果卖家坦白说这就是矿卡可以问问质保、退货政策。截至 2019 年 5 月 29日购入矿卡整 2 个月的时间目前没有翻车，macOS 下用于视频剪辑速度确实快了很多！在 Windows 用显卡超频检测风扇偶尔会提示风扇有问题但玩 Apex 英雄最高画质渲染除了显卡风扇噪音比较大以外没有任何问题。一般来说矿卡日常使用没有太大问题，后续会考虑换个显卡风扇。</p>
<p>附带一个显卡购买指南：<a href="https://dortania.github.io/GPU-Buyers-Guide/" title="https://dortania.github.io/GPU-Buyers-Guide/">https://dortania.github.io/GPU-Buyers-Guide/</a></p>
<h3 id="存储">存储</h3>
<p>如果你不差钱的话请上三星 970 EVO 500G。</p>
<p>上面提到主板支持双 Ultra M.2 插口和 4 SATA 3.0，同时还支持 <a href="https://www.youtube.com/watch?v=qg1Vvh67Efw">RAID0/1/2/3/4/5/10</a>，其中一个 M.2 插口会被无线+蓝牙模块占用，因此我还剩下一个 M.2 和 4 个 SATA。</p>
<p>对于我来说在不考虑 RAID 和手里只有比较少 SSD 硬盘的情况我会考虑买一个三星 970 EVO 250G，配合拆掉临时使用的 Windows 系统的老笔记本上的镁光 RX200 SSD 硬盘，这两块分别安装 macOS 和 Windows 系统。SSD 用来做系统安装和常用 App，大数据后期我会在买大容量机械硬盘做支持，最近价格涨上去不少。</p>
<p>当前因为有 HP Gen 8 做 NAS，在用 LightRoom 修片也基本够用。影视资源也基本上是通过 NAS 的网络协议直接拉取到电脑或者盒子上硬解播放 4k 也毫无压力。</p>
<h3 id="无线网卡方案">无线网卡方案</h3>
<p>首先博通是 Apple 的合作厂家，所有 Mac 主机的无线模块都是他家提供的，可以做到真正免驱同时以下提到的同时还支持蓝牙模块。</p>
<p>蓝牙模块不仅仅是日常连接鼠标，键盘、耳机音箱，它作为 macOS 系统的核心功能是实现 Handoff 和 AirDrop 功能。</p>
<p>苹果钦点模块：</p>
<ul>
<li>BCM94360CS2 (2013年 MacBook Air)</li>
<li>BCM94360CS (2013年 MacBook Pro)</li>
<li>BCM94360CD (2013年 iMac)</li>
<li>BCM943602CS (2015年 MacBook Pro)</li>
</ul>
<p>理论上上面 4 个模块是真正免驱的（但也不排除需要加驱动）。</p>
<table>
<thead>
<tr>
<th>接口</th>
<th>模块</th>
<th>天线</th>
<th>无线</th>
<th>蓝牙</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>PCIe/x1</td>
<td>BCM94360CD</td>
<td>4</td>
<td>2.4G 450M+/5G 1300M=1750M</td>
<td>4.0</td>
<td>iMac (2013) 使用，请勿购买三天线版本，三天线版本（3T3R）蓝牙和无线共用一根影响使用</td>
</tr>
<tr>
<td>PCIe/x1</td>
<td>BCM94331CD</td>
<td></td>
<td></td>
<td></td>
<td>tonymacx86 列表之一，国内没找到</td>
</tr>
<tr>
<td>M.2</td>
<td>BCM943602CS</td>
<td>3T3R</td>
<td>2.4G 450M+/5G 1300M=1750M</td>
<td>4.0</td>
<td>MacBook Pro (2015) 使用，蓝牙需要接 USB</td>
</tr>
<tr>
<td>M.2/NGFF 2230, key E</td>
<td>BCM94360CS2</td>
<td>2T2R</td>
<td>2.4G 300M+/5G 867M=1167M</td>
<td>4.0</td>
<td>MacBook Air (2013) 使用，价格低廉，性价比最好</td>
</tr>
<tr>
<td>M.2/NGFF 2230, key E</td>
<td>BCM94352Z/AzureWave AW-CE162NF/DW1560</td>
<td>2T2R</td>
<td>2.4G 300M/5.0G 867M=1167M</td>
<td>4.0</td>
<td></td>
</tr>
<tr>
<td>M.2</td>
<td>BCM943602BAED/DELL DW1830</td>
<td>3T3R</td>
<td>2.4G 450M+</td>
<td>4.1</td>
<td></td>
</tr>
<tr>
<td>M.2</td>
<td>BCM94350ZAE/DW1820A</td>
<td></td>
<td></td>
<td></td>
<td>tonymacx86 列表之一，国内没找到</td>
</tr>
<tr>
<td>Half mini</td>
<td>BCM94360HMB/AzureWave AW-CB160H</td>
<td>3T3R</td>
<td></td>
<td></td>
<td>tonymacx86 列表之一，国内没找到</td>
</tr>
<tr>
<td>Half mini</td>
<td>BCM94352 HMB/AzureWave AW-CE123H</td>
<td></td>
<td></td>
<td></td>
<td>tonymacx86 列表之一，国内没找到</td>
</tr>
</tbody>
</table>
<p>更多博通模块请看 <a href="https://dortania.github.io/Wireless-Buyers-Guide">无线购买指南</a>，其他兼容的列表请看 <a href="https://osxlatitude.com/forums/topic/2120-inventory-of-supportedunsupported-wireless-cards-1-snow-leopard-el-capitan/">osxlatitude 的整理</a>。</p>
<p>首先排除 PCIe 接口华擎 Z390 itx 版只有一个接口这个是为独立显卡准备的，虽然我很想入 BCM94360CD 四天线。 因此只能考虑 M.2 接口，上面的模块虽然也可以直接插 M.2 接口（底子还是 PCIe 嘛）但板子仅支持 2260/2280，支持 2260 的口我已经插了 SSD（因为主板提供散热马甲），<del>因此我只能考虑 2280。淘宝上能找到的支持 2280 转接卡的模块基本上只有 BCM94360CS2 和 BCM943602CS，考虑到后者是较新的 5G 可以达到 1300M，这俩价格也差不多基本上会考虑后者</del>。受春节的影响没有入手，期间在浏览的时候发现华擎 Z370 可以拆卸原本的 Intel 的无线模块用来安装博通网卡/蓝牙模块，联系了 up 主没有得到解答只能从他视频扣细节，Intel 网卡型号不一样但确定插槽是 M.2 Key E，考虑到主板自带两个天线口放弃了三天线的 BCM943602CS，买了最物美价廉的 BCM94360CS2，带上转接卡高度 2230 机箱可以兼容。附上一个 M.2 接口的一栏图：</p>













  
  
    
      <figure data-pswp="900x2048" data-size="800x"><a href="/uploads/2020/04/02/m2-key-list.jpeg" class="gallery-item" target="_blank" data-pswp-width="900" data-pswp-height="2048"><img src="/uploads/2020/04/02/m2-key-list_hue303cdd9ec1c456e7c7b209fdb90df78_216428_800x0_resize_q75_box.jpeg"/></a><figcaption>

    <p>M2 规格图</p></figcaption></figure>

<p><strong>特别提醒</strong>：主板自带 M.2 Key E 插口的无线模块需要<a href="https://bbs.nga.cn/read.php?tid=16399773&amp;page=1">支持非 CNVi 网卡才能使用</a>，如果有白名单请参考上面删除线内的方法。</p>
<p>如果你不需要蓝牙的话也可以考虑 USB 无线网卡，USB 类型的目前暂无网卡和蓝牙二合一可用的硬件，虽然市面上已经出了一些。个人在春节期间不忍寂寞从 7x24 小时发货的京东买了 Comfast CF-913AC V2 USB 网卡安装<a href="http://en.comfast.com.cn/index.php?m=content&amp;c=index&amp;a=show&amp;catid=30&amp;id=223">驱动</a>装的黑苹果。</p>
<h3 id="显示器">显示器</h3>
<p>家里还在服役的 DELL 2209wa 是我 2010 年购入能坚持到现在已经是个奇迹了，16:10 画面在玩 PS4 时会让画面拉伸，屏幕被植物长期亲密接触屏幕出现了一些坏点，在和老婆大人协商后加购预算购买新显示器。这也就有了这个为什么的出现。</p>
<p><a href="https://www.lg.com/cn/monitors/lg-27UL600">LG 27UL600</a> 应该是 2019 年初我找到的国内性价比最高的 4k 显示器了吧。27 寸 4k 分辨率，IPS 屏，支持 DisplayHDR 400，sRGB 99% 色域，DisplayPort 1.2 和 HDMI 2.0 接口（兼容 HDCP 2.2设备），3.5mm 音频输出接口。 缺点是底座垃圾，敲下电脑桌就有可能会让显示器晃悠一会，建议直接上摇臂支架（反正我支架是现成的把老显示器卸下来就行了）。</p>
<p>关于网上有些人说 27 寸用 4k 会特别难受的问题，我表示 Windows 和黑苹果可以字体缩放 200% 用起来非常舒服。</p>
<p>题外话，这款显示器是 27UD69-W 的升级款。如果你不考虑 sRGB 99% 色域的话入手 27UD58-B 也是不错的选择。</p>
<h3 id="黑苹果安装教程">黑苹果安装教程</h3>
<p><del>等我装好了测试没问题就写，还是说你愿意看到一个没有实践过的版本？</del></p>
<p>好啦好啦，不用催更了，<a href="https://icyleaf.com/2019/03/asrock-z390-gaming-itx-install-hackintosh-tutorial/">教程链接</a>。</p>
]]></content:encoded></item><item><title>升级 HP MicroServer Gen8 iLO 秘笈</title><link>https://icyleaf.com/2018/11/upgrade-hp-microerver-gen8-ilo/</link><pubDate>Tue, 27 Nov 2018 10:43:07 +0800</pubDate><guid>https://icyleaf.com/2018/11/upgrade-hp-microerver-gen8-ilo/</guid><description>服务器硬件提供 iLO 让你不再困扰外接屏幕和键鼠</description><content:encoded><![CDATA[<p>几年前听取网络上的建议德淘了一台 HP MicroServer Gen8 服务器作为家用的 NAS 服务器，德淘的原因除了便宜以外电源的功率比国内版的更大，内存也比国内版的大（4G）。
Gen 8 自带 iLO 这是一个很强大的功能，新出的 Gen10 虽然硬件各方面有不错的表现但却阉割了 iLO，打算入坑谨慎选择。</p>
<h2 id="给你鱼">给你鱼</h2>
<p><a href="https://pan.baidu.com/s/1wSMlqg-iVO80U-5Z-kNdQA">https://pan.baidu.com/s/1wSMlqg-iVO80U-5Z-kNdQA</a> 提取码: w8mq</p>
<h2 id="教你渔">教你渔</h2>
<p>本方法适用于你当前操作的电脑系统是任何操作系统。</p>
<h3 id="版本概念">版本概念</h3>
<p>iLO 当前的版本分为<strong>硬件版本</strong>和<strong>软件版本</strong></p>
<ul>
<li>硬件版本目前主要是 iLO4 和 iLO 5，后者是 Gen10 在使用。登录 iLO 管理后台页面的头部会提示你 iLO4/5。</li>
<li>软件版本目前 iLO4 的最新版本是 2.6.1，iLO5 因为用不上没有做了解。在 iLO 管理后台登录界面上会有一行小字提示。</li>
</ul>
<h3 id="升级固件">升级固件</h3>
<p>打开 <a href="https://support.hpe.com/hpesc/public/home">HPE 网站</a> 搜索关键词 &ldquo;HPE ProLiant MicroServer Gen8 Server&rdquo;，
不要着急回车稍等片刻等有个浮层显示后点击”驱动和文件下载“。</p>
<p>下载 iLO 固件的可通过左侧的筛选过滤选择 ”固件（Firmware）更新 - Lights-Out Management“ 然后在右侧选择日期是最新的一个对应你操作系统的版本。
如果是 macOS 或没有支持的操作系统也没关系选择任意 Windows 的版本，然后在详情页面点击下载。</p>
<p>如果你下载后的 exe 文件，通过解压文件可直接进行解压缩能看到里面的 bin 文件，这个实际上是通过 iLO 管理后台升级所用的关键文件。</p>
<p>操作路径：Administrator -&gt; Framware</p>
<h3 id="安装语言包">安装语言包</h3>
<p>还是在刚才的搜索结果页面重置并新过滤”应用软件 - Lights-Out Management“，因为语言包更新到频次没那么高，你需要把右侧最底部显示的条目数改为全部（All）
后通过搜索关键词 ”Lights-Out 4 Language Pack“ 找到你希望使用的语言包，截至目前最新的中文语言包（Simplified Chinese ）是 2017 年的，下载过程同上面。</p>
<p>解压缩文件后只需要里面的 lpk 文件。</p>
<p>操作路径：Administrator -&gt; Access Settings -&gt; Language</p>
]]></content:encoded></item><item><title>如何解决 macOS 编译丢失 C Header 文件</title><link>https://icyleaf.com/2018/10/apply-for-a-motorcycle-license/</link><pubDate>Wed, 24 Oct 2018 14:30:07 +0800</pubDate><guid>https://icyleaf.com/2018/10/apply-for-a-motorcycle-license/</guid><description>macOS 系统小升级带了兼容困扰怎么办</description><content:encoded><![CDATA[<p>今天在 macOS 10.14 通过 brew 安装 libgit2 之后调用时提示提示 <code>fatal error: 'time.h' file not found</code>，本以为是 brew 的问题自己去编译问题依然。确认了 Xcode Command Line Tools 并且再次确认了 <code>xcode-select -s /Applications/Xcode.app</code> 之后还是这样，就连重启大法也不用之后，在 Google 上检索换了好些关键词也没找到问题出在哪，索性把关键词继续模糊放大扩大范围，看到了 github 一个不知道是啥的项目看到有 <code>'stdio.h.h' file not found</code>
类似的 issue 终于找到了<a href="https://github.com/frida/frida/issues/338#issuecomment-424595668">解决答案</a>：</p>
<blockquote>
<p>关键原因是在于找不到 /usr/include 目录，然而安装 command-line tools 也不会自动帮你解决，而是需要在安装后再手动安装 /Library/Developer/CommandLineTools/Packages/macOS_SDK_headers_for_macOS_10.14.pkg 才行。</p>
</blockquote>
<p>跟随这个解决方案也附带了<a href="https://forums.developer.apple.com/thread/104296">解释</a>：</p>
<blockquote>
<p>From the latest Xcode 10 Beta 2 release notes.</p>
<p>The Command Line Tools package installs the macOS system headers inside the macOS SDK. Software that compiles with the installed tools will search for macOS headers at the standard include path: /Applications/Xcodebeta.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.1 4.sdk/usr/include For legacy software that looks for the macOS headers in the base system under /usr/include, please install the package file located at: /Library/Developer/CommandLineTools/Packages/macOS_SDK_headers_for_macOS_10.14.pkg</p>
</blockquote>
]]></content:encoded></item><item><title>海淀驾校增驾摩托车驾照</title><link>https://icyleaf.com/2018/05/apply-for-a-motorcycle-license/</link><pubDate>Mon, 14 May 2018 20:00:43 +0800</pubDate><guid>https://icyleaf.com/2018/05/apply-for-a-motorcycle-license/</guid><description>在北京考摩托车驾照 14 天拿本流程</description><content:encoded><![CDATA[<p>去年差不多这个时候也有过学摩托的念头顺便去了好几家摩托专卖店，当时有的店提供花钱买本的服务可惜一是担心假本二是没下定决心，
没过多久北京爆出来相关买本的灰色买卖这事我估计也就黄了也没在继续下去。时隔一年后的今天再次够了每天搬电池充电的电动车通勤，
上周鼓起勇气（家人的鼓励也很重要）报名了摩托车增驾 D 本。</p>
<p>北京可以学摩托车的驾校其实也不少，还是找了北边地区比较靠谱的海淀驾校。直接在官方微信公众号报名挂了电话不到一分钟就有工作人员
打电话过来确认时间上门服务（这个真心赞）。后来工作人员告诉我如果在东方时尚学过本再报增驾会有 300 的优惠，可惜现在住北边了。</p>
<p>由于这两年快递的发展学摩托车的人也逐渐多起来，海淀驾校现在是每周一期开车，<strong>一期大约 14 天时间可以拿本</strong>。</p>
<h2 id="14-天拿本流程">14 天拿本流程</h2>
<ul>
<li>第一周周四之前报名(周五当天会发短信通知培训时间点)</li>
<li>第一周的周六下午科目一培训（必须去录指纹和点名才能参加考试）</li>
<li>第二周的周四下午科目一考试（挂了可以当场免费补考一次，再挂每次 50 元补考一次）</li>
<li>第三周的周二到周五和周日可以全天训练，周一下午和周六是下午半天可以训练（至少去一次，尽量在周四前去训练场见教练并签字，不然无法参加科目二、三考试）</li>
<li>第三周的周六上午是科目四培训（同样必须驱要点名才能参加考试）</li>
<li>第四周的周一上午科目二、三考试，下午科目四考试（都过了当天拿本）</li>
</ul>
<p>看着需要四周但实际上从你到驾校算起到拿本一切顺利的情况下正好 14 天。</p>
<h3 id="训练课时">训练课时</h3>
<p>目前北京学摩托车和学汽车不一样，不打卡不记录不用约考试学时一切教练说的算。
如果你下载了 海淀驾校 App 里面可用只有查看班车路线和班车实时情况。</p>
<h3 id="训练时长">训练时长</h3>
<ul>
<li><code>上午</code>: 8:00 ~ 11:30 (班车 12:00)</li>
<li><code>下午</code>: 12:30 ~ 15:30 (班车 16:15)</li>
</ul>
<h3 id="训练车型">训练车型</h3>
<ul>
<li><code>两轮</code>：新采购的豪爵 125cc，循环挡。</li>
<li><code>边三轮</code>：已经服役好几年的嘉陵 600cc，国际挡，见本文章的封图。</li>
</ul>
<p>也就是说在这里学摩托必须要在工作日时间至少去 3 次，因为课时的原因怎么请假也得一天，建议选择一个全天可以练习的时间去。
我们这期报名的是 100 多人，报名三轮是 27 人一组，如果是全到场的话半天课时也骑不了几次。不过大家也都不是每天都去，
我周二去的时候教练说他还有 17 名学生没见过呢。</p>
<p>正常情况下学三轮通常都比两轮的要多很多，三轮数量有限是多人一组共享一辆车，两轮相对比较多一般情况下一人一辆，
车都经过特殊优化限制速度，三轮调教的不会往一边歪。</p>
<h2 id="报名所需资料">报名所需资料</h2>
<ul>
<li>身份证原件及复印件（正反复印在一张纸上）</li>
<li>北京居住证原件和复印件（非京籍需要）</li>
<li>驾照原件和复印件（增驾需要，左右两证单面复印在一张纸上）</li>
<li>一寸白底照片（如果平时带眼镜，照片也需要有眼镜，没有的话给电子版工作人员可以给 P 上眼镜）</li>
<li>报名所需的钱（两轮 E 本 1600，三轮 D 本 2000）</li>
<li>体检费用 20 元（需要现金）</li>
</ul>
<h2 id="摩托车驾照">摩托车驾照</h2>
<ul>
<li><code>F</code> 本，可以驾驶轻便型摩托车(50cc 以下排量），但市面上没有驾校可以学</li>
<li><code>E</code> 本，可以驾驶<strong>任何排量</strong>两轮摩托车以及 <code>F</code> 本的摩托车</li>
<li><code>D</code> 本，可以驾驶<strong>任何排量</strong>三轮和边三轮（跨子）摩托车以及 <code>E</code>、<code>F</code> 本的摩托车</li>
</ul>
<blockquote>
<p>划重点了！除了 <code>F</code> 以外可以开任何排量的车，无论是 110cc、250cc、400cc、1000cc 甚至更高排量的都！可！以！当然是可以上牌的车型。</p>
</blockquote>
<blockquote>
<p>两轮摩托车在驾驶时必须带安全头盔，三轮摩托车可以不用带安全头盔。</p>
</blockquote>
<p>对于纠结 <code>D</code> 和 <code>E</code> 本的童鞋，如果不差那几百元就直接 <code>D</code> 本一劳永逸。</p>
<p>如果你认定你就只开两轮摩托那 <code>E</code> 本也就足够了。倘若未来的有一天你后悔了想开三轮，对不起，你还得在增驾一次也就意味着重头学和考试一次。</p>
<h2 id="上级考试资料">上级考试资料</h2>
<p>下载 <code>驾校宝典</code> 或 <code>驾校一点通</code> 选择摩托车题库，科目一 400 道题，科目四 345 道题。但我在科目四考试时出现了 2 道没有见过的题，
不过可以根据之前的知识解答。</p>
<h2 id="训练场地指引">训练场地指引</h2>
<blockquote>
<p>打开手机上的地图 App 搜索 <code>海淀驾校摩托车训练场</code></p>
</blockquote>
<p>科目一和科目四培训及考试都在京海教学楼，以那里为起点沿着教学楼北边的道路（班车进驾校走的那条路）继续往西走 <code>1.8km</code> 就抵达摩托车
训练场。</p>
<p>如果你是开车去途中看到走路的童鞋基本上都是学摩托车的建议捎上一程，到目的地后可以把车停在训练场旁边的小树林旁。</p>
<h2 id="训练和考试项目">训练和考试项目</h2>
<ul>
<li>转弯打灯</li>
<li>单边桥</li>
<li>红绿灯（黄灯就停）</li>
<li>坡起</li>
<li>绕桩</li>
</ul>
<p>认真按着教练说的练，重点是熟练操作，掌握好离合的半联动一切都好办。实际考试主要考察绕桩，其他项目就听声音是否熄火。</p>
<blockquote>
<p>注意的是你平时训练的车号并不一定考试会用到，尽量保证掌握每辆车的离合器和半联动的感觉。</p>
</blockquote>
<h2 id="领取驾照所需资料">领取驾照所需资料</h2>
<ul>
<li>驾照原件（增驾需要）</li>
<li>身份证原件</li>
<li>一寸白底照片（无所谓带不带眼镜）</li>
<li>海淀驾校的班车卡（可以坐班车的那张）</li>
</ul>
<blockquote>
<p>注意教练声称增驾后的驾照的有效期是和原由的保持不变的（即如果你的驾照快到期了增驾后还需要在到期 90 天内换本），
但实际情况是会帮你换下一个有效期的本。</p>
</blockquote>
<h2 id="资料参考">资料参考</h2>
<p>如果你对于我文字中没有提到的部分感兴趣建议查看下如下两篇文章：</p>
<ul>
<li><a href="https://meixg.cn/2017/04/09/learn-motocycle/">2017年3月海淀驾校增驾摩托车D本流程</a></li>
<li><a href="http://blog.sina.com.cn/s/blog_6d56a57d0102x0dz.html">2017海淀驾校考摩托车驾照流程</a></li>
</ul>
]]></content:encoded></item><item><title>一招解决苹果账户因忘记安全问题绑定手机号</title><link>https://icyleaf.com/2018/04/how-to-bind-mobile-number-to-apple-developer-account/</link><pubDate>Fri, 27 Apr 2018 18:00:07 +0800</pubDate><guid>https://icyleaf.com/2018/04/how-to-bind-mobile-number-to-apple-developer-account/</guid><description>亲身经历和几招解决办法</description><content:encoded><![CDATA[<h2 id="前言">前言</h2>
<p>2018 年 4 月初的某天，苹果针对于开发者账户抛出了一个看似只有在中国实施的政策：账户需绑定手机号。
但如果你记得账户登录密码却忘记了安全问题的答案，那你就不能绑定手机号和后续操作。我是亲身经历这个事件且过程都发在了 twitter 上面，期间也有很多朋友帮忙跟进和给出不少建议。我希望国内的用户通过搜索引擎找到这里来解决问题。</p>
<blockquote>
<p>如果你只想看到最有效的解决方案请拉到文章的尾部的<strong>一招解决</strong>，中间提到的一些解决方案可能在你那边也会适用。</p>
</blockquote>
<h2 id="亲身经历">亲身经历</h2>
<p>对于绑定手机号来说，乍一看这算啥我不绑定你能咋滴！然而我们都太 naive，直到某一天我要对一个快过期的账户续费的时候发现了一个巨大的坑。
也就是说如果你没有绑定手机号你讲不能下述操作：</p>
<ul>
<li>不能接受最新苹果的协议更新 （这算事？）</li>
<li>不能对已上架的 App 新建版本</li>
<li>不能新建新 App</li>
<li>不能对账户进行续费（你没看错，我通过技术手段获取了续费链接打开还是要你绑定手机号！）</li>
</ul>
<p>老老实实的去绑定手机号，首先它会跳转到 appleid.apple.com 网站提示登录，如往常一样输入用户名密码点击登录，映入眼帘不是登录成功后
的界面而是让你输入安全问题的答案。由于公司涉及的多个账户最初并不是我来申请的，赶紧联系前同事求助得到的答案是我当时瞎填的，我&hellip;</p>
<p>第一时间打苹果客服 <code>400-009-5555</code> 接通后说明问题希望能够重设安全问题，这个时候苹果一如既往的保持高安全性的答复如果你忘记了安全问题
的答案那这个帐号基本上就废了。但如果你这个是开发者账户的话可以通过两种方式尝试解决：</p>
<ol>
<li>用手机登录该账户后尝试开启两步验证，如果没有提示安全问题开启后就可以重置，若有提示那此路不通。</li>
<li>求助苹果开发者客服 <code>400-670-1855</code>，看看他们那边怎么处理。</li>
</ol>
<blockquote>
<p>推友 <a href="https://twitter.com/frankxzx624">@frankxzx</a> 给我建议说如果开发者账户如果绑定了紧急邮箱也可以重设，但不适用于我的情况有类似需求的可以尝试。</p>
</blockquote>
<p>找了台测试机尝试方案一结果还是显示安全问题，只能寄希望于苹果开发者客服。通过几天的跟进我认为这个电话非常的坑爹，因为接通会进入等待列表，
语音还特别提示“你的电话非常重要，请耐心等待”，但通常情况下你需要 1 ~ 2 个小时才能接通，建议打这个电话的时候用一个蓝牙耳机会能让你先忙
于其他的事情。</p>
<blockquote>
<p>推友 <a href="https://twitter.com/Lonely__Ma">@Lonely</a> 给我建议是每天早上 9 点拨打秒接通，但那个时间点我一般在路上没有尝试。</p>
</blockquote>
<p>一个星期的时间我总共打通过两次，第一次给的服务还不错说情况比较复杂他的权限不能够解决，但可以给我的几个账户进行安全升级并向上级反馈并耐心
等待答复又不能保证什么时候会答复，给了我一个案例编号说你可以再次拨打客服电话报上案例编号就可以查到进度。</p>
<p>第二次拨打是 4 天后花了 1 个半小时接通，一个说中文比较费劲的技术人员告诉我你不是账户的持有人找你们的老板来打这个电话才行（哪个老板可以每天花
1 - 2 小时等待时间给你打电话还不一定能接通），跟他说了你们电话太难打了我花了快 2 小时才打通啊，这又不是随随便便就能接通的。然后有说你可以
给我们(<code>chinadev@asia.apple.com</code>)发邮件我们会尽快回复的，但邮件必须是通过有问题的 apple id 账户的邮箱发出才行。</p>
<p>感谢后挂了我就登录 apple id 的邮箱系统依次发了邮件希望能够尽快处理，因为一个账户还有 3 天就续费过期了。在看到 Apple 自动恢复的邮件显示
“我们会在一天内给你答复”</p>
<p>第一天过去了没有收到答复，第二天过去了还没有收到答复&hellip;第三天开发者账户已经过期依然没有收到答复&hellip;</p>
<p>就在我绝望之际，我看到了曙光。</p>
<h2 id="一招解决">一招解决</h2>
<blockquote>
<p>截至 2018 年 4 月 27 日该方法有效。</p>
</blockquote>
<p>推友 <a href="https://twitter.com/shanegood">@shanegood</a> 和 <a href="https://twitter.com/lipeiqiang">@lipeiqiang</a> 在第一时间提醒我通过 macOS 登录
iCloud 更新联系方式的方式可以添加绑定手机号。在本机新建了多个用户对于不同的账户依次登录 iCloud 确实可以绑定手机号！但重设安全问题是无解的。</p>
<p>对于绑定的手机号必须是没有绑定过其他 Apple Id 账户的才行，于是我通过阿里小号 App 和我另外一个大王卡小号绑定了公司的开发者帐号。蛋疼！</p>
<p>感谢在这个事件中给予帮助的推友也希望本文能够帮助你解决问题。完整的时间线都在我的 twitter 上面记录，欢迎 <a href="https://twitter.com/icyleaf">follow</a>。</p>
]]></content:encoded></item><item><title>如何使用 Docker 管理 Jenkins</title><link>https://icyleaf.com/2018/04/how-to-manage-jenkins-with-docker/</link><pubDate>Wed, 18 Apr 2018 14:44:32 +0800</pubDate><guid>https://icyleaf.com/2018/04/how-to-manage-jenkins-with-docker/</guid><description>让人几多愁的 Jenkins 该如何管理才能省心</description><content:encoded><![CDATA[<p>官方的 <a href="https://hub.docker.com/_/jenkins">jenkins</a> 镜像已经不再维护管理而是由 Jenkins Community 进行更新，鉴于 Jenkins 的更新频率特别快社区版本会提供两个版本：</p>
<ul>
<li><code>lts</code> 长期稳定版本，但还是会有新版提醒</li>
<li><code>latest</code> 每周更新版本</li>
</ul>
<p>都是基于 alpine 系统封装因此镜像的体积会大大减小很多。如果你是内网使用可以不用在意更新问题长期使用一个版本也没太大问题。</p>
<h2 id="安装">安装</h2>
<p>创建镜像时需要注意几个地方：</p>
<ol>
<li>关联本地 volumes</li>
<li>设置时区（默认是 UTC 时间）</li>
<li>映射 50000 端口（这个是 master 和 slave 的通讯端口）和 8000 端口（Web）</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">docker run -d --restart<span class="o">=</span>always
</span></span><span class="line"><span class="ln">2</span><span class="cl">    -p 8000:8080 -p 50000:50000
</span></span><span class="line"><span class="ln">3</span><span class="cl">    -v /var/lib/docker/jenkins:/var/jenkins_home
</span></span><span class="line"><span class="ln">4</span><span class="cl">    -e <span class="nv">JAVA_OPTS</span><span class="o">=</span>-Duser.timezone<span class="o">=</span>Asia/Shanghai
</span></span><span class="line"><span class="ln">5</span><span class="cl">    jenkins/jenkins:lts
</span></span></code></pre></div><p>对于进行设置 JAVA 的参数可以参考：https://github.com/jenkinsci/docker/issues/45</p>
<h2 id="配置-jenkins-的插件源">配置 Jenkins 的插件源</h2>
<p>使用过它的人都知道管理和安装插件是一个奇慢无比的事情，虽然提供了代理服务器但我这还有一个更好的方案。</p>
<p>我在翻阅国内镜像源网站的时候发现清华大学开源软件镜像站其实提供了国内 Jenkins 插件的镜像源但一直很低调的没有公布，通过进入<code>管理插件 -&gt; 高级</code>页面拉到最底部有个升级站点的自定义框，填入</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json
</span></span></code></pre></div><p>安装插件的时候系统默认会测试网络就是 ping 下 Google 的网站，它会提示失败但不用担心它会继续尝试下载和安装插件。</p>
<h2 id="升级">升级</h2>
<p>此方法适用于所有的容器的升级步骤。</p>
<p>首先需要找到容器的名字，这里我想会有不少人会问为什么你在创建一个容器的时候不指定一个名字，
那是因为后面还需要创建一个新版本的容器而名字不能一样，因此我现在创建都让 docker 随机分配。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ docker ps
</span></span><span class="line"><span class="ln">2</span><span class="cl">CONTAINER ID  ...   NAMES
</span></span><span class="line"><span class="ln">3</span><span class="cl">8f48718fdd07  ...   naughty_pasteur
</span></span></code></pre></div><p>拿到之后先停止运行后，创建一个数据备份容器再进行拉取最新版本</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ docker stop naughty_pasteur
</span></span><span class="line"><span class="ln">2</span><span class="cl">$ docker docker create --volumes-from naughty_pasteur --name jenkins-data jenkins/jenkins:lts
</span></span></code></pre></div><p>拉取最新版本后恢复数据：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ docker pull jenkins/jenkins:lts
</span></span><span class="line"><span class="ln">2</span><span class="cl">$ docker run -d --restart<span class="o">=</span>always
</span></span><span class="line"><span class="ln">3</span><span class="cl">    --volumes-from jenkins-data
</span></span><span class="line"><span class="ln">4</span><span class="cl">    -p 8000:8080 -p 50000:50000
</span></span><span class="line"><span class="ln">5</span><span class="cl">    -v /var/lib/docker/jenkins:/var/jenkins_home
</span></span><span class="line"><span class="ln">6</span><span class="cl">    -e <span class="nv">JAVA_OPTS</span><span class="o">=</span>-Duser.timezone<span class="o">=</span>Asia/Shanghai
</span></span><span class="line"><span class="ln">7</span><span class="cl">    jenkins/jenkins:lts
</span></span></code></pre></div><p>确保通过 web 访问和 build 正常后删除老的和数据备份的容器</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ docker rm naughty_pasteur
</span></span><span class="line"><span class="ln">2</span><span class="cl">$ docker rm jenkins-data
</span></span></code></pre></div><h2 id="疑惑解答">疑惑解答</h2>
<h3 id="1-我忘记设置时区但我进实例修改了时区在-jenkins-里不生效">1. 我忘记设置时区但我进实例修改了时区在 Jenkins 里不生效</h3>
<p>在 Jenkins 的系统设置页面找到脚本命令行运行：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">System</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="err">&#39;</span><span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">commons</span><span class="o">.</span><span class="na">jelly</span><span class="o">.</span><span class="na">tags</span><span class="o">.</span><span class="na">fmt</span><span class="o">.</span><span class="na">timeZone</span><span class="err">&#39;</span><span class="o">,</span> <span class="err">&#39;</span><span class="n">Asia</span><span class="o">/</span><span class="n">Shanghai</span><span class="err">&#39;</span><span class="o">)</span>
</span></span></code></pre></div><p>执行后即时生效无需重启，方法来自<a href="https://wiki.jenkins.io/display/JENKINS/Change+time+zone">官方文档</a></p>
<h2 id="官方文档">官方文档</h2>
<p><a href="https://github.com/jenkinsci/docker/blob/master/README.md">https://github.com/jenkinsci/docker/blob/master/README.md</a></p>
]]></content:encoded></item><item><title>Fast Crystal</title><link>https://icyleaf.com/2017/05/fast-crystal/</link><pubDate>Wed, 10 May 2017 11:57:58 +0000</pubDate><guid>https://icyleaf.com/2017/05/fast-crystal/</guid><description>灵感来自 fast-ruby 项目的延展性能测试</description><content:encoded><![CDATA[<p>起初是自己写了一个小测试来看看 Crystal 下连接字符串几种实现方式的性能情况，结果还真能区分出来</p>
<pre tabindex="0"><code>$ crystal build --release code/string/concatenation.cr -o bin/string/concatenation
$ ./bin/string/concatenation

Crystal 0.22.0 (2017-04-22) LLVM 4.0.0

 String#+  32.98M ( 30.32ns) (±11.62%)       fastest
String#{}   9.51M (105.16ns) (± 6.12%)  3.47× slower
 String#%    5.0M (200.03ns) (± 4.81%)  6.60× slower
</code></pre><p>于是就仿照 <a href="https://github.com/JuanitoFatas/fast-ruby">fast-ruby</a> 在周末花了时间 fork 了 crystal 版本，其实结果挺让人吃惊的，因为是编译性语言在大多数情况下一些小的语法糖在编译器优化阶段会做一致性处理最终的结果其实是一样的，但也有一些例外。</p>
<p><a href="https://github.com/icyleaf/fast-crystal">https://github.com/icyleaf/fast-crystal</a></p>
]]></content:encoded></item><item><title>打通 Sidekiq 的任督二脉 Ruby 和 Crystal</title><link>https://icyleaf.com/2017/04/sidekiq-works-in-ruby-togethor-with-crystal/</link><pubDate>Wed, 26 Apr 2017 16:00:49 +0000</pubDate><guid>https://icyleaf.com/2017/04/sidekiq-works-in-ruby-togethor-with-crystal/</guid><description>Crystal 和 Ruby 如何相互通讯</description><content:encoded><![CDATA[<p>自从开始研究 Crystal 这门语言（之前也有<a href="http://icyleaf.com/2016/07/gitlab-api-wrapper-for-crystal/">介绍</a>过），基本上每隔一段时间都会看看它的近况，去年 sidekiq 的作者用该语言重新实现了 sidekiq 项目而且给出了特别竟然的<a href="http://www.mikeperham.com/2016/05/25/sidekiq-for-crystal/">对比数据</a>。</p>
<p><img loading="lazy" src="/uploads/2017/04/26/sidekiq-benchmarks.png"
  
  
  alt="IMAGE"></img>
</p>
<p>相对比 Gitlab 采用 go 语言重新 gitlab_ci_runner 而学习一门新的语言达到高效率低内存的方法之外 Crystal 就像是新的希望。使用 Crystal 重新的 sidekiq 的代码也非常的简单但已经实现了核心功能和 Web UI。</p>
<p>本篇就给大家介绍下如果在 Ruby on Rails 的框架下调度和执行 Crystal 写的 Workers。测试环境是在 macOS 下，其他版本信息如下：</p>
<ul>
<li>Ruby 2.0+
<ul>
<li>Rails 5.0</li>
<li>Sidekiq 5.0</li>
</ul>
</li>
<li>Crystal 0.22.0+
<ul>
<li>Sidekiq.cr 0.7.0</li>
</ul>
</li>
</ul>
<h2 id="配置-rails-环境">配置 Rails 环境</h2>
<p>如何配置 Ruby、Rails、Bundler、Redis 就不在赘述，只讲核心，首先新建一个最基础的 rails 项目，不用额外的第三方辅助工具，数据库用 sqlite 减少外部依赖：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ rails new ruby_on_rails -B -T -S -C -M  -d sqlite3
</span></span></code></pre></div><p>进入项目 <code>ruby_on_rails</code> 编辑 <code>Gemfile</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1"># 修改源地址</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="n">source</span> <span class="s1">&#39;https://gems.ruby-china.org&#39;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1"># 新增 sidekiq 的支持</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="n">gem</span> <span class="s1">&#39;redis-rails&#39;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">gem</span> <span class="s1">&#39;sidekiq&#39;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="c1"># 其余的不用修改</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="c1"># Bundle edge Rails instead: gem &#39;rails&#39;, github: &#39;rails/rails&#39;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="n">gem</span> <span class="s1">&#39;rails&#39;</span><span class="p">,</span> <span class="s1">&#39;~&gt; 5.0.2&#39;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="c1"># Use sqlite3 as the database for Active Record</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="n">gem</span> <span class="s1">&#39;sqlite3&#39;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="c1"># Use Puma as the app server</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="n">gem</span> <span class="s1">&#39;puma&#39;</span><span class="p">,</span> <span class="s1">&#39;~&gt; 3.0&#39;</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="n">gem</span> <span class="s1">&#39;redis-rails&#39;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="n">gem</span> <span class="s1">&#39;sidekiq&#39;</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="n">group</span> <span class="ss">:development</span><span class="p">,</span> <span class="ss">:test</span> <span class="k">do</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">  <span class="c1"># Call &#39;byebug&#39; anywhere in the code to stop execution and get a debugger console</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">  <span class="n">gem</span> <span class="s1">&#39;byebug&#39;</span><span class="p">,</span> <span class="ss">platform</span><span class="p">:</span> <span class="ss">:mri</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="k">end</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="n">group</span> <span class="ss">:development</span> <span class="k">do</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">  <span class="c1"># Access an IRB console on exception pages or by using &lt;%= console %&gt; anywhere in the code.</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">  <span class="n">gem</span> <span class="s1">&#39;web-console&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;= 3.3.0&#39;</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">  <span class="n">gem</span> <span class="s1">&#39;listen&#39;</span><span class="p">,</span> <span class="s1">&#39;~&gt; 3.0.5&#39;</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">  <span class="c1"># Spring speeds up development by keeping your application running in the background. Read more: https://github.com/rails/spring</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">  <span class="n">gem</span> <span class="s1">&#39;spring&#39;</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">  <span class="n">gem</span> <span class="s1">&#39;spring-watcher-listen&#39;</span><span class="p">,</span> <span class="s1">&#39;~&gt; 2.0.0&#39;</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl"><span class="k">end</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">
</span></span><span class="line"><span class="ln">33</span><span class="cl"><span class="c1"># Windows does not include zoneinfo files, so bundle the tzinfo-data gem</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl"><span class="n">gem</span> <span class="s1">&#39;tzinfo-data&#39;</span><span class="p">,</span> <span class="ss">platforms</span><span class="p">:</span> <span class="o">[</span><span class="ss">:mingw</span><span class="p">,</span> <span class="ss">:mswin</span><span class="p">,</span> <span class="ss">:x64_mingw</span><span class="p">,</span> <span class="ss">:jruby</span><span class="o">]</span>
</span></span></code></pre></div><p>配置好之后执行 <code>bundle insall</code> 安装好 Gem 的依赖，再创建文件 <code>config/initializers/sidekiq.rb</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">redis_config</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">url</span><span class="p">:</span> <span class="s1">&#39;redis://localhost:6379/8&#39;</span> <span class="p">}</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="no">Sidekiq</span><span class="o">.</span><span class="n">configure_server</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="n">config</span><span class="o">.</span><span class="n">redis</span> <span class="o">=</span> <span class="n">redis_config</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="k">end</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">
</span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="no">Sidekiq</span><span class="o">.</span><span class="n">configure_client</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl">  <span class="n">config</span><span class="o">.</span><span class="n">redis</span> <span class="o">=</span> <span class="n">redis_config</span>
</span></span><span class="line"><span class="ln">9</span><span class="cl"><span class="k">end</span>
</span></span></code></pre></div><p>Sidekiq 的配置就完事了。</p>
<h2 id="配置-crystal-环境">配置 Crystal 环境</h2>
<p>Crystal 是基于 LLVM 开发，除了 Windows 以外其他绝大数系统基本上都支持（最新支持的 ARM 架构，可在树莓派上安装），<a href="https://crystal-lang.org/docs/installation/">安装步骤</a>同样不再赘述。</p>
<p>安装好之后首先创建一个新项目：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ crystal init app crystal
</span></span></code></pre></div><p>进入项目 <code>crystal</code> 编辑 <code>Shard.yml</code> 这是一个类似于 Gemfile 的功能，但实现的去中心化，在文件末尾新增如下依赖：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="ln">1</span><span class="cl"><span class="nt">dependencies</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="w">  </span><span class="nt">sidekiq</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="w">    </span><span class="nt">github</span><span class="p">:</span><span class="w"> </span><span class="l">mperham/sidekiq.cr</span><span class="w">
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="w">    </span><span class="nt">branch</span><span class="p">:</span><span class="w"> </span><span class="l">master</span><span class="w">
</span></span></span></code></pre></div><p>执行 <code>shards update</code> 或 <code>crystal deps</code> 安装依赖即可。</p>
<h2 id="编写-workers">编写 Workers</h2>
<p>Worker 的功能很简单，就是做一个类似 Redis ping 的功能，Worker 在日志输出 PONG。</p>
<h3 id="ruby-版本">Ruby 版本</h3>
<p>安装 sidekiq 后会在 rails 内置命令可生成基础模板，切换到 <code>ruby_on_rails</code> 目录：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ rails g sidekiq:worker ping1
</span></span><span class="line"><span class="ln">2</span><span class="cl">      create  app/workers/ping1_worker.rb
</span></span><span class="line"><span class="ln">3</span><span class="cl">$ rails g sidekiq:worker ping2
</span></span><span class="line"><span class="ln">4</span><span class="cl">      create  app/workers/ping2_worker.rb
</span></span></code></pre></div><p>worker 的内容也很简单，我在日志输出增加了 <code>[Ruby]</code> 作为 Ruby 版本的标识便于后面的辨识</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1"># app/workers/ping1_worker.rb</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="k">class</span> <span class="nc">Ping1Worker</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="kp">include</span> <span class="no">Sidekiq</span><span class="o">::</span><span class="no">Worker</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="k">def</span> <span class="nf">perform</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="n">logger</span><span class="o">.</span><span class="n">info</span> <span class="s2">&#34;[Ruby] PONG !&#34;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="k">end</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="k">end</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="c1"># app/workers/ping2_worker.rb</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="k">class</span> <span class="nc">Ping2Worker</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="kp">include</span> <span class="no">Sidekiq</span><span class="o">::</span><span class="no">Worker</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="k">def</span> <span class="nf">perform</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="n">logger</span><span class="o">.</span><span class="n">info</span> <span class="s2">&#34;[Ruby] PONG PONG !!&#34;</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">  <span class="k">end</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="k">end</span>
</span></span></code></pre></div><h3 id="crystal-版本">Crystal 版本</h3>
<p>切换到 <code>crystal</code> 目录下和 Ruby 不同的是它的源码是存放在 src 目录下面，我们稍微调整下结构：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln"> 1</span><span class="cl">.
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">├── LICENSE
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">├── README.md
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">├── lib
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">├── shard.lock
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">├── shard.yml
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">├── spec
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">└── src
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    ├── crystal_server.cr
</span></span><span class="line"><span class="ln">10</span><span class="cl">    └── workers
</span></span><span class="line"><span class="ln">11</span><span class="cl">        ├── ping1_worker.cr
</span></span><span class="line"><span class="ln">12</span><span class="cl">        └── ping2_worker.cr
</span></span></code></pre></div><p>worker 的内容如下，并设置 queue 为 <code>crystal</code> 用于指派使用:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-crystal" data-lang="crystal"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1"># src/workers/ping1_worker.cr</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="k">class</span> <span class="nc">Ping1Worker</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="k">include</span> <span class="n">Sidekiq</span><span class="o">::</span><span class="n">Worker</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="n">sidekiq_options</span> <span class="k">do</span> <span class="o">|</span><span class="n">job</span><span class="o">|</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="n">job</span><span class="o">.</span><span class="n">queue</span> <span class="o">=</span> <span class="s2">&#34;crystal&#34;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="k">end</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="k">def</span> <span class="nf">perform</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="n">logger</span><span class="o">.</span><span class="n">info</span> <span class="s2">&#34;[Crystal] PONG !&#34;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="k">end</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="k">end</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="c1"># src/workers/ping2_worker.cr</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="k">class</span> <span class="nc">Ping2Worker</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">  <span class="k">include</span> <span class="n">Sidekiq</span><span class="o">::</span><span class="n">Worker</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">  <span class="n">sidekiq_options</span> <span class="k">do</span> <span class="o">|</span><span class="n">job</span><span class="o">|</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="n">job</span><span class="o">.</span><span class="n">queue</span> <span class="o">=</span> <span class="s2">&#34;crystal&#34;</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">  <span class="k">end</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">
</span></span><span class="line"><span class="ln">20</span><span class="cl">  <span class="k">def</span> <span class="nf">perform</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="n">logger</span><span class="o">.</span><span class="n">info</span> <span class="s2">&#34;[Crystal] PONG PONG !!&#34;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">  <span class="k">end</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="k">end</span>
</span></span></code></pre></div><p>通过代码可以看出 Ruby 和 Crystal 的代码基本上是完全一样的。</p>
<h2 id="任督二脉">任督二脉</h2>
<p>对于使用 Sidekiq 的童鞋都知道，如果我想执行一个队列任务，只需要调用下 Worker 本身的 <code>perform_*</code> 方法，这样的话根本无法调用一个不同语言版本的 Worker 否则 sidekiq 会报类似如下错误：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">2017-04-26T06:19:14.187Z <span class="m">50690</span> TID-ox4qa1k8o WARN: <span class="o">{</span><span class="s2">&#34;context&#34;</span>:<span class="s2">&#34;Job raised exception&#34;</span>,<span class="s2">&#34;job&#34;</span>:<span class="o">{</span><span class="s2">&#34;class&#34;</span>:<span class="s2">&#34;Crystal::Ping1Worker&#34;</span>,<span class="s2">&#34;args&#34;</span>:<span class="o">[]</span>,<span class="s2">&#34;retry&#34;</span>:true,<span class="s2">&#34;queue&#34;</span>:<span class="s2">&#34;default&#34;</span>,<span class="s2">&#34;jid&#34;</span>:<span class="s2">&#34;42ce106d79
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="s2">01a274f3db2d54&#34;</span>,<span class="s2">&#34;created_at&#34;</span>:1493187554.181674,<span class="s2">&#34;enqueued_at&#34;</span>:1493187554.1820428<span class="o">}</span>,<span class="s2">&#34;jobstr&#34;</span>:<span class="s2">&#34;{\&#34;class\&#34;:\&#34;Crystal::Ping1Worker\&#34;,\&#34;args\&#34;:[],\&#34;retry\&#34;:true,\&#34;queue\&#34;:\&#34;default\&#34;,\&#34;jid
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="s2">\&#34;:\&#34;42ce106d7901a274f3db2d54\&#34;,\&#34;created_at\&#34;:1493187554.181674,\&#34;enqueued_at\&#34;:1493187554.1820428}&#34;</span><span class="o">}</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">2017-04-26T06:19:14.187Z <span class="m">50690</span> TID-ox4qa1k8o WARN: NameError: uninitialized constant Crystal
</span></span></code></pre></div><p>打通任督二脉的关键在于两个版本都提供一个 low-level 的 API 可用于定制化调用：</p>
<h3 id="ruby-版本-1">Ruby 版本</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">job_id</span> <span class="o">=</span> <span class="no">Sidekiq</span><span class="o">::</span><span class="no">Client</span><span class="o">.</span><span class="n">push</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="s1">&#39;queue&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>  <span class="c1"># 指派特定的队列名，默认是 default</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="s1">&#39;class&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>  <span class="c1"># Worker 的类名，可以是实例化类型或字符串类型</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="s1">&#39;args&#39;</span> <span class="o">=&gt;[]</span>     <span class="c1"># Worker 接收的参数，以数组形式传递</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="p">)</span>
</span></span></code></pre></div><h3 id="crystal-版本-1">Crystal 版本</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-crystal" data-lang="crystal"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">job</span> <span class="o">=</span> <span class="n">Sidekiq</span><span class="o">::</span><span class="n">Job</span><span class="o">.</span><span class="n">new</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="n">job</span><span class="o">.</span><span class="n">queue</span> <span class="o">=</span> <span class="s2">&#34;default&#34;</span>   <span class="c1"># 指派特定的队列名，默认是 default</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="n">job</span><span class="o">.</span><span class="n">klass</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>          <span class="c1"># Worker 的类名，可以是实例化类型或字符串类型</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="n">job</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="o">[].</span><span class="n">to_json</span>   <span class="c1"># Worker 接收的参数，以数组形式传递</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="n">client</span> <span class="o">=</span> <span class="n">Sidekiq</span><span class="o">::</span><span class="n">Client</span><span class="o">.</span><span class="n">new</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="n">job_id</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">job</span><span class="p">)</span>
</span></span></code></pre></div><h2 id="打通任督二脉">打通任督二脉</h2>
<p>准备工作就绪，打通任督二脉的关键就只差一个了！那就是对于 redis 数据共享，细心的童鞋可能留意了上面只配置了 Ruby 版本的 redis 连接，但对于 Crystal 我故意留白没有说明。因为这个是最关键的一步，对于当前 sidekiq.cr 版本来说。</p>
<p>sidekiq.cr 对于作者来说是一次试水并没有话特别大的精力，Crystal 本身还处在开发阶段在未到达 1.0 之前会有各种 Break Changes。而且作者是非常照顾 Heroku 的开发者，默认仅支持该服务平台 Redis-to-Go 服务，因此想设置 Redis 连接信息必须通过系统的环境变量：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl"><span class="nv">REDISTOGO_URL</span><span class="o">=</span>redis://localhost:6379/8
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="nv">REDIS_PROVIDER</span><span class="o">=</span><span class="nv">$REDISTOGO_URL</span>
</span></span></code></pre></div><p>上面的配置是不可省略的，因为我个人不懂 Heroku 给作者乱提了 PL 还被作者狠批了一顿 :(</p>
<p>回到话题本身，我们来继续写上 <code>src/crystal_server.cr</code> 关键的代码：</p>
<blockquote>
<p>注意：redis 连接信息无比保证和 rails 配置的是一致的！</p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-crystal" data-lang="crystal"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">require</span> <span class="s2">&#34;sidekiq&#34;</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="k">require</span> <span class="s2">&#34;sidekiq/cli&#34;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="k">require</span> <span class="s2">&#34;./workers/*&#34;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="no">ENV</span><span class="o">[</span><span class="s2">&#34;LOCAL_REDIS&#34;</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&#34;redis://localhost:6379/8&#34;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="no">ENV</span><span class="o">[</span><span class="s2">&#34;REDIS_PROVIDER&#34;</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&#34;LOCAL_REDIS&#34;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="n">cli</span> <span class="o">=</span> <span class="n">Sidekiq</span><span class="o">::</span><span class="no">CLI</span><span class="o">.</span><span class="n">new</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="n">server</span> <span class="o">=</span> <span class="n">cli</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="c1"># 支持中间件，默认留空即可</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="k">end</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="n">cli</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">server</span><span class="p">)</span>
</span></span></code></pre></div><p>代码需要编译执行，因为不编译是无法给 sidekiq cli 传递它接受的参数（当然也有方法，我放在末尾范例源码中自己寻找）</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ crystal build src/crystal_server.cr -o crystal_server
</span></span></code></pre></div><p>通过上面命令把源码编译成可执行文件到项目根目录的 <code>crystal_server</code> 文件。</p>
<p>打开终端一：启动 ruby 的 sidekiq server</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln"> 1</span><span class="cl">$ <span class="nb">cd</span> ruby_on_rails
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">$ sidekiq -q default
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">2017-04-26T06:47:19.299Z <span class="m">76282</span> TID-owewdljsc INFO: Booting Sidekiq 4.2.10 with redis options <span class="o">{</span>:url<span class="o">=</span>&gt;<span class="s2">&#34;redis://localhost:6379/8&#34;</span><span class="o">}</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">         m,
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">         <span class="sb">`</span><span class="nv">$b</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    .ss,  <span class="nv">$$</span>:         .,d$
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="sb">`</span><span class="nv">$$</span>P,d<span class="nv">$P</span><span class="s1">&#39;    .,md$P&#34;&#39;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">     ,<span class="nv">$$$$$bmmd$$$P</span>^<span class="s1">&#39;
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="s1">   .d$$$$$$$$$$P&#39;</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">   <span class="nv">$$</span>^<span class="s1">&#39; `&#34;^$$$&#39;</span>       ____  _     _      _    _
</span></span><span class="line"><span class="ln">13</span><span class="cl">   $:     ,<span class="nv">$$</span>:       / ___<span class="p">|</span><span class="o">(</span>_<span class="o">)</span> __<span class="p">|</span> <span class="p">|</span> ___<span class="p">|</span> <span class="p">|</span> _<span class="o">(</span>_<span class="o">)</span> __ _
</span></span><span class="line"><span class="ln">14</span><span class="cl">   <span class="sb">`</span>b     :<span class="nv">$$</span>        <span class="se">\_</span>__ <span class="se">\|</span> <span class="p">|</span>/ _<span class="sb">`</span> <span class="p">|</span>/ _ <span class="se">\ </span><span class="p">|</span>/ / <span class="p">|</span>/ _<span class="sb">`</span> <span class="p">|</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">          <span class="nv">$$</span>:         ___<span class="o">)</span> <span class="p">|</span> <span class="p">|</span> <span class="o">(</span>_<span class="p">|</span> <span class="p">|</span>  __/   &lt;<span class="p">|</span> <span class="p">|</span> <span class="o">(</span>_<span class="p">|</span> <span class="p">|</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">          <span class="nv">$$</span>         <span class="p">|</span>____/<span class="p">|</span>_<span class="p">|</span><span class="se">\_</span>_,_<span class="p">|</span><span class="se">\_</span>__<span class="p">|</span>_<span class="p">|</span><span class="se">\_\_</span><span class="p">|</span><span class="se">\_</span>_, <span class="p">|</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">        .d<span class="nv">$$</span>                                       <span class="p">|</span>_<span class="p">|</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl">2017-04-26T06:47:19.433Z <span class="m">76282</span> TID-owewdljsc INFO: Running in ruby 2.4.0p0 <span class="o">(</span>2016-12-24 revision 57164<span class="o">)</span> <span class="o">[</span>x86_64-darwin16<span class="o">]</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">2017-04-26T06:47:19.433Z <span class="m">76282</span> TID-owewdljsc INFO: See LICENSE and the LGPL-3.0 <span class="k">for</span> licensing details.
</span></span><span class="line"><span class="ln">21</span><span class="cl">2017-04-26T06:47:19.433Z <span class="m">76282</span> TID-owewdljsc INFO: Upgrade to Sidekiq Pro <span class="k">for</span> more features and support: http://sidekiq.org
</span></span><span class="line"><span class="ln">22</span><span class="cl">2017-04-26T06:47:19.442Z <span class="m">76282</span> TID-owewdljsc INFO: Starting processing, hit Ctrl-C to stop
</span></span></code></pre></div><p>打开终端二：启动 crystal 的 sidekiq server</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln"> 1</span><span class="cl">$ <span class="nb">cd</span> crystal
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">$ ./crystal_server -q crystal
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">         m,
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">         <span class="sb">`</span><span class="nv">$b</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    .ss,  <span class="nv">$$</span>:         .,d$
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="sb">`</span><span class="nv">$$</span>P,d<span class="nv">$P</span><span class="s1">&#39;    .,md$P&#34;&#39;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">     ,<span class="nv">$$$$$bmmd$$$P</span>^<span class="s1">&#39;
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="s1">   .d$$$$$$$$$$P&#39;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">   <span class="nv">$$</span>^<span class="s1">&#39; `&#34;^$$$&#39;</span>       ____  _     _      _    _
</span></span><span class="line"><span class="ln">11</span><span class="cl">   $:     ,<span class="nv">$$</span>:       / ___<span class="p">|</span><span class="o">(</span>_<span class="o">)</span> __<span class="p">|</span> <span class="p">|</span> ___<span class="p">|</span> <span class="p">|</span> _<span class="o">(</span>_<span class="o">)</span> __ _
</span></span><span class="line"><span class="ln">12</span><span class="cl">   <span class="sb">`</span>b     :<span class="nv">$$</span>        <span class="se">\_</span>__ <span class="se">\|</span> <span class="p">|</span>/ _<span class="sb">`</span> <span class="p">|</span>/ _ <span class="se">\ </span><span class="p">|</span>/ / <span class="p">|</span>/ _<span class="sb">`</span> <span class="p">|</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">          <span class="nv">$$</span>:         ___<span class="o">)</span> <span class="p">|</span> <span class="p">|</span> <span class="o">(</span>_<span class="p">|</span> <span class="p">|</span>  __/   &lt;<span class="p">|</span> <span class="p">|</span> <span class="o">(</span>_<span class="p">|</span> <span class="p">|</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">          <span class="nv">$$</span>         <span class="p">|</span>____/<span class="p">|</span>_<span class="p">|</span><span class="se">\_</span>_,_<span class="p">|</span><span class="se">\_</span>__<span class="p">|</span>_<span class="p">|</span><span class="se">\_\_</span><span class="p">|</span><span class="se">\_</span>_, <span class="p">|</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        .d<span class="nv">$$</span>                                       <span class="p">|</span>_<span class="p">|</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">
</span></span><span class="line"><span class="ln">17</span><span class="cl">2017-04-26T06:48:42.755Z <span class="m">83552</span> TID-21ybwjk  INFO: Sidekiq v0.7.0 in Crystal 0.22.0
</span></span><span class="line"><span class="ln">18</span><span class="cl">2017-04-26T06:48:42.755Z <span class="m">83552</span> TID-21ybwjk  INFO: Licensed <span class="k">for</span> use under the terms of the GNU LGPL-3.0 license.
</span></span><span class="line"><span class="ln">19</span><span class="cl">2017-04-26T06:48:42.755Z <span class="m">83552</span> TID-21ybwjk  INFO: Upgrade to Sidekiq Enterprise <span class="k">for</span> more features and support: http://sidekiq.org
</span></span><span class="line"><span class="ln">20</span><span class="cl">2017-04-26T06:48:42.755Z <span class="m">83552</span> TID-21ybwjk  INFO: Starting processing with <span class="m">25</span> workers
</span></span><span class="line"><span class="ln">21</span><span class="cl">2017-04-26T06:48:42.756Z <span class="m">83552</span> TID-21ybwjk  INFO: Press Ctrl-C to stop
</span></span></code></pre></div><h2 id="验证功力效果">验证功力效果</h2>
<p>两边的 sidekiq server 都已经跑起来了，我们先从 rails 启动 console 验证，注意留意两个 sidekiq 终端日志的输出：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ rails console
</span></span><span class="line"><span class="ln">2</span><span class="cl">Loading development environment <span class="o">(</span>Rails 5.0.2<span class="o">)</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1"># 调用 rails 本身的 ping1 和 ping2 worker</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">2.4.0 :001 &gt; Sidekiq::Client.push<span class="o">(</span><span class="s1">&#39;class&#39;</span> <span class="o">=</span>&gt; <span class="s1">&#39;Ping1Worker&#39;</span>, <span class="s1">&#39;args&#39;</span> <span class="o">=</span>&gt;<span class="o">[])</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl"> <span class="o">=</span>&gt; <span class="s2">&#34;961500753aa127b73ac50851&#34;</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">2.4.0 :002 &gt; Sidekiq::Client.push<span class="o">(</span><span class="s1">&#39;class&#39;</span> <span class="o">=</span>&gt; <span class="s1">&#39;Ping2Worker&#39;</span>, <span class="s1">&#39;args&#39;</span> <span class="o">=</span>&gt;<span class="o">[])</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl"> <span class="o">=</span>&gt; <span class="s2">&#34;be366d2e5f44adf367853d82&#34;</span>
</span></span></code></pre></div><p>对应 rails 的 sidekiq server 会同时输出：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">2017-04-26T06:53:01.722Z <span class="m">76282</span> TID-owex58ag8 Ping1Worker JID-961500753aa127b73ac50851 INFO: start
</span></span><span class="line"><span class="ln">2</span><span class="cl">2017-04-26T06:53:01.722Z <span class="m">76282</span> TID-owex58ag8 Ping1Worker JID-961500753aa127b73ac50851 INFO: <span class="o">[</span>Ruby<span class="o">]</span> PONG !
</span></span><span class="line"><span class="ln">3</span><span class="cl">2017-04-26T06:53:01.722Z <span class="m">76282</span> TID-owex58ag8 Ping1Worker JID-961500753aa127b73ac50851 INFO: <span class="k">done</span>: 0.0 sec
</span></span><span class="line"><span class="ln">4</span><span class="cl">2017-04-26T06:53:52.681Z <span class="m">76282</span> TID-owex58bs0 Ping2Worker JID-be366d2e5f44adf367853d82 INFO: start
</span></span><span class="line"><span class="ln">5</span><span class="cl">2017-04-26T06:53:52.681Z <span class="m">76282</span> TID-owex58bs0 Ping2Worker JID-be366d2e5f44adf367853d82 INFO: <span class="o">[</span>Ruby<span class="o">]</span> PONG PONG !!
</span></span><span class="line"><span class="ln">6</span><span class="cl">2017-04-26T06:53:52.681Z <span class="m">76282</span> TID-owex58bs0 Ping2Worker JID-be366d2e5f44adf367853d82 INFO: <span class="k">done</span>: 0.0 sec
</span></span></code></pre></div><p>自身一脉本来就是通的没什么好稀奇的，验证另外一脉：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ rails console
</span></span><span class="line"><span class="ln">2</span><span class="cl">Loading development environment <span class="o">(</span>Rails 5.0.2<span class="o">)</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1"># 调用 crystal 的 ping1 和 ping2 worker</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">2.4.0 :001 &gt; Sidekiq::Client.push<span class="o">(</span><span class="s1">&#39;class&#39;</span> <span class="o">=</span>&gt; <span class="s1">&#39;Ping1Worker&#39;</span>, <span class="s1">&#39;args&#39;</span> <span class="o">=</span>&gt;<span class="o">[]</span>, <span class="s1">&#39;queue&#39;</span> <span class="o">=</span>&gt; <span class="s1">&#39;crystal&#39;</span><span class="o">)</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl"> <span class="o">=</span>&gt; <span class="s2">&#34;324cf5e07b5e2999b0a45565&#34;</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">2.4.0 :002 &gt; Sidekiq::Client.push<span class="o">(</span><span class="s1">&#39;class&#39;</span> <span class="o">=</span>&gt; <span class="s1">&#39;Ping2Worker&#39;</span>, <span class="s1">&#39;args&#39;</span> <span class="o">=</span>&gt;<span class="o">[]</span>, <span class="s1">&#39;queue&#39;</span> <span class="o">=</span>&gt; <span class="s1">&#39;crystal&#39;</span><span class="o">)</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl"> <span class="o">=</span>&gt; <span class="s2">&#34;06c60bb9d52d9a31d48d2fdc&#34;</span>
</span></span></code></pre></div><p>看看 crystal 的 sidekiq server 的日志：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">2017-04-26T06:57:11.846Z <span class="m">21253</span> TID-1z8q4cg  <span class="nv">JID</span><span class="o">=</span>324cf5e07b5e2999b0a45565 INFO: Start
</span></span><span class="line"><span class="ln">2</span><span class="cl">2017-04-26T06:57:11.846Z <span class="m">21253</span> TID-1z8q4cg  <span class="nv">JID</span><span class="o">=</span>324cf5e07b5e2999b0a45565 INFO: <span class="o">[</span>Crystal<span class="o">]</span> PONG !
</span></span><span class="line"><span class="ln">3</span><span class="cl">2017-04-26T06:57:11.846Z <span class="m">21253</span> TID-1z8q4cg  <span class="nv">JID</span><span class="o">=</span>324cf5e07b5e2999b0a45565 INFO: Done: 0.000046 sec
</span></span><span class="line"><span class="ln">4</span><span class="cl">2017-04-26T06:57:20.785Z <span class="m">21253</span> TID-1z8q3y8  <span class="nv">JID</span><span class="o">=</span>06c60bb9d52d9a31d48d2fdc INFO: Start
</span></span><span class="line"><span class="ln">5</span><span class="cl">2017-04-26T06:57:20.785Z <span class="m">21253</span> TID-1z8q3y8  <span class="nv">JID</span><span class="o">=</span>06c60bb9d52d9a31d48d2fdc INFO: <span class="o">[</span>Crystal<span class="o">]</span> PONG PONG !!
</span></span><span class="line"><span class="ln">6</span><span class="cl">2017-04-26T06:57:20.785Z <span class="m">21253</span> TID-1z8q3y8  <span class="nv">JID</span><span class="o">=</span>06c60bb9d52d9a31d48d2fdc INFO: Done: 0.000049 sec
</span></span></code></pre></div><p>验证通过！打通了！</p>
<p>Crystal 这边向 Ruby 调用也可行，但只有通过如下代码，有个别时候自身调用也没有日志输出，不过在 Web UI 却发现已处理的数字已正常更新，该问题我再调查下。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-crystal" data-lang="crystal"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">require</span> <span class="s2">&#34;sidekiq&#34;</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="no">ENV</span><span class="o">[</span><span class="s2">&#34;LOCAL_REDIS&#34;</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&#34;redis://localhost:6379/8&#34;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="no">ENV</span><span class="o">[</span><span class="s2">&#34;REDIS_PROVIDER&#34;</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&#34;LOCAL_REDIS&#34;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">workers</span> <span class="o">=</span> <span class="sx">%w(Ping1Worker Ping2Worker)</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="n">workers</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">wk_class</span><span class="o">|</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="n">job</span> <span class="o">=</span> <span class="n">Sidekiq</span><span class="o">::</span><span class="n">Job</span><span class="o">.</span><span class="n">new</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="n">job</span><span class="o">.</span><span class="n">queue</span> <span class="o">=</span> <span class="s2">&#34;default&#34;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="n">job</span><span class="o">.</span><span class="n">klass</span> <span class="o">=</span> <span class="n">wk_class</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="n">Sidekiq</span><span class="o">::</span><span class="n">Client</span><span class="o">.</span><span class="n">default_context</span> <span class="o">=</span> <span class="n">Sidekiq</span><span class="o">::</span><span class="n">Client</span><span class="o">::</span><span class="n">Context</span><span class="o">.</span><span class="n">new</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="n">client</span> <span class="o">=</span> <span class="n">Sidekiq</span><span class="o">::</span><span class="n">Client</span><span class="o">.</span><span class="n">new</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">  <span class="n">job_id</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">job</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">  <span class="nb">puts</span> <span class="s2">&#34;[</span><span class="si">#{</span><span class="n">wk_class</span><span class="si">}</span><span class="s2">] job id: </span><span class="si">#{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="k">end</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">2017-04-26T07:20:58.754Z <span class="m">62256</span> TID-oukzi7jck Ping1Worker JID-1fee81b35052cba1f6525de5 INFO: start
</span></span><span class="line"><span class="ln">2</span><span class="cl">2017-04-26T07:20:58.754Z <span class="m">62256</span> TID-oukzi7jck Ping1Worker JID-1fee81b35052cba1f6525de5 INFO: <span class="o">[</span>Ruby<span class="o">]</span> PONG !
</span></span><span class="line"><span class="ln">3</span><span class="cl">2017-04-26T07:20:58.755Z <span class="m">62256</span> TID-oukzi7jck Ping1Worker JID-1fee81b35052cba1f6525de5 INFO: <span class="k">done</span>: 0.0 sec
</span></span><span class="line"><span class="ln">4</span><span class="cl">2017-04-26T07:20:58.756Z <span class="m">62256</span> TID-oul02vzfw Ping2Worker JID-0bb7eef097447784fb48d943 INFO: start
</span></span><span class="line"><span class="ln">5</span><span class="cl">2017-04-26T07:20:58.756Z <span class="m">62256</span> TID-oul02vzfw Ping2Worker JID-0bb7eef097447784fb48d943 INFO: <span class="o">[</span>Ruby<span class="o">]</span> PONG PONG !!
</span></span><span class="line"><span class="ln">6</span><span class="cl">2017-04-26T07:20:58.756Z <span class="m">62256</span> TID-oul02vzfw Ping2Worker JID-0bb7eef097447784fb48d943 INFO: <span class="k">done</span>: 0.0 sec
</span></span></code></pre></div><h2 id="结语">结语</h2>
<p>本篇只是通过一个最简单的例子让大家知道互通的方法，实际使用中对于数据交互等还有更多需要考虑的地方，这里就暂时不做展开。非常期待 Crystal 今年立的 <a href="https://crystal-lang.org/2016/12/29/crystal-new-year-resolutions-for-2017-1-0.html">1.0 的目标</a>。</p>
<p>对于 Crystal 语言本身的评价，大家也可看下 RubyChina 站长的心得<a href="https://ruby-china.org/topics/32771">Crystal 说我最近关注 Crystal 的感受</a>，编译语言有编译语言的坑，入坑需谨慎。</p>
<p>本文演示的代码已经整理并放到了 <a href="https://github.com/icyleaf/sidekiq-with-ruby-and-crystal">Github</a>，对于不明白的地方可配合代码更好服用。</p>
]]></content:encoded></item><item><title>你虐我千百遍，我待你如初恋，直到我遇到 match</title><link>https://icyleaf.com/2017/03/fastlane-match-in-action/</link><pubDate>Tue, 28 Mar 2017 20:12:07 +0800</pubDate><guid>https://icyleaf.com/2017/03/fastlane-match-in-action/</guid><description>系列文章的第三篇，教你如何使用 match 管理名词都分不清的苹果各自开发者证书</description><content:encoded><![CDATA[<h2 id="前言">前言</h2>
<p>通过前两篇的文章大家已经对 fastlane 的概念和基本使用已经有了初步的掌握，在第二篇中也有提到 fastlane 实现的各种功能其实都是基于独立封装设计的各个工具实现。它们即可以单独成为一个体系同时也会被吸纳到 fastlane 的 action 系统之中。<code>match</code> 是在 iOS 开发和持续测试和构建中最重中之重的环节，它维护和管理着 iOS 的各种证书和 profile 的创建、更新工作。想必很多用户听到 iOS 证书和 profile 都会头大脑涨，恨不得要手撕鬼子的技能点来对付他们（如图）</p>
<p><img loading="lazy" src="https://codesigning.guide/assets/img/cs-the-problem.png"
  
  
  alt="code-signing-problem"></img>
</p>
<p>上图来源于作者专门整理的网站 <a href="https://codesigning.guide/">https://codesigning.guide/</a>，对于 iOS App 签名原理感兴趣的可以参见 JSPatch 作者的分析：http://blog.cnbang.net/tech/3386/</p>
<h2 id="功能特性">功能特性</h2>
<ol>
<li>主动/被动创建、更新、Xcode 所需的各种证书和打包所需的 Profiles</li>
<li>托管 Xcode 所需的各种证书和打包所需的 Profiles</li>
<li>统一并共享团队成员统一使用</li>
<li>证书具有密码加密保护（openssl）</li>
<li>支持多团队（账户）</li>
<li>支持单 App 多 Target(identifier)</li>
<li>内测支持企业账户（v0.11.0 还在测试可用，并没有正式支持）</li>
</ol>
<h2 id="原理">原理</h2>
<p>match 其实是在 fastlane 基础包 cert、sign、spaceship、credentials_manager 之上把 iOS 开发者证书流程化的工具。为了实现团队内共享项目的开发者证书，它使用 git 仓库对证书进行托管，首先需要进行初始化，配置 git 仓库、项目的 iDP 信息之后，下载 Development、AppStore、AdHoc 的开发者证书和项目的 Profile files，并通过 openssl 的方式进行安全加密后提交并推送到 git 仓库，其他成员（或自动化构建系统）使用时需要输入密钥后才能把证书解密并导入到 keychain 和 Profiles 目录。</p>
<p>如果对于证书加密策略感兴趣的可以在本文底部资料参考的第一个链接查看详情。</p>
<h2 id="使用">使用</h2>
<blockquote>
<p>最新 fastlane 已经包含了所有的子模块，独立的 match 不在更新，请直接安装 fastlane，使用 fastlane match 代替 match 命令。</p>
</blockquote>
<p>安装就很简单通过 <code>gem install fastlane</code> 会把它的全家桶一并下载安装，首先可以看下帮助：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln"> 1</span><span class="cl">$ fastlane match --help
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  match
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  Easily sync your certificates and profiles across your team using git
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  Commands:
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    adhoc             Run match <span class="k">for</span> a adhoc provisioning profile
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    appstore          Run match <span class="k">for</span> a appstore provisioning profile
</span></span><span class="line"><span class="ln">10</span><span class="cl">    change_password   Re-encrypt all files with a different password
</span></span><span class="line"><span class="ln">11</span><span class="cl">    decrypt           Decrypts the repository and keeps it on the filesystem
</span></span><span class="line"><span class="ln">12</span><span class="cl">    development       Run match <span class="k">for</span> a development provisioning profile
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="nb">help</span>              Display global or <span class="o">[</span>command<span class="o">]</span> <span class="nb">help</span> documentation
</span></span><span class="line"><span class="ln">14</span><span class="cl">    init              Create the Matchfile <span class="k">for</span> you
</span></span><span class="line"><span class="ln">15</span><span class="cl">    nuke              Delete all certificates and provisioning profiles from the Apple Dev Portal
</span></span><span class="line"><span class="ln">16</span><span class="cl">    nuke development  Delete all certificates and provisioning profiles from the Apple Dev Portal of the <span class="nb">type</span> development
</span></span><span class="line"><span class="ln">17</span><span class="cl">    nuke distribution Delete all certificates and provisioning profiles from the Apple Dev Portal of the <span class="nb">type</span> distribution
</span></span><span class="line"><span class="ln">18</span><span class="cl">    run               Easily sync your certificates and profiles across your team using git
</span></span><span class="line"><span class="ln">19</span><span class="cl">
</span></span><span class="line"><span class="ln">20</span><span class="cl">  Global Options:
</span></span><span class="line"><span class="ln">21</span><span class="cl">    --verbose
</span></span><span class="line"><span class="ln">22</span><span class="cl">    -r, --git_url STRING URL to the git repo containing all the certificates <span class="o">(</span>MATCH_GIT_URL<span class="o">)</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    --git_branch STRING  Specific git branch to use <span class="o">(</span>MATCH_GIT_BRANCH<span class="o">)</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    -y, --type STRING    Create a development certificate instead of a distribution one <span class="o">(</span>MATCH_TYPE<span class="o">)</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    -a, --app_identifier <span class="o">[</span>VALUE<span class="o">]</span> The bundle identifier<span class="o">(</span>s<span class="o">)</span> of your app <span class="o">(</span>comma-separated<span class="o">)</span> <span class="o">(</span>MATCH_APP_IDENTIFIER<span class="o">)</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">    -u, --username STRING Your Apple ID Username <span class="o">(</span>MATCH_USERNAME<span class="o">)</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">    -s, --keychain_name STRING Keychain the items should be imported to <span class="o">(</span>MATCH_KEYCHAIN_NAME<span class="o">)</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">    -p, --keychain_password STRING This might be required the first <span class="nb">time</span> you access certificates on a new mac. For the login/default keychain this is your account password <span class="o">(</span>MATCH_KEYCHAIN_PASSWORD<span class="o">)</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">    --readonly <span class="o">[</span>VALUE<span class="o">]</span>   Only fetch existing certificates and profiles, don<span class="s1">&#39;t generate new ones (MATCH_READONLY)
</span></span></span><span class="line"><span class="ln">30</span><span class="cl"><span class="s1">    -b, --team_id STRING The ID of your Developer Portal team if you&#39;</span>re in multiple teams <span class="o">(</span>FASTLANE_TEAM_ID<span class="o">)</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">    -l, --team_name STRING The name of your Developer Portal team <span class="k">if</span> you<span class="err">&#39;</span>re in multiple teams <span class="o">(</span>FASTLANE_TEAM_NAME<span class="o">)</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">    --verbose <span class="o">[</span>VALUE<span class="o">]</span>    Print out extra information and all commands <span class="o">(</span>MATCH_VERBOSE<span class="o">)</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">    --force <span class="o">[</span>VALUE<span class="o">]</span>      Renew the provisioning profiles every <span class="nb">time</span> you run match <span class="o">(</span>MATCH_FORCE<span class="o">)</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">    --skip_confirmation <span class="o">[</span>VALUE<span class="o">]</span> Disables confirmation prompts during nuke, answering them with yes <span class="o">(</span>MATCH_SKIP_CONFIRMATION<span class="o">)</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">    --shallow_clone <span class="o">[</span>VALUE<span class="o">]</span> Make a shallow clone of the repository <span class="o">(</span>truncate the <span class="nb">history</span> to <span class="m">1</span> revision<span class="o">)</span> <span class="o">(</span>MATCH_SHALLOW_CLONE<span class="o">)</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">    --force_for_new_devices <span class="o">[</span>VALUE<span class="o">]</span> Renew the provisioning profiles <span class="k">if</span> the device count on the developer portal has changed <span class="o">(</span>MATCH_FORCE_FOR_NEW_DEVICES<span class="o">)</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">    --skip_docs <span class="o">[</span>VALUE<span class="o">]</span>  Skip generation of a README.md <span class="k">for</span> the created git repository <span class="o">(</span>MATCH_SKIP_DOCS<span class="o">)</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">    -h, --help           Display <span class="nb">help</span> documentation
</span></span><span class="line"><span class="ln">39</span><span class="cl">    -v, --version        Display version information
</span></span></code></pre></div><p>建议大家在项目中创建并配置 <code>fastlane/Matchfile</code> 文件可以把命令需要的参数省略：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ fastlane match init
</span></span></code></pre></div><p>设置好 git_url(git 仓库地址）、type（默认同步证书类型）、app_identifier、username（iDP 的账户名）即可。</p>
<h2 id="生成和同步证书">生成和同步证书</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1"># 开发环境证书</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">$ fastlane match development
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="c1"># 产品环境证书</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">$ fastlane match appstore
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="c1"># 内测环境证书</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">$ fastlane match adhoc
</span></span></code></pre></div><p>初次使用的时候会提示需要输入 iDP 的账户密码，校验成功后可以保存到 keychain 中后续可以不在重复输入（好贴心）密码（也可通过设置变量 FASTLANE_PASSWORD），该密码就是上面提到的证书加密的密钥，请妥善保存。</p>
<blockquote>
<p>提示：如果担心密码泄露可设置 FASTLANE_DONT_STORE_PASSWORD = true 不进行密码保存至 keychain，在 keychain 可通过关键词 &ldquo;deliver.&rdquo; 检索。</p>
</blockquote>
<p>有的童鞋说我们有 299 的企业证书，为什么不做支持呢？起初作者并没有打算进行支持是担心滥用以及代码结构需要较大的变更，随着开发者呼声太高，其实还是做了支持，只不过并没有正式的纳入，需要通过配置环境变量支持：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1"># 企业环境证书</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">$ ENV<span class="o">[</span><span class="s1">&#39;MATCH_FORCE_ENTERPRISE&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span> <span class="o">&amp;&amp;</span> fastlane match enterprise
</span></span></code></pre></div><h2 id="修改密钥">修改密钥</h2>
<p>建议密码定期更换或再人员发生变更之后进行密码变更：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ fastlane match change_password
</span></span></code></pre></div><h2 id="重新生成">重新生成</h2>
<p><strong>慎用</strong>：match 提供一个命令允许把当前的证书撤销后并全新的重新生成一份，这个事项是会把证书和 Profiles 全部包含在内，如果单纯的想只重设 Profles 并同步是不支持的。我想这也是为什么该命名叫做 <code>nuke</code></p>
<p>我这里可给大家提供一种只同步 profile 的方法：首先在 git 仓库中找到你要重设的 profile 文件，并把它从仓库中删除提交，然后在执行该类型的命令即可，命令发现没有 profile 会自动再生成一个 profile 并下载同步至 git 仓库。</p>
<h2 id="资料参考">资料参考</h2>
<ul>
<li><a href="http://macoscope.com/blog/simplify-your-life-with-fastlane-match/">http://macoscope.com/blog/simplify-your-life-with-fastlane-match/</a></li>
<li><a href="https://github.com/fastlane/fastlane/issues/2007">https://github.com/fastlane/fastlane/issues/2007</a></li>
</ul>
]]></content:encoded></item><item><title>北京上临时牌照流程</title><link>https://icyleaf.com/2017/03/how-to-get-temporary-car-license-in-beijing/</link><pubDate>Thu, 23 Mar 2017 00:00:00 +0800</pubDate><guid>https://icyleaf.com/2017/03/how-to-get-temporary-car-license-in-beijing/</guid><description>北京太堵，少走弯路</description><content:encoded><![CDATA[<p>汽车没有 4s 店购买“额外”的精品车饰的的后果，店里不提供免费上临牌服务需要自己办，还好自己早有准备。</p>
<h2 id="办理所需资料">办理所需资料</h2>
<ul>
<li>身份证</li>
<li>北京居住卡或居住证或工作居住证（非北京户口需要）</li>
<li>购车发票</li>
<li>强险保单</li>
<li>合格证</li>
</ul>
<p>备注：</p>
<ol>
<li>以上资料均需要原件及复印件一份</li>
<li>办理临时牌照不需要指标确认书。</li>
</ol>
<h2 id="办理过程">办理过程</h2>
<p>进门按键领号排队，等叫到的时候去柜台将上述资料给工作人员。然后在一边等待制作完成即可。不需要填写任何单子，我去的时候人比较多，大概等了30分钟。</p>
<h2 id="办理时限">办理时限</h2>
<p>周一至周五：8：30 - 18：00</p>
<p>周六、日：9：00 - 16：00（法定节假日除外）</p>
<p>自受理申请之日起一个工作日内办理完毕。</p>
<h2 id="收费问题">收费问题</h2>
<p>收费10块（两张临牌纸，5块一张），在领临牌的时候给工作人员即可。</p>
<h2 id="办理地点">办理地点</h2>
<p>（一）跨辖区临时行驶车号牌：</p>
<ul>
<li>车辆管理所：朝阳区南四环东路18号</li>
<li>京朝分所：朝阳区孛罗营北街1号</li>
<li>京海分所：海淀区北安河乡海淀驾校院内</li>
<li>京丰分所：丰台区双林南路新丰考试场南门对面</li>
<li>京顺分所：顺义区后沙峪镇泗上村裕民大街17号</li>
<li>京南分所：大兴区黄村镇狼垡村公交考试场院内</li>
<li>京北分所：昌平区马池口镇马池口村北方检测场院内</li>
</ul>
<p>有效期 7-15 天</p>
<p>（二）区域内临时行驶车号牌：</p>
<ul>
<li>东城车管站：东城区广渠门南小街5号，68399329
<ul>
<li>东城区朝内北小街豆瓣胡同1号楼4号门，88313419</li>
</ul>
</li>
<li>西城车管站：西城区赵登禹路303号，68399206
<ul>
<li>西城区广外红莲南路33号，68399472</li>
</ul>
</li>
<li>朝阳车管站：朝阳区百子湾西里303楼，88313586</li>
<li>海淀车管站：海淀区西北旺后厂村99号，62553336</li>
<li>丰台车管站：丰台区小屯西路南口加油站北侧卢沟桥乡综合办公大楼，68399740转5739</li>
<li>石景山车管站：石景山区杨庄路8号院，68863193</li>
<li>门头沟车管站：门头沟区滨河南路72号一层，69806430</li>
<li>房山车管站：房山区拱辰街道月华大街32号，68397030转5005</li>
<li>通州车管站：通州区运河西大街240号，60526300</li>
<li>昌平车管站：昌平区马池口村交通大队综合执法大厅10-15号窗口，88313830</li>
<li>顺义车管站：顺义区顺平西路10号院西院，81498347</li>
<li>大兴车管站：大兴区黄村镇海子角村500米路南，61268964</li>
<li>怀柔车管站：怀柔区青春路88号，89684090</li>
<li>平谷车管站：平谷区北街29号，69959863</li>
<li>密云车管站：密云县新北路25号，69068445</li>
<li>延庆车管站：延庆县延庆镇妫水南街，81194561</li>
<li>机场车管站：首都国际机场二纬路机场公安分局综合办公大楼，64539041</li>
<li>亦庄车管站：北京市经济技术开发区科创四街1号，88313933</li>
</ul>
<p>有效期 7 天，可以申请办理 3 次</p>
<h2 id="临时牌照有效期">临时牌照有效期</h2>
<p>临时号牌有效期为15天，最长期限不超过45天。
每辆车最多能办理3张临时牌照。</p>
<blockquote>
<p>据 4S 店告知出京的临牌只能办一次且办完之后不能再办区域内临牌。</p>
</blockquote>
<h2 id="临时牌照如何悬挂">临时牌照如何悬挂</h2>
<p>机动车临时号牌为两张，正面为车牌号码和有效期，背面为机动车详细信息，所以机动车临时号牌是不能借给他人使用。使用临时号牌上路时，应该在机动车前后挡风玻璃处各张贴一张机动车号牌，将机动车号牌号码侧朝外，如果不按照规定悬挂号牌，将被处以200元罚款和12分违章。</p>
<h2 id="咨询电话">咨询电话</h2>
<p>车管业务咨询电话：12122</p>
<blockquote>
<p>根据其他网站的反馈咨询的情况可能和实际有出入。</p>
</blockquote>
<h2 id="资料参考">资料参考</h2>
<p>北京市公安局 -  机动车临时通行牌证核发
<a href="http://www.bjgaj.gov.cn/web/detail_getZwgkInfo_279416.html">http://www.bjgaj.gov.cn/web/detail_getZwgkInfo_279416.html</a></p>
<p>北京市公安局公安交通管理局 - 申请机动车临时行驶车号牌
<a href="http://www.bjjtgl.gov.cn/jgj/jdcgl/120149/index.html">http://www.bjjtgl.gov.cn/jgj/jdcgl/120149/index.html</a></p>
<p>北京身份证北京买车上外地牌实施中
<a href="http://m.newsmth.net/article/Yaohao/34585">http://m.newsmth.net/article/Yaohao/34585</a></p>
<p>汽车实用手册(16) 临时牌照实用手册
<a href="http://www.autohome.com.cn/use/201403/742174.html">http://www.autohome.com.cn/use/201403/742174.html</a></p>
<p>百度经验 - 机动车办理北京市内临时牌照流程
<a href="http://jingyan.baidu.com/article/86fae34689365e3c48121a50.html">http://jingyan.baidu.com/article/86fae34689365e3c48121a50.html</a></p>
]]></content:encoded></item><item><title>Docker 摸爬滚打对抗 CentOS 6</title><link>https://icyleaf.com/2016/12/docker-with-centos/</link><pubDate>Fri, 30 Dec 2016 17:52:30 +0800</pubDate><guid>https://icyleaf.com/2016/12/docker-with-centos/</guid><description>能不用 CentOS 就别了吧，啊不行？那就点进来看看吧</description><content:encoded><![CDATA[



<div class="updated">
  <header class="updated-header">
    <h4 class="updated-title">更新</h4>
    
    <p class="updated-meta">10月 9, 2018</p>
    
  </header>
  <article class="updated-body">
    国庆期间恰巧服务器硬盘故障且运维并没有做 raid 备份，给更换了一台新内部服务器，索性升级到了 CentOS 7，因此针对 CentOS 6 安装 Docker 的答疑不再更新。
  </article>
</div>


<h2 id="前言">前言</h2>
<p>前不久终于把我们移动团队内部服务器从 CentOS 5.x 升级到了 6.8。本来是拜托让升级至 7.0 版本起码能用上 docker 1.12 版本还是靠谱的事情。
事情往往难以预料的被告知其他团队在安装 7.0 之后造成内部服务器群的网卡失灵的诡异故障只能作罢，想想起码还有个早期 docker 版本可安装也就先这么着吧。</p>
<p>这个是在 <a href="http://icyleaf.com/2013/09/how-to-install-gitlab-on-centos/">如何在CentOS 上安装Gitlab</a> 之后有一个无奈的使用指南，
因为运维也有他的考虑方面，参见知乎讨论：<a href="https://www.zhihu.com/question/29191794">如何说服运维选择 Debian/Ubuntu 而不是 CentOS</a></p>
<h2 id="安装-docker">安装 Docker</h2>
<h3 id="171">1.7.1</h3>
<p>Docker 最后一个支持 CentOS 6 的版本是 1.7.1 还必须安装 epel 源之后就<a href="https://github.com/docker/docker/issues/14365">被大家欢天喜地的抛弃了 6 的支持</a>。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">sudo rpm -ivh http://download.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm
</span></span><span class="line"><span class="ln">2</span><span class="cl">sudo yum -y remove docker
</span></span><span class="line"><span class="ln">3</span><span class="cl">sudo yum install libselinux-python docker-io
</span></span></code></pre></div><blockquote>
<p>由于 yum 内 docker 已经被其他使用，不用安装错误了。</p>
</blockquote>
<h3 id="171-以上版本">1.7.1 以上版本</h3>
<p><strong>请果断放弃这种想法</strong>，虽然你可能在网上搜索有个别的文章说把内核升级到 3.10 后可以安装 docker 1.9 版本，经过我个人反复测试根本不可行！</p>
<p>当然如果你还是坚持想尝试，请参考如下链接：</p>
<ul>
<li><a href="http://www.pangxie.space/docker/364">http://www.pangxie.space/docker/364</a></li>
<li><a href="http://www.cnblogs.com/dongdongwq/p/5381752.html">http://www.cnblogs.com/dongdongwq/p/5381752.html</a></li>
<li><a href="http://0evin.com/2016/06/17/%5B%E5%8E%9F%E5%88%9B%5DCentOS6.5%E5%AE%89%E8%A3%85Docker1.11.X%E7%89%88%E6%9C%AC/">http://0evin.com/2016/06/17/%5B%E5%8E%9F%E5%88%9B%5DCentOS6.5%E5%AE%89%E8%A3%85Docker1.11.X%E7%89%88%E6%9C%AC/</a></li>
</ul>
<h2 id="配置-docker">配置 Docker</h2>
<p>安装成功后先不要配置开机自启动和启动服务，docker 的官方镜像在国内众所周知的慢的一塌糊涂，如果你是在国内服务器使用请参考如下配置。</p>
<p>我这里把我个人私藏已久的好用的镜像告诉大家，大家可不要以为我用的是阿里云或者 DaoCloud 这类有很多限制的玩意：</p>
<ul>
<li>中国科技大学镜像：https://docker.mirrors.ustc.edu.cn</li>
<li>网易蜂巢镜像：http://hub-mirror.c.163.com</li>
</ul>
<p>同样需要注意的是 1.7.1 版本的 docker 配置文件是在 <code>/etc/sysconfig/docker</code> 而不是网上和官方说的 <code>/etc/default/docker</code> 打开此文件在 other_args 配置对于的源即可。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1"># /etc/sysconfig/docker</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="c1">#</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="c1"># Other arguments to pass to the docker daemon process</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1"># These will be parsed by the sysv initscript and appended</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="c1"># to the arguments list passed to docker -d</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="c1">#other_args=</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="c1">#other_args=&#34;--registry-mirror=http://hub-mirror.c.163.com&#34;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="nv">other_args</span><span class="o">=</span><span class="s2">&#34;--registry-mirror=https://docker.mirrors.ustc.edu.cn&#34;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="nv">DOCKER_CERT_PATH</span><span class="o">=</span>/etc/docker
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="c1"># Resolves: rhbz#1176302 (docker issue #407)</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nv">DOCKER_NOWARN_KERNEL_VERSION</span><span class="o">=</span><span class="m">1</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="c1"># Location used for temporary files, such as those created by</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="c1"># # docker load and build operations. Default is /var/lib/docker/tmp</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="c1"># # Can be overriden by setting the following environment variable.</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="c1"># # DOCKER_TMPDIR=/var/tmp</span>
</span></span></code></pre></div><p>后面就没什么好说的了，启动服务和设置开机自启动就完事了</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">sudo chkconfig docker on
</span></span><span class="line"><span class="ln">2</span><span class="cl">sudo service docker start
</span></span></code></pre></div><p>验证下启动的服务是否已经配置了国内镜像源</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ ps aux <span class="p">|</span> grep <span class="s2">&#34;docker -d&#34;</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl">root     <span class="m">16992</span>  0.1  0.1 <span class="m">1239860</span> <span class="m">32276</span> ?       Sl   Dec29   2:02 /usr/bin/docker -d --registry-mirror<span class="o">=</span>https://docker.mirrors.ustc.edu.cn
</span></span><span class="line"><span class="ln">4</span><span class="cl">root     <span class="m">26873</span>  0.0  0.0 <span class="m">103332</span>   <span class="m">876</span> pts/2    S+   18:16   0:00 grep docker -d
</span></span></code></pre></div><h2 id="疑难杂症">疑难杂症</h2>
<h4 id="1-使用国内镜像源-pull-镜像偶尔会失败反复几次就可以解决">1. 使用国内镜像源 pull 镜像偶尔会失败，反复几次就可以解决</h4>
<p>频次不高原因未知，因此还未重视。</p>
<h4 id="2-docker-web-管理工具">2. Docker Web 管理工具</h4>
<p>推荐使用 <a href="https://github.com/portainer/portainer">portainer</a> ，兼容 1.7 的部分功能可能会发生部分功能和参数无法显示但不影响使用。之前我有推荐 rancher（可参考前篇文章：<a href="http://icyleaf.com/2016/08/how-to-install-rancher-on-osx/">如何在 OS X 上安装 Rancher
</a>），但 rancher 官方要求 docker 最低版本是 1.9+。</p>
<h4 id="3-docker-进程挂了重启后无法恢复之前的-containers">3. Docker 进程挂了重启后无法恢复之前的 containers</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ docker start c39206003c7a
</span></span><span class="line"><span class="ln">2</span><span class="cl">Error: Cannot start container c39206003c7a: Error getting container c39206003c7ae8992a554a9ac2ea130327fc4af1b2c389656c34baf9a56c84b5 from driver devicemapper: Error mounting <span class="s1">&#39;/dev/mapper/docker-253:0-267081-c39206003c7ae8992a554a9ac2ea130327fc4af1b2c389656c34baf9a56c84b5&#39;</span> on <span class="s1">&#39;/var/lib/docker/devicemapper/mnt/c39206003c7ae8992a554a9ac2ea130327fc4af1b2c389656c34baf9a56c84b5&#39;</span>: device or resource busy
</span></span><span class="line"><span class="ln">3</span><span class="cl">2014/05/08 19:14:57 Error: failed to start one or more containers
</span></span></code></pre></div><p>这种一般是因为意外终止进程造成上次的 volume 没有正常 unmount，只需手动操作下即可：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">unmount /var/lib/docker/devicemapper/mnt/d640aea67108b04c6a5ba14645966b092db1f807f3e3f41dca7a1470f76b68fb
</span></span></code></pre></div><blockquote>
<p><code>d640aea67108b04c6a5ba14645966b092db1f807f3e3f41dca7a1470f76b68fb</code> 是根据不同 container 生成的，请根据实际情况复制和执行。</p>
</blockquote>
<p>这个真没办法，只能在 Dockerfile 或者进实例里面进行修改时区，这个我就不过多赘述了。</p>
<h4 id="4-升级运行的-container-版本">4. 升级运行的 container 版本</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ docker stop xxxx
</span></span><span class="line"><span class="ln">2</span><span class="cl">$ docker create --volumes-from &lt;container_name_of_original_server&gt; <span class="se">\ </span>--name xxx-data image/name:&lt;tag_of_previous_rancher_server&gt;
</span></span><span class="line"><span class="ln">3</span><span class="cl">$ docker pull image/name:latest
</span></span><span class="line"><span class="ln">4</span><span class="cl">$ docker run -d --volumes-from xxx-data --restart<span class="o">=</span>unless-stopped <span class="se">\ </span>-p 8080:8080 image/namel.:latest
</span></span></code></pre></div><h4 id="5-非-root-用户执行-docker">5. 非 root 用户执行 docker</h4>
<p>创建 docker 用户组并重启 docker 服务，之后把你想要的用户加到 docker 用户组即可。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ groupadd docker
</span></span><span class="line"><span class="ln">2</span><span class="cl">$ service docker restart
</span></span><span class="line"><span class="ln">3</span><span class="cl">$ usermod -a -G docker icyleaf
</span></span></code></pre></div><h4 id="6-宿主机-cst-时间会造成-docker-实例时间不准">6. 宿主机 CST 时间会造成 docker 实例时间不准</h4>
<p>这个真没办法，只能在 Dockerfile 或者进实例里面进行修改时区，这个我就不过多赘述了。</p>
]]></content:encoded></item><item><title>如何在 OS X 上安装 Rancher</title><link>https://icyleaf.com/2016/08/how-to-install-rancher-on-osx/</link><pubDate>Fri, 05 Aug 2016 17:21:08 +0800</pubDate><guid>https://icyleaf.com/2016/08/how-to-install-rancher-on-osx/</guid><description>Rancher 0.x 版本部署指南</description><content:encoded><![CDATA[



<div class="updated">
  <header class="updated-header">
    <h4 class="updated-title">更新</h4>
    
    <p class="updated-meta">2月 22, 2022</p>
    
  </header>
  <article class="updated-body">
    以下内容写于 Rancker 0.x 版本，后续版本变更比较大本文不再有没有参考。
  </article>
</div>


<p>Rancher 是 Docker 编排解决方案的一种，好处在于可以做容器编排，网络，存储，负载均衡，还能够支持云服务器（比如 Amazon EC2/Azure/DigitalOcean）也能够兼容 Docker Swarm/Mesos/Kubernetes 等其他的解决方案。自它还没有发布 <a href="http://rancher.com/announcing-rancher-1-0-ga/">1.0</a> 版本之前也有持续的关注。它自身还有个 <a href="http://www.infoq.com/cn/news/2015/03/rancheros-docker-linux">RancherOS</a> 对于 CoreOS 也是一个不小的威胁。</p>
<p>由于它提供非常优化的后台管理界面，同时也提供 REST API，日常开发使用中异常的方便。如果非要说出一点不好的，那可能就是它对内存有点小要求：<strong>最小 1GB 内存</strong>，因此如果想放在自己 VPS 上的童鞋需要评估下了。</p>
<h2 id="mac-安装">Mac 安装</h2>
<p>这块也趁着 <a href="https://docs.docker.com/docker-for-mac/">Docker for Mac</a> 的好处，终于摆脱的 <code>docker-machine</code> 的折磨，不用在依赖 VirtualBox，也不在每次装载 machine 的变量和查找虚拟机的 IP。映射的端口端口都通过 <code>localhost</code> 访问。</p>
<p>Rancher 通过 Docker 来安装本来说是非常简单的，它分为服务端和客户端。本教程以 <a href="http://docs.rancher.com/rancher/latest/en/installing-rancher/installing-server/">Single Node</a> 来讲解，不考虑 <a href="http://docs.rancher.com/rancher/latest/en/installing-rancher/installing-server/multi-nodes/">Multi Node</a>。</p>
<p>这块网上一直没有太好的解决方案，我看很多国外给出的<a href="https://gist.github.com/axnux/09dc375d71398cbbee44ebd23ba35a08">解决方案</a>也比较麻烦，主要是由于 Docker for mac 使用的是 xhyve 作为轻量化的虚拟化方案，而 rancher 安装 server 端没有任何问题，在添加主机的时候需要通过 HTTP 来连接 server 端而失败。下面我来带大家用最简单的方案来拆解。无需任何第三方的辅助。</p>
<h3 id="服务端">服务端</h3>
<blockquote>
<p>如果网速连接 docker hub 过慢可考虑使用代理设置或者国内的镜像服务，我这里分享一个 <code>https://docker.mirrors.ustc.edu.cn</code>，可在 Docker -&gt; Preferences&hellip; -&gt; Advanced -&gt; Registry Mirror 添加。</p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ docker run -d --name rancher-server --restart<span class="o">=</span>always -p 8080:8080 rancher/server
</span></span><span class="line"><span class="ln">2</span><span class="cl">$ docker logs -f rancher-server
</span></span><span class="line"><span class="ln">3</span><span class="cl">
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="nv">time</span><span class="o">=</span><span class="s2">&#34;2016-08-05T16:48:52Z&#34;</span> <span class="nv">level</span><span class="o">=</span>info <span class="nv">msg</span><span class="o">=</span><span class="s2">&#34;Creating schema machine, roles [service]&#34;</span> <span class="nv">id</span><span class="o">=</span>1ds17
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="nv">time</span><span class="o">=</span><span class="s2">&#34;2016-08-05T16:48:53Z&#34;</span> <span class="nv">level</span><span class="o">=</span>info <span class="nv">msg</span><span class="o">=</span><span class="s2">&#34;Creating schema machine, roles [project member owner]&#34;</span> <span class="nv">id</span><span class="o">=</span>1ds18
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="nv">time</span><span class="o">=</span><span class="s2">&#34;2016-08-05T16:48:53Z&#34;</span> <span class="nv">level</span><span class="o">=</span>info <span class="nv">msg</span><span class="o">=</span><span class="s2">&#34;Creating schema machine, roles [admin user readAdmin]&#34;</span> <span class="nv">id</span><span class="o">=</span>1ds19
</span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="nv">time</span><span class="o">=</span><span class="s2">&#34;2016-08-05T16:48:53Z&#34;</span> <span class="nv">level</span><span class="o">=</span>info <span class="nv">msg</span><span class="o">=</span><span class="s2">&#34;Creating schema machine, roles [readonly]&#34;</span> <span class="nv">id</span><span class="o">=</span>1ds20
</span></span></code></pre></div><p>看到如上类似的日志说明服务已经初始化完毕，通过浏览器访问 <code>http://localhost:8080</code> 就可以看到后台管理界面。</p>
<h3 id="客户端">客户端</h3>
<p>先不着急继续页面操作，回到终端上执行如下命令获取 rancher-server 容器的 IP 地址备用</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ docker inspect --format <span class="s1">&#39;{{ .NetworkSettings.IPAddress }}&#39;</span> rancher-server
</span></span><span class="line"><span class="ln">2</span><span class="cl">172.17.0.2
</span></span></code></pre></div><p>接着上面的步骤，在打开页面能看到 Add Host 按钮并点击对于弹出 “Host Registration URL” 选择 “Something else:” 在后面的输入框填入上面的 IP 和端口号 <code>http://172.17.0.2:8080</code> 并保存。</p>
<p>之后就是给你一个客户端（部署主机）的选项，由于我们只添加本机作为部署主机使用，因此这里选择 Custom，其他不用任何设置，直接滑倒最底部找到一个执行 docker 命令的区域：</p>
<p><img loading="lazy" src="http://ww2.sinaimg.cn/large/006tNbRwjw1f6jdkffiqhj31ee150k0c.jpg"
  
  
  alt="add rancher host"></img>
</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ docker run -d --privileged -v /var/run/docker.sock:/var/run/docker.sock -v /var/lib/rancher:/var/lib/rancher rancher/agent:v1.0.2 http://172.17.0.2:8080/v1/scripts/676576FFEC2212A68391:1470416400000:tfqxfdglHL6Qw8dpLVtbOesYY4
</span></span></code></pre></div><p>你会发现执行可能会报错：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">docker: Error response from daemon: Mounts denied:
</span></span><span class="line"><span class="ln">2</span><span class="cl">The path /var/lib/rancher
</span></span><span class="line"><span class="ln">3</span><span class="cl">is not shared from OS X and is not known to Docker.
</span></span><span class="line"><span class="ln">4</span><span class="cl">You can configure shared paths from Docker -&gt; Preferences... -&gt; File Sharing.
</span></span><span class="line"><span class="ln">5</span><span class="cl">See https://docs.docker.com/docker-for-mac/osxfs/#namespaces <span class="k">for</span> more info.
</span></span></code></pre></div><p>目前有可能是一个 Docker 的 Bug，因为 <code>/var/lib/rancher</code> 是挂载到已经默认添加 <code>/private</code> 文件共享，但是它还是报错，如果你在 Docker 设置的 File Sharing 添加的话它也不会让你添加，因此我们需要做一点小修改：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ docker run -d --privileged -v /var/run/docker.sock:/var/run/docker.sock -v <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/docker/rancher/var/lib/rancher:/var/lib/rancher rancher/agent:v1.0.2 http://172.17.0.2:8080/v1/scripts/676576FFEC2212A68391:1470416400000:tfqxfdglHL6Qw8dpLVtbOesYY4
</span></span><span class="line"><span class="ln">2</span><span class="cl">5cf22a10cf28b4182b6e205fa631146e86d67c3c9d86901ff8cf7ab087319a29
</span></span></code></pre></div><p>最后点击页面的 Close 后会跳转到 Host 的列表，你就能惊喜的发现添加成功了！</p>
<p><img loading="lazy" src="http://ww2.sinaimg.cn/large/006tNbRwjw1f6jdidcojkj315y0m4dik.jpg"
  
  
  alt="rancher host"></img>
</p>
<h2 id="结尾">结尾</h2>
<p>本篇只先解决这一个问题，更多使用的资料请看<a href="http://rancher.hidocker.io/">Rancher 实战红宝书</a>。</p>
]]></content:encoded></item><item><title>深入浅出 Fastlane 一看你就懂</title><link>https://icyleaf.com/2016/07/fastlane-in-action/</link><pubDate>Tue, 19 Jul 2016 20:12:07 +0800</pubDate><guid>https://icyleaf.com/2016/07/fastlane-in-action/</guid><description>系列文章的第二篇，带你了解 fastlane 使用流程</description><content:encoded><![CDATA[<p>本篇我想着重介绍 <code>fastlane</code> 本身的基本使用，这里使用 fastlane v1.98.0 作为演示版本。</p>
<h2 id="命令行工具">命令行工具</h2>
<p>安装之后默认会安装一个命令行工具 <code>fastlane</code>，利用它可以初始化、执行任务、查看任务定义、查看可用的动作和动作的详细定义，甚至可以用它来创建自定义的动作、插件以及一些辅助功能。想了解的话可以先看看它的帮助：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln"> 1</span><span class="cl">$ fastlane --help
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  fastlane
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  CLI <span class="k">for</span> <span class="s1">&#39;fastlane&#39;</span> - The easiest way to automate building and releasing your iOS and Android apps
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">        Run using <span class="sb">`</span>fastlane <span class="o">[</span>platform<span class="o">]</span> <span class="o">[</span>lane_name<span class="o">]</span><span class="sb">`</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">        To pass values to the lanes use <span class="sb">`</span>fastlane <span class="o">[</span>platform<span class="o">]</span> <span class="o">[</span>lane_name<span class="o">]</span> key:value key2:value2<span class="sb">`</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl">  Commands:
</span></span><span class="line"><span class="ln">11</span><span class="cl">    action                  Shows more information <span class="k">for</span> a specific <span class="nb">command</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">    actions                 Lists all available fastlane actions
</span></span><span class="line"><span class="ln">13</span><span class="cl">    add_plugin              Add a new plugin to your fastlane setup
</span></span><span class="line"><span class="ln">14</span><span class="cl">    disable_crash_reporting Deprecated: fastlane doesn<span class="s1">&#39;t use a crash reporter any more
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="s1">    docs                    Generate a markdown based documentation based on the Fastfile
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="s1">    enable_auto_complete    Enable tab auto completion
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="s1">    enable_crash_reporting  Deprecated: fastlane doesn&#39;</span>t use a crash reporter any more
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="nb">help</span>                    Display global or <span class="o">[</span>command<span class="o">]</span> <span class="nb">help</span> documentation
</span></span><span class="line"><span class="ln">19</span><span class="cl">    init                    Helps you with your initial fastlane setup
</span></span><span class="line"><span class="ln">20</span><span class="cl">    install_plugins         Install all plugins <span class="k">for</span> this project
</span></span><span class="line"><span class="ln">21</span><span class="cl">    lanes                   Lists all available lanes and shows their description
</span></span><span class="line"><span class="ln">22</span><span class="cl">    list                    Lists all available lanes without description
</span></span><span class="line"><span class="ln">23</span><span class="cl">    new_action              Create a new custom action <span class="k">for</span> fastlane.
</span></span><span class="line"><span class="ln">24</span><span class="cl">    new_plugin              Create a new plugin that can be used with fastlane
</span></span><span class="line"><span class="ln">25</span><span class="cl">    run                     Run a fastlane one-off action without a full lane
</span></span><span class="line"><span class="ln">26</span><span class="cl">    search_plugins          Search <span class="k">for</span> plugins, search query is optional
</span></span><span class="line"><span class="ln">27</span><span class="cl">    trigger                 Run a sepcific lane. Pass the lane name and optionally the platform first.
</span></span><span class="line"><span class="ln">28</span><span class="cl">    update_plugins          Update all plugin dependencies
</span></span><span class="line"><span class="ln">29</span><span class="cl">
</span></span><span class="line"><span class="ln">30</span><span class="cl">  Global Options:
</span></span><span class="line"><span class="ln">31</span><span class="cl">    --verbose
</span></span><span class="line"><span class="ln">32</span><span class="cl">    -h, --help           Display <span class="nb">help</span> documentation
</span></span><span class="line"><span class="ln">33</span><span class="cl">    -v, --version        Display version information
</span></span><span class="line"><span class="ln">34</span><span class="cl">
</span></span><span class="line"><span class="ln">35</span><span class="cl">  Author:
</span></span><span class="line"><span class="ln">36</span><span class="cl">    Felix Krause &lt;fastlane@krausefx.com&gt;
</span></span><span class="line"><span class="ln">37</span><span class="cl">
</span></span><span class="line"><span class="ln">38</span><span class="cl">  Website:
</span></span><span class="line"><span class="ln">39</span><span class="cl">    https://fastlane.tools
</span></span><span class="line"><span class="ln">40</span><span class="cl">
</span></span><span class="line"><span class="ln">41</span><span class="cl">  GitHub:
</span></span><span class="line"><span class="ln">42</span><span class="cl">    https://github.com/fastlane/fastlane
</span></span></code></pre></div><p>我会随着下面每个概念的解释和展开来配合上面的命令一起讲解。</p>
<h2 id="生命周期">生命周期</h2>
<table>
<thead>
<tr>
<th>执行顺序</th>
<th>方法名</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>before_all</td>
<td>在执行 lane 之前只执行一次</td>
</tr>
<tr>
<td>2</td>
<td>before_each</td>
<td>每次执行 lane 之前都会执行一次</td>
</tr>
<tr>
<td>3</td>
<td>lane</td>
<td>自定义的任务</td>
</tr>
<tr>
<td>4</td>
<td>after_each</td>
<td>每次执行 lane 之后都会执行一次</td>
</tr>
<tr>
<td>5</td>
<td>after_all</td>
<td>在执行 lane 成功结束之后执行一次</td>
</tr>
<tr>
<td>6</td>
<td>error</td>
<td>在执行上述情况任意环境报错都会中止并执行一次</td>
</tr>
</tbody>
</table>
<p>以上的部分大家在上一篇已经见识过了，有些还没接触到，不用着急都会一一说明。</p>
<h2 id="任务lane">任务（lane）</h2>
<p>正常情况下你可能只会是用到一种任务方法 <code>lane</code> 但其实它会包含很多中高级用法。在文章的末尾会详细描述。</p>
<h3 id="任务定义">任务定义</h3>
<p>定义任务的方法类似于 rake 的 task，但使用上缺比前者要好用很多，见下表：</p>
<table>
<thead>
<tr>
<th>定义</th>
<th>是否必须</th>
<th>说明</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>desc</td>
<td><code>false</code></td>
<td>方法描述</td>
<td>可多次使用打到换行的目的</td>
</tr>
<tr>
<td>name</td>
<td><code>true</code></td>
<td>方法名</td>
<td>符号化的方法名</td>
</tr>
<tr>
<td>options</td>
<td><code>false</code></td>
<td>方法参数</td>
<td>返回 Hash 类型</td>
</tr>
<tr>
<td>task</td>
<td><code>true</code></td>
<td>方法主体</td>
<td>参考 ruby 的方法代码且支持 ruby 代码</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="n">desc</span> <span class="s1">&#39;定义一个 build 方法&#39;</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="n">desc</span> <span class="s1">&#39;参数 adhoc 判断是否为内测版本, 默认为 false&#39;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="n">desc</span> <span class="s1">&#39;fastlane build&#39;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">desc</span> <span class="s1">&#39;fastlane build adhoc:true&#39;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="n">lane</span> <span class="ss">:build</span> <span class="k">do</span> <span class="o">|</span><span class="n">options</span><span class="o">|</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="c1"># task to do something</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="n">adhoc</span> <span class="o">=</span> <span class="n">options</span><span class="o">[</span><span class="ss">:adhoc</span><span class="o">]</span> <span class="o">||</span> <span class="kp">false</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="nb">puts</span> <span class="s2">&#34;adhoc: </span><span class="si">#{</span><span class="n">adhoc</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="n">gym</span><span class="p">(</span><span class="ss">type</span><span class="p">:</span> <span class="n">adhoc</span> <span class="p">?</span> <span class="s1">&#39;adhoc&#39;</span> <span class="p">:</span> <span class="s1">&#39;appstore&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="k">end</span>
</span></span></code></pre></div><h3 id="任务执行">任务执行</h3>
<p>一般情况下它需要配合定义好的 lane 才能使用，刚刚我们定义的一个 build 方法，我们这里就试着执行一下吧。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1"># 默认执行</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">$ fastlane build
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="c1"># 传递参数</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">$ fastlane build adhoc:true
</span></span></code></pre></div><h3 id="任务互调">任务互调</h3>
<p><code>lane</code> 其实可以理解为 <code>def</code> 的别名，因此多个 lane 的话实际上是可以相互调用的，这个其实特别实用，这样其实我就可以把 cocoapods 的执行放到单独的 lane 里面而不是 <code>before_all</code>，这样执行非构建的任务就不会执行不相关的任务或动作，因此 fastlane 而产生了一个私有任务用内部使用 <code>private_lane</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="ln"> 1</span><span class="cl">
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="n">default_platform</span> <span class="ss">:ios</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">platform</span> <span class="ss">:ios</span> <span class="k">do</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="n">desc</span> <span class="s1">&#39;构建前的准备工作&#39;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="n">desc</span> <span class="s1">&#39;这是一个私有任务，仅供 Fastfile 内部 lane 调用使用&#39;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="n">lane</span> <span class="ss">:prepare</span> <span class="k">do</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="n">cocoapods</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="n">match</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="k">end</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="n">desc</span> <span class="s1">&#39;通用的构建任务&#39;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="n">desc</span> <span class="s1">&#39;fastlane build&#39;</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="n">desc</span> <span class="s1">&#39;fastlane build type:adhoc&#39;</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">  <span class="n">lane</span> <span class="ss">:build</span> <span class="k">do</span> <span class="o">|</span><span class="n">options</span><span class="o">|</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="c1"># 调用上面 prepare 私有任务</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="n">prepare</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="k">case</span> <span class="n">options</span><span class="o">[</span><span class="ss">:type</span><span class="o">]</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="k">when</span> <span class="s1">&#39;adhoc&#39;</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">      <span class="c1"># 调用 下面 adhoc 任务</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">      <span class="n">adhoc</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="k">else</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">      <span class="c1"># 调用下面 appstore 任务</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">      <span class="n">appstore</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">    <span class="k">end</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">  <span class="k">end</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">
</span></span><span class="line"><span class="ln">29</span><span class="cl">  <span class="n">desc</span> <span class="s1">&#39;构建 adhoc 任务&#39;</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">  <span class="n">desc</span> <span class="s1">&#39;fastlane adhoc&#39;</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">  <span class="n">lane</span> <span class="ss">:adhoc</span> <span class="k">do</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">    <span class="n">gym</span><span class="p">(</span><span class="ss">type</span><span class="p">:</span> <span class="s1">&#39;adhoc&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">  <span class="k">end</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">
</span></span><span class="line"><span class="ln">35</span><span class="cl">  <span class="n">desc</span> <span class="s1">&#39;构建 appstore 任务&#39;</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">  <span class="n">desc</span> <span class="s1">&#39;fastlane appstore&#39;</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">  <span class="n">lane</span> <span class="ss">:appstore</span> <span class="k">do</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">    <span class="n">gym</span><span class="p">(</span><span class="ss">type</span><span class="p">:</span> <span class="s1">&#39;appstore&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">  <span class="k">end</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl"><span class="k">end</span>
</span></span></code></pre></div><p>上面的任务中，<code>build</code>/<code>adhoc</code>/<code>appstore</code> 都可以执行，只有 <code>prepare</code> 是无法通过命令行外部执行，如果执行会直接报错：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ fastlane prepare
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="o">[</span>19:17:42<span class="o">]</span>: You can<span class="s1">&#39;t call the private lane &#39;</span>prepare<span class="err">&#39;</span> directly
</span></span></code></pre></div><h3 id="任务返回值">任务返回值</h3>
<p>和 ruby 的方法一致，每个 lane 最后一行会默认作为返回值（无需 <a href="http://learnrubythehardway.org/book/ex21.html">return</a>）。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="ln">1</span><span class="cl">
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="n">lane</span> <span class="ss">:sum</span> <span class="k">do</span> <span class="o">|</span><span class="n">options</span><span class="o">|</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="n">options</span><span class="o">[</span><span class="ss">:a</span><span class="o">]</span> <span class="o">+</span> <span class="n">optiona</span><span class="o">[</span><span class="ss">:b</span><span class="o">]</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="k">end</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="n">lane</span> <span class="ss">:calculate</span> <span class="k">do</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">  <span class="n">value</span> <span class="o">=</span> <span class="n">sum</span><span class="p">(</span><span class="ss">a</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="ss">b</span><span class="p">:</span> <span class="mi">5</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl">  <span class="nb">puts</span> <span class="n">value</span> <span class="c1">#=&gt; 8</span>
</span></span><span class="line"><span class="ln">9</span><span class="cl"><span class="k">end</span>
</span></span></code></pre></div><h3 id="引入外部任务文件">引入外部任务文件</h3>
<p><code>Fastfile</code> 除了自身以外还能够引入外部其他的 <code>Fastfile</code> 并调用任务，只需要导入外部文件并使用特殊的方法标识即可：</p>
<h4 id="1-import---导入本地文件">1. import - 导入本地文件</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1"># 导入 lanes 目录的 AndroidFastfile</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="n">import</span> <span class="s2">&#34;lanes/AndroidFastfile&#34;</span>
</span></span></code></pre></div><h4 id="2-import_from_git---导入-git-仓库文件">2. import_from_git - 导入 git 仓库文件</h4>
<p>可以直接引入 git 仓库的 Fastfile 文件是一个非常赞的功能，通过使用发现其实现原理是先把 git 仓库克隆下来后在引入相对于的文件，因此建议国内在没有网络加速（翻墙）的情况下尽量不用引入比较大的 git 仓库，否则使用会需要漫长的等待&hellip;</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1"># 导入 mozilla/firefox-ios 项目下 fastlane 下面 Fastfile 文件</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="n">import_from_git</span><span class="p">(</span><span class="ss">url</span><span class="p">:</span> <span class="s1">&#39;https://github.com/mozilla/firefox-ios&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="c1"># 或者</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="n">import_from_git</span><span class="p">(</span><span class="ss">url</span><span class="p">:</span> <span class="s1">&#39;git@github.com:mozilla/firefox-ios.git&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">               <span class="ss">path</span><span class="p">:</span> <span class="s1">&#39;fastlane/Fastfile&#39;</span><span class="p">)</span>
</span></span></code></pre></div><p>假若外部引入的 <code>Fastfile</code> 有个方法是 <strong>build</strong>，在命令行工具直接执行即可，如果外部和内部都有相同的任务名，执行会直接报错：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ fastlane ios build
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="o">[</span>!<span class="o">]</span> Lane <span class="s1">&#39;gradle&#39;</span> was defined multiple times!
</span></span></code></pre></div><p>如果发生这样的事情且你希望在主体 <code>Fastfile</code> 也调用的话需要使用特殊的方法定义：<code>override_lane</code></p>
<blockquote>
<p>注意：此方法只会覆盖外部的相同方法名的代码执行，目前暂时无法使用类似 ruby 的 <code>super</code> 继承原由方法！</p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">override_lane</span> <span class="ss">:build</span> <span class="k">do</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="o">...</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="k">end</span>
</span></span></code></pre></div><h3 id="任务查看">任务查看</h3>
<p>只需执行下面这行命令就可以看到非私有任务的可用列表信息</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln"> 1</span><span class="cl">$ fastlane lanes
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">--------- ios---------
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">----- fastlane ios build
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">通用的构建任务
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">fastlane build
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">fastlane build type:adhoc
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">----- fastlane ios adhoc
</span></span><span class="line"><span class="ln">10</span><span class="cl">构建 adhoc 任务
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">----- fastlane ios appstore
</span></span><span class="line"><span class="ln">13</span><span class="cl">构建 appstore 任务
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl">Execute using <span class="sb">`</span>fastlane <span class="o">[</span>lane_name<span class="o">]</span><span class="sb">`</span>
</span></span></code></pre></div><h2 id="扩展action">扩展（Action）</h2>
<p>扩展是 fastlane 的杀手锏，重在集成了众多非常优秀好用的方法供 lane 内部使用，截至 fastlane v<code>1.98.0</code> 版本以包含 175 个扩展，这个数量还在陆续增加中。扩展初期是由发起人一个人完成，后续的大部分都是社区共享，如果你发现没有你想要的扩展，可以先去 <a href="https://github.com/fastlane/fastlane/issues?q=is%3Aopen+is%3Aissue+label%3Aaction">issues</a> 搜索下没有要么自己动手提交要么只有等待了.</p>
<h3 id="扩展列表">扩展列表</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln"> 1</span><span class="cl">$ fastlane actions
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">+--------------------+-------------------------------------------------------------+------------------+
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="p">|</span>                                   Available fastlane actions                                        <span class="p">|</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">+--------------------+-------------------------------------------------------------+------------------+
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="p">|</span> Action             <span class="p">|</span> Description                                                 <span class="p">|</span> Author           <span class="p">|</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">+--------------------+-------------------------------------------------------------+------------------+
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="p">|</span> adb                <span class="p">|</span> Run ADB Actions                                             <span class="p">|</span> hjanuschka       <span class="p">|</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="p">|</span> adb_devices        <span class="p">|</span> Get an Array of Connected android device serials            <span class="p">|</span> hjanuschka       <span class="p">|</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="p">|</span> add_git_tag        <span class="p">|</span> This will add an annotated git tag to the current branch    <span class="p">|</span> Multiple         <span class="p">|</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">...
</span></span><span class="line"><span class="ln">11</span><span class="cl">+--------------------+-------------------------------------------------------------+------------------+
</span></span><span class="line"><span class="ln">12</span><span class="cl">  Total of <span class="m">175</span> actions
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">Get more information <span class="k">for</span> one specific action using <span class="sb">`</span>fastlane action <span class="o">[</span>name<span class="o">]</span><span class="sb">`</span>
</span></span></code></pre></div><h3 id="扩展使用帮助">扩展使用帮助</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1"># 查看 adb 扩展的使用帮助</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">$ fastlane action adb
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">Loading documentation <span class="k">for</span> adb:
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">+---------------------------------+
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="p">|</span>               adb               <span class="p">|</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">+---------------------------------+
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="p">|</span> Run ADB Actions                 <span class="p">|</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="p">|</span>                                 <span class="p">|</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="p">|</span> see adb --help <span class="k">for</span> more details <span class="p">|</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="p">|</span>                                 <span class="p">|</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="p">|</span> Created by hjanuschka           <span class="p">|</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">+---------------------------------+
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl">+----------+----------------------------------------------------------------------+-------------------+---------+
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="p">|</span>                                                  adb Options                                                  <span class="p">|</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">+----------+----------------------------------------------------------------------+-------------------+---------+
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">|</span> Key      <span class="p">|</span> Description                                                          <span class="p">|</span> Env Var           <span class="p">|</span> Default <span class="p">|</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">+----------+----------------------------------------------------------------------+-------------------+---------+
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">|</span> serial   <span class="p">|</span> Android serial, which device should be used <span class="k">for</span> this <span class="nb">command</span>         <span class="p">|</span> FL_ANDROID_SERIAL <span class="p">|</span>         <span class="p">|</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="p">|</span> <span class="nb">command</span>  <span class="p">|</span> All commands you want to pass to the adb command, e.g. <span class="sb">`</span>kill-server<span class="sb">`</span> <span class="p">|</span> FL_ADB_COMMAND    <span class="p">|</span>         <span class="p">|</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">|</span> adb_path <span class="p">|</span> The path to your <span class="sb">`</span>adb<span class="sb">`</span> binary                                        <span class="p">|</span> FL_ADB_PATH       <span class="p">|</span> adb     <span class="p">|</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">+----------+----------------------------------------------------------------------+-------------------+---------+
</span></span><span class="line"><span class="ln">24</span><span class="cl">
</span></span><span class="line"><span class="ln">25</span><span class="cl">+-------------------------------+
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="p">|</span>       adb Return Value        <span class="p">|</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">+-------------------------------+
</span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="p">|</span> The output of the adb <span class="nb">command</span> <span class="p">|</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">+-------------------------------+
</span></span><span class="line"><span class="ln">30</span><span class="cl">
</span></span><span class="line"><span class="ln">31</span><span class="cl">More information can be found on https://github.com/fastlane/fastlane/blob/master/fastlane/docs/Actions.md
</span></span></code></pre></div><h3 id="创建自定义扩展">创建自定义扩展</h3>
<p>通过内置的命令创建你需要的扩展，扩展名必须是全部小写且只能使用下划线分割词组，生成好的扩展文件会在 <code>fastlane/actions</code> 目录找到:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ fastlane new_action
</span></span><span class="line"><span class="ln">2</span><span class="cl">Must be lower <span class="k">case</span>, and use a <span class="s1">&#39;_&#39;</span> between words. Do not use <span class="s1">&#39;.&#39;</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">examples: <span class="s1">&#39;testflight&#39;</span>, <span class="s1">&#39;upload_to_s3&#39;</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">Name of your action: hello
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="o">[</span>15:33:15<span class="o">]</span>: Created new action file <span class="s1">&#39;./fastlane/actions/hello.rb&#39;</span>. Edit it to implement your custom action.
</span></span></code></pre></div><p>这块会占比较大的篇幅，尽情期待后续的展开。</p>
<h3 id="引入外部扩展">引入外部扩展</h3>
<p>这块其实也有两种方法可以引入，文件引入是官方教程提供的方法，第二种是我个人尝试出来的，第三种是最近版本才官方支持的。</p>
<h4 id="1-本地文件引入">1. 本地文件引入</h4>
<p>自定义的扩展其实也算是本地文件引入的一种形式，当然位于其他路径的通过指定方法也能做到</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1"># 引入项目根目录 script/share_actions 路径</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="n">actions_path</span> <span class="s1">&#39;../script/share_actions&#39;</span>
</span></span></code></pre></div><h4 id="2-rubygem-引入">2. rubygem 引入</h4>
<blockquote>
<p>不再建议使用本方法，请看第三种插件引入。</p>
</blockquote>
<p>我在团队内部创建了一个自定义的扩展，仅限于团队内部使用而无法贡献社区，我只能采取封装成 ruby gem 包，通过 ruby 的 <code>require</code> 方式引入，最终可以完美支持，目前已在项目中使用大半年之久。最重要的是我是开源的：<a href="https://github.com/icyleaf/fastlane-qyer">fastlane-qyer</a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1"># 首先安装需要的 rubygem: gem install fastlane-qyer</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="nb">require</span> <span class="s1">&#39;fastlane-qyer&#39;</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="n">lane</span> <span class="ss">:upload</span> <span class="k">do</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">  <span class="n">qyer</span><span class="p">(</span><span class="ss">api_key</span><span class="p">:</span> <span class="s1">&#39;[token]&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="k">end</span>
</span></span></code></pre></div><p>注意，使用 rubygem 引入的无法在 fastlane actions 中显示出来，也无法使用 fastlane action [name] 查看使用帮助。我猜想一是官方没有这样提供思路，二是就算你引入了 gem 也不是特别好判断里面的文件结构。</p>
<h4 id="3-插件引入">3. 插件引入</h4>
<p>我注意到 <a href="https://github.com/fastlane/fastlane/releases/tag/1.93.0">1.93.0</a> 增加了插件机制，很好的解决第二种出现的一些问题。大概看了一下主要是采用 <code>Gemfile</code> 的方式使用 <code>Pluginfile</code> 维护了引入第三方插件列表。实现原理还是属于第二种方法。</p>
<p>通过 <code>fastlane search_plugins</code> 查看当前支持的插件，并使用 <code>fastlane add_plugins [name]</code> 引入。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln"> 1</span><span class="cl">$ fastlane search_plugins
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="o">[</span>16:04:33<span class="o">]</span>: Listing all available fastlane plugins
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">+--------------------------+---------------------------------------------------+-----------+
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="p">|</span>                                Available fastlane plugins                                <span class="p">|</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">+--------------------------+---------------------------------------------------+-----------+
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="p">|</span> Name                     <span class="p">|</span> Description                                       <span class="p">|</span> Downloads <span class="p">|</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">+--------------------------+---------------------------------------------------+-----------+
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="p">|</span> ruby                     <span class="p">|</span> Useful fastlane actions <span class="k">for</span> Ruby projects         <span class="p">|</span> <span class="m">782</span>       <span class="p">|</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="p">|</span> versioning               <span class="p">|</span> Allows to work set/get app version directly       <span class="p">|</span> <span class="m">758</span>       <span class="p">|</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="p">|</span>                          <span class="p">|</span> to/from Info.plist                                <span class="p">|</span>           <span class="p">|</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="p">|</span> branding                 <span class="p">|</span> Add some branding to your fastlane output         <span class="p">|</span> <span class="m">716</span>       <span class="p">|</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="p">|</span> instrumented_tests       <span class="p">|</span> New action to run instrumented tests <span class="k">for</span> android. <span class="p">|</span> <span class="m">590</span>       <span class="p">|</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="p">|</span>                          <span class="p">|</span> This basically creates and boots an emulator      <span class="p">|</span>           <span class="p">|</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="p">|</span>                          <span class="p">|</span> before running an gradle commands so that you can <span class="p">|</span>           <span class="p">|</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="p">|</span>                          <span class="p">|</span> run instrumented tests against that emulator.     <span class="p">|</span>           <span class="p">|</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="p">|</span>                          <span class="p">|</span> After the gradle <span class="nb">command</span> is executed, the avd     <span class="p">|</span>           <span class="p">|</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">|</span>                          <span class="p">|</span> gets shut down and deleted. This is really        <span class="p">|</span>           <span class="p">|</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="p">|</span>                          <span class="p">|</span> helpful on CI services, keeping them clean and    <span class="p">|</span>           <span class="p">|</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">|</span>                          <span class="p">|</span> always having a fresh avd <span class="k">for</span> testing.            <span class="p">|</span>           <span class="p">|</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="p">|</span> xamarin_build            <span class="p">|</span> Build xamarin android<span class="se">\i</span>os projects                <span class="p">|</span> <span class="m">582</span>       <span class="p">|</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">|</span> appicon                  <span class="p">|</span> Generate required icon sizes and iconset from a   <span class="p">|</span> <span class="m">509</span>       <span class="p">|</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="p">|</span>                          <span class="p">|</span> master application icon.                          <span class="p">|</span>           <span class="p">|</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">...
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="p">|</span> download_file            <span class="p">|</span> This action downloads a file from an HTTP/HTTPS   <span class="p">|</span> <span class="m">171</span>       <span class="p">|</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl"><span class="p">|</span>                          <span class="p">|</span> url <span class="o">(</span>e.g. ZIP file<span class="o">)</span> and puts it in a destination  <span class="p">|</span>           <span class="p">|</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="p">|</span>                          <span class="p">|</span> path                                              <span class="p">|</span>           <span class="p">|</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">+--------------------------+---------------------------------------------------+-----------+
</span></span><span class="line"><span class="ln">29</span><span class="cl">
</span></span><span class="line"><span class="ln">30</span><span class="cl"><span class="c1"># 添加 sentry 插件</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">$ fastlane add_plugin sentry
</span></span><span class="line"><span class="ln">32</span><span class="cl"><span class="o">[</span>16:16:23<span class="o">]</span>: Plugin <span class="s1">&#39;fastlane-plugin-sentry&#39;</span> was added to <span class="s1">&#39;./fastlane/Pluginfile&#39;</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl"><span class="o">[</span>16:16:23<span class="o">]</span>: It looks like fastlane plugins are not yet <span class="nb">set</span> up <span class="k">for</span> this project.
</span></span><span class="line"><span class="ln">34</span><span class="cl"><span class="o">[</span>16:16:23<span class="o">]</span>: fastlane will create a new Gemfile at path <span class="s1">&#39;Gemfile&#39;</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl"><span class="o">[</span>16:16:23<span class="o">]</span>: This change is neccessary <span class="k">for</span> fastlane plugins to work
</span></span><span class="line"><span class="ln">36</span><span class="cl">Should fastlane modify the Gemfile at path <span class="s1">&#39;Gemfile&#39;</span> <span class="k">for</span> you? <span class="o">(</span>y/n<span class="o">)</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">y
</span></span><span class="line"><span class="ln">38</span><span class="cl"><span class="o">[</span>16:16:29<span class="o">]</span>: Successfully modified <span class="s1">&#39;Gemfile&#39;</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl"><span class="o">[</span>16:16:29<span class="o">]</span>: Make sure to commit your Gemfile, Gemfile.lock and Pluginfile to version control
</span></span><span class="line"><span class="ln">40</span><span class="cl">Installing plugin dependencies...
</span></span><span class="line"><span class="ln">41</span><span class="cl">Successfully installed plugins
</span></span><span class="line"><span class="ln">42</span><span class="cl">
</span></span><span class="line"><span class="ln">43</span><span class="cl">$ cat fastlane/Pluginfile
</span></span><span class="line"><span class="ln">44</span><span class="cl"><span class="c1"># Autogenerated by fastlane</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl"><span class="c1">#</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl"><span class="c1"># Ensure this file is checked in to source control!</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl">
</span></span><span class="line"><span class="ln">48</span><span class="cl">gem <span class="s1">&#39;fastlane-plugin-sentry&#39;</span>
</span></span></code></pre></div><p>更详细的继续期待后续报道，我要挖坑无数。</p>
<h3 id="扩展的命令行调用">扩展的命令行调用</h3>
<p>社区的力量果然是很强大的，陆续添加了那么多功能，早期用户表示不开心！嗯，由于社区的呼声和贡献目前可以通过命令调用扩展：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1"># 使用 notification 扩展发送一个通知消息</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">$ fastlane run notification message:<span class="s2">&#34;Hi macOS&#34;</span> title:<span class="s2">&#34;Fastlane Notification&#34;</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="o">[</span>15:58:05<span class="o">]</span>: --------------------------
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="o">[</span>15:58:05<span class="o">]</span>: --- Step: notification ---
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="o">[</span>15:58:05<span class="o">]</span>: --------------------------
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="o">[</span>15:58:05<span class="o">]</span>: Result: <span class="nb">true</span>
</span></span></code></pre></div><h2 id="辅助功能">辅助功能</h2>
<h3 id="自动更新">自动更新</h3>
<p>fastlane 提供一个方法 <code>update_fastlane</code> 用于对于自身的版本检查和更新，这个第一篇文章我也有提到过。它其实一个是一个扩展，使用 <code>fastlane action update_fastlane</code> 能够看到使用帮助。它有一个参数是可以指定检查特定的 fastlane 工具并进行更新，但其实它是使用 rubygems 进行对 gem 的更新，因此这块其实可以传入任何需要检查并更新的 gem：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">update_fastlane</span><span class="p">(</span><span class="ss">tools</span><span class="p">:</span><span class="s1">&#39;fastlane,gym,match,cocoapods,rest-client&#39;</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="环境变量">环境变量</h3>
<p>从 fastlane 的设计体系上在各个地方都加入了环境变量的支持，每个扩展的参数、以及扩展需要共享给其他扩展和任务读取的数据都是通过环境变量获取，如下是我收集的比较常用的列表：</p>
<table>
<thead>
<tr>
<th>环境变量</th>
<th>来源</th>
<th>说明</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>FASTLANE_USER</td>
<td>credentials_manager</td>
<td>Apple 开发者账户名</td>
<td>验证通过后会保存 Keychain</td>
</tr>
<tr>
<td>FASTLANE_PASSWORD</td>
<td>credentials_manager</td>
<td>Apple 开发者账户密码</td>
<td>验证通过后会保存 Keychain</td>
</tr>
<tr>
<td>FASTLANE_TEAM_ID<!-- raw HTML omitted -->CERT_TEAM_ID</td>
<td>produce<!-- raw HTML omitted -->sigh</td>
<td>Apple 团队 ID</td>
<td></td>
</tr>
<tr>
<td>DELIVER_USER&lt;br &gt;PRODUCE_USERNAME</td>
<td>deliver<!-- raw HTML omitted -->produce</td>
<td>iTunesConnect 账户名</td>
<td></td>
</tr>
<tr>
<td>DELIVER_PASSWORD</td>
<td>deliver</td>
<td>iTunesConnect 账户密码</td>
<td></td>
</tr>
<tr>
<td>MATCH_PASSWORD</td>
<td>match</td>
<td>证书加/解密密码</td>
<td></td>
</tr>
<tr>
<td>FASTLANE_XCODE_LIST_TIMEOUT</td>
<td>fastlane_core</td>
<td>获取 iOS Scheme 的超时时间</td>
<td>默认 10s</td>
</tr>
</tbody>
</table>
]]></content:encoded></item><item><title>Gitlab API Wrapper for Crystal</title><link>https://icyleaf.com/2016/07/gitlab-api-wrapper-for-crystal/</link><pubDate>Mon, 11 Jul 2016 20:41:26 +0800</pubDate><guid>https://icyleaf.com/2016/07/gitlab-api-wrapper-for-crystal/</guid><description>学习新语音最好的途径就是造轮子</description><content:encoded><![CDATA[<h2 id="gitlabcr">Gitlab.cr</h2>
<p><a href="https://github.com/icyleaf/gitlab.cr">gitlab.cr</a> 是我最近课下练习的新语言 <a href="http://crystal-lang.org/">Crystal</a> 写的 gitlab 包，方法和功能和 <a href="https://github.com/NARKOZ/gitlab">gitlab ruby 版本</a>基本类似。</p>
<p>目前已经完成了大部分 API 的封装，在一边熟悉 crystal 的同时一边补充，其中肯定有一些性能问题和坑，毕竟没有任何依赖都是自己实现的。比较坑爹的是官方手册太简单，也没有实时跟进，能够好好翻阅的其实也就是官方的 API 文档和源码。不过 crystal 还算比较人性化的一面，默认集成了类似 rspce 的单元测试（简化版）和依赖库管理 shards（类似 bundler）和生成文档的工具。通过 <a href="https://travis-ci.org/%60%60">travis-ci</a> 会自动生成每次 git push 的变化。</p>
<p>API 文档：http://icyleaf.github.io/gitlab.cr/</p>
<h2 id="为什么学习-crystal">为什么学习 Crystal？</h2>
<p><img loading="lazy" src="https://cloud.githubusercontent.com/assets/209371/13291809/022e2360-daf8-11e5-8be7-d02c1c8b38fb.png"
  
  
  alt="crystal logo"></img>
</p>
<p>Ruby 的缺点众所周知的一个点就是慢，虽说用它的人都不在乎主要是用的爽，so what！这一致命的坑其实默默的被承受着，很多的 Ruby 开发者也在一直寻觅着新的更高性能的语言。比如 Gitlab 的 Build Runner 使用 Go 实现了。Rails 的核心开发者基于多年对 Ruby 的怨念而开发的 Elixir，还有 Firefox 主导的 Rust 也吸引了不少目光。有那么多选择为什么偏偏选了这么一个没有听说过的语言？</p>
<h2 id="语言优势">语言优势</h2>
<ul>
<li>类似 Ruby 风格语法（但舍弃了一些动态特性）</li>
<li>一切都是对象（和 Ruby 一样）</li>
<li>自动类型推荐和静态类型检查</li>
<li>支持方法重载</li>
<li>易用的 C 语言库的绑定机制</li>
<li>基于 LLVM（目前不支持 Windows）</li>
<li>编译性语言，可以打包二进制包</li>
</ul>
<p>仅仅是这些可能大家觉得没什么，其实对我来说也不够冲击力，最重要的关键是在我从订阅的 Ruby Weekly 周刊看到 sidekiq 的作者用 crystal 重新实现了核心部分发的<a href="http://www.mikeperham.com/2016/05/25/sidekiq-for-crystal/">博文分享</a>，提到的一点：<strong>至少是比 ruby 2.3 大部分代码要快 3-5 倍，减少至少 3 倍的内存占用</strong>。怀着怀疑的态度我大概的研究了这个语言，确实看到了新希望。</p>
<table>
<thead>
<tr>
<th>库</th>
<th>语言</th>
<th>并发量</th>
<th>平均响应时间</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/sdogruyol/fast-http-server">fast-http-server</a></td>
<td><code>Crystal</code></td>
<td>18348.47rpm</td>
<td>8.67ms</td>
</tr>
<tr>
<td><a href="https://github.com/indexzero/http-server">http-server</a></td>
<td><code>Node.js</code></td>
<td>2105.55rpm</td>
<td>47.92ms</td>
</tr>
<tr>
<td><a href="https://docs.python.org/2/library/simplehttpserver.html">SimpleHTTPServer</a></td>
<td><code>Python</code></td>
<td>785.14rpm</td>
<td>1.91ms</td>
</tr>
</tbody>
</table>
<p>还有一份一直再更新维护的语言之间的<a href="https://github.com/kostya/benchmarks">评测</a>仅供参考，看着里面的数据还是蛮吸引人的。</p>
<blockquote>
<p>评测数据来源: <a href="http://www.akitaonrails.com/2016/05/31/flirting-with-crystal-a-rubyist-perspective">Flirting with Crystal, a Rubyist Perspective</a></p>
</blockquote>
<h2 id="语言友好">语言友好</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1"># File: server.cr</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="nb">require</span> <span class="s2">&#34;http/server&#34;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">server</span> <span class="o">=</span> <span class="no">HTTP</span><span class="o">::</span><span class="no">Server</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="mi">8080</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">context</span><span class="o">|</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="n">context</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">content_type</span> <span class="o">=</span> <span class="s2">&#34;text/plain&#34;</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="n">context</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">print</span> <span class="s2">&#34;Hello world! The time is </span><span class="si">#{</span><span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="k">end</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="nb">puts</span> <span class="s2">&#34;Listening on http://0.0.0.0:8080&#34;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="n">server</span><span class="o">.</span><span class="n">listen</span>
</span></span></code></pre></div><p>看着是不是是不是和 Ruby 差不多。通过命令编译成二进制在运行试试：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ crystal build --release server.cr
</span></span><span class="line"><span class="ln">2</span><span class="cl">$ ./server
</span></span><span class="line"><span class="ln">3</span><span class="cl">Listening on http://0.0.0.0:8080
</span></span></code></pre></div><blockquote>
<p>macOS 用户可以通过 brew 进行安装 <code>brew install crystal-lang</code></p>
</blockquote>
<h2 id="语言限制">语言限制</h2>
<ul>
<li>没有了强大的黑魔法，尤其是针对 <code>eval</code> 和 <code>send</code> 两个的缺失。提供了 macro 的方式可以实现部分动态定义方法的机制。</li>
<li>require 引入必须放置在头部（crystal 0.7.7 以上版本的限制）</li>
<li>有待优化的 gc 机制（目前采用的是 <a href="https://zh.wikipedia.org/wiki/%E8%B2%9D%E5%A7%86%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8">Hans Boehm GC</a>）</li>
<li>还在开发中的语言，API 变化很快</li>
</ul>
<h2 id="最后想说的话">最后想说的话</h2>
<p>总体来说是一个让人眼前一亮的语言，很是期待后续的进化。我相信 sidekiq 作者的那篇博文也让无数开发者看到了新大陆。目前项目也在<a href="https://salt.bountysource.com/teams/crystal-lang">捐献</a>中，如果你对它感兴趣不妨慷慨的动动自己的钱包，Ruby 的创始人 matz 直接捐献了 $500。</p>
<h2 id="相关资源">相关资源</h2>
<ul>
<li>作者 Twitter: <a href="https://twitter.com/asterite">https://twitter.com/asterite</a></li>
<li>Awesome Crystal: <a href="http://awesome-crystal.com/">http://awesome-crystal.com/</a></li>
<li>Sidekiq for Crystal: <a href="http://www.mikeperham.com/2016/05/25/sidekiq-for-crystal/">http://www.mikeperham.com/2016/05/25/sidekiq-for-crystal/</a></li>
<li>Test Driving Sidekiq and Crystal: <a href="http://www.mikeperham.com/2016/06/14/test-driving-sidekiq-and-crystal/">http://www.mikeperham.com/2016/06/14/test-driving-sidekiq-and-crystal/</a></li>
<li>Flirting with Crystal, a Rubyist Perspective: <a href="http://www.akitaonrails.com/2016/05/31/flirting-with-crystal-a-rubyist-perspective">http://www.akitaonrails.com/2016/05/31/flirting-with-crystal-a-rubyist-perspective</a></li>
</ul>
]]></content:encoded></item><item><title>Fastlane - iOS 和 Android 的自动化构建工具</title><link>https://icyleaf.com/2016/07/intro-fastlane-automation-for-ios-and-android/</link><pubDate>Mon, 11 Jul 2016 12:36:07 +0800</pubDate><guid>https://icyleaf.com/2016/07/intro-fastlane-automation-for-ios-and-android/</guid><description>使用 fastlane 提升构建移动应用的效率</description><content:encoded><![CDATA[<h2 id="前言">前言</h2>
<p>这篇文章整理了很久，发现在一篇文章里无法一一讲述和全面的覆盖，初步打算是把这个做成一个系列，想到哪里就写到哪里，如果恰好有读者爱戴并有一些建议反馈，我也会根据大家的需要调整内容的方向和深度。论美剧的编剧的重要性(笑)。</p>
<h2 id="初次邂逅">初次邂逅</h2>
<p>初时 fastlane 的时候是去年的 11 月份，看到大就感觉遇到了神器一般的惊喜。它一个针对于 iOS 和 Android（后来才支持的）全方位自动化流程的工具，请看下图</p>
<p><img loading="lazy" src="https://fastlane.tools/assets/img/intro-fastlane-tree.png"
  
  
  alt="fastlane-flow"></img>
</p>
<p>流程图中每个环节都是独立的工具，每个工具只干一件事情，分工非常的明确。以下是我在团队项目中用到的：</p>
<ul>
<li><a href="https://github.com/fastlane/fastlane/tree/master/scan">scan</a> 自动化测试工具，很好的封装了 Unit Test</li>
<li><a href="https://github.com/fastlane/fastlane/tree/master/sigh">sigh</a> 针对于 iOS 项目开发证书和 Provision file 的下载工具</li>
<li><a href="https://github.com/fastlane/fastlane/tree/master/match">match</a> 同步团队每个人的证书和 Provision file 的超赞工具，规范<a href="https://codesigning.guide/">代码签名</a>（虽然里面有些设定比较损）</li>
<li><a href="https://github.com/fastlane/fastlane/tree/master/gym">gym</a> 针对于 iOS 打包和签名的自动化工具，完爆 <code>xctool</code>，而 <code>shenzhen</code> 也放弃维护</li>
<li><a href="https://github.com/icyleaf/fastlane-qyer">qyer</a> 团队定制的工具，用于检测包和上传到自己的内部分发平台</li>
<li><a href="https://github.com/fastlane/fastlane">fastlane</a> 简单理解就是控制整体流程和实现的框架容器</li>
</ul>
<p>利用目前支持的工具可以做所有包含自动化和可持续化构建的每个环节，比如单元测试、截图、分发渠道、上传元数据和 ipa 包提交审核等等。看到这这些是不是很兴奋？
反正我看到之后就像黑夜看到了光明，果断抛弃自己维护的脚本。</p>
<h2 id="基本构成">基本构成</h2>
<p>Fastlane 提供的流程的众多工具都是可以独立存在和使用（提供 cli 命令），也可以统一由 fastlane 来控制。它在使用中提出了两个概念：</p>
<ul>
<li><code>action</code>: Fastlane 的插件，截至当前内置 165 个至多，不过每个动作的颗粒度大小不一。<a href="https://github.com/fastlane/fastlane/blob/master/fastlane/docs/Actions.md">查看详情</a></li>
<li><code>lane</code>: Fastlane 的任务（或者可以理解为命令），一个可以包含多个 lanes，通过 <code>fastlane</code> cli 传入制定的 lane 来执行。</li>
</ul>
<p>光说不干假把式，看法宝：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="n">lane</span> <span class="ss">:adhoc</span> <span class="k">do</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="c1"># build version 自动加一</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="n">increment_build_number</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="c1"># 执行 pod install</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="n">cocoapods</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="c1"># 调用 facebook 的 xctool 进行单元测试</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="n">xctool</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="c1"># 对模拟器运行的 App 进行截图</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="n">snapshot</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="c1"># 安装团队证书和 profiles</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="n">match</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="c1"># 上传 App 元数据和签名的 ipa 到 iTunes Conneects</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="n">deliver</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="c1"># 把截图套进一个设备外壳</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">  <span class="n">frameit</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">  <span class="c1"># 允许自定义的脚本文件</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">  <span class="n">sh</span> <span class="s2">&#34;./customScript.sh&#34;</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">  <span class="c1"># 发消息到 slack</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">  <span class="n">slack</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="k">end</span>
</span></span></code></pre></div><h2 id="安装">安装</h2>
<p>工具的起源本身是专门针对 iOS 项目，因此目前依赖于 macOS 10.9 以上系统，Ruby 是一个众所周知的轮子发明者，很多知名的工具都是它开发的，fastlane 也不例外。以下是依赖环境：</p>
<ul>
<li>macOS 10.9+</li>
<li>Ruby 2.0+ (推荐 rvm 或 rbenv 安装)</li>
<li>Xcode + command line tools</li>
</ul>
<p>以上依赖配置好之后就可以通过 rubygem 进行安装：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ <span class="o">[</span>sudo<span class="o">]</span> gem install fastlane
</span></span></code></pre></div><p>fastlane 默认会把核心工具都会进行安装，需要大家耐心等待一会&hellip;</p>
<h2 id="初始化">初始化</h2>
<p>有两种方法可以初始化，一种是通过命令，一种是自己创建指定的（至少包含一个）约束文件 <code>Fastfile</code>。首先我先介绍大家使用命令初始化:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1"># 切换只你开发的 iOS 项目根目录</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">$ <span class="nb">cd</span> to/your/ios/project
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">$ fastlane init
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="o">[</span>11:46:34<span class="o">]</span>: Detected iOS/Mac project in current directory...
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="o">[</span>11:46:34<span class="o">]</span>: This setup will <span class="nb">help</span> you get up and running in no time.
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="o">[</span>11:46:34<span class="o">]</span>: fastlane will check what tools you<span class="s1">&#39;re already using and set up
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="s1">[11:46:34]: the tool automatically for you. Have fun!
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="s1">[11:46:34]: Created new folder &#39;</span>./fastlane<span class="s1">&#39;.
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="s1">...
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="s1">Your Apple ID (e.g. fastlane@krausefx.com): xxx@gmail.com
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="s1">[11:46:59]: Verifying if app is available on the Apple Developer Portal and iTunes Connect...
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="s1">[11:46:59]: Starting login with user &#39;</span>xxx@gmail.com<span class="s1">&#39;
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="s1">Multiple teams found on the Developer Portal, please enter the number of the team you want to use:
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="s1">1) XXXXXXXXXX &#34;XXXXXXXXXX&#34; (In-House)
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="s1">2) YYYYYYYYYY &#34;YYYYYYYYYY&#34; (Company/Organization)
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="s1">+----------------+----------------------------------------------------------------------------+
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="s1">|                                       Detected Values                                       |
</span></span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="s1">+----------------+----------------------------------------------------------------------------+
</span></span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="s1">| Apple ID       | xxx@gmail.com                                                              |
</span></span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="s1">| App Name       | Hello Fastlane                                                             |
</span></span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="s1">| App Identifier | com.icyleaf.demo.HelloFastlane                                             |
</span></span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="s1">| Workspace      | /Users/icyleaf/Development/iOS/HelloFastlane.xcworkspace                   |
</span></span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="s1">+----------------+----------------------------------------------------------------------------+
</span></span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="s1">[11:48:36]: This app identifier doesn&#39;</span>t exist on iTunes Connect yet, it will be created <span class="k">for</span> you
</span></span><span class="line"><span class="ln">26</span><span class="cl">Please confirm the above values <span class="o">(</span>y/n<span class="o">)</span> n
</span></span><span class="line"><span class="ln">27</span><span class="cl">App Identifier <span class="o">(</span>com.krausefx.app<span class="o">)</span>: com.icyleaf.demo.HelloFastlane
</span></span><span class="line"><span class="ln">28</span><span class="cl"><span class="o">[</span>11:50:04<span class="o">]</span>: Created new file <span class="s1">&#39;./fastlane/Appfile&#39;</span>. Edit it to manage your preferred app metadata information.
</span></span><span class="line"><span class="ln">29</span><span class="cl">Optional: The scheme name of your app <span class="o">(</span>If you don<span class="s1">&#39;t need one, just hit Enter): AppDemo
</span></span></span><span class="line"><span class="ln">30</span><span class="cl"><span class="s1">[11:50:40]: &#39;</span>snapshot<span class="s1">&#39; not enabled.
</span></span></span><span class="line"><span class="ln">31</span><span class="cl"><span class="s1">[11:50:40]: &#39;</span>cocoapods<span class="s1">&#39; enabled.
</span></span></span><span class="line"><span class="ln">32</span><span class="cl"><span class="s1">[11:50:40]: &#39;</span>carthage<span class="s1">&#39; not enabled.
</span></span></span><span class="line"><span class="ln">33</span><span class="cl"><span class="s1">[11:50:40]: Created new file &#39;</span>./fastlane/Fastfile<span class="err">&#39;</span>. Edit it to manage your own deployment lanes.
</span></span><span class="line"><span class="ln">34</span><span class="cl"><span class="o">[</span>11:50:40<span class="o">]</span>: fastlane will send the number of errors <span class="k">for</span> each action to
</span></span><span class="line"><span class="ln">35</span><span class="cl"><span class="o">[</span>11:50:40<span class="o">]</span>: https://github.com/fastlane/enhancer to detect integration issues
</span></span><span class="line"><span class="ln">36</span><span class="cl"><span class="o">[</span>11:50:40<span class="o">]</span>: No sensitive/private information will be uploaded
</span></span><span class="line"><span class="ln">37</span><span class="cl"><span class="o">[</span>11:50:40<span class="o">]</span>: Successfully finished setting up fastlane
</span></span></code></pre></div><p>这部分会进行联网，并提示输入你的 Apple ID 来验证你的应用是否存在（没有也会帮你自动创建）并获取相应的关键信息，通过一系列的流程下来把获取的信息会创建一个 <code>fastlane</code> 目录
并并写入相应的文件（如果某些信息没有填写会忽略某些文件的生成）：</p>
<ul>
<li><code>Fastfile</code>: 核心文件，主要用于 cli 调用和处理具体的流程，<a href="https://github.com/fastlane/fastlane/tree/master/fastlane/docs#fastfile">了解详情</a></li>
<li><code>Appfile</code>: 从 Apple Developer Portal 获取和项目相关的信息，<a href="https://github.com/fastlane/fastlane/blob/master/fastlane/docs/Appfile.md">了解详情</a></li>
<li><code>Deliverfile</code>: 从 iTunes Connect 获取和项目相关的信息，<a href="https://github.com/fastlane/fastlane/blob/master/deliver/Deliverfile.md">了解详情</a></li>
</ul>
<p>抛开其他的几个文件先不说，大家先把注意力放到刚创建好的 <code>Fastfile</code> 文件上面（可能有变化，仅作参考），如果大家对 Ruby 有了解的话，它定义的 DSL 语言非常类似 <a href="https://github.com/ruby/rake">rake</a>，但流程上有参考的 <a href="https://github.com/rspec/rspec">rspec</a>，一旦不满足需求还可以使用 Ruby 代码来实现。单凭 DSL 语言来说就算对于 Ruby 没有基础的也能很快掌握，大多都是比较简单易懂的语法。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1"># Customise this file, documentation can be found here:</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="c1"># https://github.com/fastlane/fastlane/tree/master/fastlane/docs</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="c1"># All available actions: https://github.com/fastlane/fastlane/blob/master/fastlane/docs/Actions.md</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1"># can also be listed using the `fastlane actions` command</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="c1"># Change the syntax highlighting to Ruby</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="c1"># All lines starting with a # are ignored when running `fastlane`</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="c1"># If you want to automatically update fastlane if a new version is available:</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="c1"># update_fastlane</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="c1"># This is the minimum version number required.</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="c1"># Update this, if you use features of a newer version</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="n">fastlane_version</span> <span class="s2">&#34;1.95.0&#34;</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="n">default_platform</span> <span class="ss">:ios</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="n">platform</span> <span class="ss">:ios</span> <span class="k">do</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">  <span class="c1"># 执行所有命令前都会先执行这里</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">  <span class="n">before_all</span> <span class="k">do</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="c1"># ENV[&#34;SLACK_URL&#34;] = &#34;https://hooks.slack.com/services/...&#34;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="n">cocoapods</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">  <span class="k">end</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">
</span></span><span class="line"><span class="ln">25</span><span class="cl">  <span class="n">desc</span> <span class="s2">&#34;Runs all the tests&#34;</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">  <span class="n">lane</span> <span class="ss">:test</span> <span class="k">do</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">    <span class="nb">scan</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">  <span class="k">end</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">
</span></span><span class="line"><span class="ln">30</span><span class="cl">  <span class="n">desc</span> <span class="s2">&#34;Submit a new Beta Build to Apple TestFlight&#34;</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">  <span class="n">desc</span> <span class="s2">&#34;This will also make sure the profile is up to date&#34;</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">  <span class="n">lane</span> <span class="ss">:beta</span> <span class="k">do</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">    <span class="c1"># match(type: &#34;appstore&#34;) # more information: https://codesigning.guide</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">    <span class="n">gym</span><span class="p">(</span><span class="ss">scheme</span><span class="p">:</span> <span class="s2">&#34;AppDemo&#34;</span><span class="p">)</span> <span class="c1"># Build your app - more options available</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">    <span class="n">pilot</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">
</span></span><span class="line"><span class="ln">37</span><span class="cl">    <span class="c1"># sh &#34;your_script.sh&#34;</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">    <span class="c1"># You can also use other beta testing services here (run `fastlane actions`)</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">  <span class="k">end</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">
</span></span><span class="line"><span class="ln">41</span><span class="cl">  <span class="n">desc</span> <span class="s2">&#34;Deploy a new version to the App Store&#34;</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">  <span class="n">lane</span> <span class="ss">:appstore</span> <span class="k">do</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">    <span class="c1"># match(type: &#34;appstore&#34;)</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">    <span class="c1"># snapshot</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl">    <span class="n">gym</span><span class="p">(</span><span class="ss">scheme</span><span class="p">:</span> <span class="s2">&#34;AppDemo&#34;</span><span class="p">)</span> <span class="c1"># Build your app - more options available</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl">    <span class="n">deliver</span><span class="p">(</span><span class="ss">force</span><span class="p">:</span> <span class="kp">true</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl">    <span class="c1"># frameit</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl">  <span class="k">end</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl">
</span></span><span class="line"><span class="ln">50</span><span class="cl">  <span class="c1"># 你可以定义属于自己的 lane（任务）</span>
</span></span><span class="line"><span class="ln">51</span><span class="cl">  <span class="n">lane</span> <span class="ss">:hello</span> <span class="k">do</span>
</span></span><span class="line"><span class="ln">52</span><span class="cl">    <span class="nb">puts</span> <span class="s2">&#34;hello world&#34;</span>
</span></span><span class="line"><span class="ln">53</span><span class="cl">  <span class="k">end</span>
</span></span><span class="line"><span class="ln">54</span><span class="cl">
</span></span><span class="line"><span class="ln">55</span><span class="cl">  <span class="c1"># 仅当上述流程全部执行成功后才会走这里。其实应该定义为 after_success</span>
</span></span><span class="line"><span class="ln">56</span><span class="cl">  <span class="n">after_all</span> <span class="k">do</span> <span class="o">|</span><span class="n">lane</span><span class="o">|</span>
</span></span><span class="line"><span class="ln">57</span><span class="cl">    <span class="c1"># slack(</span>
</span></span><span class="line"><span class="ln">58</span><span class="cl">    <span class="c1">#   message: &#34;Successfully deployed new App Update.&#34;</span>
</span></span><span class="line"><span class="ln">59</span><span class="cl">    <span class="c1"># )</span>
</span></span><span class="line"><span class="ln">60</span><span class="cl">  <span class="k">end</span>
</span></span><span class="line"><span class="ln">61</span><span class="cl">
</span></span><span class="line"><span class="ln">62</span><span class="cl">  <span class="c1"># 如果流程发生异常会走这里并终止</span>
</span></span><span class="line"><span class="ln">63</span><span class="cl">  <span class="n">error</span> <span class="k">do</span> <span class="o">|</span><span class="n">lane</span><span class="p">,</span> <span class="n">exception</span><span class="o">|</span>
</span></span><span class="line"><span class="ln">64</span><span class="cl">    <span class="c1"># slack(</span>
</span></span><span class="line"><span class="ln">65</span><span class="cl">    <span class="c1">#   message: exception.message,</span>
</span></span><span class="line"><span class="ln">66</span><span class="cl">    <span class="c1">#   success: false</span>
</span></span><span class="line"><span class="ln">67</span><span class="cl">    <span class="c1"># )</span>
</span></span><span class="line"><span class="ln">68</span><span class="cl">  <span class="k">end</span>
</span></span><span class="line"><span class="ln">69</span><span class="cl"><span class="k">end</span>
</span></span></code></pre></div><p>通过上面的注解，我想大家对它已经有了初步的了解，那么定义完之后该如何执行呢？回到刚才的终端（关闭了？那再切换到刚才的 iOS 项目的根目录）：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln"> 1</span><span class="cl">$ fastlane ios hello
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="o">[</span>11:56:24<span class="o">]</span>: -------------------------------------------------
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="o">[</span>11:56:24<span class="o">]</span>: --- Step: Verifying required fastlane version ---
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="o">[</span>11:56:24<span class="o">]</span>: -------------------------------------------------
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="o">[</span>11:56:24<span class="o">]</span>: fastlane version valid
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="o">[</span>11:56:24<span class="o">]</span>: ------------------------------
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="o">[</span>11:56:24<span class="o">]</span>: --- Step: default_platform ---
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="o">[</span>11:56:24<span class="o">]</span>: ------------------------------
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="o">[</span>11:56:24<span class="o">]</span>: Driving the lane <span class="s1">&#39;ios hello&#39;</span> 🚀
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="o">[</span>11:56:24<span class="o">]</span>: -----------------------
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="o">[</span>11:56:24<span class="o">]</span>: --- Step: cocoapods ---
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="o">[</span>11:56:24<span class="o">]</span>: -----------------------
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="o">[</span>11:56:24<span class="o">]</span>: $ pod install
</span></span><span class="line"><span class="ln">14</span><span class="cl">...
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="o">[</span>11:56:28<span class="o">]</span>: hello world
</span></span><span class="line"><span class="ln">16</span><span class="cl">
</span></span><span class="line"><span class="ln">17</span><span class="cl">+------+-------------------------------------+-------------+
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="p">|</span>                     fastlane summary                     <span class="p">|</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">+------+-------------------------------------+-------------+
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">|</span> Step <span class="p">|</span> Action                              <span class="p">|</span> Time <span class="o">(</span>in s<span class="o">)</span> <span class="p">|</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">+------+-------------------------------------+-------------+
</span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="p">|</span> <span class="m">1</span>    <span class="p">|</span> Verifying required fastlane version <span class="p">|</span> <span class="m">0</span>           <span class="p">|</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="p">|</span> <span class="m">2</span>    <span class="p">|</span> default_platform                    <span class="p">|</span> <span class="m">0</span>           <span class="p">|</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl"><span class="p">|</span> <span class="m">3</span>    <span class="p">|</span> cocoapods                           <span class="p">|</span> <span class="m">4</span>           <span class="p">|</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">+------+-------------------------------------+-------------+
</span></span><span class="line"><span class="ln">26</span><span class="cl">
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="o">[</span>11:56:28<span class="o">]</span>: fastlane.tools finished successfully 🎉
</span></span></code></pre></div><p>哒哒！一个简单的任务执行完毕！</p>
<p>如果大家注意观察上面的文件可能注意到一些小细节：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1"># 自动更新 fastlane 工具，需要 rubygems &gt;= 2.1.0</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="n">update_fastlane</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1"># 最低兼容版本，由于 fastlane 还是逐步健壮的阶段更新速度还是蛮快的，</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="c1"># 为了防止新特性在旧版本的不支持会强制设置一个最低兼容版本</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="c1"># 不过工具特别贴心的会在每次执行之后会检查是否有新版本，如果有会在最后末尾追加新版本提醒</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="n">fastlane_version</span> <span class="s2">&#34;1.95.0&#34;</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="c1"># 默认使用平台是 ios，也就是说文件可以定义多个平台，</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="c1"># 通过上述执行的命令也能看出来是执行的 ios 平台下面的 hello 任务。</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="c1"># 这个的作用是可以在执行 fastlane 的时候省略 ios，不信你执行 fastlane hello 试试。</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="n">default_platform</span> <span class="ss">:ios</span>
</span></span></code></pre></div><h2 id="android-的支持">Android 的支持</h2>
<p>这个的支持我觉得关键是社区的呼声太大，加上贡献者的热情（我提交过许多 issues 和个别 PL，响应非常的迅速）很快就加上了其支持，
但具体的特性不是特别多，主要是对于 <code>gradle</code> 的封装，我先不做展开介绍，大家可以先看看<a href="https://github.com/fastlane/fastlane/blob/master/fastlane/docs/Android.md">官方文档</a>，如果后续有特别不明白的地方我在做具体的讲解。</p>
<p>今天就先写到这里后续我会继续整理更多的使用指南和实战范例共大家参考，最后给大家附赠官方给大家的一些<a href="https://github.com/fastlane/examples">范例</a>。</p>
]]></content:encoded></item><item><title>博客迁徙记</title><link>https://icyleaf.com/2015/12/a-history-of-my-blog/</link><pubDate>Thu, 17 Dec 2015 15:01:56 +0800</pubDate><guid>https://icyleaf.com/2015/12/a-history-of-my-blog/</guid><description>文章没写几篇，博客系统换了到挺勤</description><content:encoded><![CDATA[



<div class="updated">
  <header class="updated-header">
    <h4 class="updated-title">更新</h4>
    
    <p class="updated-meta">8月 15, 2022</p>
    
  </header>
  <article class="updated-body">
    <p>博客系统的迁移变更改为时间倒序排列，没想到这次坚持的时间还挺长，没有关停这里实属幸运吧。</p>
<p>这次借助于撰写<a href="https://icyleaf.com/2022/02/how-to-homelab-part-0-intro/">如何搭建家用 homelab: 先导篇</a>难得有一番时间给这里拔拔草，休憩一番。</p>

  </article>
</div>


<p>博客的历史文章通过几次的系统和脚本转换过，已经不堪入目。在统一 markdown 格式的时候还翻看了自己写的文字有些感触。复活记可能还要经历几次，不如就写一篇博客的迁徙记吧。</p>
<h2 id="hugohttpgohugoio"><a href="http://gohugo.io/">Hugo</a></h2>
<blockquote>
<p>2016.8 ~ 至今</p>
</blockquote>
<p>Hugo 是用 Go 语言开发维护的，再了解和上手上着实让我研究了好一番，因为它的自由度太大了，初始化项目后居然连主题都不带的，都需要自己从 github 上安装一份之后才能运行。其实切换使用它的最根本原因是 Hexo 是满足我的绝大部分需求的尤其是原先用的 NexT 主题也很好用，但唯一比较麻烦的是它依赖 Node.js 每次用 Docker 在本地进行维护的时候都要更新好久。我也喜欢在 VPS 上也备有一套运行环境，脱离了有环境的电脑我随时可以写完同步后在服务器上面手动或自动生成。基于这点给我带来的困扰是最多的，因为我的服务器配置的最低标准，内存还不到 1G，每次 hexo 在生成静态资源的时候很容易把内存爆掉，直接抛出内存不足的异常。反观 hugo 命令编译后可以在任意平台直接使用，速度也是搜搜的，内存占用也就不用说了，虽然没有 hexo 的迁移方案，整体也很简单，因为 hugo 除了默认支持 toml 格式以为，还兼容 yaml 和 json。文章的内容都是 markdown 这个基本上是业界标配了。</p>
<p>在整理之余，我对于 docker 和 docker-compose 有了更好的理解，同时新的博客系统会用 caddy 把 nginx 替换掉跑一段时间看看，可能还会切换成 h2o 再跑一段时间来分别看看两者的性能情况。新的 http server 都是基于 HTTP/2 协议优化的。我想后面是属于 HTTPS + HTTP/2 的时代。</p>
<h2 id="hexohttpshexoio"><a href="https://hexo.io/">Hexo</a></h2>
<blockquote>
<p>2013.12 ~ 2016.8</p>
</blockquote>
<p>Hexo 由台湾人使用 Node.js 开发并开源，网站本身提供明细的文档和插件扩展。对比 Pelican 来说比较适合国人，附带实用的命令行工具。Pelican 在使用中总有些不太爽的地方，Hexo 就在哪个时候出现在了我的视野，弥补了我的需要，用的顺手的系统就不在乎什么语言开发的，更何况也是静态发布。</p>
<p>主题真的是太喜欢之前实现的那个就直接由迁移的过来，历史文章又经历了一次迁移，其实已经有些部分的内容有些损坏了。单纯从主题和内容来说，整个网站有些支离破粹。</p>
<p>这个阶段对我而言是幸福的一年，对我的博客来说是相当冷落的一年。从结识土豪妞到一起走上婚姻殿堂，我感到非常的幸福。这里确是一片静寂两年的时间文章数量一个手都能数过来（寥寥 5 篇文章）。爱情和工作两方面的因素，直接导致各种的事情急剧减少，包括不仅限于户外登山、骑行、看书、电影。话说也奇怪了文章不少了可以理解，怎么外出活动也居然少了呢 &gt;.&lt;</p>
<p>博客的复活是意料之外的事情，前几天惯例的吸收网上的信息，看到推荐一个 VPS，和 DigitalOcean 类似 SSD 硬盘、最低每月 5 刀的租金。速度方面很明显，尝试一番后发现最优情况 ping 值可以稳定在 60 ~ 100 左右，下载速度也能达到 1~2Mb/s。信用卡刷钱先试 3 个月再说。自然就想到把博客迁移过来。年底将至，还要有两年的总结需要完成，提前做好准备也是件好事。</p>
<p>从 Dropbox 找回博客系统和日志，重新本地部署环境。悲催，Hexo 不工作了。检查后发现升级到 3.0 版本，代码结构变化了的。文章的格式也做了调整。又有事情要忙活了。</p>
<p>写好升级兼容脚本，文章没问题了，主题有崩了。脑海里立即飘出来一个曾经看到过的网站用的是 Hexo 搭建的，主题还挺好看。打开 Chrome 页面历史搜索关键字，打开目标网站快捷键切换到页面底部 &ldquo;Theme - NexT&rdquo;，一切就顺理成章的平滑过来。还顺手试了一把 <code>git subtree</code> 代替费死牛力的 <code>git submodule</code>。</p>
<h2 id="pelicanhttpsgithubcomgetpelicanpelican"><a href="https://github.com/getpelican/pelican">Pelican</a></h2>
<blockquote>
<p>2013.1 ~ 2013.12</p>
</blockquote>
<p>这是一个短暂的瞬间，@<a href="http://cnborn.net">CNBorn</a> 建议把动态的博客内容静态化速度就上去了。但是有些功能就需要依托外部的服务，比如搜索、评论。当时网站也还在 ping 值在 300 - 400 之间 DreamHost  虚拟主机上面。GFW 在不断进化和完善，这个时候就开始用上了 IP 封杀，Dreamhost 的大部分 IP 也没能幸免。毫不犹豫的就改换了 Pelican 这套框架。</p>
<p>动态切换为静态之后最大的问题就在于后台没有了，所有信息都需要在配置文件里面来处理。文章也只能本地写后生成静态文件并发布。没有选择部署在 Github Page 还是因为它的速度有些不太稳定了。已经使用了虚拟主机配合自建 VPN 的 Linode 主机而不使用确实有些浪费资源。</p>
<p>Chyrp 切换过来的历史文章通过自己写的脚本迁移过来，多少有些格式的不兼容和转换问题，手查和纠正了部分。主题借鉴于 Squarespace 给别人订制的样式，自己使用部分配色用 Twitter Bootstrap 重新实现。</p>
<p>使用 Pelican 的另外一个因素是想学习 Python，之后的文章开始增加了 python 相关和 Linux 基础技术文章。学习上重点放在了日常脚本的使用以及 pip+django 的功能学习，配合提交部分代码到 <a href="https://github.com/openparty/openparty">OpenParty</a> 网站。</p>
<p>顺带提一句，Dango 自带的模板引擎和 Jinja2 用着是最爽的事情，和 Ruby 的 Haml/Slim 是不一样的 G 点。</p>
<p>本人从小偏爱骑行，在北京漂泊的日子，也只能是户外登山扎营（装备可压缩），反复的搬家对于还要再带一个自行车和一堆配件来说有些艰巨，在更换一个相对比较大的租房一狠心入了美利达公爵 650。长时间的骑行和休闲骑车差别很明显。累！很累！尤其是和公路车一起骑更累！骑行不像是登山，后者只需要完成登山的过程享受一把自虐，骑行是全程的，从你报名一个活动开始，你要从家骑到集合点、骑到目的地、骑到腐败点、最后还要疲惫的骑回家，这个过程是值得回忆的。也就有了我第一次长距离骑行，献给了<a href="http://icyleaf.com/2013/05/riding-to-hulunbeier/">http://icyleaf.com/2013/05/riding-to-hulunbeier/</a></p>
<p>历史快照：https://web.archive.org/web/20130201044534/http://icyleaf.com/</p>
<h2 id="chyrphttpsgithubcomvitochyrp"><a href="https://github.com/vito/chyrp">Chyrp</a></h2>
<blockquote>
<p>2012.4 ~ 2012.12</p>
</blockquote>
<p><strong>最新补充：</strong> 终于想起来为什么更换掉 Wordpress，是因为 Wordpress 有个版本连续有后门被捅菊花，我的博客连连中招。反复清理无数感染的文件还是被捅。实在没精力跟它周折。想想也是时候放弃这个庞然怪物了。</p>
<p>自己已经记不得这个系统了，因为使用的时间不算很长，根据 Archive.org 的历史快照显示于 2012 年 4 月切换过来。系统提供迁移脚本直接把 mysql 数据转为为自己支持的字段格式。Chyrp 号称是最轻量级的微博客系统，有些类似 Tumblr。转换的原因现在想想应该是 Twitter 大多时候也是被 GFW 的状态，想用微博客系统把自己的牢骚、文章和一些图片揉到一起使用。还有一个原因是有插件可以支持 markdown 编写文章。</p>
<p>这段时间是在新浪乐居从事移动开发和团队建设的事情，文章更多的增加了针对 Android 和 iOS 开发相关的技术类文章。</p>
<p>我是一个念旧的人，之前记录的文字总想着可以保留下来，从这里开始后面的任何的博客系统的迁徙都会把数据转换过去。懂技术也算是一个优势（笑）</p>
<p>历史快照：<a href="https://web.archive.org/web/20120414131120/http://icyleaf.com/">https://web.archive.org/web/20120414131120/http://icyleaf.com/</a></p>
<h2 id="wordpresshttpwwwwordpressorg"><a href="http://www.wordpress.org">WordPress</a></h2>
<blockquote>
<p>2007 ~ 2012.3</p>
</blockquote>
<p>鉴于 My Opera 进行被 GFW 抽打，最终管制监禁之后，开始考虑更换新的博客平台，在使用 WordPress 之前也在国内寻找一个稳定的平台。新浪博客因为明星效应略有反感再加上网站广告横飞、没有什么玩头就按着可以自定义 CSS 的方式找了几个（如今都消失了）都感觉不太靠谱。有些想放弃，有次回家过年和挚友 @<a href="https://Twitter.com/lopor">lopor</a> 在网吧上网，聊到这事，他说他已经和几个 V2EX 朋友合租了一台 Dreamhost 虚拟主机（VPS 那个时候还处于买不起的状态），要不要自己搭建一个 WordPress，心里一边听他给我演示一边看他打开网站和 ssh 工具进行着不知道什么事情的操作。</p>
<p>说来也巧，在大学的时候和学校网络维护的老师混的比较熟悉，老师说看看 PHP 吧，语言很简单很容易就可以开发出来一个网站。而 WordPress 本来也是 PHP 开发的。接着就有了注册域名，让朋友把 WordPress 给我部署到虚拟空间，解析域名。一切起了就开始了第二阶段的博客记录，也是时间最长的一个阶段。</p>
<p>使用 WordPress 之后的两年里，工作写 Java/HTML/CSS/Javascript，晚上的时候就开始学习 PHP，最开始就是拿 WordPress 的插件练手。粗略的熟悉整体的通用函数和钩子，等运用的比较熟练了，找了一个轻量级的 Kohana 框架开始学习整体的架构和编程思想。</p>
<p>也是这一阶段开始了跨城市出走的经历，有 5 篇文章整理了去新疆乌鲁木齐出差之余游走在 7-5事件之后的一些所见所闻（当前从文字来看看不出什么端倪），里面的照片放在已经被墙的 Google Picasa 相册。再那的 11 天让我知道了 GFW 已经完善到可以瞬间做到一个内部的局域网（当时本地除了电话可以和外界沟通之外，短信和网络全部封闭）</p>
<p>WordPress 同样也是收到 Twitter 这类碎片化的微服务的冲击，文章数量开始逐年减少。内容上开始增加了养生（我这小小年级就开始了）和一些软件推荐和技巧性文章，偶尔还会发一些我开源代码的宣传。</p>
<p>最重要的是我开始了写年度计划和年终总结的文章，这将作为我人生的记录和回顾的最重要的证据。</p>
<p>这个期间的朋友大多数来自于 V2EX 社区和 Twitter 上面。还和部分的朋友一起参加过第一届的 Wordcamp 2008，朋友聚集了私下一起吐槽各种渣的地方。</p>
<p>WordPress 因简单方便，功能强大而流行也因太过于扩充里面的功能而没有很好的优化核心代码而遭人唾弃。@<a href="http://Twitter.com/yichi">yichi</a> 有保存但是的部分照片 <a href="https://www.flickr.com/photos/yichi0523/albums">Flickr 相册</a></p>
<p>使用期间也挂过 Google Ads 和阿里妈妈广告联盟试图赚些收入。收入明细甚微，到目前对自己的定义还都是技术，营销果然不是我的菜。</p>
<p>历史快照：<a href="https://web.archive.org/web/20100701151339/http://icyleaf.com/">https://web.archive.org/web/20100701151339/http://icyleaf.com/</a> 网站界面完整当时的仿照 Delicious.com (美味书签) 全站复制过来。</p>
<p>这里再说一个域名的小插曲，域名最开始还是 icyleaf.cn，国内为了推销 cn 域名起初大体都是 1 元第一年。用了一年之后发现之后的费用飙升到比 com 域名还贵，加上开了 Visa 信用卡立即切换过去。庆幸的是我的域名比较个性没有什么人抢注。</p>
<h2 id="my-operahttpmyoperacom"><a href="http://my.opera.com">My Opera</a></h2>
<blockquote>
<p>2006 ~ 2008</p>
</blockquote>
<p>记忆已经有些模糊了，依稀记得第一次真正开始写博客是在上大二的时候，当时作为一名苦逼学生党，在网络上到处搜刮免费资源，误打误撞的在 My Opera 安家、开始了博客的更新。起初无非就是些不痛不痒的牢骚、生活流水，哪个黑客杂志发布我投稿的文章了和一些网络上发现的各种新鲜的技术资源。尤其热衷于博客主题的修改。</p>
<p>My Opera 定位是一个社交服务平台，在那个年代应该是和 MySpace 等竞争类似网站，自身提供的功能可谓强大，不仅仅是博客，还开放相册，自创建维护的群组论坛和好友社交等主要功能。也有不少的中国人和国外的留学生（及华人）在上面聚集。通过群组的查找（类似豆瓣小组但比起强大）加入了几个华人圈，其中我比较活跃的主要是一个名叫板秀的群组。里面提供各种在当时看来非常酷炫漂亮的主题。My Opera 博客除了默认几套主题以外，还提供可自定义 CSS 样式表作为其重要&quot;秘密武器&quot;。也使得我为之着迷。从此也在网络开开启了第二个交际圈（第一个是非安全黑客论坛圈）。</p>
<p>大学学的科目都是非常基础的语言课程，汇编语言、C、VB/VF 之类的和 CSS + HTML 一比较来说前者的诱惑力明显不如后者。之后除了学业以外开始正式的接触 HTML/CSS/Javascript 为后面的 web 开发做好了前期的铺垫。这当时是后话了。</p>
<p>好久不长，My Opera 因是免费注册使用被一些国内的偏激份子占据后开始各种宣传转法轮和反国家等言论。正碰巧那个时候 GFW 初出茅庐，开始了域名封杀的策略。在期间 GFW 偶尔抽风也就开始慢慢的淡出 My Opera 转战到迅速火起来的 Twitter。</p>
<p>自 2007 年注册 Twitter 之后所有话唠的信息都开始转移。My Opera 只剩下一些网络技术资源和扯蛋疼的文字。最后终结到大学毕业之后停止更新。</p>
<p>最终随着 Opera 被 Android 和 iOS 等现代智能浏览器的出现逐渐没落，2014 年 3 月 3 日正式的关闭了 My Opera 服务。</p>
<p>还好 Archive.org 有索引保存到历史快照，也算是一种纪念：</p>
<ul>
<li><a href="https://web.archive.org/web/20060820214239/http://my.opera.com/icyleaf/blog/">博客快照</a></li>
<li><a href="https://web.archive.org/web/20070206190114/http://my.opera.com/blogshowing/blog">板秀群组快照</a></li>
</ul>
<h2 id="内容量">内容量</h2>
<p>统计自使用自建博客系统开始计算，My Opera 作为一个自留地不再统计范围：</p>
<p>历经 8 年之余的时间共计 <code>106</code> 篇：</p>
<ul>
<li>2007 年总文章数量 7 篇（有删减）</li>
<li>2008 年总文章数量 14 篇（有删减）</li>
<li>2009 年总文章数量 13 篇（有删减）</li>
<li>2010 年总文章数量 7 篇（有删减）</li>
<li>2011 年总文章数量 7 篇（有删减）</li>
<li>2012 年总文章数量 23 篇</li>
<li>2013 年总文章数量 14 篇</li>
<li>2014 年总文章数量 4 篇</li>
<li>2015 年总文章数量 3 篇</li>
<li>2016 年总文章数量 4 篇</li>
<li>2017 年总文章数量 4 篇</li>
<li>2018 年总文章数量 6 篇</li>
<li>2019 年总文章数量 5 篇</li>
<li>2020 年总文章数量 0 篇</li>
<li>2021 年总文章数量 1 篇</li>
</ul>
]]></content:encoded></item><item><title>Hexo 主题推荐 NexT</title><link>https://icyleaf.com/2015/12/hexo-theme-next/</link><pubDate>Thu, 17 Dec 2015 14:41:00 +0800</pubDate><guid>https://icyleaf.com/2015/12/hexo-theme-next/</guid><description>或许是最近几年非常流行的主题之一</description><content:encoded><![CDATA[<p>这是我见过配备最完善的 hexo 主题，支持丰富的配置，和 hexo 一样完善的文档。兼容国内外的扩展服务，最重要的主题作者还是国人。</p>
<ul>
<li>文档：http://theme-next.iissnan.com/</li>
<li>源码：https://github.com/iissnan/hexo-theme-next</li>
</ul>
]]></content:encoded></item><item><title>极速化 CocoaPods</title><link>https://icyleaf.com/2015/01/speed-up-cocoapods/</link><pubDate>Tue, 20 Jan 2015 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2015/01/speed-up-cocoapods/</guid><description>iOS 组件仓库超时，网络环境不畅通该如何解，我来指点一二</description><content:encoded><![CDATA[<p><a href="http://cocoapods.org/">Cocopods</a> 本身是一个优秀的 iOS 开发的包管理工具，涵盖了 7k+ 的开源组件，包管理库是托管在 Github。
众所周知的原因它的速度日渐缓慢，有时会频繁报如下错误：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ pod install
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl">Cloning into <span class="s1">&#39;/path/to/ios/project/Pods/xxx&#39;</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">
</span></span><span class="line"><span class="ln">5</span><span class="cl">error: RPC failed<span class="p">;</span> <span class="nv">result</span><span class="o">=</span>52, HTTP <span class="nv">code</span> <span class="o">=</span> <span class="m">0</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">
</span></span><span class="line"><span class="ln">7</span><span class="cl">fatal: The remote end hung up unexpectedly
</span></span></code></pre></div><p>本文主要为解决该问题而诞生的，以下的加速方案不局限于目前已流传的优化方案，而是在此基础上<strong>彻底的加速</strong>！</p>
<ul>
<li>使用淘宝 Ruby Gems 源（Cocoapods 使用 ruby 开发）</li>
<li><code>pod install</code> 时不设置包的更新：<a href="http://phatblat.com/blog/2014/07/30/pod-install/">参考文章</a></li>
<li>使用国内 git 服务器镜像 Cocoapods Spec: <a href="http://blog.devtang.com/blog/2014/05/25/use-cocoapod-to-manage-ios-lib-dependency/">参考文章</a></li>
</ul>
<p>如果你对 Cocoapods 有更深层次的理解，请参见：<a href="http://www.objc.io/issue-6/cocoapods-under-the-hood.html">objc.io: Cocoapods under the hood</a> <a href="http://objccn.io/issue-6-4/">中文版本</a></p>
<p>今天早晨看到微博众多 iOS 开发者赞同转发《<a href="http://weibo.com/p/1001603800875490492754">CocoaPods最佳实践探讨</a>》一文，
针对 <code>Pods</code> 建议纳入版本控制也是无奈之举。之前公司项目中也是这样施行很长一段时间，不排除更新可能会造成很多无用信息&quot;刷屏&quot;，
偶尔还会因为版本冲突造成一些混乱状况需要处理。个人还是更倾向于精简原则，遵循<a href="http://guides.cocoapods.org/using/using-cocoapods.html#should-i-ignore-the-pods-directory-in-source-control">官方的建议</a>。</p>
<p>大家都是技术人员，其实这些小问题难道因为 github 倒下就没有解决方案了吗？！看我如何撕破这层纸老虎：</p>
<h3 id="技术概述">技术概述</h3>
<ul>
<li>Cocopods v0.34.0+</li>
<li>Gitlab: 自建私有 git 服务器</li>
<li>gitlab-mirrors: 专用于 github 镜像至 gitlab 并保持定期更新</li>
<li>rake: ruby 的代码构建工具（不懂 ruby 的可以把它理解为命令聚合工具）</li>
</ul>
<h3 id="技术剖析">技术剖析</h3>
<p>Cocoapods 自身支持<a href="http://guides.cocoapods.org/making/private-cocoapods.html">私有仓库</a>，
恰好的是就在前不久发布的 <a href="https://github.com/CocoaPods/CocoaPods/blob/master/CHANGELOG.md#0340">0.34.0</a> 版本支持 <code>Podfile</code>
添加多个的包源仓库，举个例子：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">source</span> <span class="s1">&#39;https://github.com/artsy/Specs.git&#39;</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="n">source</span> <span class="s1">&#39;https://github.com/CocoaPods/Specs.git&#39;</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="n">pod</span> <span class="s1">&#39;AFNetworking&#39;</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="n">pod</span> <span class="s1">&#39;Mantle&#39;</span>
</span></span></code></pre></div><p>这个特性其实是为了扩充官方 Spec 的同时可以更好的让开发者管理私有的公共组件，那我同样是从这里下手：</p>
<blockquote>
<p>前提是自己以及搭建好 gitlab 服务器：<a href="https://about.gitlab.com/downloads/">官方教程 （Ubuntu）</a> | <a href="http://icyleaf.com/2013/09/how-to-install-gitlab-on-centos/">本人教程 （CentOS）</a></p>
</blockquote>
<h4 id="自力更生">自力更生</h4>
<p>首先我们需要创建一个自己的 Spec 仓库，目录结构如下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">.
</span></span><span class="line"><span class="ln">2</span><span class="cl">├── CocoaPods-version.yml
</span></span><span class="line"><span class="ln">3</span><span class="cl">├── Specs/
</span></span><span class="line"><span class="ln">4</span><span class="cl">├── README.md
</span></span><span class="line"><span class="ln">5</span><span class="cl">├── Rakefile
</span></span><span class="line"><span class="ln">6</span><span class="cl">└── Gemfile
</span></span></code></pre></div><p>配置不做详细描述，这里比官方多了两个文件 <code>Rakefile</code> 和 <code>Gemfile</code> 都是 rake 所需的文件，这个后面会讲到。
再者就是配置 <a href="https://github.com/samrocketman/gitlab-mirrors#three-easy-steps">gitlab-mirrors</a>，教程很详细不再重复。</p>




<div class="updated">
  <header class="updated-header">
    <h4 class="updated-title">更新</h4>
    
    <p class="updated-meta">4月 18, 2022</p>
    
  </header>
  <article class="updated-body">
    gitlab-mirrors 的机制问题再使用其他会有很大的限制，我重新造了一个新轮子 <a href="https://icyleaf.com/2018/04/intro-hpr/">hpr</a> 通过 HTTP REST API + Docker 部署的方式更好的解决了这个问题。
  </article>
</div>


<h4 id="偷梁换柱">偷梁换柱</h4>
<p>利用私有 Spec 仓库特性，可以把官方 <code>Spec</code> 目录下面的包按需或全部镜像过来，再次基础上<strong>把里面涉及 github 的地址替换成 gitlab 的地址</strong></p>
<p>你没有看错，这是核心步骤，如果这步没有做那么和国内镜像的地址没有任何差别。核心代码如下：</p>
<h5 id="rakefile">Rakefile</h5>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nb">require</span> <span class="s1">&#39;uri&#39;</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="nb">require</span> <span class="s1">&#39;fileutils&#39;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="nb">require</span> <span class="s1">&#39;multi_json&#39;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="nb">require</span> <span class="s1">&#39;net/ssh&#39;</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="n">desc</span> <span class="s1">&#39;镜像一个 github 包至 gitlab 仓库&#39;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="n">task</span> <span class="ss">:clone</span><span class="p">,</span> <span class="o">[</span><span class="ss">:name</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="p">,</span> <span class="nb">p</span><span class="o">|</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  <span class="nb">name</span> <span class="o">=</span> <span class="nb">p</span><span class="o">[</span><span class="ss">:name</span><span class="o">]</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="n">current_path</span> <span class="o">=</span> <span class="no">Dir</span><span class="o">.</span><span class="n">pwd</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="n">specs</span> <span class="o">=</span> <span class="no">Dir</span><span class="o">[</span><span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="s1">&#39;~&#39;</span><span class="p">),</span> <span class="s1">&#39;.cocoapods/repos/master/Specs/*&#39;</span><span class="p">)</span><span class="o">]</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl">  <span class="n">repo</span> <span class="o">=</span> <span class="n">specs</span><span class="o">.</span><span class="n">select</span> <span class="p">{</span> <span class="o">|</span><span class="n">s</span><span class="o">|</span> <span class="no">File</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="nb">name</span> <span class="p">}</span><span class="o">.</span><span class="n">first</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl">  <span class="k">if</span> <span class="n">repo</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nb">puts</span> <span class="s2">&#34; * found repo, copy it here&#34;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="n">repo_store_path</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_path</span><span class="p">,</span> <span class="s1">&#39;Specs&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="no">FileUtils</span><span class="o">.</span><span class="n">cp_r</span> <span class="n">repo</span><span class="p">,</span> <span class="n">repo_store_path</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="nb">puts</span> <span class="s2">&#34; * updating repo url&#34;</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">    <span class="no">Dir</span><span class="o">[</span><span class="s2">&#34;</span><span class="si">#{</span><span class="n">repo_store_path</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">/*&#34;</span><span class="o">].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">      <span class="n">pod_file</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s2">&#34;</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">.podspec.json&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">      <span class="n">json</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">pod_file</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">      <span class="n">data</span> <span class="o">=</span> <span class="no">MultiJson</span><span class="o">.</span><span class="n">load</span> <span class="n">json</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">
</span></span><span class="line"><span class="ln">26</span><span class="cl">      <span class="k">if</span> <span class="n">data</span><span class="o">[</span><span class="s1">&#39;source&#39;</span><span class="o">][</span><span class="s1">&#39;git&#39;</span><span class="o">]</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">        <span class="nb">puts</span> <span class="s2">&#34; -&gt; </span><span class="si">#{</span><span class="n">data</span><span class="o">[</span><span class="s1">&#39;version&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">: git&#34;</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">        <span class="n">orginal_repo_url</span> <span class="o">=</span> <span class="n">data</span><span class="o">[</span><span class="s1">&#39;source&#39;</span><span class="o">][</span><span class="s1">&#39;git&#39;</span><span class="o">]</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">        <span class="n">coverted_repo_name</span> <span class="o">=</span>  <span class="no">URI</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">orginal_repo_url</span><span class="p">)</span><span class="o">.</span><span class="n">path</span><span class="o">[</span><span class="mi">1</span><span class="o">..-</span><span class="mi">1</span><span class="o">].</span><span class="n">gsub</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">downcase</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">        <span class="n">data</span><span class="o">[</span><span class="s1">&#39;source&#39;</span><span class="o">][</span><span class="s1">&#39;git&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&#34;http://gitlab.dev/mirrors/</span><span class="si">#{</span><span class="n">coverted_repo_name</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">
</span></span><span class="line"><span class="ln">32</span><span class="cl">        <span class="no">File</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pod_file</span><span class="p">,</span> <span class="no">JSON</span><span class="o">.</span><span class="n">pretty_generate</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">      <span class="k">else</span> <span class="n">data</span><span class="o">[</span><span class="s1">&#39;source&#39;</span><span class="o">][</span><span class="s1">&#39;http&#39;</span><span class="o">]</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">        <span class="nb">puts</span> <span class="s2">&#34; -&gt; </span><span class="si">#{</span><span class="n">data</span><span class="o">[</span><span class="s1">&#39;version&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">: http url, do you want speed up?&#34;</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">      <span class="k">else</span> <span class="n">data</span><span class="o">[</span><span class="s1">&#39;source&#39;</span><span class="o">][</span><span class="s1">&#39;svn&#39;</span><span class="o">]</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">        <span class="nb">puts</span> <span class="s2">&#34; -&gt; </span><span class="si">#{</span><span class="n">data</span><span class="o">[</span><span class="s1">&#39;version&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">: svn repo, do you want speed up?&#34;</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">      <span class="k">end</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">    <span class="k">end</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">    <span class="nb">puts</span> <span class="s2">&#34;Not find spec named: </span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">  <span class="k">end</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl"><span class="k">end</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">
</span></span><span class="line"><span class="ln">44</span><span class="cl"><span class="n">desc</span> <span class="s1">&#39;gitlab 服务器镜像 Cocoapod Spec&#39;</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl"><span class="n">task</span> <span class="ss">:mirror</span><span class="p">,</span> <span class="o">[</span><span class="ss">:repo</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="p">,</span> <span class="nb">p</span><span class="o">|</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl">  <span class="n">host</span>        <span class="o">=</span> <span class="s1">&#39;172..0.1&#39;</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl">  <span class="n">user</span>        <span class="o">=</span> <span class="s1">&#39;icyleaf&#39;</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl">  <span class="n">options</span>     <span class="o">=</span> <span class="p">{</span><span class="ss">:keys</span> <span class="o">=&gt;</span> <span class="s1">&#39;~/.ssh/keys/id_rsa.pub&#39;</span><span class="p">}</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl">
</span></span><span class="line"><span class="ln">50</span><span class="cl">  <span class="nb">puts</span> <span class="s2">&#34;Connect gitlab server and mirror&#34;</span>
</span></span><span class="line"><span class="ln">51</span><span class="cl">  <span class="no">Net</span><span class="o">::</span><span class="no">SSH</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">ssh</span><span class="o">|</span>
</span></span><span class="line"><span class="ln">52</span><span class="cl">    <span class="n">gitmirror_path</span> <span class="o">=</span> <span class="s1">&#39;/home/gitmirror/gitlab-mirrors&#39;</span>
</span></span><span class="line"><span class="ln">53</span><span class="cl">    <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&#34;sudo -u gitmirror -H rake </span><span class="se">\&#34;</span><span class="s2">add[</span><span class="si">#{</span><span class="nb">p</span><span class="o">[</span><span class="ss">:repo</span><span class="o">]</span><span class="si">}</span><span class="s2">]</span><span class="se">\&#34;</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="ln">54</span><span class="cl">    <span class="n">stdout</span> <span class="o">=</span> <span class="n">ssh</span><span class="o">.</span><span class="n">exec!</span><span class="p">(</span><span class="s2">&#34;echo &#39;cd </span><span class="si">#{</span><span class="n">gitmirror_path</span><span class="si">}</span><span class="s2"> &amp;&amp; </span><span class="si">#{</span><span class="n">cmd</span><span class="si">}</span><span class="s2">&#39;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">55</span><span class="cl">    <span class="nb">puts</span> <span class="n">stdout</span>
</span></span><span class="line"><span class="ln">56</span><span class="cl">    <span class="n">ssh</span><span class="o">.</span><span class="n">loop</span>
</span></span><span class="line"><span class="ln">57</span><span class="cl">  <span class="k">end</span>
</span></span><span class="line"><span class="ln">58</span><span class="cl"><span class="k">end</span>
</span></span></code></pre></div><h5 id="gemfile">Gemfile</h5>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">source</span> <span class="s2">&#34;https://ruby.taobao.org&#34;</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="n">gem</span> <span class="s1">&#39;rest_client&#39;</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="n">gem</span> <span class="s1">&#39;multi_json&#39;</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="n">gem</span> <span class="s1">&#39;rake&#39;</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="n">gem</span> <span class="s1">&#39;net-ssh&#39;</span>
</span></span></code></pre></div><p><code>rake</code> 里面有两个 task：</p>
<ul>
<li>mirror: 镜像 iOS 开源组件</li>
<li>clone: 负责把官方 spec 指定包（开源组件的版本控制）替换 gitlab 地址并加入到私有包仓库</li>
</ul>
<h3 id="总结">总结</h3>
<p>通过工具总有办法可以改进和提升开发者的效率和解决各种的问题，希望本文可以给大家带来更多的灵感！</p>
<h3 id="答疑解惑">答疑解惑</h3>
<h5 id="f-这套理论靠谱吗">F: 这套理论靠谱吗？</h5>
<p>A: 目前我们团队已经采用并运行了很长一段时间，没有任何风险。最大的优势在于兼容官方的仓库，
就算无法链接自己的私有服务器，使用官方和国内镜像的都可以瞬间切换。</p>
<h5 id="f-如果没有服务器可以实现吗">F: 如果没有服务器可以实现吗？</h5>
<p>A: 醒醒吧孩子，就连单纯的镜像官方 Cocoapods Spec 还需要一个服务器执行定期同步脚本呢。</p>
<h5 id="f-国内-git-托管服务器能够支持吗">F: 国内 git 托管服务器能够支持吗？</h5>
<p>A: 据我所知国内大部分 git 托管服务器的解决方案都是基于 gitlab 二次开发的，理论上可行，
上面提到的 gitlab-mirror 本身依赖于 gitlab 的 api 在镜像的同时自动新建仓库。如果有成功的欢迎反馈。</p>
<h5 id="f-我从你代码发现服务器同样调用了一个-rake-脚本你没有开源">F: 我从你代码发现服务器同样调用了一个 rake 脚本，你没有开源！</h5>
<p>A: 眼睛真够敏锐的，个人对 gitlab-mirror 再做镜像时做了一个约束，新建一个 <code>Rakefile</code> 文件放到你的 gitlab-mirror 项目根目录即可：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nb">require</span> <span class="s1">&#39;uri&#39;</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="n">desc</span> <span class="s2">&#34;Adding repo to gitmirror&#34;</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="n">task</span> <span class="ss">:add</span><span class="p">,</span> <span class="o">[</span><span class="ss">:repo</span><span class="o">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="p">,</span> <span class="nb">p</span><span class="o">|</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="n">repo</span> <span class="o">=</span> <span class="nb">p</span><span class="o">[</span><span class="ss">:repo</span><span class="o">]</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="k">begin</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="nb">name</span> <span class="o">=</span> <span class="no">URI</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">repo</span><span class="p">)</span><span class="o">.</span><span class="n">path</span><span class="o">[</span><span class="mi">1</span><span class="o">..-</span><span class="mi">1</span><span class="o">].</span><span class="n">gsub</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="s1">&#39;.git&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="k">if</span> <span class="nb">name</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">      <span class="sb">`./add_mirror.sh -f --git --project-name </span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="sb"> --mirror </span><span class="si">#{</span><span class="n">repo</span><span class="si">}</span><span class="sb">`</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="k">end</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="k">rescue</span> <span class="no">Error</span> <span class="o">=&gt;</span> <span class="n">e</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="nb">puts</span> <span class="s1">&#39;not url&#39;</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">  <span class="k">end</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="k">end</span>
</span></span></code></pre></div><h5 id="f-我还有问题">F: 我还有问题！</h5>
<p>A: 麻烦请留言，谢谢！</p>
]]></content:encoded></item><item><title>Puma 替换 Unicorn 跑 Gitlab</title><link>https://icyleaf.com/2014/01/moving-unicorn-to-puma-on-gitlab/</link><pubDate>Sun, 26 Jan 2014 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2014/01/moving-unicorn-to-puma-on-gitlab/</guid><description>用 Ruby 编写的 Puma 网关才是未来</description><content:encoded><![CDATA[<p>前篇介绍到如何在《<a href="http://icyleaf.com/2013/09/how-to-install-gitlab-on-centos/">CentoOS 上面安装 Gitlab</a>》一文，gitlab 默认使用的是 <code>unicorn</code> 作为内部的 app server，再用 <code>nginx</code> 做代理转发。之前是在公司内部搭建了一个平台，用着还算可以。有打算在 <a href="https://www.linode.com/?r=66b0730eca572d3e45f083e29b1b3f8781b2a009">Linode 购买的 VPS</a> 上面，使用 <code>unicorn</code> 跑服务的时候 <code>ruby</code> 的进程居然占了 400-500M 左右，对于 Linode 刚刚免费升级之后才有 1G 内存的环境上，我还真有点放弃安装它的欲望。于是在想是否可以使用 <code>puma</code> 替换掉原先的。</p>
<h2 id="puma">puma</h2>
<p>简单介绍下 <a href="http://puma.io/"><code>puma</code></a>，它是一个由 ruby 编写的转为 <a href="http://rack.github.io/"><code>rack</code></a> 设计的 app server，在性能和资源占有上却有极大的优势（下表数据来自官方）</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="ln">1</span><span class="cl">PUMA - 78 Mb
</span></span><span class="line"><span class="ln">2</span><span class="cl">RAINBOWS! (1X16) - 120 Mb
</span></span><span class="line"><span class="ln">3</span><span class="cl">UNICORN - 1076 Mb
</span></span><span class="line"><span class="ln">4</span><span class="cl">RAINBOWS! (16X32) - 1138 Mb
</span></span></code></pre></div><p>而且集成也非常的简单，若使用 rails 或者 sinatra（及 padrino）都已经支持，直接 <code>gem install puma</code>，然后跑默认的 <code>rails/padrino server</code> 会自动加载。</p>
<h2 id="教程">教程</h2>
<p>Okay，经过一番查找，官方在收集的 <a href="https://gitlab.com/gitlab-org/gitlab-recipes/tree/master">repices</a> 里面有关于 <code>puma</code> 的一些配置。他们也是收集的非官方资料，里面的资料只有借鉴意义，真正拿来用的时候各种问题，所以才有了本篇文字。</p>
<p>首先是关闭启动的 <code>gitlab</code> 服务</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ <span class="o">(</span>sudo<span class="o">)</span> service gitlab stop
</span></span></code></pre></div><p>关闭之后，添加 puma gem，打开 <code>Gemfile</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">group</span> <span class="ss">:unicorn</span> <span class="k">do</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="n">gem</span> <span class="s1">&#39;unicorn&#39;</span><span class="p">,</span> <span class="s1">&#39;~&gt; 4.6.3&#39;</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">	<span class="n">gem</span> <span class="s1">&#39;unicorn-worker-killer&#39;</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="k">end</span>
</span></span></code></pre></div><p>找到上面的这段 group 替换成：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">gem</span> <span class="s1">&#39;puma&#39;</span>
</span></span></code></pre></div><p>再者修改 <code>config.ru</code>，把下面这段代码做下替换，删除 unicorn 的代码，加载 puma：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">unless</span> <span class="n">defined?</span><span class="p">(</span><span class="no">PhusionPassenger</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="nb">require</span> <span class="s1">&#39;unicorn&#39;</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">  <span class="c1"># Unicorn self-process killer</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">  <span class="nb">require</span> <span class="s1">&#39;unicorn/worker_killer&#39;</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">  <span class="c1"># Max memory size (RSS) per worker</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">  <span class="n">use</span> <span class="no">Unicorn</span><span class="o">::</span><span class="no">WorkerKiller</span><span class="o">::</span><span class="no">Oom</span><span class="p">,</span> <span class="p">(</span><span class="mi">200</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">20</span><span class="p">)),</span> <span class="p">(</span><span class="mi">250</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">20</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="k">end</span>
</span></span></code></pre></div><p>更新成</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="ln">1</span><span class="cl"><span class="k">unless</span> <span class="n">defined?</span><span class="p">(</span><span class="no">PhusionPassenger</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="nb">require</span> <span class="s1">&#39;puma&#39;</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="k">end</span>
</span></span></code></pre></div><p>替换完毕更新 <code>gem</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1"># mysql 数据库</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">bundle install --without development <span class="nb">test</span> postgres --path vendor/bundle --no-deployment
</span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="c1"># postgres 数据库</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">bundle install --without development <span class="nb">test</span> mysql --path vendor/bundle --no-deployment
</span></span></code></pre></div><p>最后还有两处需要修改，添加 <code>config/puma.rb</code>（替代 <code>config/unicorn.rb</code>） 以及替换 <code>/etc/init.d/gitlab</code> 服务脚本代码。</p>
<p><code>config/puma.rb</code>的代码在<a href="https://gitlab.com/gitlab-org/gitlab-recipes/blob/master/app-server/puma/puma.rb">这里可以下载</a>，无需做任何的修改。</p>
<p><code>/etc/init.d/gitlab</code> 服务脚本：<a href="https://gitlab.com/gitlab-org/gitlab-recipes/tree/master/init/sysvinit/centos">CentOS</a> | <a href="https://gitlab.com/gitlab-org/gitlab-recipes/tree/master/init/sysvinit/debian">Debian(Ubuntu)</a></p>
<blockquote>
<p>服务脚本需要设置下执行权限： chmod +x /etc/init.d/gitlab</p>
</blockquote>
<p>最后开启服务应该就完美了</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ <span class="o">(</span>sudo<span class="o">)</span> service gitlab start
</span></span></code></pre></div><h2 id="我想用-apache-怎么办">我想用 Apache 怎么办？</h2>
<p>嗯，我没尝试过，官方有提供收集的资料，<a href="https://gitlab.com/gitlab-org/gitlab-recipes/tree/master/web-server">自己查看下吧</a>，记得要活学活用，直接套肯定会出问题的。</p>
]]></content:encoded></item><item><title>Homebrew 隐藏命令</title><link>https://icyleaf.com/2014/01/homebrew-hidden-commands/</link><pubDate>Sat, 25 Jan 2014 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2014/01/homebrew-hidden-commands/</guid><description>适用于 macOS 服务下的小秘密</description><content:encoded><![CDATA[<p><a href="http://brew.sh">Homebrew</a> 可谓是 Mac 开发者必备的工具之一，它承载在各种包管理的特性以及拥有一票热情高涨的社区提供强大支持。今天我就给大家解密一下 brew 内部的隐藏命令都有哪些。</p>
<h2 id="服务管理">服务管理</h2>
<p>当我们安装了众多需要挂载的服务，需要重启或停止的时候，都特别希望 Mac 可以有个统一的命令可以管理服务的状态，比如 <code>services</code> 命令甚至说 <code>/etc/init.d/</code> 也可以啊！</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln"> 1</span><span class="cl">$ brew services <span class="nb">command</span> <span class="o">[</span>formula<span class="o">]</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">usage: <span class="o">[</span>sudo<span class="o">]</span> brew services <span class="o">[</span>--help<span class="o">]</span> &lt;command&gt; <span class="o">[</span>&lt;formula&gt;<span class="o">]</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">Small wrapper around <span class="sb">`</span>launchctl<span class="sb">`</span> <span class="k">for</span> supported formulae, commands available:
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">	cleanup Get rid of stale services and unused plists
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">	list    List all services managed by <span class="sb">`</span>brew services<span class="sb">`</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">	restart Gracefully restart selected service
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">	start   Start selected service
</span></span><span class="line"><span class="ln">10</span><span class="cl">	stop    Stop selected service
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">Options, sudo and paths:
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">sudo   When run as root, operates on /Library/LaunchDaemons <span class="o">(</span>run at boot!<span class="o">)</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">Run at boot:  /Library/LaunchDaemons
</span></span><span class="line"><span class="ln">16</span><span class="cl">Run at login: /Users/icyleaf/Library/LaunchAgents
</span></span></code></pre></div><p>这个是我要讲的第一个隐藏命令！太坑爹了，那么实用的命令居然没有包含在 <code>brew --help</code> 帮助里面！我们再也不用发愁记住 <code>launchctl load/unload &lt;path&gt;</code> 的坑爹命令了！</p>
<p>重启 Nigix 就那么简单：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ brew services restart nginx
</span></span></code></pre></div><p>停止 Postgresql 服务</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ brew services stop mysql
</span></span></code></pre></div><p>查看系统通过 brew 安装的服务：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ brew services list
</span></span><span class="line"><span class="ln">2</span><span class="cl">postgresql started        - /Users/icyleaf/Library/LaunchAgents/homebrew.mxcl.postgresql.plist
</span></span><span class="line"><span class="ln">3</span><span class="cl">nginx      started        - /Users/icyleaf/Library/LaunchAgents/homebrew.mxcl.nginx.plist
</span></span></code></pre></div><p>清除已卸载无用的启动配置文件：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ brew services cleanup
</span></span><span class="line"><span class="ln">2</span><span class="cl">Removing unused plist /Users/icyleaf/Library/LaunchAgents/homebrew.mxcl.mysql.plist
</span></span><span class="line"><span class="ln">3</span><span class="cl">Removing unused plist /Users/icyleaf/Library/LaunchAgents/homebrew.mxcl.redis.plist
</span></span></code></pre></div><h2 id="安装扩展">安装扩展</h2>
<p>这个相信很多人都已经用到过了，安装他人扩展的 brew 服务。由于 brew 和包含的包源都是通过 github 来管理，人为的维护管理，除了自己的源还允许别人的源添加进来。类似与 <code>Ubuntu</code> 的 <code>ppa</code>。好处在于只有我安装规定的方式把包丢到 github 上面就可以用了！</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ brew tap &lt;gihhub_user/repo&gt;
</span></span></code></pre></div><p>这个命令并没有包含任何的帮助说明，其实它只接受上面的这个参数。</p>
<p>举例说明一下，Mac OS 比较歧视 PHP ，所以每次系统更新都会把常用的开发包（Ruby、Python 等）也顺带着更新到最新版本。（吐槽：Java 都已经被抛弃不再默认安装了），而 <code>brew</code> 居然也不包含 <code>PHP</code> 的包，那怎么办呢？</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ brew tap josegonzalez/php
</span></span></code></pre></div><p>命令完成之后，执行（当前最新是 php 5.5 版本，请根据需要替换）</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ brew install php55
</span></span></code></pre></div><p>当我们没有传递任何参数，默认显示已经通过 <code>tap</code> 安装了哪些扩展，为什么我说是通过 <code>tap</code> 呢，因为 <code>brew</code> 其实除了这些自身也用了一些其他扩展，通过下面命令显示：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ brew ls-taps
</span></span></code></pre></div><h2 id="web-化显示可用包和已安装工具">Web 化显示可用包和已安装工具</h2>
<p>对于习惯命令行的人这个用途不大，就顺带一提而已，这个命令依赖 <code>sinatra</code>，大家通过 <code>gem</code> 安装即可。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ brew server
</span></span></code></pre></div><blockquote>
<p>如果你用 <code>puma</code> 可能报一个 <strong>[BUG] Segmentation fault</strong> 错误，那是因为你通过 rvm 或 renv 安装了跟高级的版本，而系统却用的 1.8.7 造成了版本差，请切换为系统依赖后再重试（你可能需要重新安装 sinata）：</p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ rvm use system
</span></span><span class="line"><span class="ln">2</span><span class="cl">$ /usr/bin/gem install sinatra
</span></span></code></pre></div><h2 id="彩蛋">彩蛋</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ brew beer
</span></span></code></pre></div><h2 id="更多隐藏命令">更多隐藏命令</h2>
<p>一次性没太多精力完解读所有隐藏命令，这个艰巨的任务就交给大家了：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ brew commands
</span></span></code></pre></div><p>其实这些命令可以在<a href="https://github.com/Homebrew/homebrew/tree/master/Library/Contributions/cmd">官方源代码</a>看到。</p>
]]></content:encoded></item><item><title>初识 Ruby Gem Guard</title><link>https://icyleaf.com/2014/01/intro-ruby-gem-guard/</link><pubDate>Sat, 25 Jan 2014 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2014/01/intro-ruby-gem-guard/</guid><description>撰写规则帮你监听文件系统变更做出对应的行动</description><content:encoded><![CDATA[<p><a href="http://guardgem.org">Guard</a> 是一个很好的 Web 辅助开发工具，因为看了 tutsplus 网站的介绍视频：<a href="http://net.tutsplus.com/tutorials/tools-and-tips/guard-is-your-best-friend/">Guard is your best firend</a>。这里把视频的东西提取出来自我消化：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ gem install guard
</span></span></code></pre></div><p>它实际的工作就像名字那样，实时守卫这某些文件并做出对应的操作，本质上相当于一个有这个思想的禁卫兵，通过指派命令（安装扩展 gem）而负责守卫和执行，比如视频中提到的：</p>
<p>上面是概念的理解，实际上的流程是，设定一系列的规则，让他监控文件内容（修改时间）的动态，一旦发生变化则根据不同的命令执行不同的操作。</p>
<p>具体基本操作不再多少，官方 <a href="https://github.com/guard/guard">README</a> 写的非常详细，或者通过上面视频也能熟悉。</p>
<h2 id="guard-sass">guard-sass</h2>
<p>监听 <a href="http://sass-lang.com/">sass</a> 文件并转换成 css 文件</p>
<h2 id="guard-coffeescript">guard-coffeescript</h2>
<p>监听 <a href="http://coffeescript.org/">coffeescript</a> 文件并转换成 js 文件</p>
<h2 id="guard-rspec">guard-rspec</h2>
<p>自动跑 <a href="https://github.com/rspec/rspec-core">rspec</a> test</p>
<h2 id="guard-livereload">guard-livereload</h2>
<p>配合浏览器的辅助工具，做到无需手动刷新页面即可看到 html/css/js 的修改变化，浏览器需要安装配套插件。</p>
<h2 id="guard-zeus">guard-zeus</h2>
<p>自动接管 <a href="https://github.com/burke/zeus">zeus</a></p>
<h2 id="guard-puma">guard-puma</h2>
<p><a href="http://puma.io">puma</a> 是目前比较新的一个 web 服务器，这个扩展可以监听配置变化从而自动重启服务器。</p>
<p>官方列举的所有扩展：<a href="https://github.com/guard/guard/wiki/List-of-available-Guards">List of available Guards</a></p>
]]></content:encoded></item><item><title>Linux 101 系列：ssh OpenSSH 客户端工具</title><link>https://icyleaf.com/2014/01/linux-101-ssh/</link><pubDate>Wed, 22 Jan 2014 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2014/01/linux-101-ssh/</guid><description>当你敲下 ssh 为什么没连接成功到远程服务器</description><content:encoded><![CDATA[<blockquote>
<p>使用 *nix 服务器肯定会用到 ssh，它是一个链接到远程服务器终端的工具。</p>
</blockquote>
<h2 id="基本常识">基本常识</h2>
<h3 id="基本组成部分">基本组成部分</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ man ssh
</span></span><span class="line"><span class="ln">2</span><span class="cl">ssh <span class="o">[</span>-1246AaCfgKkMNnqsTtVvXxYy<span class="o">]</span> <span class="o">[</span>-b bind_address<span class="o">]</span> <span class="o">[</span>-c cipher_spec<span class="o">]</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">     <span class="o">[</span>-D <span class="o">[</span>bind_address:<span class="o">]</span>port<span class="o">]</span> <span class="o">[</span>-e escape_char<span class="o">]</span> <span class="o">[</span>-F configfile<span class="o">]</span> <span class="o">[</span>-I pkcs11<span class="o">]</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">     <span class="o">[</span>-i identity_file<span class="o">]</span> <span class="o">[</span>-L <span class="o">[</span>bind_address:<span class="o">]</span>port:host:hostport<span class="o">]</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">     <span class="o">[</span>-l login_name<span class="o">]</span> <span class="o">[</span>-m mac_spec<span class="o">]</span> <span class="o">[</span>-O ctl_cmd<span class="o">]</span> <span class="o">[</span>-o option<span class="o">]</span> <span class="o">[</span>-p port<span class="o">]</span>
</span></span><span class="line"><span class="ln">6</span><span class="cl">     <span class="o">[</span>-R <span class="o">[</span>bind_address:<span class="o">]</span>port:host:hostport<span class="o">]</span> <span class="o">[</span>-S ctl_path<span class="o">]</span> <span class="o">[</span>-W host:port<span class="o">]</span>
</span></span><span class="line"><span class="ln">7</span><span class="cl">     <span class="o">[</span>-w local_tun<span class="o">[</span>:remote_tun<span class="o">]]</span> <span class="o">[</span>user@<span class="o">]</span>hostname <span class="o">[</span>command<span class="o">]</span>
</span></span></code></pre></div><p>有没有被帮助手册的参数吓到，那我们精简一下：</p>
<blockquote>
<p>ssh [user@]hostname [-p port]</p>
</blockquote>
<p>登录到远程服务器和登录本地电脑系统没什么大的区别，都需要用户名，密码，除此之外我们还需要知道远程服务器的地址（IP 地址或域名均可）及允许的端口（默认 22 端口）。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ ssh root@10.10.10.10 -p <span class="m">22</span>
</span></span></code></pre></div><p>有些时候大家发现一些教程没有提到用户，实际上 ssh 很聪明，默认会使用当前系统的用户名：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl"><span class="o">(</span>icyleaf<span class="o">)</span> $ ssh 10.10.10.10
</span></span></code></pre></div><p>这个就等同于</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ ssh icyleaf@10.10.10.10
</span></span></code></pre></div><p>有些服务器可能为了安全期间修改了默认的端口，比如 2020：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ ssh icyleaf@10.10.10.10 -p <span class="m">2020</span>
</span></span></code></pre></div><h3 id="高级参数">高级参数</h3>
<h4 id="socket-代理">Socket 代理</h4>
<p>呐，你可能因为 GFW 的威力，尝试使用 ssh 的 socket 代理，实际上就是用到的 <code>-D</code> 参数：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">-D <span class="o">[</span>bind_address:<span class="o">]</span>port
</span></span><span class="line"><span class="ln">2</span><span class="cl">   Specifies a <span class="nb">local</span> <span class="sb">``</span>dynamic application-level port forwarding.
</span></span><span class="line"><span class="ln">3</span><span class="cl">   This works by allocating a socket to listen to port on the <span class="nb">local</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">   side, optionally bound to the specified bind_address.  Whenever a
</span></span><span class="line"><span class="ln">5</span><span class="cl">   connection is made to this port, the connection is forwarded over
</span></span><span class="line"><span class="ln">6</span><span class="cl">   the secure channel, and the application protocol is <span class="k">then</span> used to
</span></span><span class="line"><span class="ln">7</span><span class="cl">   determine where to connect to from the remote machine.  Currently
</span></span><span class="line"><span class="ln">8</span><span class="cl">   the SOCKS4 and SOCKS5 protocols are supported, and ssh will act
</span></span><span class="line"><span class="ln">9</span><span class="cl">   as a SOCKS server.  Only root can forward privileged ports.
</span></span></code></pre></div><p>我们来简单画下它的工作流程：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="ln">1</span><span class="cl">|----client----|                    |-----server----|
</span></span><span class="line"><span class="ln">2</span><span class="cl">|              |                    |               |
</span></span><span class="line"><span class="ln">3</span><span class="cl">|   local port&lt;|  &lt;incoming         |               |
</span></span><span class="line"><span class="ln">4</span><span class="cl">|    ssh port&lt;&gt;|  &lt;--------------&gt;  |&lt;&gt; ssh port    |
</span></span><span class="line"><span class="ln">5</span><span class="cl">                                    |    forwarding&gt;|  &gt;outgoing connection
</span></span><span class="line"><span class="ln">6</span><span class="cl">
</span></span><span class="line"><span class="ln">7</span><span class="cl">                                     &lt;&lt;&lt;------------local network-----------
</span></span></code></pre></div><p>它首先需要登录到远程服务器，并把本地的请求全部转发到服务器指定的端口上，然后通过由服务器再去请求。例如我们设置 8624 端口：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ ssh -D8624 icyleaf@10.10.10.10 -p <span class="m">22</span>
</span></span></code></pre></div><p>这样保持这个连接，我们在设置浏览器或系统的 socket4/5 代理就能达到翻墙的目的。当前这个最大的前提是你的服务器在不手 GFW 的控制下（任意海外未被 GFW 服务器）</p>
<h4 id="跳板代理">跳板代理</h4>
<p>或许曾经你在看某本黑客杂志或电影出现过这样的片段，黑客使用肉鸡跳板不断的增加难度避开警察的追踪，实际上我们通过 ssh 也能非常简单又很酷的实现。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="ln">1</span><span class="cl">-L [bind_address:]port:host:hostport
</span></span><span class="line"><span class="ln">2</span><span class="cl">   Specifies that the given port on the local (client) host is to be
</span></span><span class="line"><span class="ln">3</span><span class="cl">   forwarded to the given host and port on the remote side.  This
</span></span><span class="line"><span class="ln">4</span><span class="cl">   works by allocating a socket to listen to port on the local side,
</span></span><span class="line"><span class="ln">5</span><span class="cl">   optionally bound to the specified bind_address.  Whenever a con-
</span></span><span class="line"><span class="ln">6</span><span class="cl">   nection is made to this port, the connection is forwarded over
</span></span><span class="line"><span class="ln">7</span><span class="cl">   the secure channel, and a connection is made to host port
</span></span><span class="line"><span class="ln">8</span><span class="cl">   hostport from the remote machine.
</span></span></code></pre></div><p>同样给出工作流程：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="ln">1</span><span class="cl">|----client----|                    |-----server----|                 |-----host-----|
</span></span><span class="line"><span class="ln">2</span><span class="cl">|              |                    |               |                 |              |
</span></span><span class="line"><span class="ln">3</span><span class="cl">|   local port&lt;|  &lt;incoming         |               |                 |              |
</span></span><span class="line"><span class="ln">4</span><span class="cl">|    ssh port&lt;&gt;|  &lt;--------------&gt;  |&lt;&gt; ssh port    |                 |              |
</span></span><span class="line"><span class="ln">5</span><span class="cl">                                    |    forwarding&gt;|  -------------&gt; |&gt;host port    |
</span></span><span class="line"><span class="ln">6</span><span class="cl">
</span></span><span class="line"><span class="ln">7</span><span class="cl">                                     &lt;&lt;&lt;------------local network-------------------&gt;&gt;&gt;
</span></span></code></pre></div><p>实际上我只需要操作 <code>-L [bind_address:]port:host:hostport</code> 即可。这里假设我们想登录的目标服务器 target(10.10.10.10)，而我们希望在肉鸡 chicken(20.20.20.20) 上做成跳板：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ ssh -L2020:20.20.20.20:22 10.10.10.10
</span></span></code></pre></div><h3 id="简化配置">简化配置</h3>
<p>反复的输入这些繁琐的参数，甚是苦恼，能不能通过一种起个别名就能把上面的参数全部自动设置好呢？！没问题！</p>
<p>创建 <code>~/.ssh/config</code> 文件：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">Host linode
</span></span><span class="line"><span class="ln">2</span><span class="cl">HostName 10.10.10.10
</span></span><span class="line"><span class="ln">3</span><span class="cl">Port <span class="m">22</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">User icyleaf
</span></span></code></pre></div><p>这个就是基本组成部分。如果你想配置更多，下面是完整的参数：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="ln"> 1</span><span class="cl">AddressFamily
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">BatchMode
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">BindAddress
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">ChallengeResponseAuthentication
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">CheckHostIP
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">Cipher
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">Ciphers
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">ClearAllForwardings
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">Compression
</span></span><span class="line"><span class="ln">10</span><span class="cl">CompressionLevel
</span></span><span class="line"><span class="ln">11</span><span class="cl">ConnectionAttempts
</span></span><span class="line"><span class="ln">12</span><span class="cl">ConnectTimeout
</span></span><span class="line"><span class="ln">13</span><span class="cl">ControlMaster
</span></span><span class="line"><span class="ln">14</span><span class="cl">ControlPath
</span></span><span class="line"><span class="ln">15</span><span class="cl">ControlPersist
</span></span><span class="line"><span class="ln">16</span><span class="cl">DynamicForward
</span></span><span class="line"><span class="ln">17</span><span class="cl">EscapeChar
</span></span><span class="line"><span class="ln">18</span><span class="cl">ExitOnForwardFailure
</span></span><span class="line"><span class="ln">19</span><span class="cl">ForwardAgent
</span></span><span class="line"><span class="ln">20</span><span class="cl">ForwardX11
</span></span><span class="line"><span class="ln">21</span><span class="cl">ForwardX11Timeout
</span></span><span class="line"><span class="ln">22</span><span class="cl">ForwardX11Trusted
</span></span><span class="line"><span class="ln">23</span><span class="cl">GatewayPorts
</span></span><span class="line"><span class="ln">24</span><span class="cl">GlobalKnownHostsFile
</span></span><span class="line"><span class="ln">25</span><span class="cl">GSSAPIAuthentication
</span></span><span class="line"><span class="ln">26</span><span class="cl">GSSAPIDelegateCredentials
</span></span><span class="line"><span class="ln">27</span><span class="cl">HashKnownHosts
</span></span><span class="line"><span class="ln">28</span><span class="cl">Host
</span></span><span class="line"><span class="ln">29</span><span class="cl">HostbasedAuthentication
</span></span><span class="line"><span class="ln">30</span><span class="cl">HostKeyAlgorithms
</span></span><span class="line"><span class="ln">31</span><span class="cl">HostKeyAlias
</span></span><span class="line"><span class="ln">32</span><span class="cl">HostName
</span></span><span class="line"><span class="ln">33</span><span class="cl">IdentityFile
</span></span><span class="line"><span class="ln">34</span><span class="cl">IdentitiesOnly
</span></span><span class="line"><span class="ln">35</span><span class="cl">IPQoS
</span></span><span class="line"><span class="ln">36</span><span class="cl">KbdInteractiveAuthentication
</span></span><span class="line"><span class="ln">37</span><span class="cl">KbdInteractiveDevices
</span></span><span class="line"><span class="ln">38</span><span class="cl">KexAlgorithms
</span></span><span class="line"><span class="ln">39</span><span class="cl">LocalCommand
</span></span><span class="line"><span class="ln">40</span><span class="cl">LocalForward
</span></span><span class="line"><span class="ln">41</span><span class="cl">LogLevel
</span></span><span class="line"><span class="ln">42</span><span class="cl">MACs
</span></span><span class="line"><span class="ln">43</span><span class="cl">NoHostAuthenticationForLocalhost
</span></span><span class="line"><span class="ln">44</span><span class="cl">NumberOfPasswordPrompts
</span></span><span class="line"><span class="ln">45</span><span class="cl">PasswordAuthentication
</span></span><span class="line"><span class="ln">46</span><span class="cl">PermitLocalCommand
</span></span><span class="line"><span class="ln">47</span><span class="cl">PKCS11Provider
</span></span><span class="line"><span class="ln">48</span><span class="cl">Port
</span></span><span class="line"><span class="ln">49</span><span class="cl">PreferredAuthentications
</span></span><span class="line"><span class="ln">50</span><span class="cl">Protocol
</span></span><span class="line"><span class="ln">51</span><span class="cl">ProxyCommand
</span></span><span class="line"><span class="ln">52</span><span class="cl">PubkeyAuthentication
</span></span><span class="line"><span class="ln">53</span><span class="cl">RekeyLimit
</span></span><span class="line"><span class="ln">54</span><span class="cl">RemoteForward
</span></span><span class="line"><span class="ln">55</span><span class="cl">RequestTTY
</span></span><span class="line"><span class="ln">56</span><span class="cl">RhostsRSAAuthentication
</span></span><span class="line"><span class="ln">57</span><span class="cl">RSAAuthentication
</span></span><span class="line"><span class="ln">58</span><span class="cl">SendEnv
</span></span><span class="line"><span class="ln">59</span><span class="cl">ServerAliveInterval
</span></span><span class="line"><span class="ln">60</span><span class="cl">ServerAliveCountMax
</span></span><span class="line"><span class="ln">61</span><span class="cl">StrictHostKeyChecking
</span></span><span class="line"><span class="ln">62</span><span class="cl">TCPKeepAlive
</span></span><span class="line"><span class="ln">63</span><span class="cl">Tunnel
</span></span><span class="line"><span class="ln">64</span><span class="cl">TunnelDevice
</span></span><span class="line"><span class="ln">65</span><span class="cl">UsePrivilegedPort
</span></span><span class="line"><span class="ln">66</span><span class="cl">User
</span></span><span class="line"><span class="ln">67</span><span class="cl">UserKnownHostsFile
</span></span><span class="line"><span class="ln">68</span><span class="cl">VerifyHostKeyDNS
</span></span><span class="line"><span class="ln">69</span><span class="cl">VisualHostKey
</span></span><span class="line"><span class="ln">70</span><span class="cl">XAuthLocation
</span></span></code></pre></div><h3 id="配置文件">配置文件</h3>
<p>刚才讲到的 <code>~/.ssh/config</code> 是配置 ssh 服务器的文件，其实除了这些还有好多，比如大家可能会经常见到的：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="ln"> 1</span><span class="cl">~/.ssh/config
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  This is the per-user configuration file.  The file format and
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  configuration options are described in ssh_config(5).  Because of
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  the potential for abuse, this file must have strict permissions:
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  read/write for the user, and not accessible by others.
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">~/.ssh/authorized_keys
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  Lists the public keys (DSA/ECDSA/RSA) that can be used for log-
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  ging in as this user.  The format of this file is described in
</span></span><span class="line"><span class="ln">10</span><span class="cl">  the sshd(8) manual page.  This file is not highly sensitive, but
</span></span><span class="line"><span class="ln">11</span><span class="cl">  the recommended permissions are read/write for the user, and not
</span></span><span class="line"><span class="ln">12</span><span class="cl">  accessible by others.
</span></span><span class="line"><span class="ln">13</span><span class="cl">
</span></span><span class="line"><span class="ln">14</span><span class="cl">~/.ssh/identity
</span></span><span class="line"><span class="ln">15</span><span class="cl">~/.ssh/id_dsa
</span></span><span class="line"><span class="ln">16</span><span class="cl">~/.ssh/id_ecdsa
</span></span><span class="line"><span class="ln">17</span><span class="cl">~/.ssh/id_rsa
</span></span><span class="line"><span class="ln">18</span><span class="cl">  Contains the private key for authentication.  These files contain
</span></span><span class="line"><span class="ln">19</span><span class="cl">  sensitive data and should be readable by the user but not acces-
</span></span><span class="line"><span class="ln">20</span><span class="cl">  sible by others (read/write/execute).  ssh will simply ignore a
</span></span><span class="line"><span class="ln">21</span><span class="cl">  private key file if it is accessible by others.  It is possible
</span></span><span class="line"><span class="ln">22</span><span class="cl">  to specify a passphrase when generating the key which will be
</span></span><span class="line"><span class="ln">23</span><span class="cl">  used to encrypt the sensitive part of this file using 3DES.
</span></span><span class="line"><span class="ln">24</span><span class="cl">
</span></span><span class="line"><span class="ln">25</span><span class="cl">~/.ssh/identity.pub
</span></span><span class="line"><span class="ln">26</span><span class="cl">~/.ssh/id_dsa.pub
</span></span><span class="line"><span class="ln">27</span><span class="cl">~/.ssh/id_ecdsa.pub
</span></span><span class="line"><span class="ln">28</span><span class="cl">~/.ssh/id_rsa.pub
</span></span><span class="line"><span class="ln">29</span><span class="cl">  Contains the public key for authentication.  These files are not
</span></span><span class="line"><span class="ln">30</span><span class="cl">  sensitive and can (but need not) be readable by anyone.
</span></span><span class="line"><span class="ln">31</span><span class="cl">
</span></span><span class="line"><span class="ln">32</span><span class="cl">~/.ssh/known_hosts
</span></span><span class="line"><span class="ln">33</span><span class="cl">  Contains a list of host keys for all hosts the user has logged
</span></span><span class="line"><span class="ln">34</span><span class="cl">  into that are not already in the systemwide list of known host
</span></span><span class="line"><span class="ln">35</span><span class="cl">  keys.  See sshd(8) for further details of the format of this
</span></span><span class="line"><span class="ln">36</span><span class="cl">  file.
</span></span></code></pre></div><p>更多文件：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="ln"> 1</span><span class="cl">~/.rhosts
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  This file is used for host-based authentication (see above).  On
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  some machines this file may need to be world-readable if the
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  user&#39;s home directory is on an NFS partition, because sshd(8)
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  reads it as root.  Additionally, this file must be owned by the
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  user, and must not have write permissions for anyone else.  The
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  recommended permission for most machines is read/write for the
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">  user, and not accessible by others.
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl">~/.shosts
</span></span><span class="line"><span class="ln">11</span><span class="cl">  This file is used in exactly the same way as .rhosts, but allows
</span></span><span class="line"><span class="ln">12</span><span class="cl">  host-based authentication without permitting login with
</span></span><span class="line"><span class="ln">13</span><span class="cl">  rlogin/rsh.
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl">~/.ssh/
</span></span><span class="line"><span class="ln">16</span><span class="cl">  This directory is the default location for all user-specific con-
</span></span><span class="line"><span class="ln">17</span><span class="cl">  figuration and authentication information.  There is no general
</span></span><span class="line"><span class="ln">18</span><span class="cl">  requirement to keep the entire contents of this directory secret,
</span></span><span class="line"><span class="ln">19</span><span class="cl">  but the recommended permissions are read/write/execute for the
</span></span><span class="line"><span class="ln">20</span><span class="cl">  user, and not accessible by others.
</span></span><span class="line"><span class="ln">21</span><span class="cl">
</span></span><span class="line"><span class="ln">22</span><span class="cl">~/.ssh/environment
</span></span><span class="line"><span class="ln">23</span><span class="cl">  Contains additional definitions for environment variables; see
</span></span><span class="line"><span class="ln">24</span><span class="cl">  ENVIRONMENT, above.
</span></span><span class="line"><span class="ln">25</span><span class="cl">
</span></span><span class="line"><span class="ln">26</span><span class="cl">~/.ssh/rc
</span></span><span class="line"><span class="ln">27</span><span class="cl">  Commands in this file are executed by ssh when the user logs in,
</span></span><span class="line"><span class="ln">28</span><span class="cl">  just before the user&#39;s shell (or command) is started.  See the
</span></span><span class="line"><span class="ln">29</span><span class="cl">  sshd(8) manual page for more information.
</span></span><span class="line"><span class="ln">30</span><span class="cl">
</span></span><span class="line"><span class="ln">31</span><span class="cl">/etc/hosts.equiv
</span></span><span class="line"><span class="ln">32</span><span class="cl">  This file is for host-based authentication (see above).  It
</span></span><span class="line"><span class="ln">33</span><span class="cl">  should only be writable by root.
</span></span><span class="line"><span class="ln">34</span><span class="cl">
</span></span><span class="line"><span class="ln">35</span><span class="cl">/etc/shosts.equiv
</span></span><span class="line"><span class="ln">36</span><span class="cl">  This file is used in exactly the same way as hosts.equiv, but
</span></span><span class="line"><span class="ln">37</span><span class="cl">  allows host-based authentication without permitting login with
</span></span><span class="line"><span class="ln">38</span><span class="cl">  rlogin/rsh.
</span></span><span class="line"><span class="ln">39</span><span class="cl">
</span></span><span class="line"><span class="ln">40</span><span class="cl">/etc/ssh/ssh_config
</span></span><span class="line"><span class="ln">41</span><span class="cl">  Systemwide configuration file.  The file format and configuration
</span></span><span class="line"><span class="ln">42</span><span class="cl">  options are described in ssh_config(5).
</span></span><span class="line"><span class="ln">43</span><span class="cl">
</span></span><span class="line"><span class="ln">44</span><span class="cl">/etc/ssh/ssh_host_key
</span></span><span class="line"><span class="ln">45</span><span class="cl">/etc/ssh/ssh_host_dsa_key
</span></span><span class="line"><span class="ln">46</span><span class="cl">/etc/ssh/ssh_host_ecdsa_key
</span></span><span class="line"><span class="ln">47</span><span class="cl">/etc/ssh/ssh_host_rsa_key
</span></span><span class="line"><span class="ln">48</span><span class="cl">  These files contain the private parts of the host keys and are
</span></span><span class="line"><span class="ln">49</span><span class="cl">  used for host-based authentication.  If protocol version 1 is
</span></span><span class="line"><span class="ln">50</span><span class="cl">  used, ssh must be setuid root, since the host key is readable
</span></span><span class="line"><span class="ln">51</span><span class="cl">  only by root.  For protocol version 2, ssh uses ssh-keysign(8) to
</span></span><span class="line"><span class="ln">52</span><span class="cl">  access the host keys, eliminating the requirement that ssh be
</span></span><span class="line"><span class="ln">53</span><span class="cl">  setuid root when host-based authentication is used.  By default
</span></span><span class="line"><span class="ln">54</span><span class="cl">  ssh is not setuid root.
</span></span><span class="line"><span class="ln">55</span><span class="cl">
</span></span><span class="line"><span class="ln">56</span><span class="cl">/etc/ssh/ssh_known_hosts
</span></span><span class="line"><span class="ln">57</span><span class="cl">  Systemwide list of known host keys.  This file should be prepared
</span></span><span class="line"><span class="ln">58</span><span class="cl">  by the system administrator to contain the public host keys of
</span></span><span class="line"><span class="ln">59</span><span class="cl">  all machines in the organization.  It should be world-readable.
</span></span><span class="line"><span class="ln">60</span><span class="cl">  See sshd(8) for further details of the format of this file.
</span></span><span class="line"><span class="ln">61</span><span class="cl">
</span></span><span class="line"><span class="ln">62</span><span class="cl">/etc/ssh/sshrc
</span></span><span class="line"><span class="ln">63</span><span class="cl">  Commands in this file are executed by ssh when the user logs in,
</span></span><span class="line"><span class="ln">64</span><span class="cl">  just before the user&#39;s shell (or command) is started.  See the
</span></span><span class="line"><span class="ln">65</span><span class="cl">  sshd(8) manual page for more information.
</span></span></code></pre></div><p>资料参考：</p>
<ol>
<li>[Linux] man ssh</li>
<li><a href="http://www.openfsg.com/index.php/Advanced_SSH_usage">Advanced SSH usage</a></li>
</ol>
]]></content:encoded></item><item><title>2013 年终总结</title><link>https://icyleaf.com/2013/12/2013-in-review/</link><pubDate>Mon, 30 Dec 2013 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2013/12/2013-in-review/</guid><description>有得有失的一年，跳出舒适圈才能破局</description><content:encoded><![CDATA[<p>人生能够走过几次 1314 新旧年的交替，都有些忘记过去的一年做了些什么事情，翻看日历和一些零碎的笔记在努力把之前的事情慢慢回忆起来。</p>
<h2 id="工作">工作</h2>
<p>工作算得上又失落也有少许沉淀。</p>
<p>首先结束了人生第二家干了大约三年半的公司。当职位慢慢爬升，周围的环境已不再是曾经那么单纯程序员思维，在<a href="http://icyleaf.com/2013/01/2011-2012-in-review/">去年年终总结</a>也提到过爬升所带来的宝贵经验，但今年却尝到了不一样的教训：</p>
<ul>
<li>产品和技术是为了市场（目标用户）服务</li>
<li>团队不能够急剧扩张</li>
<li>这不仅仅是一个人的『战役』</li>
<li>提防小人的冷枪</li>
</ul>
<p>其实前者还好，总有办法弥补，但面对最后一条，我选择了无奈的离开&hellip;</p>
<p>2007 年 12 月来北京之后，几乎没有怎么休息过，人生总是在岗位上奋斗，本想着这次离职可以在出走玩玩，时节又逢夏末秋初，正好是看雪山的季节。事情往往事与愿违，离职三天后，我入职了第三家公司，一朋友急缺人员，我选择了去帮他救火&hellip;</p>
<h2 id="技术">技术</h2>
<p>在做移动互联网的这两年中，个人大概分析了下市场情况，挣钱的永远是那么两类，游戏和广告。而国内大多数公司都是为了抢占一个端口而做的业务相关的应用。除了不差钱的和玩票性质的以外，大多应用都不知道在干些什么。</p>
<p>『无论是 PC 还是 Mobile，展现给用户的最终还是数据。』基于这条理论，我决定尝试挖掘数据和分析数据，试图在数据中得到一些答案。《<a href="http://book.douban.com/subject/10945606/">精益创业</a>》却给了相反的实践方案。个人打算结合两者的优势积累一些资料。</p>
<p>因为数据的采集，建立数据仓库和分析，我并没有采用 Python，而是使用了 Ruby。或许语法糖太多了，可以让我更快的解决一些实际问题。</p>
<p>虽然在移动最热的时候，暂停了一下。我想重新再开始那里才是真正的战场。</p>
<h2 id="生活">生活</h2>
<h3 id="户外">户外</h3>
<p>攒了三年多的假，竟然有了 20 多天假期，一南一北各去了一个地方：</p>
<h4 id="1-风云莫测的贡嘎转山">1. 风云莫测的贡嘎转山</h4>
<p>五一假期左右请了几天假连成 11 天，花了 8 天贡嘎转山，其余天在成都市内转了转整理成册。</p>
<p>浏览照片：</p>
<ul>
<li><a href="http://www.douban.com/photos/album/102784556/">贡嘎转山</a></li>
<li><a href="http://www.douban.com/photos/album/123285098/">天府之乐</a></li>
</ul>
<h4 id="2-骑行呼伦贝尔之额尔古纳河右岸">2. 骑行呼伦贝尔之额尔古纳河右岸</h4>
<p>2013 年的端午节，受 <a href="http://www.douban.com/people/loddit/">loddit</a> 邀请组成了 4 人小队前往呼伦贝尔，踏上了第一次为期 4.5 天的骑行活动。我还特意做了一个<a href="http://icyleaf.com/2013/05/riding-to-hulunbeier/">路线征集计划书</a>。</p>
<p>浏览照片：<a href="http://www.douban.com/photos/album/107796607/">骑行呼伦贝尔</a></p>
<h4 id="3-两次山西五台山朝圣反穿正穿">3. 两次山西五台山朝圣（反穿/正穿）</h4>
<p>去年冬季反穿过一次五台山，大雪纷飞。一直都知道大五台是一个四季变化的地方，特别想体验一下不同季节的风景。在 9 月初再次踏上五塔山的土地。幸福的是认识了土豪妞。</p>
<p>第二次去五台山是还想和她一起去体验雪景，结果天气晴朗，没有一点飘雪。那个时候已经是 11 月，哪里有像凛冬将至的赶脚，摔！</p>
<p>浏览照片：<a href="http://www.douban.com/photos/album/111742562/">朝圣五台山</a></p>
<h3 id="阅读">阅读</h3>
<p><img loading="lazy" src="https://chart.googleapis.com/chart?chs=370x200&amp;cht=bvs&amp;chxp=2,100&amp;chxt=y,x,x&amp;chxl=0:%7c0%7c1%7c2%7c3%7c4%7c5%7c6%7c7%7c8%7c9%7c10%7c1:%7c1%7c2%7c3%7c4%7c5%7c6%7c7%7c8%7c9%7c10%7c11%7c12%7c2:%7cmonth&amp;chf=c,lg,90,76A4FB,0.5,ffffff,0%7cbg,s,EFEFEF&amp;chd=t:0,60,10,0,0,0,30,40,40,40,0,20&amp;chco=0000ff&amp;chtt=2013&#43;%e5%b9%b4%e5%85%b1%e9%98%85%e8%af%bb&#43;24&#43;%e6%9c%ac%e4%b9%a6"
  
  
  alt="2013豆瓣阅读图表"></img>
</p>
<p>上半年总把玩着 iPad，积攒的实体书虽多，看完的较少，更别提存储量更大的电子书了；下半年开始有读书量得益于从日本 amazon 海淘了一个 kindle paperwhite，加上豆瓣阅读和多看的给力，也购买了不少在价格上更有优势的电子书。</p>
<p>推荐书籍：</p>
<ul>
<li>技术：《Tmux &ndash; Productive Mouse-Free Development》</li>
<li>创业：《精益创业》</li>
<li>历史：《极简欧洲史》</li>
<li>小说：《三国演义》《冰与火之歌》《星际争霸系列》</li>
</ul>
<h3 id="电影">电影</h3>
<p><img loading="lazy" src="https://chart.googleapis.com/chart?chs=370x200&amp;cht=bvs&amp;chxp=2,100&amp;chxt=y,x,x&amp;chxl=0:%7c0%7c5%7c10%7c15%7c20%7c1:%7c1%7c2%7c3%7c4%7c5%7c6%7c7%7c8%7c9%7c10%7c11%7c12%7c2:%7cmonth&amp;chf=c,lg,90,76A4FB,0.5,ffffff,0%7cbg,s,EFEFEF&amp;chd=t:60,80,60,20,75,30,65,40,50,55,30,35&amp;chco=0000ff&amp;chtt=2013&#43;%e5%b9%b4%e5%85%b1%e8%a7%82%e5%bd%b1&#43;120&#43;%e9%83%a8"
  
  
  alt="2013豆瓣观影图表"></img>
</p>
<p>囧，居然看了那么多电影，我自己都有些惊讶&hellip;</p>
<p>推荐电影：</p>
<ul>
<li>纪录片：《独立游戏大电影》《工业光魔 创造不可能》</li>
<li>动画长篇：《疯狂原始人》</li>
<li>美剧：《纸牌屋》《绝命毒师》</li>
<li>IMAX：《地心引力》</li>
</ul>
<h3 id="家庭">家庭</h3>
<p>爷爷永远的辞世，永远缅怀。</p>
<p>老院子自爷爷过世之后开始没了灵气，就连每年硕果累累的枣树也聋了，没有结一个枣，又逢拆迁计划，于是从不崇拜买房主义的我在家给父母合资买了套房子，在家也忙活了十多天参与房子的装修，劳神劳力费钱，唉&hellip;从此荷包又瘪了 :(</p>
<!-- raw HTML omitted -->
<p>新的一年我想尝试写写日记，就像《和时间做朋友》里面提到的，我想对于时间和事情的归档更加的精确，未来还有更多的事情要去做！</p>
]]></content:encoded></item><item><title>学习 Ansible + Vagrant</title><link>https://icyleaf.com/2013/12/learning-ansible-and-vagrant/</link><pubDate>Sat, 21 Dec 2013 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2013/12/learning-ansible-and-vagrant/</guid><description>Vagrant 可能会让人忘记但你不应该不学 Ansible</description><content:encoded><![CDATA[<blockquote>
<p>Ansible is a radically simple IT orchestration engine that makes your applications and systems easier to deploy. Avoid writing scripts or custom code to deploy and update your applications— automate in a language that approaches plain English, using SSH, with no agents to install on remote systems.</p>
</blockquote>
<p>简单来说 <a href="https://github.com/ansible/ansible">Ansible</a> 是一个极简化的应用和系统部署工具，类似 <a href="https://github.com/puppetlabs/puppet">Puppet</a>、<a href="https://github.com/opscode/chef">Chef</a>、<a href="https://github.com/saltstack/salt">SaltStack</a>。由于默认使用 <code>ssh</code> 管理服务器（集群），配置文件采用 yaml 而不是某一种特定语言制定。方便至极。</p>
<p>很多人说 salt 也很用的，为什么不考虑呢，我个人觉得，ansible 的配置文件编写起来比较方便，不需要使用 <a href="http://jinja.pocoo.org/">jinja2</a> 模板引擎适合非 <code>python</code> 用户管理。而且我也较同意 &ldquo;<a href="http://missingm.co/2013/06/ansible-and-salt-a-detailed-comparison/">Ansible and Salt: A detailed comparison</a>&rdquo; 文章的评测。</p>
<p>由于个人之前没用过任何其他工具，至于你想知道上面哪些之间有什么区别的话，参见此文：<a href="http://www.infoworld.com/d/data-center/review-puppet-vs-chef-vs-ansible-vs-salt-231308?page=0,0">Review: Puppet vs. Chef vs. Ansible vs. Salt</a> 或 &ldquo;<a href="http://ttyn.me/2013/02/19/ansible_intro.html">开始使用配置和发布管理</a>&rdquo; 一文中也有提到其特性。</p>
<h1 id="安装">安装</h1>
<p>大家移步 LinuxToy 的 <a href="https://linuxtoy.org/archives/hands-on-with-ansible.html">Ansible 快速上手</a> 一文，以及 <a href="http://gogojimmy.net/2013/05/26/vagrant-tutorial/">使用Vagrant練習環境佈署</a> 作为学习铺垫，我就不再多写。这里我想重点介绍下 Ansible + Vagrant 配合使用技巧。</p>
<blockquote>
<p>其实上面 &ldquo;使用Vagrant練習環境佈署&rdquo; 提到的配置文件是 Vagrantfile config version = 1 时候的，当前 vagrant 版本是 1.4.1， Vagrantfile config version = 2，因此配置的部分已经有所变动。大家需要做下更新。</p>
</blockquote>
<p>如果你使用的是 Vagrant 1.4.0+，工具已经完全集成了上述的 DevOps 工具（甚至 Docker，另外一神器，后续看看能否给个介绍）。默认配置文件只包含了 Puppet 和 Chef，大家需要看<a href="http://docs.vagrantup.com/v2/provisioning/index.html">官方文档</a>。</p>
<p>如果你是 Mac OS 用户，可以通过 <code>brew</code> 和 <code>brew-cask</code> 命令安装：</p>
<pre tabindex="0"><code>$ brew update
$ brew install ansible
$ brew cask install vagrant
</code></pre><h1 id="创建-vagrant-实例">创建 Vagrant 实例</h1>
<p>首先创建学习目录(<code>~/src/learn_ansible</code>)和一个实例，采用 CentOS 6.5 x64 系统：</p>
<pre tabindex="0"><code>$ vagrant init centos65 https://github.com/2creatives/vagrant-centos/releases/download/v6.5.1/centos65-x86_64-20131205.box
</code></pre><p>下载完毕之后，编辑 <code>Vagrantfile</code> 添加如下内容：</p>
<pre tabindex="0"><code>config.vm.network :private_network, ip: &#34;33.33.33.10&#34;
config.vm.provision :ansible do |ansible|

ansible.inventory_path = &#34;ansbile/hosts&#34;
	ansible.playbook = &#34;ansbile/playbook.yml&#34;

	# 默认使用 sudo 权限
	ansible.sudo = true
	# 开启调试信息模式
	ansible.verbose = &#39;vvv&#39;
end
</code></pre><p>并在学习目录创建 <code>ansible</code> 目录以及下面两个文件，结构如下：</p>
<pre tabindex="0"><code>$ tree
.
├── Vagrantfile
└── ansible
    ├── hosts
    └── playbook.yml
1 directory, 3 files

`hosts` 文件内容，ip 地址和上面 `Vagrantfile` 设置的一致：
</code></pre><p>[webserver]
33.33.33.10</p>
<pre tabindex="0"><code>
`playbook.yml` 文件内容：
</code></pre><hr>
<h1 id="ansbile-的配置文件这里指定只作用于-webserver-服务器">ansbile 的配置文件，这里指定只作用于 webserver 服务器</h1>
<h1 id="使用-vagrant-的-sudu-权限执行任务">使用 vagrant 的 sudu 权限执行任务</h1>
<ul>
<li>hosts: webserver
user: vagrant
sudo: yes
tasks:
<h1 id="任务只有一个就是安装-nginx">任务只有一个，就是安装 nginx</h1>
<ul>
<li>name: Install Nginx
yum: name=nginx state=present</li>
</ul>
</li>
</ul>
<pre tabindex="0"><code>

# 连接 &amp; 部署

使用 Vagrant 的好处在于，它集成了这些工具，并通过 `vagrant provision` 这个命令就能连接服务器并部署。这里我想让大家学习到如何通过传统 ssh 链接 vagrant 虚拟机的方法：

从上面的配置文件我们得知，服务器的 ip 是 `33.33.33.10` 而且默认登录到虚拟机上的用户是 vagrant（密码也是用户名），链接端口是 22。我们先拷贝 ssh public key 到服务器上：
</code></pre><p>$ ssh-copy-id <a href="mailto:vagrant@33.33.33.10">vagrant@33.33.33.10</a></p>
<pre tabindex="0"><code>
完成之后，我们就可以通过下面命令测试是否配置成功：
</code></pre><p>$ ansible -u vagrant -i ansible/hosts all -m ping</p>
<p>webserver | success &raquo; {
&ldquo;changed&rdquo;: false,
&ldquo;ping&rdquo;: &ldquo;pong&rdquo;
}</p>
<pre tabindex="0"><code>
返回 `ping: pong` 即为连接成功并可以进行部署。若你之前执行了 `vagrant provision` 就会自动执行 `playbook.yml` 的内容。


今天初探就到此结束，希望通过本篇文字大家对它有个大概的了解。
</code></pre>]]></content:encoded></item><item><title>ActiveRecord 使用秘笈</title><link>https://icyleaf.com/2013/12/activerecord-tips/</link><pubDate>Tue, 03 Dec 2013 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2013/12/activerecord-tips/</guid><description>作为 Rails 生态之一的 ORM 一定要好好学习</description><content:encoded><![CDATA[<p>ActiveRecord 是 Rails 内置的 ORM 框架，大多数人学习 Ruby 都是从 rails 开始，接触的也是这个 ORM，因此就有了这个使用秘笈。</p>
<h1 id="支持-rake-dbxxx-命令">支持 <code>rake db:xxx</code> 命令</h1>
<p>在非 rails 项目怎么让 rake 支持 db:xxx 命令呢？把如下代码放到 <code>Rakefile</code> 中:</p>
<pre tabindex="0"><code>namespace :db do
  require &#39;activerecord&#39;
  require &#39;yaml&#39;

  desc &#34;加载项目表数据到数据库&#34;
  task :init =&gt; :dbenv do
    file = &#34;db/schema.rb&#34;
    load(file) # 参考 rails 文件结构
  end

  desc &#34;创建数据库初始化数据&#34;
  task :seed =&gt; :dbenv do
    seed_file = File.join(File.dirname(__FILE__), &#39;db&#39;, &#39;seeds.rb&#39;)
    load(seed_file) if File.exist?(seed_file)
  end

  desc &#34;合并 db/migrate 目录下的数据库文件&#34;
  task :migrate =&gt; :dbenv do
    ActiveRecord::Migration.verbose = ENV[&#34;VERBOSE&#34;] ? ENV[&#34;VERBOSE&#34;] == &#34;true&#34; : true
    ActiveRecord::Migrator.migrate(&#34;db/migrate/&#34;, ENV[&#34;VERSION&#34;] ? ENV[&#34;VERSION&#34;].to_i : nil)
    Rake::Task[&#34;db:schema:dump&#34;].invoke if ActiveRecord::Base.schema_format == :ruby
  end

  desc &#39;设定 STEP=n 回滚之前版本的数据库结构&#39;
  task :rollback =&gt; :dbenv do
    step = ENV[&#39;STEP&#39;] ? ENV[&#39;STEP&#39;].to_i : 1
    ActiveRecord::Migrator.rollback(&#39;db/migrate/&#39;, step)
    Rake::Task[&#34;db:schema:dump&#34;].invoke if ActiveRecord::Base.schema_format == :ruby
  end

  task :dbenv do
    dbname = ENV[&#39;db&#39;] || &#39;development&#39;
  	$dbconfig = YAML::load(&#39;db/database.yml&#39;)
    ActiveRecord::Base.establish_connection($dbconfig[dbname])
  end

  namespace :schema do
    desc &#34;把数据库结构写入 db/schema.rb 文件&#34;
    task :dump =&gt; :dbenv do
      require &#39;active_record/schema_dumper&#39;
      File.open(ENV[&#39;SCHEMA&#39;] || &#34;db/schema.rb&#34;, &#34;w&#34;) do |file|
        ActiveRecord::SchemaDumper.dump(ActiveRecord::Base.connection, file)
      end
    end
  end
end
</code></pre><p>初始化数据库结构</p>
<pre tabindex="0"><code>$ rake db:init
</code></pre><h1 id="支持-sql-server">支持 SQL Server</h1>
<p>只针对 *nix 系统：</p>
<ol>
<li>安装 freetds</li>
</ol>
<pre tabindex="0"><code>* Mac OS: `brew install freetds`
* CentOS: `yum install -y freetds`
</code></pre><ol start="2">
<li><code>gem install tiny_tds</code></li>
<li><code>gem install activerecord-sqlserver-adapter</code></li>
</ol>
<p>引用如下：</p>
<pre tabindex="0"><code>require &#39;tiny_tds&#39;
require &#39;activerecord-sqlserver-adapter&#39;
require &#39;active_record&#39;

ActiveRecord::Base.establish_connection({
  :adapter =&gt; &#39;sqlserver&#39;
 :host =&gt; &#39;10.10.10.10&#39;,
 :username =&gt; &#39;sa&#39;,
  :password =&gt; &#39;p@ssword&#39;,
  :database =&gt; &#39;development&#39;,
  :timeout =&gt; 10,
  :port =&gt; 1433,
})

class Users &lt; ActiveRecord::Base
	self.table_name = &#39;User&#39;
	default_scope { lock(&#39;WITH (NOLOCK)&#39;) }
end
</code></pre><h1 id="多数据库支持">多数据库支持</h1>
<p>创建 <code>config/database.yml</code> 文件:</p>
<pre tabindex="0"><code>development:
  adapter: mysql2
  host: localhost
  username: root
  password:
  database: development
  timeout: 10
  port: 3306
test:
  adapter: mysql2
  host: 10.10.10.10
  username: root
  password: p@ssword
  database: test
  timeout: 10
  port: 1433
production:
  adapter: mysql2
  host: 33.33.33.33
  username: root
  password: p@ssword
  database: production
</code></pre><p>创建 <code>lib/model.rb</code> 文件:</p>
<pre tabindex="0"><code>$dbconfig = YAML::load(File::open(&#39;config/database.yml&#39;))

class User &lt; ActiveRecord::Base
  establish_connection $dbconfig[&#39;development&#39;]
end

class Post &lt; ActiveRecord::Base
  establish_connection $dbconfig[&#39;test&#39;]
end

class Tag &lt; ActiveRecord::Base
  establish_connection $dbconfig[&#39;production&#39;]
end
</code></pre><h1 id="动态创建表名">动态创建表名</h1>
<p>假若有个需求需要按照每月分表（当然也可以安装业务分表什么的），我们可以通过下面方式调用：</p>
<pre tabindex="0"><code># 插入 post，如果表不存在则创建后插入
post = Post.date(&#39;201312&#39;).get_or_create_table.create(
  title:&#39;test&#39;,
  content:&#39;body&#39;
)

# Model 实现代码
class Post &lt; ActiveRecord::Base
  @date = Time.now.strftime(&#34;%Y%02m&#34;)

  def self.date(date)
  	@date = date
  end

  def self.get_or_create_table(params={})
    self.date(params[:date]) if params[:date]
    self.create_table(params) if !self.exists?
  end

  def self.create_table(params={})
    self.date(params[:date]) if params[:date]
    table_name = self.table_name
    ActiveRecord::Schema.define do
      create_table table_name do |table|
        table.column :title, :string
        table.column :content, :text
        table.column :created_at, :datetime
        table.column :updated_at, :datetime
      end
    end

    return self
  end

  def self.table_exists?
    # 如果你设置了多数据库请取消下行注解并更改配置名（参考上个技巧）
    # ActiveRecord::Base.establish_connection($dbconfig[&#39;development&#39;])

    ActiveRecord::Base.connection.tables.include?(self.table_name)
  end

  def table_name
    &#34;#{@date_users}&#34;
  end
end
</code></pre>]]></content:encoded></item><item><title>Git 和 Pager 的那点事</title><link>https://icyleaf.com/2013/10/about-pager-on-git/</link><pubDate>Wed, 16 Oct 2013 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2013/10/about-pager-on-git/</guid><description>tig 是一个代替 Git Pager 的好工具</description><content:encoded><![CDATA[<blockquote>
<p>Git 几乎所有命令都提供分页器，即当命令输出超过一页时，自动在每页输出后暂停，可以按空格继续显示，按 q 退出。</p>
</blockquote>
<p>默认 git 的 <code>pager = less -FRSX</code>，这个可以通过两种方式更改：</p>
<p>命令：</p>
<pre tabindex="0"><code>$ git config --global core.pager &#34;less -FRSX&#34;
</code></pre><p>配置文件：</p>
<pre tabindex="0"><code>$ vim ~/.gitconfig
</code></pre><p>了不起了通过设置自动匹配的色彩来增强可读性</p>
<pre tabindex="0"><code>$ git config --global color.ui on
</code></pre><p>随着 <a href="http://jonas.nitro.dk/tig">tig</a> 的出现，给 git 的增加了一个强大武装武器。（不明观众看这里先对它有个感官概念：<a href="http://gitready.com/advanced/2009/07/31/tig-the-ncurses-front-end-to-git.html">tig, the ncurses front-end to Git</a>）</p>
<p>可能大家不知道 tig 本身就可以也是一个 pager，因此我们可以在 git config 默认替换之：</p>
<pre tabindex="0"><code>$ git config --global core.pager tig
</code></pre><p>自从这样配置之后，让我幸福了好几年。直到&hellip;今天发现一个怪异的问题，使用任何需要显示 tig pager 的地方设置的配色是以代码形式显示，而不是解析成了终端显示的颜色。最近忍不住升级到了 10.9 并更新了一些命令，因此也没搞清楚到底是哪里出了问题。只能先把 git 自带的 color 渲染给关闭才解决了这个问题</p>
<pre tabindex="0"><code>$ git config --global color.ui off
</code></pre><p>我的个人 <code>.gitconfig</code> 等配置文件：https://gist.github.com/icyleaf/868866</p>
]]></content:encoded></item><item><title>如何在 CentOS 上安装 Gitlab</title><link>https://icyleaf.com/2013/09/how-to-install-gitlab-on-centos/</link><pubDate>Tue, 17 Sep 2013 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2013/09/how-to-install-gitlab-on-centos/</guid><description>Barl Metal 安装服务依赖还是很痛苦的，CentOS 上是痛苦面具</description><content:encoded><![CDATA[<p>2013 年 08 月的 OpenParty &ldquo;<a href="http://www.beijing-open-party.org/event/25">花事如期</a>&rdquo; 活动上，<a href="https://github.com/vecio">晓东</a>在他的机器上演示了自建 Gitlab 的项目，看到 Gitlab 目前已经比较成熟，而不像早期寒碜的界面，这个时候看安装一下也是不错的事情，不过他们的项目文档只提供了 Ubuntu 系统的<a href="https://github.com/gitlabhq/gitlabhq#installation">安装文档</a>，对于 CentOS 没有提到，非官方的文档有比较老久，凭着之前熟悉 Ubuntu 和学习 CentOS，那就开始安装吧：</p>
<p>以下教程在 <code>CentOS 6 x86_64</code> 版本下操作。</p>
<h2 id="首先安装-epel-和编译依赖库">首先安装 EPEL 和编译依赖库</h2>
<pre tabindex="0"><code>$ rpm -ivh http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm
</code></pre><blockquote>
<p>如果你是非 64 位，去上面的网址找到适合你发行版的最新版本的 epel rpm</p>
</blockquote>
<pre tabindex="0"><code>$ yum -y update
$ yum -y install gcc gcc-c++ make autoconf libyaml-devel gdbm-devel ncurses-devel openssl-devel zlib-devel readline-devel curl-devel expat-devel gettext-devel  tk-devel libxml2-devel libffi-devel libxslt-devel libicu-devel sendmail patch libyaml* pcre-devel sqlite-devel vim
</code></pre><h2 id="安装-python-27">安装 Python 2.7+</h2>
<p>Gitlab 要求 Python 2.5.5+ 以及 Ruby 1.9+</p>
<p>系统 Python 默认是 2.6.x，如果你想把 Python 升级到目前比较流行的 2.7.x 就参照下面步骤，否则直接跳过。（Gitlab 目前不支持 Python 3.0）</p>
<pre tabindex="0"><code>$ mkdir /tmp/gitlab &amp;&amp; cd /tmp/gitlab
$ curl --progress http://python.org/ftp/python/2.7.5/Python-2.7.5.tgz | tar xvf
$ cd Python-2.7.5
$ ./configure --prefix=/usr/local
$ make &amp;&amp; make altinstall
</code></pre><p>安装好之后，需要做两件事情，替换默认 python 的版本至最新版本，</p>
<pre tabindex="0"><code>$ sudo ln -s /usr/local/bin/python2.7 /usr/local/bin/python
</code></pre><blockquote>
<p>因为系统默认 <code>PATH</code> 的寻址路径是 <code>/usr/local/bin</code></p>
</blockquote>
<p>最后看下 Python 版本是否是刚刚安装的版本：</p>
<pre tabindex="0"><code>$ python --version
</code></pre><blockquote>
<p>由于 <code>yum</code> 是 python 的一个 module，所以这块修改可能会引起无法调用 yum 脚本，所以需要修改这个文件 <code>/usr/bin/yum</code> 的第一行为 <code>!#/usr/bin/python2.6</code></p>
</blockquote>
<h2 id="安装-ruby-20">安装 Ruby 2.0</h2>
<p>Ruby 1.9 和 2.0 的特性差别不大，索性升级至最新 2.0 版本即可</p>
<pre tabindex="0"><code>$ cd /tmp/gitlab
$ curl --progress http://cache.ruby-lang.org/pub/ruby/2.0/ruby-2.0.0-p247.tar.gz | tar xz
$ cd ruby-2.0.0-p247
$ ./configure
$ make
$ make install
</code></pre><p>ruby 2.0 已经内置 gem (v2.0.3)，只需要安装 bundler</p>
<pre tabindex="0"><code>$ gem install bundler
</code></pre><blockquote>
<p>若在执行 <code>sudo ruby</code> 或 <code>sudo gem</code> 找不到命令，因为编译的路径配置到了 <code>/usr/local/bin</code>，我们只需要做下软链接到 root 用户可以找到的 <code>$PATH</code> 路径：</p>
</blockquote>
<pre tabindex="0"><code>$ ln -s /usr/local/bin/ruby /usr/bin/ruby
$ ln -s /usr/local/bin/gem /usr/bin/gem
$ ln -s /usr/local/bin/bundle /usr/bin/bundle
</code></pre><h2 id="安装-git-和-gitolite">安装 Git 和 Gitolite</h2>
<pre tabindex="0"><code>$ yum -y install git-all gitolite
</code></pre><h2 id="安装-nginx">安装 Nginx</h2>
<pre tabindex="0"><code>$ yum -y install nginx
$ service nginx start
</code></pre><blockquote>
<p>nginx 需要从 EPEL 中安装，默认系统没有 nginx 包。</p>
</blockquote>
<h2 id="安装-mysql-和-redis">安装 Mysql 和 Redis</h2>
<p>Gitlab 要求强制安装 redis 处理一些数据，另外支持 MySQL 和 PostgreSQL，这里主要以 MySQL 为例</p>
<pre tabindex="0"><code>$ yum -y install mysql mysql-devel mysql-server redis
</code></pre><p>配置 Mysql 和 gitlab 需要的用户和数据库</p>
<pre tabindex="0"><code>$ service mysqld start
$ mysql -u root
$ mysql&gt; CREATE USER &#39;gitlab&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;gitlab&#39;;
$ mysql&gt; CREATE DATABASE IF NOT EXISTS `gitlabhq_production` DEFAULT CHARACTER SET `utf8` COLLATE `utf8_unicode_ci`;
$ mysql&gt; GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, DROP, INDEX, ALTER ON `gitlabhq_production`.* TO &#39;gitlab&#39;@&#39;localhost&#39;;
$ mysql&gt; \q
</code></pre><p>Redis 使用默认配置即可，直接启动</p>
<pre tabindex="0"><code>$ service redis start
</code></pre><h2 id="添加-gitlab-用户">添加 Gitlab 用户</h2>
<pre tabindex="0"><code>$ useradd -c &#39;GitLab&#39; git
</code></pre><p>CentOS 的命令没有办法直接禁止用户的访问的参数，需要用下面命令：</p>
<pre tabindex="0"><code>$ passwd -l git
</code></pre><h2 id="安装-gitlab-shell">安装 Gitlab-shell</h2>
<p>使用 root 账户切换到 git 账户下操作，可以比官方教程省去一些麻烦的输入</p>
<pre tabindex="0"><code>$ su git &amp;&amp; cd /home/git
$ git clone https://github.com/gitlabhq/gitlab-shell.git
$ cd gitlab-shell
</code></pre><p>通过 <code>git tag</code> 查看最新版本并切换之</p>
<pre tabindex="0"><code>$ git checkout v1.7.1
</code></pre><p>编辑配置文件修改你要设定的域名（domain），比如 <code>http://gitlab.dev/</code></p>
<pre tabindex="0"><code>$ vim config.yml
</code></pre><p>完成之后执行安装脚本</p>
<pre tabindex="0"><code>$ ./bin/install
</code></pre><h2 id="安装-gitlab">安装 Gitlab</h2>
<pre tabindex="0"><code>$ cd /home/git
$ git clone https://github.com/gitlabhq/gitlabhq.git gitlab
$ cd /home/git/gitlab
</code></pre><p>通过 <code>git tag</code> 查看最新版本并切换之</p>
<pre tabindex="0"><code>$ git checkout 6.0.1
</code></pre><p>这里需要配置的东西多一些，这里参考<a href="https://github.com/gitlabhq/gitlabhq/blob/master/doc/install/installation.md#configure-it">官方的文档</a>，也可以安装我下面的步骤来：</p>
<pre tabindex="0"><code>$ cd /home/git/gitlab
</code></pre><p>复制配置文件，修改 host 相关的配置项，主要是 domain 要和上面的 <code>http://gitlab.dev</code></p>
<pre tabindex="0"><code>$ cp config.yml{.example,}
$ vim config/gitlab.yml
</code></pre><p>确认 gitlab 以下目录的权限是否正确</p>
<pre tabindex="0"><code>$ mkdir tmp/pids/
$ mkdir tmp/sockets/
$ chown -R git log/
$ chown -R git tmp/
$ chmod -R u+rwX log/
$ chmod -R u+rwX tmp/
$ chmod -R u+rwX tmp/pids/
$ chmod -R u+rwX tmp/sockets/
</code></pre><p>创建 satellites 目录，这个目录是保存各个用户的仓库</p>
<pre tabindex="0"><code>$ mkdir /home/git/gitlab-satellites
</code></pre><p>创建 uploads 目录（为什么 gitlab 不在项目中创建呢= =！）</p>
<pre tabindex="0"><code>$ mkdir public/uploads
$ chmod -R u+rwX  public/uploads
</code></pre><p>复制 unicorn 配置文件</p>
<pre tabindex="0"><code>$ cp config/unicorn.rb{.example,}
</code></pre><p>设置 ruby web 容器的参数，比如 2GB RAM 服务器可以设置 3 个 worker。</p>
<blockquote>
<p>如果系统其他服务占用了 unicorn 的端口，记得改名。</p>
</blockquote>
<pre tabindex="0"><code>$ vim config/unicorn.rb
</code></pre><p>设置一些 git 全局参数</p>
<pre tabindex="0"><code>$ git config --global user.name &#34;GitLab&#34;
$ git config --global user.email &#34;gitlab@localhost&#34;
$ git config --global core.autocrlf input
</code></pre><p>配置 gitlab 数据库设置</p>
<pre tabindex="0"><code>$ cp config/database.yml{.mysql,}
$ vim config/database.yml
$ chmod o-rwx config/database.yml
</code></pre><p>安装必需的 Ruby Gems</p>
<pre tabindex="0"><code>$ cd /home/git/gitlab
$ [sudo] gem install charlock_holmes --version &#39;0.6.9.4&#39;
$ bundle install --deployment --without development test postgres aws
</code></pre><p>初始化数据库数据（执行输入 <code>Yes</code> 继续创建）</p>
<pre tabindex="0"><code>$ bundle exec rake gitlab:setup RAILS_ENV=production
</code></pre><p>设置 init 脚本</p>
<pre tabindex="0"><code>$ sudo cp lib/support/init.d/gitlab /etc/init.d/gitlab
$ sudo chmod +x /etc/init.d/gitlab
</code></pre><h2 id="检查-gitlab-状态">检查 Gitlab 状态</h2>
<pre tabindex="0"><code>$ bundle exec rake gitlab:env:info RAILS_ENV=production
</code></pre><p>启动 gitlab 服务</p>
<pre tabindex="0"><code>$ sudo service gitlab start
</code></pre><p>再起检查，保证所有项目都是绿色</p>
<pre tabindex="0"><code>$ bundle exec rake gitlab:check RAILS_ENV=production
</code></pre><h2 id="配置-nginx">配置 nginx</h2>
<p>根据 nginx 的安装路径适当修改下面的路径即可，我们先把 gitlab 提供的配置文件拷贝过去</p>
<pre tabindex="0"><code>$ sudo mkdir -p /etc/nginx/conf/sites/
$ sudo cp lib/support/nginx/gitlab /etc/nginx/conf/sites/gitlab.conf
</code></pre><blockquote>
<p>根据 nginx 版本和不同发行版的不同，配置结构可能不同根据你的实际情况加载 <code>gitlab.conf</code></p>
</blockquote>
<p>修改 <code>gitlab.conf</code> 的 <code>YOUR_SERVER_FQDN</code> 为上面设置的 domain。
最后修改 <code>nginx.conf</code> 或者 <code>default.conf</code> 加载 <code>/etc/nginx/conf/site</code> 下所有 conf 文件</p>
<pre tabindex="0"><code>http {

	include /etc/nginx/conf/site/*.conf;

	server {
		…
	}
}
</code></pre><p>保存后，重启各个服务</p>
<pre tabindex="0"><code>$ sudo service nginx reload
$ sudo service gitlab restart
</code></pre><h2 id="开始-gitlab-之旅">开始 Gitlab 之旅</h2>
<p>配置好 hosts 即可访问 <code>gitlab.dev</code></p>
<pre tabindex="0"><code>$ echo &#34;127.0.0.1 gitlab.dev&#34; &gt;&gt; /etc/hosts
</code></pre><p>默认的用户名密码：</p>
<pre tabindex="0"><code>admin@local.host
5iveL!fe
</code></pre><h2 id="各种坑">各种坑</h2>
<h3 id="1-错误日志报权限错误">1. 错误日志报权限错误</h3>
<pre tabindex="0"><code>2013/11/07 00:42:21 [crit] 15875#0: *2 stat() &#34;/home/git/gitlab/public/favicon.ico.html&#34; failed (13: Permission denied), client: 33.33.33.1, server: gitlab.web.lo, request: &#34;GET /favicon.ico HTTP/1.1&#34;, host: &#34;gitlab.web.lo&#34;
2013/11/07 00:42:21 [crit] 15875#0: *2 connect() to unix:/home/git/gitlab/tmp/sockets/gitlab.socket failed (13: Permission denied) while connecting to upstream, client: 33.33.33.1, server: gitlab.web.lo, request: &#34;GET /favicon.ico HTTP/1.1&#34;, upstream: &#34;http://unix:/home/git/gitlab/tmp/sockets/gitlab.socket:/favicon.ico&#34;, host: &#34;gitlab.web.lo&#34;
2013/11/07 00:42:31 [crit] 15875#0: *2 stat() &#34;/home/git/gitlab/public/&#34; failed (13: Permission denied), client: 33.33.33.1, server: gitlab.web.lo, request: &#34;GET / HTTP/1.1&#34;, host: &#34;gitlab.web.lo&#34;
2013/11/07 00:42:31 [crit] 15875#0: *2 stat() &#34;/home/git/gitlab/public//index.html&#34; failed (13: Permission denied), client: 33.33.33.1, server: gitlab.web.lo, request: &#34;GET / HTTP/1.1&#34;, host: &#34;gitlab.web.lo&#34;
2013/11/07 00:42:31 [crit] 15875#0: *2 stat() &#34;/home/git/gitlab/public/.html&#34; failed (13: Permission denied), client: 33.33.33.1, server: gitlab.web.lo, request: &#34;GET / HTTP/1.1&#34;, host: &#34;gitlab.web.lo&#34;
2013/11/07 00:42:31 [crit] 15875#0: *2 connect() to unix:/home/git/gitlab/tmp/sockets/gitlab.socket failed (13: Permission denied) while connecting to upstream, client: 33.33.33.1, server: gitlab.web.lo, request: &#34;GET / HTTP/1.1&#34;, upstream: &#34;http://unix:/home/git/gitlab/tmp/sockets/gitlab.socket:/&#34;, host: &#34;gitlab.web.lo&#34;
2013/11/07 00:42:31 [crit] 15875#0: *2 stat() &#34;/home/git/gitlab/public/favicon.ico&#34; failed (13: Permission denied), client: 33.33.33.1, server: gitlab.web.lo, request: &#34;GET /favicon.ico HTTP/1.1&#34;, host: &#34;gitlab.web.lo&#34;
2013/11/07 00:42:31 [crit] 15875#0: *2 stat() &#34;/home/git/gitlab/public/favicon.ico/index.html&#34; failed (13: Permission denied), client: 33.33.33.1, server: gitlab.web.lo, request: &#34;GET /favicon.ico HTTP/1.1&#34;, host: &#34;gitlab.web.lo&#34;
2013/11/07 00:42:31 [crit] 15875#0: *2 stat() &#34;/home/git/gitlab/public/favicon.ico.html&#34; failed (13: Permission denied), client: 33.33.33.1, server: gitlab.web.lo, request: &#34;GET /favicon.ico HTTP/1.1&#34;, host: &#34;gitlab.web.lo&#34;
2013/11/07 00:42:31 [crit] 15875#0: *2 connect() to unix:/home/git/gitlab/tmp/sockets/gitlab.socket failed (13: Permission denied) while connecting to upstream, client: 33.33.33.1, server: gitlab.web.lo, request: &#34;GET /favicon.ico HTTP/1.1&#34;, upstream: &#34;http://unix:/home/git/gitlab/tmp/sockets/gitlab.socket:/favicon.ico&#34;, host: &#34;gitlab.web.lo&#34;
</code></pre><p>解决方案:</p>
<pre tabindex="0"><code>$ (sudo) chmod o+x /home/git
</code></pre><h3 id="2-8080-端口被占用">2. 8080 端口被占用</h3>
<p>这样主要是因为 nginx 的配置是做 unicorn 的代理转发，实际上 gitlab 是由 unicorn 容器驱动，而在配置里默认绑定的是 <code>8080</code> 端口</p>
<pre tabindex="0"><code>$ vim /home/git/gitlab/config/unicorn.rb
</code></pre><p>找到 <code>listen &quot;127.0.0.1:8080&quot;, :tcp_nopush =&gt; true</code> 修改成其他未占用的端口号即可。</p>
]]></content:encoded></item><item><title>配置 CentOS 的网络联网设置</title><link>https://icyleaf.com/2013/09/network-configuration-in-centos/</link><pubDate>Thu, 05 Sep 2013 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2013/09/network-configuration-in-centos/</guid><description>一篇很基础的配网知识点</description><content:encoded><![CDATA[<p>安装完毕 CentOS 6 Server 开始配置网络设置，网上有很多的教程，用的方法要么不全，要么操作方式比较早期，花点时间整理了下方法：</p>
<h2 id="dhcp-设定">DHCP 设定</h2>
<p>CentOS 默认使用了 <code>dhcp</code> 但是可恨的是没有开启。首先我们先看看本机的网卡信息</p>
<pre tabindex="0"><code>$ ip a
</code></pre><p>返回结果：</p>
<pre tabindex="0"><code>1: lo:  mtu 16436 qdisc noqueue state UNKNOWN
link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
inet 127.0.0.1/8 scope host lo
inet6 ::1/128 scope host
valid_lft forever preferred_lft forever
2: eth0:  mtu 1500 qdisc mq state UP qlen 1000
link/ether 00:22:19:09:4d:3c brd ff:ff:ff:ff:ff:ff
</code></pre><p>其中 <code>lo</code> 是回路路由，咱们不必管它，这里 <code>eth0</code> 大家会很熟悉吧，这表示第一块网卡。好了，我们需要改改它的配置文件(CentOS 默认没有安装 <code>vim</code>):</p>
<pre tabindex="0"><code>$ vi /etc/sysconfig/network-scripts/ifcfg-eth0
</code></pre><p>如果你要改其他网卡，比如 <code>eth1</code> 那需要修改 <code>/etc/.../ifcfg-eth1</code></p>
<pre tabindex="0"><code>DEVICE=eth0
HWADDR=&#34;00:22:19:09:4D:3C&#34;
NM_CONTROLLED=yes
ONBOOT=yes      # 默认是 no，我们要改成 yes
BOOTPROTO=dhcp  # 如果不是这个值也要修改
</code></pre><p>最后重启 network service 即可：</p>
<pre tabindex="0"><code>$ service network restart
# 或者比较原始的方法
$ /etc/init.d/network restart
</code></pre><p>如果你看到它在重启并配置 DHCP 服务，那就说明没有问题了</p>
<pre tabindex="0"><code>Bringing up loopback interface:                [  OK  ]
Bringing up interface eth0:
Determining IP information for eth0... done.   [  OK  ]
</code></pre><p>测试一下</p>
<pre tabindex="0"><code>$ ping google.com
$ ifconfig
</code></pre><h2 id="手动设定">手动设定</h2>
<p>大部分操作和上面的一直，唯一不同的就是修改 <code>/etc/sysconfig/network-scripts/ifcfg-*</code> 文件：</p>
<pre tabindex="0"><code>DEVICE=eth0
HWADDR=&#34;00:22:19:09:4D:3C&#34;
NM_CONTROLLED=yes
ONBOOT=yes      		# 默认是 no，我们要改成 yes
BOOTPROTO=static  		# 改成静态模式
IPADDR=192.168.1.11 	# 设定 ip 地址
NETMASK=255.255.255.0 	# 设定子网掩码
GATEWAY=192.168.1.1 	# 设定网关 ip
</code></pre><p>修改 DNS 地址</p>
<pre tabindex="0"><code>$ vi /etc/resolve.conf

nameserver 8.8.8.8 # 主 DNS
nameserver 8.8.4.4 # 备选 DNS
</code></pre>]]></content:encoded></item><item><title>Linux 101 系列：chmod 文件权限工具</title><link>https://icyleaf.com/2013/08/linux-101-chmod/</link><pubDate>Wed, 28 Aug 2013 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2013/08/linux-101-chmod/</guid><description>640, 755, +X, -rw 这都是什么暗号</description><content:encoded><![CDATA[<blockquote>
<p>chmod 是用来管理文件访问权限的命令，大家是使用 *nix 系统的时候经常跟它打交道。</p>
</blockquote>
<h2 id="基本常识">基本常识</h2>
<h3 id="用户和用户组">用户和用户组</h3>
<table>
<thead>
<tr>
<th>参数</th>
<th>英文</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>u</td>
<td>Use</td>
<td>当前用户</td>
</tr>
<tr>
<td>g</td>
<td>Group</td>
<td>所属用户组</td>
</tr>
<tr>
<td>o</td>
<td>Others</td>
<td>其他人（其他用户及用户组，包含访客用户）</td>
</tr>
</tbody>
</table>
<h3 id="数字与参数">数字与参数</h3>
<table>
<thead>
<tr>
<th>数字</th>
<th>符号</th>
<th>说明</th>
<th>对文件</th>
<th>对目录</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>x</td>
<td>可执行权限</td>
<td>可被系统执行的权限</td>
<td>无</td>
</tr>
<tr>
<td>2</td>
<td>w</td>
<td>写权限</td>
<td>可以编辑或修改文件内容，但不含删除该文件</td>
<td>增删改该目录及目录下全部文件</td>
</tr>
<tr>
<td>4</td>
<td>r</td>
<td>读权限</td>
<td>可读取文件的内容</td>
<td>可读取目录结构</td>
</tr>
</tbody>
</table>
<blockquote>
<p>备注：<code>ls -l</code>对于文件权限是由 rwx 倒序组成。比如 <code>-rwxr--r--</code>，说明当前用户拥有全部权限，所属用户组和其他人只有读权限。</p>
</blockquote>
<h2 id="实例">实例</h2>
<h3 id="数字篇">数字篇</h3>
<h4 id="1-当前用户拥有所有权限其他只有读权限">1. 当前用户拥有所有权限，其他只有读权限</h4>
<table>
<thead>
<tr>
<th>u</th>
<th>g</th>
<th>o</th>
</tr>
</thead>
<tbody>
<tr>
<td>6</td>
<td>4</td>
<td>4</td>
</tr>
<tr>
<td>rw</td>
<td>r</td>
<td>r</td>
</tr>
</tbody>
</table>
<h4 id="2-所有用户及用户组添加全部权限-谨慎使用">2. 所有用户及用户组添加全部权限 （<strong>谨慎使用</strong>）</h4>
<table>
<thead>
<tr>
<th>u</th>
<th>g</th>
<th>o</th>
</tr>
</thead>
<tbody>
<tr>
<td>7</td>
<td>7</td>
<td>7</td>
</tr>
<tr>
<td>rwx</td>
<td>rwx</td>
<td>rwx</td>
</tr>
</tbody>
</table>
<h3 id="符号篇">符号篇</h3>
<pre tabindex="0"><code>通用公式：[用户(组)] + [操作] + [符号]
</code></pre><p>其中<code>操作</code>是由如下表构成：</p>
<table>
<thead>
<tr>
<th>操作</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-</td>
<td>移除权限</td>
</tr>
<tr>
<td>+</td>
<td>增加权限</td>
</tr>
<tr>
<td>=</td>
<td>设定权限</td>
</tr>
</tbody>
</table>
<h4 id="1-所有用户及用户组添加执行权限">1. 所有用户及用户组添加执行权限</h4>
<pre tabindex="0"><code>$ chmod +x [file]
</code></pre><h5 id="2-不允许其他人有写权限">2. 不允许其他人有写权限</h5>
<pre tabindex="0"><code>$ chmod o-w [file]
</code></pre><h4 id="3-增加用户组的读写权限">3. 增加用户组的读写权限</h4>
<pre tabindex="0"><code>$ chmod g+rw [file]
</code></pre><h4 id="4-除了当前用户都移除读写权限">4. 除了当前用户都移除读写权限</h4>
<pre tabindex="0"><code>$ chmod go-rw [file]
</code></pre><h4 id="5-设置当前用户所有权限所属用户组和其他人保留读权限">5. 设置当前用户所有权限，所属用户组和其他人保留读权限</h4>
<pre tabindex="0"><code>$ chmod u=rwx,g=r,o=r [file]
</code></pre>]]></content:encoded></item><item><title>个人 Mac OS 常用应用清单【2013年版】</title><link>https://icyleaf.com/2013/07/my-mac-os-apps-list-2013/</link><pubDate>Mon, 22 Jul 2013 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2013/07/my-mac-os-apps-list-2013/</guid><description>日常使用、开发、娱乐全方面整理</description><content:encoded><![CDATA[<blockquote>
<p>特别提醒：没有标注【收费】的应用均为免费应用。【增强付费】代表可以免费使用，但是需要付费开启扩展功能。</p>
</blockquote>
<p>最近有些朋友从 Windows 转到了 Mac 上面，发现之前写的清单有些老久了，重新更新一番，然后简单分个类整理：</p>
<h3 id="app">App</h3>
<h4 id="系统辅助">系统辅助</h4>
<ul>
<li>Alfred 2：必备神器，基于 spotlight 开发的检索应用，可开发各种插件。【增强付费】</li>
<li>AppCleaner：卸载软件必备，可监听应用删除事件干净清除，适合用于第三方安装和 App Store</li>
<li>百度输入法：目前除了<strong>鼠须管</strong>之外的最好选择。尤其是最近刚刚发布的新版</li>
<li>OmniDiskSweeper：磁盘空间使用率情况</li>
<li>Clean my mac：系统垃圾收集清理利器【付费】</li>
<li>The Unarchiver: 最智能且免费的解压缩软件</li>
<li>VirtualBox：开源的虚拟机，越来越好用了</li>
<li>Mactracker：收集了历代 Mac 产品的数据信息</li>
<li>Memory Clean：内存回收时使用，效果还可以</li>
<li>CheatSheet：可以显示任何一个应用的热键（hotkey）的辅助工具</li>
<li>iTools：iOS 设备管理工具</li>
<li>Tuxera NTFS：可写 NTFS 磁盘分区的工具【收费】</li>
</ul>
<h4 id="应用开发">应用开发</h4>
<ul>
<li>iTerm 2：代替默认 Terminal 的应用，支持多 session 和扩展</li>
<li>Kaleidoscope：Mac 下最佳对比工具，没有之一，唯一的缺点就是太贵了【付费】</li>
<li>MesaSQLite：SQLite 数据库管理软件</li>
<li>Sublime text：传说中代替 textmate 的代码编辑器，可使用开发版免费试用【付费】</li>
<li>Sequel pro：Mysql 数据库管理软件</li>
<li>TotalFinder：躺着也中枪的 Finder 增强型工具，10.8 以下强烈推荐（10.9 系统实现），虽然收费但是可以全功能无限期使用【收费】</li>
<li>Xcode：Mac OSX/iOS 开发唯一指定 IDE</li>
<li>Mou：Markdown 编辑器</li>
<li>Cornerstone：比较好用的 svn 客户端，偶尔使用，大多数用 <code>git-svn</code> 转换【收费】</li>
<li>Dash：整合了当前最全的各种语言，框架，第三方包的文档查询和 code snippets 工具【增强付费】</li>
<li>MongoHub：Mongodb 客户端，大数据时总会崩溃。暂无其他应用替代</li>
<li>Producteev：多平台的项目事项管理工具，虽然是 Todo list 但比较专业</li>
<li>Wunderlist：To-Do list 工具【增强付费】</li>
</ul>
<h4 id="图像设计">图像&amp;设计</h4>
<ul>
<li>Sip：取色工具，限免时购入【付费】</li>
<li>Skala Preview：iOS 快速设计稿预览工具</li>
<li>Sparkbox：图片资源管理工具【付费】</li>
<li>Lightroom 4：传说中数码照片处理工具【付费】</li>
<li>Fireworks：虽然已经被 Adobe 毙掉了，但是它是我唯一会使用的图片处理工具【付费】</li>
<li>Live Interior 3D Pro：快速户型设计工具【付费】</li>
</ul>
<h4 id="数据备份">数据备份</h4>
<ul>
<li>Dropbox：多平台文件云同步软件，我的文档，照片（内置自动同步）和代码都在这里</li>
<li>云诺：国内的多平台文件云同步软件，一些大体积的文件丢这里保存</li>
<li>Pocket：Read it later 前身，收集的文章都在这里看</li>
<li>Evernote：笔记整理同步必备</li>
</ul>
<h4 id="日常使用">日常使用</h4>
<ul>
<li>Chrome：可以使用 Google 账户同步书签，扩展，密码等</li>
<li>Fantastical：增强系统日立和提醒事项的快速工具</li>
<li>LibreOffice：Office 套件</li>
<li>doo：文档辅助检索归档工具</li>
<li>Skim：PDF 阅读器</li>
<li>Synergy：多平台的多设备通用一套鼠标键盘的工具</li>
<li>阿里旺旺：淘宝剁手党必备</li>
<li>QQ：不解释</li>
<li>备忘录（Notes）：系统自带的记笔记的工具（通过 iCloud 云同步数据到手机）</li>
<li>提醒事项（Reminder）：系统自带的 To-Do List 工具（通过 iCloud 云同步数据到手机）</li>
</ul>
<h4 id="音乐视频">音乐视频</h4>
<ul>
<li>dRadio：豆瓣 FM app，支持歌词和热键。淘汰了之前的 DoubanFM</li>
<li>iTunes：音乐，Podcast 的利器，就是太吃内存</li>
<li>Music Converter：音乐格式转换工具</li>
<li>SmartConverter：电影格式转换工具，支持手持设备的大小转换</li>
<li>MPlayerX：视频播放器利器，备选可以用 VLC</li>
</ul>
<h4 id="娱乐">娱乐</h4>
<ul>
<li>Simple Comic：看漫画软件</li>
</ul>
<h3 id="command">Command</h3>
<ul>
<li>zsh：配合 <code>oh-my-zsh</code> 使用的最好的 shell</li>
<li>git：SCM 管理工具</li>
<li>tig：<code>git log</code> 增强辅助工具</li>
<li>axel：多线程下载工具</li>
<li>youtube-dl：youtube 视频下载器（需翻墙先）</li>
<li>autojump：记录用户每次 cd 的路径，根据缩写快速跳转</li>
<li>tmux：终端分屏利器，建议看下这本书：《》</li>
<li>nginx：服务器</li>
<li>mysql：数据库</li>
<li>kdiff3：内容对比工具，一般 <code>git merge-tools</code> 时使用</li>
<li>android-sdk：Mac OX 在开发 Android 利器</li>
<li>brew： Mac OS 下最佳包管理工具，以上所述命令行应用都可以通过它来安装</li>
</ul>
]]></content:encoded></item><item><title>呼伦贝尔骑行计划书</title><link>https://icyleaf.com/2013/05/riding-to-hulunbeier/</link><pubDate>Sat, 25 May 2013 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2013/05/riding-to-hulunbeier/</guid><description>一星期几个基友们的骑行规划</description><content:encoded><![CDATA[



<div class="updated">
  <header class="updated-header">
    <h4 class="updated-title">更新</h4>
    
    <p class="updated-meta">7月 1, 2013</p>
    
  </header>
  <article class="updated-body">
    完成于 2013 年端午节期间，成果和照片：
<a href="http://www.douban.com/photos/album/107796607/">http://www.douban.com/photos/album/107796607/</a>
  </article>
</div>


<h1 id="呼伦贝尔骑行计划书">呼伦贝尔骑行计划书</h1>
<h2 id="出行时间">出行时间</h2>
<p>2013.6.9 ~ 6.16 (端午+请两天假+周末)</p>
<p>计划安排 16 日到达北京，不影响 17 日正常上班。</p>
<h2 id="总公里数">总公里数</h2>
<p>约 500 ~ 600km （有效骑行时间为4天半）</p>
<h2 id="路线地图">路线地图</h2>













  
  
    
      <figure data-pswp="1034x835" data-size="800x"><a href="/uploads/2013/05/25/hulunbeier-riding-roadmap.jpg" class="gallery-item" target="_blank" data-pswp-width="1034" data-pswp-height="835"><img src="/uploads/2013/05/25/hulunbeier-riding-roadmap_hu6dcac0a8d491935924faf69d0f5e89b1_202439_800x0_resize_q75_box.jpg"/></a><figcaption>

    <p>呼伦贝尔旅行地图</p></figcaption></figure>

<h2 id="预计费用">预计费用</h2>
<table>
<thead>
<tr>
<th>名称</th>
<th>费用</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>火车费</td>
<td>820</td>
<td>按照优先车次</td>
</tr>
<tr>
<td>餐费</td>
<td>50*7 = 350</td>
<td>含水</td>
</tr>
<tr>
<td>住宿</td>
<td>50*4 = 200</td>
<td>民宅借宿</td>
</tr>
<tr>
<td>其他费用</td>
<td>未知</td>
<td>可能会出现未遇见的各种费用</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><strong>总计</strong></td>
<td><strong>1450</strong></td>
<td>估算数字，具体依据实际消费统计</td>
</tr>
</tbody>
</table>
<h2 id="计划修订">计划修订</h2>
<ul>
<li><a href="https://gist.github.com/icyleaf/5626948/5f9340c235a4f512c39a05a8125b2e16418dff82">满洲里线</a></li>
<li>恩和线（<strong>当前</strong>）</li>
</ul>
<h2 id="北下边境线">北下边境线</h2>
<h4 id="day-0-北京---齐齐哈尔">Day 0 北京 - 齐齐哈尔</h4>
<table>
<thead>
<tr>
<th>车次</th>
<th>出发地</th>
<th>到达地</th>
<th>出发时间</th>
<th>到达时间</th>
<th>历时</th>
<th>类型</th>
</tr>
</thead>
<tbody>
<tr>
<td>K39</td>
<td>北京</td>
<td>齐齐哈尔</td>
<td>23:00</td>
<td>18:32</td>
<td>19:32</td>
<td>硬铺：314</td>
</tr>
</tbody>
</table>
<h4 id="day-1-齐齐哈尔---伊图里河---恩和骑行约160km">Day 1 齐齐哈尔 - 伊图里河 - 恩和（骑行约160km）</h4>
<table>
<thead>
<tr>
<th>车次</th>
<th>出发地</th>
<th>到达地</th>
<th>出发时间</th>
<th>到达时间</th>
<th>历时</th>
<th>类型</th>
</tr>
</thead>
<tbody>
<tr>
<td>K7093</td>
<td>齐齐哈尔</td>
<td>伊图里河</td>
<td>22:55</td>
<td>11:20</td>
<td>12:25</td>
<td>硬铺：95</td>
</tr>
</tbody>
</table>
<h4 id="day-3-恩和---七卡---乌兰山---五卡---黑山头口岸骑行约120km">Day 3 恩和 - 七卡 - 乌兰山 - 五卡 - 黑山头口岸（骑行约120km）</h4>
<h4 id="day-4-黑山头口岸---额尔古纳骑行约100km">Day 4 黑山头口岸 - 额尔古纳（骑行约100km）</h4>
<h4 id="day-5-额尔古纳---海拉尔骑行约140km">Day 5 额尔古纳 - 海拉尔（骑行约140km）</h4>
<h4 id="day-6-海拉尔---北京">Day 6 海拉尔 - 北京</h4>
<table>
<thead>
<tr>
<th>车次</th>
<th>出发地</th>
<th>到达地</th>
<th>出发时间</th>
<th>到达时间</th>
<th>历时</th>
<th>类型</th>
</tr>
</thead>
<tbody>
<tr>
<td>K1302</td>
<td>海拉尔</td>
<td>北京</td>
<td>15:47</td>
<td>21:18</td>
<td>29:31</td>
<td>硬铺：403</td>
</tr>
<tr>
<td>K278</td>
<td>海拉尔</td>
<td>北京北</td>
<td>18:18</td>
<td>23:29</td>
<td>29:11</td>
<td>硬铺：365</td>
</tr>
</tbody>
</table>
<h4 id="day-7-到达北京">Day 7 到达北京</h4>
]]></content:encoded></item><item><title>针对 Universal 应用上线 App Store 的提示</title><link>https://icyleaf.com/2013/02/app-store-review-tips-about-universal-app/</link><pubDate>Tue, 19 Feb 2013 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2013/02/app-store-review-tips-about-universal-app/</guid><description>上线 Universal 被拒后的想法和思考</description><content:encoded><![CDATA[<h2 id="官方禁止新版本支持的设备小余旧版本">官方禁止新版本支持的设备小余旧版本</h2>
<p><a href="https://itunes.apple.com/cn/app/le-ju-ji-suan-qi-zui-gei-li/id397735649?mt=8">乐居计算器</a>是我们的第一款 Universal 应用，这次做了重要变化，但仅限于 iPhone 的修改，本想改本次上线仅支持 iPhone 来赶 deadline，临到上线的时候却被 Xcode 报错：</p>
<blockquote>
<p>&ldquo;This bundle does not support one or more of the devices that were supported in the previous bundle for this app. Bundles must continue to support any devices previously supported.&rdquo;</p>
</blockquote>
<p>官方《<a href="https://developer.apple.com/appstore/guidelines.html">App Store Review Guidelines</a>》却没有提到有这样的限制，最后在官方技术 Q&amp;A 找到答疑，参见 <a href="http://developer.apple.com/library/ios/#qa/qa1623/_index.html">Why am I getting device support errors when uploading my app?</a></p>
<h2 id="iphone-和-ipad-的排名是分开统计的">iPhone 和 iPad 的排名是分开统计的</h2>
<p>不知道大家注意没有，其实就算你发布的 app 是 Universal，但 app store 针对它的排行榜确实分开计算的，因此在做排名统计的时候不要只顾着一个设备的数据。那这个下载的数据怎么计算呢？</p>
<ol>
<li>什么设备下载就算那个设备的数据</li>
<li>通过 itunes 下载的算 iphone 的数据（Ocz）</li>
</ol>
<blockquote>
<p>数据来源：<a href="http://www.quora.com/How-does-being-a-universal-app-affect-App-Store-rankings">How does being a universal app affect App Store rankings</a></p>
</blockquote>
<h2 id="iphoneipad-新版本改为-universal两者都算新品上线">iPhone/iPad 新版本改为 Universal，两者都算新品上线</h2>
<p>原理同上，不再细说</p>
<h2 id="iphoneipad-还是一劳永逸的-universal">iPhone/iPad 还是一劳永逸的 Universal</h2>
<p>这是一个众说纷纭的话题，我的个人建议是，如果团队人较少且应用是免费发布，尽可能做成 Universal，减少不必要的维护成本和开发成本（虽然兼容平台会有一些牺牲）；如果是做付费且运营的人员可以支撑，可以最快最能抓住市场需求的点发布 iPhone 版本，通过市场反应去绝对是否开发 iPad 版本，等推广达到一个峰值（这个需要自己衡量）时，可以把 iPhone 或 iPad 的改成 Universal 版本，再次赚上一笔。</p>
<p>当然也有从 Universal 版拆分为 iPhone 和 iPad 的策略，不过我个人对此营销手段感到反感。重要的事让用户失去了占便宜的特殊心理。</p>
<h3 id="扩展阅读">扩展阅读</h3>
<ul>
<li><a href="http://www.cocoanetics.com/2011/05/to-universal-or-not/">To Universal or Not</a></li>
<li><a href="http://blog.iteleportmobile.com/the-case-for-universal-apps">The Case for Universal Apps</a></li>
</ul>
]]></content:encoded></item><item><title>Dash</title><link>https://icyleaf.com/2013/02/dash/</link><pubDate>Wed, 06 Feb 2013 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2013/02/dash/</guid><description>你值得拥有的文档管理工具</description><content:encoded><![CDATA[<p>Dash 是 Mac OS 的一个文档管理工具，从它第一版发布用到现在，绝对是一个你值得拥有的文档管理工具，因为它还是免费的，你可以从 <a href="https://itunes.apple.com/cn/app/dash-docs-snippets/id458034879?mt=12">Mac App Store</a> 购买。但是全功能需要应用内付费，否则有些“小骚扰”。</p>
<blockquote>
<p>建议购买 Full Version，目前是半价，人民币 30 元</p>
</blockquote>
<p><img loading="lazy" src="http://a1.mzstatic.com/us/r1000/106/Purple/v4/14/50/16/14501624-f6fd-4dae-a2bf-187a5a6417de/icon.175x175-75.png"
  
  
  alt="Dash"></img>
</p>
<h2 id="特性">特性</h2>
<ul>
<li>支持任何一个你想管理的文档（iOS/Mac/PHP/Python/Java/jQuery/Backbone.js 等等）</li>
<li>支持自定义生成你想要的文档（AppleDoc/JavaDoc/RDoc/Doxygen/pydoctor/Sphinx/Scaladoc）</li>
<li>自动升级文档版本</li>
<li>快捷键搜索文档及 API</li>
<li>管理和搜索 Code Snippets</li>
<li>无缝插入众多第三方应用（Alfred，XCode，Terminal，Eclipse，甚至任意的 App）</li>
</ul>
<h2 id="功能介绍">功能介绍</h2>
<p>这块已经有人介绍了，我就不多说了：<a href="http://scriptfans.iteye.com/blog/1543219">Dash：程序员的的好帮手</a></p>
<h2 id="生成自己的文档">生成自己的文档</h2>
<p>Dash 本身只支持 docsets 格式的文档，也就是由 <a href="http://gentlebytes.com/appledoc/">appledoc</a> 生成的。默认是让 XCode 的 Organizer 管理文档，但是针对这个庞然大物，只是做文档的管理和快速搜索有消受不起。因此 Dash 才诞生出来的。</p>
<p>其实本篇日志主要是讲这块的内容，从上面的特性上面我也说到 Dash 支持生成任何的文档，因为它支持的文档类型涵盖了目前绝大多数的文档格式，针对这块官方已经写了<a href="http://kapeli.com/docsets">如何转换的说明</a>，这里简单说明下：</p>
<table>
<thead>
<tr>
<th>语言</th>
<th>转换工具</th>
</tr>
</thead>
<tbody>
<tr>
<td>Objective-C 文档</td>
<td><a href="http://gentlebytes.com/appledoc-docs-examples-basic/">appledoc</a></td>
</tr>
<tr>
<td>Python, Sphinx, pydoctor</td>
<td><a href="http://pypi.python.org/pypi/doc2dash/">doc2dash</a></td>
</tr>
<tr>
<td>Javadoc</td>
<td><a href="http://kapeli.com/JavaDocset.zip">java.docset</a></td>
</tr>
<tr>
<td>RDoc</td>
<td>使用 Dash 自身的 &ldquo;Ruby Installed Gems&rdquo;</td>
</tr>
<tr>
<td>Scaladoc</td>
<td><a href="https://bitbucket.org/inkytonik/mkscaladocset">mkscaldocset</a></td>
</tr>
<tr>
<td>Doxygen(源码)</td>
<td>修改参数生成</td>
</tr>
<tr>
<td>docsetutil</td>
<td>需要创建指定目录结构</td>
</tr>
<tr>
<td>SQLite</td>
<td>官方支持数据库索引，需要创建指定目录结构</td>
</tr>
</tbody>
</table>
<h3 id="生成-flask-文档">生成 Flask 文档</h3>
<p>因为最近在学习 Flask，过年回家家里没有网络，因为我需要可以查询它的文档，虽然官方提供了 html 和 pdf 格式，但是没有办法快速搜索 API，没法发挥 Dash 的优势嘛，对吧！</p>
<p>Flask 官方提供的 html 文档是 Sphinx 格式的，首先把<a href="http://flask.pocoo.org/docs/flask-docs.zip">文档</a>下载到本地，并安装好 doc2dash，另外备好一个 <a href="https://bitbucket-assetroot.s3.amazonaws.com/c/photos/2011/Sep/30/flask-logo-2523728525-3_avatar.png">flask icon</a>。</p>
<pre tabindex="0"><code>$ pip install doc2dash
</code></pre><p>因为 Dash 可以让每个文档都有自己的 Icon，否则默认只是 docset 的 Icon，下载完毕之后，执行代码：</p>
<pre tabindex="0"><code>$ doc2dash --name Flask --icon flask-logo.png --add-to-dash /path/to/flask-docs
</code></pre><p>其中 <code>--add-to-dash</code> 是生成完毕后自动添加到 Dash，默认生成好的 docset 文件在当前目录。</p>
<p>好了，Dash 已经可以索引到所有的 Flask API 了，真是太 TMD 的酷了！</p>
<h2 id="维护你的文档">维护你的文档</h2>
<p>如果你希望把自己生成的文档分享出来，并提供后期的维护升级，你可以提供一个 feed 保持文档的自动更新，这里有<a href="http://kapeli.com/feeds/NodeJS.xml">一个关于 NodeJS 的例子</a>。</p>
<ul>
<li>你可以提供多个 url 多备份提供文档下载</li>
<li>支持 tgz 格式的打包</li>
</ul>
]]></content:encoded></item><item><title>介绍 virtualenvwrapper</title><link>https://icyleaf.com/2013/01/intro-virtualenvwrapper/</link><pubDate>Wed, 16 Jan 2013 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2013/01/intro-virtualenvwrapper/</guid><description>多 Python 版本环境的管理工具</description><content:encoded><![CDATA[<p>上回说到 <a href="http://icyleaf.com/2012/07/intro-virtualenv">virtualenv</a> 的基本使用，这会为了提高工作效率，再次介绍针对于它增强的一个扩展 <a href="http://www.doughellmann.com/projects/virtualenvwrapper/">virtualenvwrapper</a>。</p>
<h2 id="安装配置">安装配置</h2>
<pre tabindex="0"><code>$ pip install virtualenvwrapper
</code></pre><p>安装好之后需要简单配置下，主要是设置独立环境的保存路径：</p>
<pre tabindex="0"><code>$ export WORKON_HOME=~/Envs
$ mkdir -p $WORKON_HOME
$ source /usr/local/bin/virtualenvwrapper.sh
</code></pre><p>如果使用 oh-my-zsh 的可以开启对应的 virtualenvwrapper 插件， <code>WORKON_HOME</code> 会设置在 <code>~/.virtualenvs/</code></p>
<h2 id="常用命令">常用命令</h2>
<h1 id="查看已创建的环境">查看已创建的环境</h1>
<pre tabindex="0"><code>$ lsvirtualenv
</code></pre><h1 id="创建环境">创建环境</h1>
<pre tabindex="0"><code>$ mkvirtualenv &lt;env_name&gt;
$ mkvirtualenv -r requirements.txt &lt;env_name&gt;
</code></pre><h1 id="切换到某个环境">切换到某个环境</h1>
<pre tabindex="0"><code>$ workon &lt;env_name&gt;
</code></pre><h1 id="设置当前环境的默认工作路径下次执行-workon-命令会自动切换路径">设置当前环境的默认工作路径(下次执行 workon 命令会自动切换路径)</h1>
<pre tabindex="0"><code>(env_name) $ setvirtualenvproject
</code></pre><h1 id="查看当前环境已安装的-packages">查看当前环境已安装的 packages</h1>
<pre tabindex="0"><code>$ lssitepackages
</code></pre><h1 id="删除环境">删除环境</h1>
<pre tabindex="0"><code>$ rmvirtualenv &lt;env_name&gt;
</code></pre><h1 id="创建临时环境-deactivate-之后自动销毁">创建临时环境 (deactivate 之后自动销毁)</h1>
<pre tabindex="0"><code>$ mktmpenv
</code></pre><p>查看更详细的<a href="http://virtualenvwrapper.readthedocs.org/en/latest/command_ref.html">命令描述文档</a>。</p>
]]></content:encoded></item><item><title>面粉的种类说明</title><link>https://icyleaf.com/2013/01/types-of-flour/</link><pubDate>Mon, 14 Jan 2013 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2013/01/types-of-flour/</guid><description>饺子，面包，馒头的面粉有区别吗</description><content:encoded><![CDATA[<blockquote>
<p>以下资源收集于网络。</p>
</blockquote>
<h2 id="面粉为何物">面粉为何物</h2>
<p>小麦是世界上栽种最广的粮食。与其它谷物去壳后直接食用不同，小麦表面麸皮坚韧，内部胚乳易碎，难以加工成整粒，所以只能磨制成面粉。</p>
<p>小麦面粉和其它粮食磨成粉的最大区别在于小麦特有的两种蛋白质能够结合形成弹性和延展性都很好的面筋（就是既能拉得很长，又不会断掉），因此只有小麦才能制作出花样繁多、口感各异的面食制品。</p>
<p>面粉中面筋的含量和质量（就是两种蛋白质各自的含量）取决于小麦作物的品种和种植过程，而不是面粉加工过程，但是在加工储藏过程中，蛋白质含量有可能发生变化。</p>
<h3 id="基本概念">基本概念</h3>
<ul>
<li><code>面筋</code>：就是从面粉中提取出的（纯筋度）蛋白质部分，可以拌凉皮、做油面筋等中国特色美食。</li>
<li><code>小麦淀粉</code>：又叫澄粉，澄面，汀粉，汀面，就是面粉里除掉蛋白质之后剩下的（无筋度）淀粉部分，颜色非常白，是水晶糕点的主要原料，也是凉皮的原料。</li>
</ul>
<h2 id="面粉的分类">面粉的分类</h2>
<ul>
<li><code>高筋面粉</code>：又叫强力粉，bread flour，蛋白质含量11.5%以上，筋度最强，用于做面包、批萨、泡芙、油条、千层饼等需要依靠很强的弹性和延展性来包裹气泡、油层以便形成疏松结构的点心。</li>
<li><code>中筋面粉</code>：最普通的面粉，plain flour，蛋白质含量9.5-11.5%，用于做馒头、包子、饺子、烙饼、面条、麻花等大多数中式点心。</li>
<li><code>低筋面粉</code>：又叫薄力粉，cake flour，蛋白质含量6.5-9.5%，可以用按照质量比四份中筋面粉加一份玉米淀粉（其它淀粉也可以）混合配成，适合做蛋糕、饼干、蛋挞等松散、酥脆、没有韧性的点心。</li>
<li><code>自发粉</code>：超市里卖的自发粉是面粉中混入一定比例的酵母、泡打粉和其它化学添加剂，用时只需要加水，而且可以节约发酵时间。使用自发粉应该按照包装上的说明，因为不同的产品配方，使用方法可能有不同。</li>
<li><code>全麦面粉</code>：小麦种子由麸皮、胚乳、胚芽三部分组成，麸皮坚硬难以消化，胚芽含油丰富易酸败，因此面粉由胚乳制成。但是麸皮提供丰富的膳食纤维，非常有益于人的消化过程。所以，全麦面粉就是在胚乳制成的普通面粉中添加磨制过的麸皮，对于面包、蛋糕、面条等不同的用途，所添加的麸皮比例和麸皮大小、形状也各有不同，所以其实全麦面粉并不是整个的麦粒直接磨碎的粗制品，反而是更加复杂的精制品。</li>
</ul>
<h2 id="中国地区的说明">中国地区的说明</h2>
<p>现在国内超市粮食区卖的面粉主要是适合中式面食的中筋面粉，而标注<strong>精粉</strong>, <strong>特粉</strong>, <strong>富强粉</strong>的是表明面粉的加工精细程度，而不是面粉的筋度含量。一般可以用中筋面粉代替高筋面粉或者低筋面粉而不会有明显差别。</p>
<blockquote>
<p><code>饺子粉</code> 是中筋面粉，<code>面包粉</code> 是高筋面粉。</p>
</blockquote>
]]></content:encoded></item><item><title>2011-2012 两年总结</title><link>https://icyleaf.com/2013/01/2011-2012-in-review/</link><pubDate>Tue, 01 Jan 2013 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2013/01/2011-2012-in-review/</guid><description>回忆两年的事情是一件痛苦的事情，幸好赶上了新浪潮</description><content:encoded><![CDATA[<p>从 2011 年忙碌到 2012 年，这两年的时间经历的很多事物，让我感受颇多，而我惊讶的是 2011 的年终总结居然缺失了。这两年工作上专注了一个领域，也是当前最火热移动互联网。两年放在一起总结也算是比较完整的。</p>
<p>总结从已下几大方面分别详细描述：</p>
<ul>
<li>移动互联网</li>
<li>技术</li>
<li>户外</li>
<li>书影音</li>
<li>下厨</li>
<li>品酒</li>
<li>游戏</li>
</ul>
<h2 id="移动互联网">移动互联网</h2>
<p>在 2010 年终总结也有说过，因为出身 Java，对于 Android 的兴趣以及入手 MBP，又禁不住和 iOS 做个比较，以至于今后踏上了移动互联网的风潮。正好公司和领导也希望组建这样一个团队。于是 @lnsoso 牵头，尽快组建了小团队开始了新的尝试。</p>
<h3 id="团队">团队</h3>
<p>新的团队专注于移动互联网的手机平台：Android 和 iOS。应用主要是“房产”这个相对比较垂直的领域。虽然经历了两年的时间，我们还是保持轻小的团队，核心人员加起来也不到 6 个人，更像是一个创业团队。经历了两年的时间，做了一些产品，其中有欢乐，有痛苦，有争执，甚至更激烈的争吵。但是这些都不会阻碍我们的前进，不仅让我们之间在工作中更好的合作，生活上也成为了至好的朋友。</p>
<blockquote>
<p>能够和这么出色的移动团队一起工作，我感动非常的荣幸！借此感谢 @<a href="http://weibo.com/206424200">lnsoso</a>， @<a href="http://weibo.com/54mifan"><em>米饭</em></a>， @<a href="http://weibo.com/stcui">SC崔圣</a>， @<a href="http://weibo.com/u/1611804343">瑞宇</a>， 小胖， @<a href="http://weibo.com/designl">Design_L</a>， 英军，周奎，庆祥，刘伟和小雨。</p>
</blockquote>
<h3 id="角色变化">角色变化</h3>
<p>小团队虽然灵活度很高，但每个人也要担着多项的角色，对于每个人来说都是一种挑战，同样对于我也是。从产品构思，原型设计，前端、后段的代码编写都需要一个人来全程承担，对于程序员来说，相对还算好，缺陷是容易站在局限的角度考虑事情；对于一个项目，不仅仅产品要优秀，更重要的还是要运营的好。对于这个角色我感到有压力。虽然这个行业大家都是在摸着石头过河，本身作为程序员来说，“运营”是一个艰巨的任务。</p>
<p>最初作为程序员来说，总是觉得和产品，设计等非技术人员存在沟通障碍。尤其是上面想法传达下来的本质变化导致开发出来一个四不像的“怪物”，内心会有一种“产品应该这样才符合逻辑，这样，那样修改灵活的更高”的冲动。然后自己真正担当了“<strong>产品</strong>”这个角色，需要涉及到：</p>
<ul>
<li>扩大自己的思考范围</li>
<li>如何和各阶人员沟通</li>
<li>和所有参与人员很好沟通并还原真实想法继续碰撞火花</li>
<li>更好的在技术上展现</li>
</ul>
<p>而“运营”这个角色，体现了如何把自己的产品扩散出去。程序员很难从自身的“小宇宙”释放出来。这也是为什么程序员的转型只有两个：架构师和产品经理。</p>
<p>说实话我本身不是一个好运营，也当不了这个角色。接触这个角色能让我在产品和技术上继续更多的思考。</p>
<p>不过“技术”才是我的最爱，其他的角色只是为了更好的让我架构于技术。</p>
<h3 id="产品">产品</h3>
<p>房产类的应用其实非常的小众。买房，装修对于大多数人来说都是一次性消费。也很难会有冲动消费。唯一可以有苗头的就是租房业务。然后这个行业由于各种房产中介的介入导致行业的乌鸦瘴气，再加上用户的流动性非常的大，需求周期相对比较长。导致整个房产行业相对比较难做。因此团队初期没有任何创新的应用，大多于公司业务相关：</p>
<ul>
<li><a href="http://3g.leju.com/1/2011/1103/1.html">口袋房产</a> - 专注租房和二手房用户，里面整合了我们很多贴心而且很酷的功能。</li>
<li><a href="http://3g.leju.com/1/2011/1103/2.html">乐居计算器</a> - 最给力的房产、家居计算器。汇率第一时间更新，还有贷款的还款提醒，妈妈再也不用担心我忘记还款了。</li>
<li><a href="http://3g.leju.com/1/2011/1206/6.html">帝都空气质量</a> - 去年 PM2.5 很火的时候，花了一个星期做的小应用，上线第一天就冲到了天气分类前三名，而且当时我在外地出差，路上构思了很好的宣传语，结果第二天被“网监局”勒令下线了。原因在于应用不能以大公司的名义发布。</li>
<li><a href="http://3g.leju.com/1/2012/0614/8.html">口袋新房</a> - 凭借我们强大的房产数据库，打造最新最热的新房资料及资讯。</li>
</ul>
<p>后续还有些公司的产品由其他部门策划和开发。导致策划的创新项目又无法开展。这点较为头疼。</p>
<p>除此之外其实自己还有一个比较不太惹眼的项目：移动产品通用管理后台系统。由于产品的数据需要不断的交互，加上各种需求和统计需要，实现了很多很棒的功能：</p>
<ul>
<li>各个产品的信息，用于版本更新和应用推荐</li>
<li>用户评论的自动采集，Feedback 的反馈和答复</li>
<li>产品的用户统计数据</li>
<li>统计任意 iOS 产品的发布情况，策略分析和排名情况</li>
<li>应用调用接口的权限系统和统计数据</li>
<li>健全的日志系统</li>
<li>加上 twitter boostrap 的出现，又很好的兼容了移动设备。</li>
</ul>
<p>根据产品的需求不断的改善优化一个产品的感觉真好。</p>
<h2 id="技术">技术</h2>
<h3 id="phpjavaobj-c">PHP/Java/Obj-C</h3>
<p>工作原因这三个语言哪个都不能丢，需实时关注和研究：</p>
<ul>
<li>PHP: 继续保持关注 Kohana 这个框架。更好为服务器端开发，为前端服务。</li>
<li>Java/Android: 从效率和内存管理上，更好的架构整个框架。</li>
<li>Obj-C/iOS: 除了自身的知识学习，每次 iOS 升级都有新鲜感，ARC，Storyboard 等特性。推荐 CocoaPod 管理库类。迁移升级 <a href="https://github.com/icyleaf/ShareKit">ShareKit</a> 目前已经能够完美支持国内主流分享服务。生产自己的应用。</li>
<li>Obj-C/Mac：破天荒的为了朋友写了第一个编码转换的 Mac App：<a href="http://icyleaf.com/2012/10/easyconvert-gbk-to-utf8-convert-tool-for-mac">EasyConvert</a>，而且还破天荒的收到一个 pull request，感动</li>
<li>Javascript/jQuery：写过几个豆瓣扩展，全选邀请好友，批量喜欢友邻的喜欢的东西。唉，热心肠就是要多付出。</li>
</ul>
<p>除此之外还接触了 Python 和 Go。</p>
<p>Python 作为脚本语言在命令行下可以完美处理零碎的工作，加上 <a href="https://github.com/openparty/openparty">OpenParty</a> 网站代码需要改进，而又学习了 Django 框架（好大好重- -！）。</p>
<p>Go 了解不多，个人感觉更像是 C 的变异超集，性能和编写上有了很大的改进，也能很好的调试，甚至是为服务器端服务。但是受于 C 的理念和局限性， Go 也不能脱离一些缺陷的设计。</p>
<h2 id="户外">户外</h2>
<p>从 09 年开始和几个朋友陆续做了几次外出。起初爬山仅仅是为了活动筋骨，减少职业病的发生，但后来却逐渐的爱上了这个爱好。工作突然繁忙中断了下来，但对于户外热爱不曾熄灭过。2011 年夏天重新走出户外。</p>
<h3 id="爬山">爬山</h3>
<p>2011：</p>
<ul>
<li>2011-06-04 参加了活动 去看看初夏的关沟</li>
<li>2011-06-12 参加了活动 《小北队》“箭扣长城-那无法抵挡的诱惑”</li>
<li>2011-07-17 参加了活动 去十三陵走八陵一库</li>
<li>2011-07-31 参加了活动 【逍遥游】7月31日 水泉沟-黄花城-香屯一日穿越</li>
<li>2011-08-06 参加了活动 三岔村野长城</li>
<li>2011-08-13 参加了活动 【逍遥游】8月13-14翡翠岛第二季优惠活动火爆召集中</li>
<li>2011-09-03 参加了活动 【华北小黄山】云蒙天仙瀑 冷甸豪宅任我行</li>
</ul>
<p>2012：</p>
<ul>
<li>2012-01-02 参加了活动 元旦崇礼雪乡穿越</li>
<li>2012-03-03 参加了活动 北京最美乡村-香屯-大云峡谷穿越，感受山谷间纯净的美-徒步、观冰瀑，摄影，赏古长城，一日穿越活动！</li>
<li>2012-03-17 尼泊尔文化之旅</li>
<li>2012-07-07 参加了活动 7号8号海陀第二届帐篷节扎营 纯属自娱自乐 捡拾垃圾活动。</li>
<li>2012-08-04 参加了活动 【三丰队】明长城、东指壶——平谷第一高峰连穿</li>
<li>2012-08-11 组织了活动 【漫步人生，活在当下】东灵山重装穿越，露营</li>
<li>2012-11-11 参加了活动 【漫步人生，活在当下】风雪箭扣 - 反穿线路，西栅子 - 将军把关 - 天梯 - 飞鹰倒挂</li>
<li>2012-11-19 参加了活动 【四野户外】风雪大五台，周末五台连穿</li>
<li>2012-12-08 组织了活动 【漫步人生，活在当下】经典线路：香八拉-新人拉练</li>
</ul>
<p>户外照片：<a href="http://www.517huwai.com/photos/11573">http://www.517huwai.com/photos/11573</a></p>
<h3 id="骑行">骑行</h3>
<p>怎么说呢，既然爬山了，怎么能少的了骑车呢，从小就爱骑车，每逢周末都要骑上车在小城里面四处的骑行。虽然没有怎么骑行远路。从心底还是比较热爱的。在 2012 年 05 月末结束了缠绕我两年多的纠结，入手了“美利达”山地车（淘宝购入，远远低于低于市场价。全新专卖店货色）</p>
<p>然后总是频频刷街于长安街，还是没有太远的骑行，到现在最长的路线也就 100 多公里而已。骑行之后才真正发现，骑行原来比爬山过程更加艰辛。尤其是丘陵地带（有感于南京）。</p>
<p>明年争取环青海湖 :)</p>
<p>部分骑行路线：<a href="http://www.douban.com/photos/album/34304181/">http://www.douban.com/photos/album/34304181/</a></p>
<h3 id="旅行">旅行</h3>
<ul>
<li>2011年十一期间的北疆之旅，历时 8 天，花费 8k 上下</li>
<li>2012年三月的尼泊尔文化之旅，历史 7 天，花费 5k 上下</li>
</ul>
<p>两次单身旅行，让我深深的感受到，其实出国游没有那么难，而且更舒服，钱还不一定比国内游贵。</p>
<h2 id="书影音">书影音</h2>
<p>数据来源于自己书影音的记录。</p>
<h3 id="读书">读书</h3>
<p>看了下历年的统计，我 2010 年读过 82 本（有水分）。 11 年读过 20 本，12 年读过 14 本，这两年读的书明显下降了好多，旅游的书在多数，技术的书明显少了很多。而图书馆去的次数也非常少了。来年要继续努力，读书不能再减了！</p>
<p>好评图书：窥视印度，不去会死，简单法则，冰与火之歌，黑客与画家，禅与摩托车的维修艺术。</p>
<h3 id="电影">电影</h3>
<p>很遗憾，IMDB Top250，居然历时三年还是没有看完，目前已经看到了第 194 名（不是最新的排名数据）。看了那么多不同类型的电影，终于从脑容量的电影成功转型，认识了一些影人，导演。相比较最近几年的电影，我很庆幸也很遗憾有那么多老电影没看过。</p>
<p>好评电影：IMDB Top250 所以电影 XD</p>
<h3 id="音乐">音乐</h3>
<p>尝试听古典音乐，而且还听了耶鲁大学的公开课《Listen to music》，让我喜欢上了德彪西的《月光》和柴可夫斯基第一&amp;第一钢琴协奏曲。钢琴和小提琴的配合是那么的颤动心灵。</p>
<p>其实自己听的音乐比较杂，和电影类似，除了重金属，等比较极度喧嚣的音乐外，能接受度比较高。</p>
<h2 id="下厨">下厨</h2>
<p>总觉得出了开封，我们家的小吃在任何地方要么吃不着，要么没有熟悉的味道。加上新搬的家附近没有一家良心餐馆，结果把自己的身体吃垮了。时隔 3 年依赖重新下厨开灶。本身擅长开封小吃类面点：羊肉炕馍，大肉火烧，锅贴，千层饼，鸡蛋饼，炒凉粉各种折腾。反正吃的自己不亦乐乎。</p>
<p>就在写这篇总结之前，花了一个小时给自己做了几张鸡蛋饼，一碗紫菜虾皮汤。</p>
<p>做饭本着一个原则：不能亏待自己的肚子，嗯！</p>
<h2 id="品酒">品酒</h2>
<p>在 2011 年体检查出来轻微脂肪肝，而原因有三，我可能涉及到两种：酒精性脂肪肝，肥胖性脂肪肝。为了健康，戒了大半年酒（也在于追求对象要求）。最终于 11 年光棍节之后还是单身开了酒戒。转念的体检发现脂肪肝木有了。由于同年也开始了户外，所以最终也没有判断出原因 &gt;.&lt;</p>
<p>啤酒：经 Tin 大师的推荐，喜欢上了比利时啤酒，尤其是智美和都威，前者是修道院啤酒，口感醇厚可嘉，分蓝/红/白帽，红、蓝智美都会随温度不同而明显呈现味道上的变化，至于白帽国内没见到有卖的；而后者劲儿相对比较大，入口略苦，入喉之后出现甘甜，是一种前期痛苦立马又享受想和下一口的冲动。</p>
<p>白酒：伏特加，托 <a href="http://www.douban.com/people/CNBorn/">CNBorn</a> 的福，尝试了纯伏特加的感觉，类似于都威前期，酒性很烈，入喉之后犹如一泉山水滋润着喉咙。这次试喝的是 Absolut Vodka。我不知道是否是否和喝的品牌有差异。</p>
<p>红酒：北京桂花陈酒，经济实惠的最佳选择。入口初体验入桂花糖水一般甜蜜，又夹杂着一些酒心糖的特殊酒味。后劲较大，一不小心很容易醉。</p>
<h2 id="游戏">游戏</h2>
<p>从小就爱玩游戏，打电动，从最初的掌声游戏机（俄罗斯方块），GBC，GBA SP，PSP 到主机类游戏红白机，街机，世嘉，土星，PS，PS2，电脑游戏，网游。都一概不拉的接触过。但自从开始工作之后接触的游戏基本上降到了最低。</p>
<p>一个机缘巧合，听说烈火战车（Twisted Metal）将于 2012 年情人节发行 PS3 版本。为了这个重温这个游戏，我居然入手了一台 PS3，因此购入了一些比较耐玩的游戏：</p>
<ul>
<li>烈火战车</li>
<li>刺客信条：兄弟会、启示录</li>
<li>镜之边缘</li>
<li>暴雨</li>
<li>神秘海域3</li>
<li>蝙蝠侠：阿卡姆疯人院</li>
<li>战地3</li>
</ul>
<p>游戏对于来说属于业余消遣，没事时候的解闷工具。沉迷？已经不太可能了。</p>
<h2 id="单纯">单纯</h2>
<p>原来出了程序员这个圈子，其他地方是那么的妖魔化，我喜欢纯粹的程序员生活。希望自己可以保持这份单纯，同时多一份戒心，防止不轨分子的侵袭。</p>
<h2 id="两年结语">两年结语</h2>
<p>很长时间没有写东西了，这一写有些控制不了自己的思想，最近两年思考的东西太多了，同时又少了倾诉。做的事情也逐渐多了，有时候觉得总会被世俗的东西侵袭，一些理想化，纯粹的东西开始动摇。有时候变得很难把握。感觉曾经的很多东西都在一件件的被磨灭或改变。</p>
<h2 id="2013">2013？</h2>
<p>说好的世界末日没有到来，日子还有继续生活下去。该奋斗的东西也不能丢，相信自己的信念，勇往直前吧！少年!</p>
]]></content:encoded></item><item><title>打绳结</title><link>https://icyleaf.com/2012/11/how-to-bends-and-hitches/</link><pubDate>Fri, 30 Nov 2012 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2012/11/how-to-bends-and-hitches/</guid><description>人在户外混还是要有点安全意识</description><content:encoded><![CDATA[<p>收集<a href="https://weibo.com/1819732165">磨房</a>微博上面主页君教你打绳结的一些知识点：</p>
<h1 id="alpine-butterfly-bend阿尔卑斯蝴蝶结">Alpine Butterfly Bend（阿尔卑斯蝴蝶结）</h1>
<p>这个绳结强度大可靠性高，登山的时候很实用，平时绑鞋带什么的就别这样弄了</p>
<p><img loading="lazy" src="http://ww2.sinaimg.cn/bmiddle/6c76e8c5jw1dyvsxbmdbjg.gif"
  
  
  alt="Alpine Butterfly
Bend"></img>
</p>
<h1 id="linemans-loop-中间结或工程蝴蝶结">lineman&rsquo;s loop (中间结或工程蝴蝶结)</h1>
<p>这种结经常用在登山时绑在中间的人身上；此时只要作个大绳圈套在中间人的身上即可。只要两头的人不想松开，中间的人就跑不掉啦.</p>
<p><img loading="lazy" src="http://ww2.sinaimg.cn/bmiddle/6c76e8c5jw1dz1crmzgl5g.gif"
  
  
  alt="lineman&amp;rsquo;s
loop"></img>
</p>
<h1 id="blakes-hitch-抓结或移动结">blake&rsquo;s hitch (抓结或移动结)</h1>
<p>用于行进，上升过程中的保护，此结不受力时可滑动，受力时在主绳上卡住不动。晚归不想在门外过夜，被迫从楼顶爬回自家阳台的汉子必备</p>
<p><img loading="lazy" src="http://ww4.sinaimg.cn/bmiddle/6c76e8c5jw1dz2oxc2g6ag.gif"
  
  
  alt="blake&amp;rsquo;s
hitch"></img>
</p>
<h1 id="双渔人结">双渔人结</h1>
<p>它是连接两根绳子的常用结法，这个结比较容易打，但是很难拆开，大家练习的时候注意不要打的太紧了。</p>
<p><img loading="lazy" src="http://ww2.sinaimg.cn/bmiddle/6c76e8c5jw1dz3mi2ddkzg.gif"
  
  
  alt="双渔人结"></img>
</p>
<h1 id="双绳八字结">双绳八字结</h1>
<p>今儿个教大家的是另外一种实用的连接两根绳子的结法。大家打的时候要把两端的绳子留长一点，才不容易滑脱<del>这种结法的优势在于：即使拉力很大，用过之后绳结都能够轻松解开。试过解不开绳子的同学就知道这个结的好了</del>（实际使用时不要用两根大小型号差异太大的绳子）</p>
<p><img loading="lazy" src="http://ww4.sinaimg.cn/bmiddle/6c76e8c5jw1dz52enzvd7g.gif"
  
  
  alt="双绳八字结"></img>
</p>
<h1 id="bowline-bend-单套结">bowline bend (单套结)</h1>
<p>绳结中间留出来的那个圈可用于绳与绳、绳与环之间的临时连接，常用于户外宿营或者是户外运动中进行固定的临时安全带。非要用听起来那么高级的结来绑鞋带的人你就绑吧</p>
<p><img loading="lazy" src="http://ww1.sinaimg.cn/bmiddle/6c76e8c5gw1dz68igt76pg.gif"
  
  
  alt="bowline
bend"></img>
</p>
]]></content:encoded></item><item><title>修复 OS X 打开方式的重复项</title><link>https://icyleaf.com/2012/11/%E4%BF%AE%E5%A4%8D-os-x-%E6%89%93%E5%BC%80%E6%96%B9%E5%BC%8F%E7%9A%84%E9%87%8D%E5%A4%8D%E9%A1%B9/</link><pubDate>Tue, 06 Nov 2012 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2012/11/%E4%BF%AE%E5%A4%8D-os-x-%E6%89%93%E5%BC%80%E6%96%B9%E5%BC%8F%E7%9A%84%E9%87%8D%E5%A4%8D%E9%A1%B9/</guid><description>$ /System/Library/Frameworks/CoreServices.framework/Versions/A/Frameworks/LaunchServices.framework/Versions/A/Support/lsregister -kill -r -domain local -domain system-domainuser</description><content:encoded>&lt;pre tabindex="0">&lt;code>$ /System/Library/Frameworks/CoreServices.framework/Versions/A/Frameworks/LaunchServices.framework/Versions/A/Support/lsregister -kill -r -domain local -domain system-domainuser
&lt;/code>&lt;/pre></content:encoded></item><item><title>EasyConvert</title><link>https://icyleaf.com/2012/10/easyconvert-gbk-to-utf8-convert-tool-for-mac/</link><pubDate>Thu, 25 Oct 2012 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2012/10/easyconvert-gbk-to-utf8-convert-tool-for-mac/</guid><description>托设计朋友的要求，继续奉献出一个小工具: EasyConvert - 针对于文本文件的编码转换工具 - GBK to UTF8 首先这个应用是用于 OS X 系统的，其次其实它是一个很弱的工具，对...</description><content:encoded><![CDATA[<p>托设计朋友的要求，继续奉献出一个小工具: EasyConvert - 针对于文本文件的编码转换工具 - GBK to UTF8</p>
<p>首先这个应用是用于 OS X 系统的，其次其实它是一个很弱的工具，对于技术宅来说一行代码搞定：</p>
<pre tabindex="0"><code>iconv -f GBK -t UTF-8 source.txt \&gt; output.txt
</code></pre><p>但对于非技术的人来说，跟他们说 terminal 就费了牛鼻子劲了，索性上工具。</p>
<p>代码是开放的：<a href="https://github.com/icyleaf/EasyConvert">https://github.com/icyleaf/EasyConvert</a></p>
<p>应用下载：<a href="https://github.com/downloads/icyleaf/EasyConvert/EasyConvert_v0.1.3.zip">EasyConvert_v0.1.3.zip</a></p>
<p>使用方法很简单，把要转换的 gbk 文件拖到应用窗口里面，应用会自动保存到同目录下。</p>
<p>BTW，应用 Icon 及涉及的图片资源均来自网络，<a href="https://github.com/icyleaf/EasyConvert/blob/master/EasyConvert/Readme">声明在此</a>。</p>
]]></content:encoded></item><item><title>在 iOS 应用调用 App Store 显示指定应用的详情</title><link>https://icyleaf.com/2012/10/how-to-preview-app-detail-buit-in-app-using-app-store-data/</link><pubDate>Thu, 25 Oct 2012 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2012/10/how-to-preview-app-detail-buit-in-app-using-app-store-data/</guid><description>可能很多手机应用都使用了“应用推荐”的功能，实现方式各式各样，对于 iOS 来说最致命的缺点就是，如果用户喜欢给推荐的应用，当用户点击该应用的时候，...</description><content:encoded><![CDATA[<p>可能很多手机应用都使用了“应用推荐”的功能，实现方式各式各样，对于 iOS 来说最致命的缺点就是，如果用户喜欢给推荐的应用，当用户点击该应用的时候，系统会硬生生的从当前应用内退出并打开 App Store 查看应用的详情。如果站在用户体验的角度来看，这其实是一个非常差劲的体验。那么能不能有一种方式可以在应用内部打开呢？</p>
<p>答案是肯定可以！！ iOS 6 其实包括了很多很好的特性，比如 Soical framework，丰富了分享面板，包括我最近刚刚更新的 ShareKit 也对新浪微博支持了这个特性(<a href="https://github.com/icyleaf/ShareKit/issues/4">ShareKit#4</a>)。还有针对于 O2O 具有杀手锏作用的 Pass Kit framework 等等等等&hellip;&hellip;</p>
<blockquote>
<p>喂喂喂，你说了半天没有讲到正题啊？！！</p>
</blockquote>
<p>咳~咳~书归正题，如果你没做应用内付费，可能你就忽略了 iOS 6 对 In-App Purchase 的说明：</p>
<blockquote>
<p>The Store Kit framework (StoreKit.framework) now supports the purchasing of iTunes content inside your app and provides support for having downloadable content hosted on Apple servers. With in-app content purchases, you present a view controller that lets users purchase apps, music, books, and other iTunes content directly from within your app. You identify the items you want to make available for purchase but the rest of the transaction is handled for you by Store Kit.</p>
</blockquote>
<p>也就是说 StoreKit framework 支持了在应用下载其他应用的特性！！！兴奋吧，官方很慷慨的支持了这个功能！！如果查看手册，其实咱们用到的只有 SKStoreProductViewController 这个类和所述的 delegate 就够了。</p>
<p>代码如下：</p>
<pre tabindex="0"><code>SKStoreProductViewController *controller = [[SKStoreProductViewController alloc] init];
controller.delegate = self;
NSDictionary *params = [NSDictionary dictionaryWithObject:@&#34;397735649&#34; // App id
                                                   forKey:SKStoreProductParameterITunesItemIdentifier];

[controller loadProductWithParameters:params
                      completionBlock:^(BOOL result, NSError *error) {
                          if (result)
                              [self presentViewController:controller
                                                 animated:YES
                                               completion:nil];
                      }];
</code></pre>]]></content:encoded></item><item><title>如何针对 iOS 设备进行网络抓包分析</title><link>https://icyleaf.com/2012/10/%E5%A6%82%E4%BD%95%E9%92%88%E5%AF%B9-ios-%E8%AE%BE%E5%A4%87%E8%BF%9B%E8%A1%8C%E7%BD%91%E7%BB%9C%E6%8A%93%E5%8C%85%E5%88%86%E6%9E%90/</link><pubDate>Mon, 15 Oct 2012 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2012/10/%E5%A6%82%E4%BD%95%E9%92%88%E5%AF%B9-ios-%E8%AE%BE%E5%A4%87%E8%BF%9B%E8%A1%8C%E7%BD%91%E7%BB%9C%E6%8A%93%E5%8C%85%E5%88%86%E6%9E%90/</guid><description>Charles 目前是 OS X 上面最好的抓包分析软件，相比 WireShark 功能更加强大，并支持代理功能。 iPad HTTP Debugging with Charles - 教大家如何使用它进行代理抓包 Testing / Tethering Data Driven Mobile Apps with Charles and OSX - 教大...</description><content:encoded><![CDATA[<p>Charles 目前是 OS X 上面最好的抓包分析软件，相比 WireShark 功能更加强大，并支持代理功能。</p>
<ol>
<li><a href="http://www.ravelrumba.com/blog/ipad-http-debugging/">iPad HTTP Debugging with Charles</a> - 教大家如何使用它进行代理抓包</li>
<li><a href="http://www.skinkers.com/2012/06/12/testing-tethering-data-driven-mobile-apps-with-charles-and-osx-ipad-iphone-http-debugging/">Testing / Tethering Data Driven Mobile Apps with Charles and OSX</a> - 教大家如何进行 request remap，适合不改动代码的情况下修改域名切换环境</li>
</ol>
<p>不过 Charles 的确定就是共享软件，未注册版本可以使用全功能但是限制是只能允许使用 30 分钟，那么&hellip;习惯用 Terminal 的还有一个方法：<a href="http://useyourloaf.com/blog/2012/02/07/remote-packet-capture-for-ios-devices.html">Remote Packet Capture for iOS Devices</a></p>
<pre tabindex="0"><code>$ rvictl -s &lt;UDID&gt;
$ rvictl -l
$ tcpdump -n -t -i rvi0 -q tcp
</code></pre>]]></content:encoded></item><item><title>沙漠穿越要点</title><link>https://icyleaf.com/2012/09/across-the-desert-tips/</link><pubDate>Tue, 25 Sep 2012 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2012/09/across-the-desert-tips/</guid><description>2012 的 10.1 期间去了趟库布其沙漠，以下整理的数据做了矫正和更新。 以库布其沙漠为例： 温差 ​1. 五一期间，白天 35 度左右，晚上 10 度左右。 ​2. 十一期间，...</description><content:encoded><![CDATA[<blockquote>
<p>2012 的 10.1 期间去了趟库布其沙漠，以下整理的数据做了矫正和更新。</p>
</blockquote>
<p>以库布其沙漠为例：</p>
<h2 id="温差">温差</h2>
<p>​1. 五一期间，白天 35 度左右，晚上 10 度左右。</p>
<p>​2. 十一期间，白天 27度左右，晚上 -5 度左右。</p>
<h2 id="装备">装备</h2>
<p>把你所需要的东西列出一个单子，只带必需品，可有可无的东西建议不要带，比如：钥匙、钱包、牙具、化妆品、大的刀具、金属水壶、手机备用电池、充电器、望远镜、笨重的照相器材等等。把这些东西所占的重量用水来代替，我想你的负重也不会有多少。</p>
<p>​1. 背包：<strong>重装</strong>男士 60L+，女士 50L+ ；<strong>轻装</strong>男士 40L+，女士25L+</p>
<p>​2. 服装：干衣裤、冲锋衣裤，晚上温差大的话需要再备抓绒</p>
<p>​3. 睡袋：舒适温标必须在 0 到 -5 度之间</p>
<p>​4. 帐篷：双层帐，最好是铝杆（防风好重量也轻）
　
​5. 鞋袜：高帮防水登山鞋，徒步鞋（鞋面必须是全皮或表面无网眼面料，防止漏沙）、袜子不少于 2 双</p>
<p>​6. 手仗：2根必备(节省体力，且保护膝盖。强驴忽略)</p>
<ol start="7">
<li>
<p>沙套：可防止沙子进入鞋里（雪套亦可）</p>
</li>
<li>
<p>防晒：帽子（带沿帽为佳。或者头巾）、太阳镜、润唇膏、防晒霜</p>
</li>
<li>
<p>头灯：夜间备用。保证电池备足　</p>
</li>
<li>
<p>水具：建议用水袋，水壶、水瓶也可（人/天日均消耗水约 1.5L - 2.5L）</p>
</li>
</ol>
<p>​11. 炊具：建议 2 - 4 人一套，各带自己的餐具，汽罐每人至少准备一罐（另外准备做饭需要的水）</p>
<p>​12. 急救：日常医疗包，创可贴，防中暑药品，闹肚子药等</p>
<p>​13. 摄影：防水套（风沙不大的话，不带亦可）</p>
<p>​14. 环保：垃圾袋（把不可讲解垃圾回收）</p>
<p>​15. 其他：GPS（防止迷失）、手台（沟通及呼救）</p>
<h2 id="食物">食物</h2>
<p>大家可以多带一些高热量、高营养的食品，尽可能不带垃圾食品。水每人每天准备5-6升水，可以带一些功能性营养性饮料，食品尽量选择高能量的简单易消化并不易变质的干粮类食品，尽量少用耗水量大的食品，金属或玻璃盛装的食品勿带。喜欢喝酒的个别队员也不要带酒，因为酒精会大量消耗水分，等穿越成功回到市内可以尽情腐败。在沙漠里，因为个体的差异每个人所需要的水分也不同，建议在出发前几天就要大量饮水，让身体尽量储存水分，在沙漠负重行走时要采用少量多次的饮水方法补充水分，避免不科学的饮水方法；大家都知道：徒步负重穿越沙漠会耗费大量的体力能量，所以，要求所有队员不管在扎营吃饭或是路餐时都要及时补充食物、补充营养，不要因为累了想多休息一会不想动而不补充能量，那样的话后果会很严重，造成体力严重透支，出现安全隐患，因为以前出现过类似的事情，所以，此次特别强调！如果有队员出现心慌、体力不支等情况要及时报告领队；</p>
<h2 id="穿越要点">穿越要点</h2>
<h3 id="如何行走">如何行走</h3>
<p>控制行军速度和定时休息是顺利到达目的地的关键，沙漠穿越行走 40 分钟休息
3-5 分钟为宜，要严格控制休息时间和行走时间，时速掌握在 2.5-3 公里/小时。</p>
<p>在平缓的地方行走最好不要跟着前面的脚印走，最好在偏离十几公分的没有经过踩踏的地方走。而在上坡时行走最好选择前面人的脚印走，跟走在台阶上差不多，利用手杖的支撑，会很轻松的翻越沙丘。</p>
<p>背包负重行走时经常要翻越沙丘，为了给双腿减轻承重，用带大雪栏的双杖辅助行走会起到事半功倍的效果，尤其是上坡，会为双腿分担至少四分之一的承载力，使身体延迟疲劳，也提高了行进速度。　　</p>
<h3 id="如何饮水">如何饮水</h3>
<p>在野外环境，每个人的耐渴程度不一样，在你出发前两天就开始大量饮水，让身体储存足够的水份。进入沙漠后，背包行走，尤其接近中午前后，身体会大量出汗，这个时候你就要特别注意，一定要定时饮水，每次饮水不要超过
100ml，20-30 分钟饮水一次。一般早晨行走 1
个小时侯后开始饮水，中午路餐用水控制在
400-500ml，在行走时要定时定量饮水，这是考验一个人适应环境和自控的能力，若没有这种自控能力，说明你不适合进入沙漠。　　</p>
<h3 id="饮食时间">饮食时间</h3>
<p>负重徒步穿越沙漠，会耗费很多的能量，建议上午 9-10 点，下午 3-4
点边走边拿出少量高热量路餐食用来补充身体能量，并不是等饿的受不了的时候再补充。　</p>
<h2 id="摄影者须知">摄影者须知</h2>
<p>沙漠里的细沙会在你不经意的时候沾满你的全身，所以在拍摄时应谨慎的拿出相机，并拍掉手上的沙子，避免相机跟沙子接触。若不小心沾上沙子可用嘴猛力吹掉沙子。有风的情况下尽量不要使用相机，并用密封性好的袋子或者相机套包住相机。　</p>
<h2 id="扎营者须知">扎营者须知</h2>
<p>​1. 扎营：帐篷迎风面最小的一角冲向来风，打地钉时先把浮沙扒掉，露出硬度大的潮湿沙子，地钉以大于45度角度斜插在湿沙子里面，一般能防止
7-8
级的大风。把除了帐篷门的其他三个部分用沙子挡起来，也能抵抗强风和保暖。</p>
<p>​2. 拔营：睡袋不要叠，抓起睡袋的一个角直接往压缩袋里使劲积压，十几秒就能收好一个睡袋。收帐篷时内外帐不要叠好，可随意的塞到背包里的睡袋上面并压紧。这样下来，拔营速度可大大的提高。　</p>
<h2 id="资料来源">资料来源</h2>
<p>以上资料从各大户外论坛收集并重新整理归类。</p>
]]></content:encoded></item><item><title>户外简易版煲仔饭</title><link>https://icyleaf.com/2012/09/claypot-rice-on-the-outdoor/</link><pubDate>Wed, 05 Sep 2012 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2012/09/claypot-rice-on-the-outdoor/</guid><description>几周前和同事及其朋友几位组织灵山重装扎营，结果当天下雨加上另辟蹊径的路被封，只好改重装徒步&amp;hellip;虽然遗憾但是吃到了好吃的煲仔饭，掌...</description><content:encoded><![CDATA[<p>几周前和同事及其朋友几位组织灵山重装扎营，结果当天下雨加上另辟蹊径的路被封，只好改重装徒步&hellip;虽然遗憾但是吃到了好吃的煲仔饭，掌勺的是来自广东的黑仔。记录制作步骤如下：</p>
<p>​1. 生米和水的比例是 1:1.5</p>
<p>​2.上火（不是电饭煲）开煮米饭至粘米的时候（水分已经被米粒吸收），加入切好的腊肠和腊肉，小火继续蒸（闷）</p>
<p>​3.几分钟后腊味飘逸出来后，加入少量的酱油（最好不用可以代替的老抽或生抽，颜色和味道都太重），搅拌似的酱油包含每个米粒。</p>
<p>​4.继续闷一会直到米饭完全吸收水分成饱和状出锅（如果喜欢吃锅巴的可以适当多闷一会）</p>
]]></content:encoded></item><item><title>升级 OS X 10.8 和 Python 第三方库那点事</title><link>https://icyleaf.com/2012/08/upgrade-osx-10-8-with-python-library/</link><pubDate>Fri, 24 Aug 2012 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2012/08/upgrade-osx-10-8-with-python-library/</guid><description>今天把公司的机器升级到了 10.8 本来就觉得 OS X 的平滑升级做的非常的好，除了一些被乔帮主鄙视的 JDK 需要重新安装外，其他的一切都很平滑的迁移过来。中午的...</description><content:encoded><![CDATA[<p>今天把公司的机器升级到了 10.8 本来就觉得 OS X
的平滑升级做的非常的好，除了一些被乔帮主鄙视的 JDK
需要重新安装外，其他的一切都很平滑的迁移过来。中午的时候想用 django
练手做个晓项目，熟练的在终端创建新项目，结果爆出如下错误：</p>
<blockquote>
<p>pkg_resources.DistributionNotFound: distribute==0.6.27</p>
</blockquote>
<p>顺是看了下 <code>/Library/Python/2.7/site-packages</code>
竟然发现里面没有任何的库，心里想估计是升级的适合系统清理掉了，那只能重新安装下了，于是又输入：</p>
<pre tabindex="0"><code>$ sudo pip install django
</code></pre><p>再次报错：</p>
<blockquote>
<p>pkg_resources.DistributionNotFound: pip==1.1</p>
</blockquote>
<p>外头想想也对，python 的库都被清掉了，那只能使用 easy_install 了啊（犯2啊！）</p>
<pre tabindex="0"><code>$ sudo easy_install pip
</code></pre><p>继续报错 = =!</p>
<blockquote>
<p>pkg_resources.DistributionNotFound: distribute==0.6.27</p>
</blockquote>
<p>Ocz，肿么又报错了&hellip;迅速脑中确认几件事情：</p>
<p>​1. Python 是否是调用的系统默认的 - √</p>
<p>​2. 确认 easy_install 是否存在 - √ （不仅存在，连没有了的 pip 和
virtualenv 还存在软链接）</p>
<p>​3. distribute 是啥 - ˚∆˚ （Python 新手成长中）</p>
<p>于是网上查询发现也有不少遇到升级 10.8 发现 pip
不见了，但是他们提供的解决方案是：</p>
<pre tabindex="0"><code>$ sudo easy_install -U pip
</code></pre><p>但是在我本地执行还是报 <code>distribute</code>
不存在，看了需要重新安装它了吧，既然不能通过包管理软件执行，那只有官方下载源码安装了：</p>
<pre tabindex="0"><code>$ curl -O http://python-distribute.org/		$ distribute_setup.py &amp;&amp; python
$ distribute_setup.py
</code></pre><p>安装成功之后就有可以从本篇开头的操作继续重装下去了 T_T</p>
<p>补习知识：</p>
<blockquote>
<p>distribute 0.6.28</p>
</blockquote>
<blockquote>
<p>Easily download, build, install, upgrade, and uninstall Python
packages</p>
</blockquote>
]]></content:encoded></item><item><title>如何保持在 Git Submodule 代码的开放和私有共存</title><link>https://icyleaf.com/2012/08/how-to-keep-public-and-private-versions-of-a-git-submodule-repo-in-sync/</link><pubDate>Fri, 03 Aug 2012 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2012/08/how-to-keep-public-and-private-versions-of-a-git-submodule-repo-in-sync/</guid><description>假设我在 github 有一个开源的版本库 x 供大家使用，该库里面又包含了好些个 submodules，其中有一个 submodule 名为 a 是自己在 github 又创建的: $ git submodule add http://github.com/icyleaf/a.git modules/a 现在...</description><content:encoded><![CDATA[<p>假设我在 github 有一个开源的版本库 x 供大家使用，该库里面又包含了好些个 submodules，其中有一个 submodule 名为 a 是自己在 github 又创建的:</p>
<pre tabindex="0"><code>$ git submodule add http://github.com/icyleaf/a.git modules/a
</code></pre><p>现在问题是，由于代码需要更新，同时涉及到了 a 这个 submodule，但是它的添加 url 是 read-only，由于 x 这个库是供大家使用，因此 a 又不能设为 private：</p>
<pre tabindex="0"><code>$ git clone git@github.com:icyleaf/a.git modules/a
</code></pre><p>目前想到的方法是在 x 库以外 clone 下来 a，进行私有的写入和 push 到 github 上面，然后在 x 库的 a 里 git pull 下来获得最新的代码。</p>
<p>如何解决这样的问题，能够当大家全部 clone 下来，而自己开发也能避免麻烦？在一篇文章上面找到了灵感，折腾了一番搞定了 !</p>
<p>该文章有一节讲到，开发者如果经常需要更新 submodule ，即可更换 submodule 的 remote url：</p>
<pre tabindex="0"><code>$ cd commonlib
$ git remote rm origin
$ git remote add origin ssh://mark@git.mysociety.org/data/git/public/commonlib.git
$ git remote -v origin ssh://mark@git.mysociety.org/data/git/public/commonlib.git

However, you’ll find that two helpful config options will have been
deleted when removing and adding back origin, so you’ll want to add
these back.

$ git config branch.master.remote origin
$ git config branch.master.merge refs/heads/master
</code></pre><p>首先我也先对 a 进行 git remote -v，结果显示：</p>
<pre tabindex="0"><code>origin http://github.com/icyleaf/a.git (fetch)
origin http://github.com/icyleaf/a.git (push)
</code></pre><p>发现和文章里面的显示的结果不一样，于是我就在想能不能在 remote
上面做些手脚，首先看下 git remote 的 help，发现有一条是可以单独设置 remote
push 的 url ，也就是更换上面 git remote -v 中 push 的 url，尝试：</p>
<pre tabindex="0"><code>$ git remote set-url --push origin git@github.com:icyleaf/a.git
</code></pre><p>再次执行 remote -v:</p>
<pre tabindex="0"><code>origin http://github.com/icyleaf/a.git (fetch)
origin git@github.com:icyleaf/a.git (push)
</code></pre><p>执行成功！然后随意 commit 并 push orgin master，成功！</p>
<p>搞定！</p>
]]></content:encoded></item><item><title>利用 argparse 写的脚本命令：测试 URL 响应时间</title><link>https://icyleaf.com/2012/08/url-request-time-test-using-python-with-argparse/</link><pubDate>Thu, 02 Aug 2012 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2012/08/url-request-time-test-using-python-with-argparse/</guid><description>前几天看完《Python简明教程》，预想练手，想起同事的一个 ruby 代码，尝试改写成 python，顺便看看两个语言的简练程度。下面是原始的 ruby 代码：...</description><content:encoded><![CDATA[<p>前几天看完《<a href="http://woodpecker.org.cn/abyteofpython_cn/chinese/">Python简明教程</a>》，预想练手，想起同事的一个 ruby 代码，尝试改写成 python，顺便看看两个语言的简练程度。下面是原始的 ruby 代码：</p>
<pre tabindex="0"><code>#!/usr/bin/env ruby

require &#39;rubygems&#39;
require &#39;net/http&#39;

urls = [&#34;http://icyleaf.com&#34;]
50.times do
  urls.each do |url|
    start_at = Time.now
    Net::HTTP.get URI.parse(url)
    end_at = Time.now
    diff = end_at - start_at
    if diff &lt; 0.3 then
      color_code = 32
    elsif diff &gt; 0.8 then
      color_code = 31
    else
      color_code = 33
    end
    puts &#34;#{url}\n time: \033[#{color_code}m#{diff}\033[0m seconds&#34;
  end
end
</code></pre><p>改写 python 的同时，考虑脚本的灵活性准备增加两个参数，第一个是请求测试次数，第二个是请求测试的 URL，而 python 默认提供了 <a href="http://docs.python.org/dev/library/argparse.html">argparse</a> 库，可以很方便的生成 &ndash;help 的帮助和解析传递的参数：</p>
<pre tabindex="0"><code>#!/usr/bin/env python

import urllib2
import time
import sys
import argparse

def benchmark(url, count):
	for i in range(count):
		s = time.time()
		r = urllib2.urlopen(urllib2.Request(url))
		e = time.time()
		diff = e - s

		if diff &lt; 0.3:
			color_code = 32
		elif diff &gt; 0.8:
			color_code = 31
		else:
			color_code = 33

		print &#39;# %d&#39; % (i + 1)
		print &#39;\tStauts: %s&#39; % r.getcode()
		print &#39;\tTime: \033[%dm%f\033[0m second(s)&#39; % (color_code, diff)


def main(argv):
	parser = argparse.ArgumentParser(description=&#39;url request time test&#39;)

	parser.add_argument(&#39;URL&#39;, help=&#39;request url&#39;)
	parser.add_argument(&#39;-t&#39;, &#39;--time&#39;, action=&#39;store&#39;, dest=&#39;count&#39;, type=int, default=10, help=&#39;request times&#39;)
	args = parser.parse_args(argv)

	benchmark(args.URL, args.count)


if __name__ == &#39;__main__&#39;:
	main(sys.argv[1:])
</code></pre><p>当然，我主要是为了练手 python 才去写的，ruby 本身也有 <a href="http://ruby-doc.org/stdlib-1.9.3/libdoc/optparse/rdoc/OptionParser.html">optparse</a> 库用于解析参数，但是需要自己手写生成 &ndash;help 的输出，而且需要对每个参数做相应的 callback。</p>
<p>效果如下：</p>
<p><img loading="lazy" src="http://ww3.sinaimg.cn/large/65d1d65bgw1dvi5nsc4sdj.jpg"
  
  
  alt="screenshot"></img>
</p>
]]></content:encoded></item><item><title>Dropbox和Apache关于权限的问题</title><link>https://icyleaf.com/2012/07/how-to-fix-dropbox-with-apache-about-acces-permission/</link><pubDate>Mon, 30 Jul 2012 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2012/07/how-to-fix-dropbox-with-apache-about-acces-permission/</guid><description>自从上次 SSD 硬盘不小心挂了之后，就算是返厂检修，一旦是算坏只能更换新的无法提供维修服务。这次我对待一些数据就更加小心了。尤其是代码，其实这次代...</description><content:encoded><![CDATA[<p>自从上次 SSD 硬盘不小心挂了之后，就算是返厂检修，一旦是算坏只能更换新的无法提供维修服务。这次我对待一些数据就更加小心了。尤其是代码，其实这次代码也并没有损失多少，丢失了一些平时的练习的项目。但为了保证代码的完整性和整体的同步性，我决定使用 Dropbox 同步我的代码。这样平时练习的代码也不必丢到 Github 或者花麻烦自建的服务器上面，什么都不需要操作就可以同步与无形之中。</p>
<p>移动用户目录的 src 至 Dropbox 目录并创建软链接：</p>
<pre tabindex="0"><code>$ mv ~/src ~/Dropbox/src
</code></pre><pre tabindex="0"><code>$ ln -s ~/Dropbox/src ~/src
</code></pre><p>如果这是写 Dropbox 同步代码的事情，那到这里就结束了，后来发现 apache
无法访问 php 的目录，报如下错误：</p>
<blockquote>
<p>Symbolic link not allowed or link target not accessible:
/Users/icyleaf/src</p>
</blockquote>
<p>这个问题是因为我 VirtualHost 是这样配置的，使用的是经过处理的软链接的方式访问，而 apache 默认不允许这种行为：</p>
<pre tabindex="0"><code>&lt;directory &#34; users icyleaf src php&#34;&gt;

	Options Indexes FollowSymLinks MultiViews Includes

	AllowOverride All

	Order allow,deny

	Allow from all

&lt;/directory&gt;
</code></pre><p>但是我 Directory 已经配置了 <code>Options FollowSymLinks</code> 但还是报如下错误，经过反复的检查 <code>/Users/icyleaf/src</code> 目录的权限也没有问题，最后只能在配置里把软链接替换成原始路径：</p>
<pre tabindex="0"><code>&lt;directory &#34; users icyleaf dropbox src php&#34;&gt;

	Options Indexes FollowSymLinks MultiViews Includes

	AllowOverride All

	Order allow,deny

	Allow from all

&lt;/directory&gt;
</code></pre><p>发现还是无法访问，但是报了的是另外一个错误：</p>
<blockquote>
<p>Permission denied: access to / denied</p>
</blockquote>
<p>又是一番折腾，最终发现居然是坑爹的 Dropbox 的访问权限居然是：</p>
<pre tabindex="0"><code>drwx------@ 21 icyleaf staff 714 7 30 06:07 Dropbox
</code></pre><p>调整权限：</p>
<pre tabindex="0"><code>$ chmod o+w ~/Dropbox
</code></pre><p>再次查看权限:</p>
<pre tabindex="0"><code>drwxr-xr-x@ 21 icyleaf staff 714 7 30 06:07 Dropbox
</code></pre><p>再次访问权限没有问题，替换为原来的软链接方式访问，一切搞定！</p>
]]></content:encoded></item><item><title>Sublime Text 2 + GoSublime + ZSH 的配置</title><link>https://icyleaf.com/2012/07/sublime-text-2-and-gosublime-with-zsh/</link><pubDate>Mon, 30 Jul 2012 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2012/07/sublime-text-2-and-gosublime-with-zsh/</guid><description>Sublime Text 2（下面简称 Subl） 通过 PCIP（Package Control: Install Package）安装各式各样的插件，其中还包括 Google 刚刚发布 1.0+ 的 golang 语言也有相应的插件 G...</description><content:encoded><![CDATA[<p><a href="http://www.sublimetext.com/2">Sublime Text 2</a>（下面简称 Subl） 通过 PCIP（Package Control: Install Package）安装各式各样的插件，其中还包括 Google 刚刚发布 1.0+ 的 golang 语言也有相应的插件 <a href="https://github.com/DisposaBoy/GoSublime">GoSublime</a>，其实本来用 tmux + vim 也能解决编写和执行命令之间切换的工作。但是 tmux 的快捷键有时候重复多了会很不爽&hellip;</p>
<p>于是今天开始尝试使用 Subl 来编写 golang，安装完毕插件之后，编写还是比较方便的，有语法高亮，代码提示，错误提示，快速编译执行等，但是我在编译执行的时候总是会报如下错误:</p>
<blockquote>
<p>/bin/sh: go: command not found</p>
</blockquote>
<p>由于插件默认是安装 sh shell 去搜索路径的，肯定是因为在 <code>.bash_profile</code> 里面没有找到 go 命令，而我已经切换了 zsh shell （.zshrc）因此才会报此错误。</p>
<p>最后翻找了半天资料，发现通过 Preferencs -&gt; Brower Packages -&gt; Gosublime 下面有一个 <a href="https://github.com/DisposaBoy/GoSublime/blob/master/USAGE.md">USAGE.md</a> 的文档，原来修改 <code>GoSublime.sublime-settings</code> 下面的 <code>env</code> 的 $PATH 解决了此问题：</p>
<blockquote>
<p>&ldquo;env&rdquo;: { &ldquo;PATH&rdquo;: &ldquo;/usr/local/sbin:/usr/local/bin:$PATH&rdquo;}</p>
</blockquote>
<p>再次编译运行，搞定！</p>
]]></content:encoded></item><item><title>初次接触 virtualenv</title><link>https://icyleaf.com/2012/07/intro-virtualenv/</link><pubDate>Fri, 27 Jul 2012 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2012/07/intro-virtualenv/</guid><description>python 的 virtualenv 功能看着类似于 Ruby 的 RVM，其实这两个东西我都没有用过，本身脚本语言用的最熟练的是 php，最近觉得 php 在处理一些多线程和终端繁琐的事情上有...</description><content:encoded><![CDATA[<p>python 的 virtualenv 功能看着类似于 Ruby 的 RVM，其实这两个东西我都没有用过，本身脚本语言用的最熟练的是 php，最近觉得 php 在处理一些多线程和终端繁琐的事情上有些局限性。决定熟悉下 python 并尝试用 django 做一个小应用。</p>
<p>由于本身 <a href="http://github.com/openparty/openparty">OpenParty</a> 的代码也是基于 django 开发的，加上最近也开始使用了 virtualenv，这样正好解决了不同项目在使用不同的环境造成的一些困扰。</p>
<p>OS X 本身已经安装了 easy_install 可以通过命令安装：</p>
<pre tabindex="0"><code>$ easy_install pip
</code></pre><p>安装好之后，可以为每个项目创建一个专属的开发环境，这个环境可以单独存放在一个目录下面，比如：</p>
<pre tabindex="0"><code>~/envs
      \
      |- env1
      |- env2
      \- env3
</code></pre><p>创建一个的纯净的开发环境:</p>
<pre tabindex="0"><code>$ virtualenv --no-site-packages &lt;env_name&gt;
</code></pre><p>进入专属的开发环境：</p>
<pre tabindex="0"><code>$ source &lt;env_name&gt;/bin/activate
</code></pre><p>你会发现 <code>(&lt;env_name&gt;)</code> 会出现在你终端提示的前面，这个时候就说明进入该环境，以后的任何和 python 相关的依赖都是在这个环境下面，和系统全局的不受任何影响。</p>
<p>比如通过快速安装项目的依赖：</p>
<pre tabindex="0"><code>(env_name)$ pip install -r requirements
</code></pre><p>下载的依赖都会存放在这个路径：</p>
<pre tabindex="0"><code>&lt;env_name&gt;/lib/python2.7/site-packages/
</code></pre><p>退出当前的开发环境：</p>
<pre tabindex="0"><code>$ deactivate
</code></pre><p>资料参考：</p>
<ol>
<li><a href="http://github.com/openparty/openparty">OpenParty README</a></li>
<li><a href="http://www.virtualenv.org/">virtualenv</a></li>
<li><a href="http://jsome.net/blog/2010/06/11/start-to-use-virtualenv">开始使用Virtualenv</a></li>
</ol>
]]></content:encoded></item><item><title>“java.lang.NoClassDefFoundError” in Android</title><link>https://icyleaf.com/2012/05/how-to-salvation-android-import-jar-exception-during-running/</link><pubDate>Mon, 14 May 2012 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2012/05/how-to-salvation-android-import-jar-exception-during-running/</guid><description>最近 Eclipse 的 ADT 升级至了 18 版本，结果运行的时候发现导入的第三方 jar 包总是报错 java.lang.NoClassDefFoundError 可气的是 Eclipse 不会给工程同时在编译的时候也不会报错。 后来发现此版本，第三方...</description><content:encoded><![CDATA[<p>最近 Eclipse 的 ADT 升级至了 18 版本，结果运行的时候发现导入的第三方 jar
包总是报错</p>
<blockquote>
<p>java.lang.NoClassDefFoundError</p>
</blockquote>
<p>可气的是 Eclipse 不会给工程同时在编译的时候也不会报错。</p>
<p>后来发现此版本，第三方的 <code>jar</code> 包必须放在项目的 <code>libs</code>
目录下面，而且仅能放在 <code>libs</code> 根目录下面，即不能在 <code>libs</code>
下面在建立子目录存放，也不能改名 <code>lib</code> 目录&hellip;.</p>
<p>更无奈的是， Eclipse 的 User Library 也是出现同样的问题，目前无解 &gt;.&lt;</p>
]]></content:encoded></item><item><title>友盟 iOS 发布渠道自动化脚本</title><link>https://icyleaf.com/2012/05/ios-publish-channel-packger-for-umeng/</link><pubDate>Thu, 10 May 2012 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2012/05/ios-publish-channel-packger-for-umeng/</guid><description>现在公司的大多数手机项目的统计服务都是用的友盟，而自使用之初到现在都有一个渠道管理的功能，这个最后打包的时候实际上可能会产生一点点的麻烦，最...</description><content:encoded><![CDATA[<p>现在公司的大多数手机项目的统计服务都是用的<a href="http:///www.umeng.com">友盟</a>，而自使用之初到现在都有一个渠道管理的功能，这个最后打包的时候实际上可能会产生一点点的麻烦，最早第一个 app 发布的时候，写了一个半自动的脚本，凑合用了很久，现在觉得需要完全自动化，于是借鉴之前 <a href="http://icyleaf.com/2012/04/automating-script-to-testFlight-from-xcode/">testflightapp 的自动化脚本</a>，重新改造脚本。</p>
<p>实现分两部分：</p>
<ul>
<li>iOS 代码</li>
<li>自动化脚本</li>
</ul>
<p>实现原理很简单，我利用一个文本文件放置在项目当中（比如：<code>PublishChannel.txt</code>），里面只需要存上发布渠道的名字，默认是 <code>App Store</code>。在代码中只需要想友盟调用函数的时候，读取这个文件即可。只需要做这样简单的工作就结束了 iOS 代码部分的工作。</p>
<p>主要的功能基本上都是由自动化脚本完成。因为它要去标记分发渠道，处理打包工作：</p>
<ol>
<li>打包需要一个符合官方发布要求的 Icon，即 512x512 px，PNG 格式且名字必须是 <code>iTunesArtwork</code> （不能包含后缀，无比保证在终端检查）</li>
<li>修改 PublishChannel.txt 的分发渠道</li>
<li>同时需要把 .app 的文件放在 <code>Payload</code> 并和 <code>iTunesArtwork</code> 一起打成 ipa 包（实际上就是一个 zip，改成了 ipa）</li>
</ol>
<p>这样看起来其实工作也不复杂，只不过分发渠道多了就是有些浪费时间。同样还是采用了 Archive 的 Post-Action，这里面可以插入脚本以及外部的调用脚本（如果看不到下面的具体代码，请<a href="https://gist.github.com/2650508">点击这里</a>：</p>
<!-- raw HTML omitted -->
]]></content:encoded></item><item><title>获取公网 IP</title><link>https://icyleaf.com/2012/05/fetch-public-ip/</link><pubDate>Wed, 09 May 2012 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2012/05/fetch-public-ip/</guid><description>$ curl -s http://checkip.dyndns.org | grep -Eo &amp;#39;([0-9]{1,3}\\.){3}[0-9]{1,3}&amp;#39;</description><content:encoded><![CDATA[<pre tabindex="0"><code>$ curl -s http://checkip.dyndns.org | grep -Eo &#39;([0-9]{1,3}\\.){3}[0-9]{1,3}&#39;
</code></pre>]]></content:encoded></item><item><title>QuickLook 感悟</title><link>https://icyleaf.com/2012/04/thinking-in-quicklook/</link><pubDate>Mon, 30 Apr 2012 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2012/04/thinking-in-quicklook/</guid><description>前段时间对 OS X 系统的 QuickLook 非常感兴趣，能够随着开发者的定制，针对不同的文件呈现符合用户需求的预览功能，然后认为它属于是万能的。随后可以琢磨利用它...</description><content:encoded><![CDATA[<p>前段时间对 OS X 系统的 <a href="http://en.wikipedia.org/wiki/Quick_Look">QuickLook</a> 非常感兴趣，能够随着开发者的定制，针对不同的文件呈现符合用户需求的预览功能，然后认为它属于是万能的。随后可以琢磨利用它做些意思的事情。</p>
<h1 id="范例">范例</h1>
<p>为了大家对它有个直接的认识，我这里找了几个范例，看到图大家就非常明白了！</p>
<p>默认系统很对 QuickTime 兼容格式的可以实现视频预览播放，如果安装了最新的 MPlayerX，同样也支持大多数格式（目前还不支持 mkv）
<img loading="lazy" src="https://developer.apple.com/library/mac/documentation/UserExperience/Conceptual/Quicklook_Programming_Guide/Art/preview_example2.jpg"
  
  
  alt="video quicklook"></img>
</p>
<h1 id="预热">预热</h1>
<p>Xcode 已经内置了 QuickLook 的插件模块，一边阅读<a href="https://developer.apple.com/library/mac/#documentation/UserExperience/Conceptual/Quicklook_Programming_Guide/Introduction/Introduction.html">官方文档</a>，一边在 Github 上面搜索相关的<a href="https://github.com/search?q=QuickLook&amp;type=Repositories">开源项目</a>。</p>
<p>QuickLook 是通过 <a href="https://developer.apple.com/library/mac/#documentation/FileManagement/Conceptual/understanding_utis/understand_utis_conc/understand_utis_conc.html#//apple_ref/doc/uid/TP40001319-CH202-CHDHIJDE">UTIs</a> 的资源类型来对文件进行预览。</p>
<h1 id="有意思的事情">有意思的事情</h1>
<p>不知从何开始，硬盘收集的电影越来越多，有时候也从朋友那边资源交换来了不少。其实这里有一个很大的问题，交换过来的资源并不一定符合每个人的口味，但面对一个个电影名字的众多视频而且可能还没有仔细的分类（包括我也是没有归类），其实在选择看哪个的时候有些头胀。之前也整理了一些 <a href="http://icyleaf.com/2012/03/pngcrush-usage-with-ios-apps/">pngcrush</a> 的资源。脑门一亮，在想能不能利用 QuickLook 去<em>准确显示</em>电影的信息。</p>
<p>电影的信息来源不用愁，利用 <a href="http://www.douban.com/service/apidoc/reference/subject">豆瓣相关 API</a> 可以搜索到电影的信息，但是这里还有几点难题：</p>
<ol>
<li>视频文件的文件名是否好提取关键字（视频文件根据每个来源提供者，视频工作室，个人的维护不同导致很难）</li>
<li>豆瓣 API 接口是否给力（根据 1 是否能够准确搜索到正确的结果呢）</li>
</ol>
<p>针对于上面的问题，第一我想测试下豆瓣 API 是否给力，于是找了几种不同方式的视频文件名进行测试，记过尚可，但是搜索结果一般都是多条，其结果显示可能会存在偏差（主要是存在于电脑重名），当然这样也无法避免。这里我想郑重的表扬 IMDB 的策略，<a href="http://www.imdbapi.com/">IMDB API</a> 可以按照关键字和 imdb id 去搜索（豆瓣也满足），让我表扬的地方在于，它返回的结果永远只有一条，我曾测试利用不同语种（大语种，小语种不行）的名字去尝试搜索几乎 98% 的命中率， 而且在搜索的基础上，又提供一个 year 的参数。</p>
<blockquote>
<p>这会 IMDB API 服务器总是 503 状态，哎&hellip;</p>
</blockquote>
<p>基于种种的问题，我最终采用了在文件添加 imdb id 的方式以保证完美的命中率！（虽然前期准备工作可能辛苦点 &gt;..&lt;）</p>
<h1 id="干活">干活！</h1>
<p>说干就干，在通读了文档和一些开源代码之后，就准备练手。如果大家同样开始跟我新建工程编写代码的时候就会发现一个很坑爹的事情，官方的文档根本没有更新！用的还是 Xcode 3 做的指导。问题在于 3 升级到 4 之后，很多东西都已经改的面目全非。对于熟悉 3 的开发者就不必担心了。</p>
<p>QuickLook 官方文档的前面内容都没有问题，主要是后面有个 Debug 和 Test 的章节，在 4 里面有了一些大的变化，比如需要把 <code>.qlgenerator</code> 文件复制到 <code>/Library/QuickLook</code> 或 <code>~/Library/QuickLook</code> 目录下面，然后通过外部命令 <code>qlmanage</code> 去做代码的实现预览。</p>
<blockquote>
<p>如果发现没有更新，尝试 <code>qlmanage -r</code> 更新一下</p>
</blockquote>
<p>在 Xcode 4 是如下解决：</p>
<ol>
<li>复制 <code>.qlgenerator</code> 文件到对应的目录下面</li>
</ol>
<p>在工程项目的 <code>Build Phases</code> 找到 <code>Add BuildPhase</code> 并选择 <code>Add Copy Files</code>，在选项设置 <code>Destination</code> 选择 <code>Absolute Path</code>，在 <code>Subpath</code> 填入 <code>~/Library/QuickLook</code>，最后在下面的列表添加项目的 <code>.qlgenerator</code> 文件</p>
<ol start="2">
<li>执行外部命令</li>
</ol>
<p>在工程中按快捷键 <code>Command + Shift + ,</code>，打开 Scheme， 在 <code>Run</code> 的 <code>Info</code> 更换 <code>Executable</code>，在 <code>/usr/bin</code> 找到 <code>qlmanage</code> 文件。再更换到 <code>Arguments</code> 里面添加参数格式：</p>
<blockquote>
<p>-p /your/path/to/quicklook/file</p>
</blockquote>
<p>比如，我要预览的是 <code>/Users/icyleaf/sample.mkv</code> 文件:</p>
<blockquote>
<p>-p /Users/icyleaf/sample.mkv</p>
</blockquote>
<h1 id="备受打击">备受打击</h1>
<p>当一切都紧锣密鼓的完成下去的时候，遇到一个无法解决的问题，就是在使用 HTTP 请求的时候，总是返回 &ldquo;<em>Operation not permitted</em>&rdquo; 的错误，最后没有办法开始 Google 求助，然后发现了<a href="http://web.archiveorange.com/archive/v/SEb6aPoIYeg2zfU4v9Ee">一个很残酷的现实</a>。于是我有仔细的看了看官方文档，翻到了彻底让我失败的证据！</p>
<blockquote>
<p><em>Important</em> For security reasons, you cannot use Web Kit plug-ins in HTML passed back to Quick Look (so you cannot, for example, use Java applets or Flash animations).</p>
</blockquote>
<p>当前我以为只是不能使用 Webkit 嵌套 HTML，但是看到很多例子（比如预览 Markdown，JSON，.strings 文件）都是通过 WebKit 达到预览格式化后的 HTML 实现的。我还特别高兴的认为官方文档净吓唬我&hellip;</p>
<p>原来官方是出于安全考虑，把所有应用放在一个安全的 sandbox 里面，任何有威胁可能的安全问题一律扼杀掉，最终导致我的想法难产了 T_______T</p>
<p>BTW，假如你的 QuickLook 也需要使用到 Webkit，默认调试报 &ldquo;WebKit Threading Violation - initial use of WebKit from a secondary thread.&rdquo; 错误，系统不运行从其他线程访问资源，因此在 Info.plist 把 <code>QLNeedsToBeRunInMainThread</code> 设置为 <code>YES</code> 即可。</p>
<h1 id="漏网之鱼">漏网之鱼?</h1>
<p>为什么这么讲呢，因为我看到 QuickLook 可以利用第三方的命令甚至是脚本去实现一些功能:</p>
<ul>
<li><a href="https://github.com/davea/qlmarkdownpython">qlmarkdownpython</a> - 利用 py 脚本 + Python framework 实现 markdown 的格式化</li>
<li><a href="https://github.com/johan/QuickJSON">QuickJSON</a> - 利用 node 脚本实现 JSON 的友好化显示</li>
</ul>
<p>假如可以利用外部的脚本及命令的话，那是不是可以利用他们完成网络的访问及后续的格式化工作，QuickLook 只是做统一的输出？</p>
<p>To be contiue&hellip;</p>
]]></content:encoded></item><item><title>自动化脚本上传应用至 testflightapp</title><link>https://icyleaf.com/2012/04/automating-script-to-testflight-from-xcode/</link><pubDate>Fri, 06 Apr 2012 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2012/04/automating-script-to-testflight-from-xcode/</guid><description>Testflightapp 是团队开发测试中起了重要的角色，尤其是到目前为止一直是免费，最近还推出的 Live 功能不仅可以统计本身的一些数据还可以把现有的一些其他的账户的数据...</description><content:encoded><![CDATA[<p>Testflightapp 是团队开发测试中起了重要的角色，尤其是到目前为止一直是免费，最近还推出的 Live 功能不仅可以统计本身的一些数据还可以把现有的一些其他的账户的数据（比如， itunesconnect，Apple iAd，admob 等）导入进一步扩大聚合。</p>
<p>尤其是它真的重视开发着的核心需求，仅推出了唯一的一个公开 API，就是上传打包后的 ipa 文件，配合 Xcode 中 Archive 的 Post-action 可以轻松搞定自动化的操作。</p>
<p>下面是网上搜集的脚本，算是我发现定制化比较强的<a href="https://gist.github.com/1379127">自动化脚本</a>，而且注解也写的很详细。可以在配合我的打包脚本，可以把各个发布渠道的事情一起自动化。</p>
<blockquote>
<p>注意：Xcode 默认的 run script 是 <code>/bin/sh</code>，而上面的脚本是
<code>/bin/bash</code>。</p>
</blockquote>
<p>这个 Post-action 不爽的地方在于所有的 <code>echo</code> 没有办法直接输出到 Xcode 的 output 里面，所以脚本只能把 log 保持到了 <code>/tmp</code>
目录下面，如果发现出现问题请仔细查看 log。</p>
<p>BTW，Post-actions 添加的脚本对于忽略了 XCode 干扰文件的版本控制来说，它没有归入到版本控制之中，脚本是被转义后放在了一个 xcscheme 的 xml 文件中：</p>
<pre tabindex="0"><code>(project).xcodeproj/xcuserdata/(username).xcuserdatad/xcschemes/(name).xcscheme
</code></pre>]]></content:encoded></item><item><title>使用 Git Hooks 实现自动项目部署</title><link>https://icyleaf.com/2012/03/apps-auto-deploy-with-git/</link><pubDate>Wed, 14 Mar 2012 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2012/03/apps-auto-deploy-with-git/</guid><description>最近在某服务器上面搭建 git 开发和部署环境，git 开发环境很简单，按照 ProGit 一书的相关知识就可以轻松搞定，实现了类似 Github 的使用 SSH + 私有 Clone 的方式。 关于部...</description><content:encoded><![CDATA[<p>最近在某服务器上面搭建 git 开发和部署环境，git 开发环境很简单，按照 ProGit 一书的相关知识就可以轻松搞定，实现了类似 Github 的使用 SSH + 私有 Clone 的方式。</p>
<p>关于部署，实际上是自动部署，起初的想法是使用 bash shell 制定一个定时任务去不断 git pull 产品代码，后来记得 Git 带有 Hooks，索性在ProGit 一书翻了翻：</p>
<blockquote>
<p>Git 本身可以调用自定义的挂钩脚本，其中有两组：客户端和服务器端。客户端挂钩用于客户端的操作，如提交和合并。服务器端挂钩用于 Git 服务器端的操作，如接收被推送的提交。详情请查看 <a href="http://progit.org/book/zh/ch7-3.html">ProGit 相关章节</a></p>
</blockquote>
<p>如果这样就简单了，利用服务器端调用想要的挂钩（Hook），即可实现自动部署的方案，为了保证不被肆意部署，特加了一个对需要部署 commit 的判断，利用读取 commit subject 并匹配想要的字符串才去部署，这样我认为是一个比较安装的部署方案。</p>
<p>Git的挂钩（Hook）主要包含：</p>
<ul>
<li>applypatch-msg</li>
<li>post-update</li>
<li>pre-rebase</li>
<li>commit-msg</li>
<li>pre-applypatch</li>
<li>update</li>
<li>post-commit</li>
<li>pre-commit</li>
<li>post-receive</li>
<li>prepare-commit-msg</li>
</ul>
<p>这里我们只需要使用 post-receive 这个 Hook：在接收 post(push)
请求之后执行。其他大部分我也没有大多研究，不过看名字不算难理解，我觉得其中大部分包含 commit 的属于客户端。</p>
<p>好了，部署开始：</p>
<p>​1. 在服务器 git 仓库（注意是 bare 仓库，不是代码仓库）的 Hooks，编辑
post-receive（如果没有自行创建），代码请看：http://gist.github.com/566767</p>
<p>这里会先判断脚本所在目录是否是 bare git 仓库，然后获取最新 commit 的 subject，并匹配是否包含 [deploy] 字样，如果包含，则继续检查产品代码仓库路径是否存在，如果存在则执行 git pull 操作。</p>
<p>​2. 对刚才编辑的 post-receive 执行下面命令以保证脚本可执行：</p>
<pre tabindex="0"><code>$ chmod +x post-receive
</code></pre><p>​3. 完成！</p>
<!-- raw HTML omitted -->
<p>对于自定义脚本，其实不仅限于 bash shell，你可以使用你熟悉的语言，然后把你的脚本路径在 hooks 脚本中加载即可。</p>
<p>脚本还会继续更新，下面需要增加关于测试部分的相关判断和部署。 bash shell 还需要进一步学习，上面脚本是我第一次写，如有不妥之处，请指教，感谢！</p>
]]></content:encoded></item><item><title>pngcrush 的一些用法</title><link>https://icyleaf.com/2012/03/pngcrush-usage-with-ios-apps/</link><pubDate>Fri, 09 Mar 2012 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2012/03/pngcrush-usage-with-ios-apps/</guid><description>pngcrush 顾名思义，看起名字本身就优化 png 的工具，为什么会提到它呢，因为目前所有 iOS app 自身的 png 文件都是经过它优化的，对于优化有的 png，系统本身默认是无...</description><content:encoded><![CDATA[<p>pngcrush 顾名思义，看起名字本身就优化 png 的工具，为什么会提到它呢，因为目前所有 iOS app 自身的 png 文件都是经过它优化的，对于优化有的 png，系统本身默认是无法识别的（包括看图工具，作图工具）。但这个工具不仅仅可以优化还可以还原。假如你希望可以学习优秀 iOS App 的一些 png 资源设计，通过这个工具延伸的一些辅助工具，可以快速预览和恢复未优化的图片。</p>
<h1 id="pngcrush">pngcrush</h1>
<p>本身就是一个开源的工具，托管在 <a href="http://pmt.sourceforge.net/pngcrush/index.html">SourceForge</a>，可以在任何平台运行，对于安装 Xcode 的童鞋，此工具默认放在：</p>
<pre tabindex="0"><code># XCode 4.3+
/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/usr/bin/pngcrush

# XCode 4.2.x 以下版本
/Developer/Platforms/iPhoneOS.platform/Developer/usr/bin/

# 还原 ipa 目录下所以 png 文件到 reverted 目录下面
pngcrush -dir reverted -revert-iphone-optimizations -q ipa/*.png
</code></pre><p>这里还有一些其他版本的<a href="http://stackoverflow.com/questions/7138700/pngcrush-uncrush-on-linux">类似工具</a></p>
<h1 id="quicklook">Quicklook</h1>
<p>OSX 有个系统的快速预览功能，简单的解释（针对于图片来说）：可以显示图片的内容，同时选中文件，按<strong>空格</strong>对于系统可以识别的即可快速查看文件的内容。</p>
<p>但由于 iOS app 的 png 文件是优化后的，既然系统无法识别，那就更别提 Quicklook 了，于是利用 pngcrush 就有了新的产物：PngUncrush.qlgenerator。有了它就可以用 Quicklook 显示和查看 png 图片了。</p>
<p>目前利用这个工具做成的工具很多，包括用 shell 安装的，pkg 文件，实际上原理都是把这个文件丢到系统 <code>/Library/QuickLook/</code> 或者 <code>~/Library/QuickLook/</code> 下面即可。</p>
<p>我觉得比较好用的是 <a href="http://castelliweb.com/blog/2010/05/24/quicklook-plugins-for-mac/">Quicklook Plugins for Mac</a>，这是一个 pkg 安装文件，不仅包括了对于 png 文件的快速预览，同时对于 ipa 文件的图表也会更换为更为直观的 App 图标，方便大家的浏览和识别。</p>
<h1 id="atpeek">atPeek</h1>
<p>我就知道你不会满足上面半自动的工具，我想 <a href="http://www.atpurpose.com/atPeek/">atPeek</a>(奇怪为什么会被墙掉) 也是你在本博文中最满意的工具。正式介绍下，这个工具自打开的一瞬间，就会加载 <code>Music/iTunes/Mobile Applications</code> 目录下面的所有 ipa 文件。点击你需要查看的 ipa 文件，不仅可以查看该 ipa 的基本 App，最让大家爽的是，ipa 的所有资源文件以文件资源管理器的方式呈现出来。嗯，没错！我可以看到你们双眼发光了！</p>
<p>但是，这是一个付费应用，你可以进行的操作就是浏览 ipa 和应用自带的预览功能，任何的放大以及导出 png 资源，都是需要付费的，价格为 $4.99。</p>
]]></content:encoded></item><item><title>升级 xcode 4.3.1</title><link>https://icyleaf.com/2012/03/upgrade-xcode-431/</link><pubDate>Fri, 09 Mar 2012 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2012/03/upgrade-xcode-431/</guid><description>下载 XCode 目前有两种途径： ​1. Mac App Store ​2. Apple Developer Download Page (需要有开发者账号并登陆） 对于前者好处在于免费下载但下载时间或许非常漫长；但后者如果条件都满...</description><content:encoded><![CDATA[<p>下载 XCode 目前有两种途径：</p>
<p>​1. <a href="http://itunes.apple.com/us/app/xcode/id497799835?mt=12">Mac App Store</a></p>
<p>​2. <a href="https://developer.apple.com/downloads/index.action">Apple Developer Download Page</a>
(需要有开发者账号并登陆）</p>
<p>对于前者好处在于免费下载但下载时间或许非常漫长；但后者如果条件都满足的话（apple developer id + <a href="http://t.cn/zOcn4KN">script</a> + vps + axel）那就可以非常快速的下载到页面上面的所有资源。</p>
<p>XCode 4.3 之后的版本采用核心和模块分离，现在主程序只有 1.8G 左右，其余的包括 Command line tools + dashcode + graphics tools（同样可以使用上面的脚本）需要单独按需下载。但这还不是变化最大的，最大的地方在于之前版本都是存放在 <code>/Developer</code> 路径下面，4.3 之后的版本统一改放在了 <code>/Applications</code>下面，下载 dmg 打开后直接把 Xcode 拖入 <code>/Applications</code> 即可。</p>
<p>安装完毕后首次启动，会有一个提示，这点需要非常注意，新版的会要求你把 <code>/Developer</code> 以及 <code>/Applications/Install Xcode</code> 一并移动至回收站，注意是整个目录完全移动。假如你的机器安装了其他的开发工具放置在了<code>/Developer</code> 了，这里就需要谨慎处理。</p>
<p>初次之外，我参考 <a href="http://useyourloaf.com/blog/2012/2/17/updating-to-xcode-43.html">Use Your Loaf</a>的博文，假如你的环境还需要依赖 Command line tools for xcode，除了下载和安装的过程，还需要在终端作下处理。比如上面提到博文所说的 <code>agvtools</code> 管理 App 版本自动化的工具。在升级 4.3+ 版本可能就会出现下面的错误</p>
<pre tabindex="0"><code>$ agvtools
Error: No developer directory found at /Developer.
Run /usr/bin/xcode-select to update the developer directory path.
</code></pre><p>Use Your Loaf 博文提到需要使用 <code>xcode-select</code> 重新选择 Xcode 的安装路径，来保证终端工具可以正常运行，但是在 4.3.1 中我尝试还是失败。提示如下：</p>
<pre tabindex="0"><code>$ sudo /usr/bin/xcode-select -switch /Applications/Xcode.app
$ agvtool
Error: Can&#39;t run /Applications/Xcode.app/usr/bin/agvtool (no such file).
</code></pre><p>经常检查发现，实际上 Command line tools 安装后存放在 <code>/Applications/Xcode.app/Contents/Developer/usr</code> 路径下面，尝试更正操作:</p>
<pre tabindex="0"><code>$ sudo /usr/bin/xcode-select -switch /Applications/Xcode.app/Contents/Developer/

搞定！

---------华丽丽的分割线---------

**Instruments 哪里去了？**

哼哼，尝试在 Xcode 图标右键 &#34;Open Developer Tool&#34;，看到了吧，还有一些其他的工具 :)
</code></pre>]]></content:encoded></item><item><title>Colors</title><link>https://icyleaf.com/2012/03/colors-is-ios-development-utility-tool/</link><pubDate>Fri, 02 Mar 2012 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2012/03/colors-is-ios-development-utility-tool/</guid><description>最新更新，发现更好的免费取色器 Sip Colors 是一个简单的颜色取色器，简单的有可能你都没有听说过它，虽然它对于平面设计师以及 Web 设计师不太看中，但它可是程...</description><content:encoded><![CDATA[<blockquote>
<p>最新更新，发现更好的免费取色器 <a href="https://itunes.apple.com/us/app/sip/id507257563?mt=12">Sip</a></p>
</blockquote>
<p><a href="http://mattpatenaude.com/">Colors</a> 是一个简单的颜色取色器，简单的有可能你都没有听说过它，虽然它对于平面设计师以及
Web
设计师不太看中，但它可是程序员中的一个实用利器，为什么这样说呢，看下面截图，除了基本的颜色取值外，还包括了 Mac 和 iOS（iPhone/iPad）对于类的取值。</p>
<p>等等，你说的不对，我下载了发现并没有 UIColor 的值，坑爹这不是，哈哈，非也，这个应用的最大好处在于可以自定义输出值。默认程序并没有 UIColor 这值。其实添加也很简单，在设置里（Command+逗号），添加一个名为 UIColor 的选项，其中只需要设置 GRB 的输出值和 Alpha 一样即可（Short Decimal over 1），输出格式使用 UIColor 的 RGBA 格式：</p>
<pre tabindex="0"><code>[UIColor colorWithRed:%r green:%g blue:%b alpha:%a]
</code></pre><p>后来发现这个应用是开源项目，且最后更新时间为 2009 年，难怪没有 UIColor
的输出值，有兴趣的朋友可以 Fork ：https://github.com/13bold/Colors</p>
<blockquote>
<p>我 fork 了作者的分支，添加了对 UIColor 的支持：http://github.com/icyleaf/Colors</p>
</blockquote>
]]></content:encoded></item><item><title>让 Android 支持下拉刷新(Pull Refresh)</title><link>https://icyleaf.com/2012/02/pull-refresh-for-android/</link><pubDate>Wed, 29 Feb 2012 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2012/02/pull-refresh-for-android/</guid><description>曾几何时，自 Android 发布之后一直以来就被管以 Geek 的玩具，而不太注重界面设计和用户交互设计，这让 Android 开发者也顺其自然的接受了这个不好的头衔，但我一度认为...</description><content:encoded><![CDATA[<p>曾几何时，自 Android 发布之后一直以来就被管以 Geek 的玩具，而不太注重界面设计和用户交互设计，这让 Android 开发者也顺其自然的接受了这个不好的头衔，但我一度认为这只是不思进取的行为，谁说 Android 就不能像 iPhone 的界面那样设计，我认为只有用心，没神马不能实现的。说回正题，第一次看到 Android 有这项功能的莫过于改版后的 Twitter，我认为它绝对是一个标榜性的 App（同时也包括已开源许久的 <a href="http://code.google.com/p/foursquared/">Foursquare</a>）。于是全世界的开发者就开始寻思这个效果 Twitter
是如何实现的，于是就有了&hellip;</p>
<p><img loading="lazy" src="https://github.com/johannilsson/android-pulltorefresh/raw/master/android-pull-to-refresh.png"
  
  
  alt=""></img>
</p>
<p>这是由 <a href="http://johannilsson.com/2011/03/13/android-pull-to-refresh-update.html">johannilsson</a> 以及众位其好友的研究成果，并已 Apache 2.0 协议开源托管在 Github：<a href="https://github.com/johannilsson/android-pulltorefresh">https://github.com/johannilsson/android-pulltorefresh</a></p>
<p>大概看了一下源码，发现和我初步的想法类似，除了需要集成系统的 ListView 之外，只能在 HeaderView 上面做文章，外加配合 onTouchEvent， onScroll
事件可以捕捉用户下拉和上滑的事件监听。</p>
<p>用法：</p>
<p>Layout</p>
<pre tabindex="0"><code>// The PullToRefreshListView replaces a standard ListView widget.

&lt;com.markupartist.android.widget.pulltorefreshlistview
android:id=&#34;@+id/android:list&#34;
android:layout\_height=&#34;fill\_parent&#34;
android:layout\_width=&#34;fill\_parent&#34;
/\&gt;
</code></pre><p>Activity</p>
<pre tabindex="0"><code>// Set a listener to be invoked when the list should be refreshed.

((PullToRefreshListView) getListView()).setOnRefreshListener(new
OnRefreshListener() {

	@Override
	public void onRefresh() {
		// Do work to refresh the list here.
		new GetDataTask().execute();

	}

});

private class GetDataTask extends AsyncTask&lt;void, void, string[]&gt; {

...

@Override
protected void onPostExecute(String[] result) {
	mListItems.addFirst(&#34;Added after refresh...&#34;);

	// Call onRefreshComplete when the list has been refreshed.
	((PullToRefreshListView) getListView()).onRefreshComplete();
		super.onPostExecute(result);

	}

}
</code></pre><p>仓库里除了实现类外，还有<a href="https://github.com/johannilsson/android-pulltorefresh/tree/master/pulltorefreshexample">一个实例</a>，看看人家够意思吧。</p>
]]></content:encoded></item><item><title>如何让 iOS 和 Android 支持自定义字体</title><link>https://icyleaf.com/2011/07/custom-fonts-both-in-ios-and-android/</link><pubDate>Wed, 06 Jul 2011 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2011/07/custom-fonts-both-in-ios-and-android/</guid><description>本篇教程的目前源于我们团队设计师一直询问，iOS(iPhone/iPad) 和 Android 两个平台是否支持自定义字体的问题，恰巧前不久唐茶计划出了一个关...</description><content:encoded><![CDATA[<p>本篇教程的目前源于我们团队设计师一直询问，iOS(iPhone/iPad) 和 Android
两个平台是否支持自定义字体的问题，恰巧前不久<a href="http://www.v2ex.com/t/15220">唐茶计划</a>出了一个关于在中文阅读新体验的电子书应用：<a href="http://itunes.apple.com/cn/app/id446752200?mt=8">失控</a>。里面提到中文的显示采用了香港字体设计室的全新中文黑体字：<a href="http://www.typeisbeautiful.com/2011/07/4276">信黑体</a>。于是我就在想看来
iOS 是可以支持自定义字体的。通过搜索和研究整理如下，供自己备份和大家参考</p>
<h1 id="ios">iOS</h1>
<p>iOS 对字体以样式的支持是非常有限的(内嵌<a href="http://iosfonts.com/">默认字库列表</a>)，尤其说对于用习惯了 HTML + CSS，就觉得 iOS 对字体的扩展真是逊到渣了，当然高人们已经准备为大众造福，出现了轻巧的
<a href="https://github.com/zynga/FontLabel">FontLable</a>，<a href="https://github.com/mattt/TTTAttributedLabel">TTTAttributedLabel</a> 开源库到怪兽级别 <a href="https://github.com/facebook/three20">Three20</a> 开源框架。但假如仅仅是想加载自定义字体来说，对于 iOS 4 版本还是比较简单的：</p>
<ol>
<li>添加自定义字体文件做资源文件添加到 XCode 项目之中</li>
<li>在 info.plist 中新增一个名为 UIAppFonts 的 Key，类型是数组（array）</li>
<li>把新增的字体的文件名（包括后缀）依次填入 UIAppFonts 数组（注意区分大小写）</li>
<li>保存 info.plist（废话）。准备工作完毕，下面是编码部分</li>
</ol>
<pre tabindex="0"><code>@implementation CustomFontLabel

- (id)initWithCoder:(NSCoder *)decoder
{
    if (self = [super initWithCoder: decoder])
    {
        [self setFont: [UIFont fontWithName: @&#34;Custom Font Name&#34; size: self.font.pointSize]];
        // 这里 Custom Font Name 并不是字体的文件名，而且系统注册显示的字体标准名称，比如
        // 比如，微软雅黑，最好就用 Microsoft YaHei （不过这个会存在版权问题把 XD）
        // 另外，注意区分大小写
    }
    return self;
}

@end
</code></pre><p>这里还有更完整的<a href="http://stackoverflow.com/questions/360751/can-i-embed-a-custom-font-in-an-iphone-application">关于 iOS 不同平台支持自定义字体</a>的问答。</p>
<h1 id="android">Android</h1>
<p>Android 默认支持  Droid Sans，Droid Sans Mono 和 Droid Serif 三种字体，其实对于中文的显示还是很不错的，有些类似于微软雅黑字体（<a href="http://www.cnbeta.com/articles/114854.htm">区别</a>）。假如只是对默认的字体进行更换，最简单的方法就是配置 layout 文件：</p>
<pre tabindex="0"><code>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;
&lt;LinearLayout xmlns:android=&#34;http://schemas.android.com/apk/res/android&#34;
              android:orientation=&#34;vertical&#34;
              android:layout_width=&#34;fill_parent&#34;
              android:layout_height=&#34;fill_parent&#34;
        &gt;
    &lt;TextView
            android:layout_width=&#34;fill_parent&#34;
            android:layout_height=&#34;wrap_content&#34;
            android:text=&#34;This is a &#39;sans&#39; demo!&#34;
            android:typeface=&#34;sans&#34;
            /&gt;
     &lt;TextView
            android:layout_width=&#34;fill_parent&#34;
            android:layout_height=&#34;wrap_content&#34;
            android:text=&#34;This is a &#39;serif&#39; demo!&#34;
            android:typeface=&#34;serif&#34;
            android:textStyle=&#34;italic&#34;
            /&gt;
     &lt;TextView
            android:layout_width=&#34;fill_parent&#34;
            android:layout_height=&#34;wrap_content&#34;
            android:text=&#34;This is a &#39;monospace&#39; demo!&#34;
            android:typeface=&#34;monospace&#34;
            android:textStyle=&#34;bold&#34;
            /&gt;
&lt;/LinearLayout&gt;
</code></pre><p>但是这样肯定不能满足大家对于字体排版高一级的要求，下面是支持自定义字体的步骤：</p>
<p>首先，添加自定义字体文件放在项目的 <code>assets/fonts</code> 目录下面（目录可能需要自己创建）。</p>
<p>其次，编辑 layout 文件（这里做一个示范）</p>
<pre tabindex="0"><code>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;
&lt;LinearLayout xmlns:android=&#34;http://schemas.android.com/apk/res/android&#34;
              android:orientation=&#34;vertical&#34;
              android:layout_width=&#34;fill_parent&#34;
              android:layout_height=&#34;fill_parent&#34;
        &gt;
    &lt;TextView android:id=&#34;@+id/textview&#34;
            android:layout_width=&#34;fill_parent&#34;
            android:layout_height=&#34;wrap_content&#34;
            android:text=&#34;This is a &#39;Microsoft YaHei&#39; demo!&#34;
            /&gt;
    &lt;Button android:id=&#34;@+id/button&#34;
            android:layout_width=&#34;fill_parent&#34;
            android:layout_height=&#34;wrap_content&#34;
            android:text=&#34;This is a &#39;Microsoft YaHei&#39; button!&#34;
            /&gt;
&lt;/LinearLayout&gt;
</code></pre><p>最后，在代码部分实现自定义字体（和 iOS 类似）</p>
<pre tabindex="0"><code>public void onCreate(Bundle savedInstanceState)
{
       super.onCreate(savedInstanceState);
        setContentView(R.layout.main);

        TextView textView = null;
        Button button = null;

        setFont(textView, &#34;fonts/YaHei.ttf&#34;, R.id.text_view);
        setFont(button, &#34;fonts/YaHei.ttf&#34;, R.id.button);
}

void setFont(TextView name, String path, int res)
{
    	name = (TextView) findViewById(res);
        Typeface font = Typeface.createFromAsset(this.getAssets(), path);
        name.setTypeface(font);
}
</code></pre><p>扩展阅读 [<a href="http://mobile.tutsplus.com/tutorials/android/customize-android-fonts/">1</a>] [<a href="http://russenreaktor.wordpress.com/2010/04/29/solved-android-using-custom-fonts/">2</a>]</p>
<p>话说，为什么 Android 到现在都没有更多的开源的库和框架呢？</p>
]]></content:encoded></item><item><title>Chrome 扩展</title><link>https://icyleaf.com/2011/06/chrome-extension-url-to-qr-code/</link><pubDate>Thu, 16 Jun 2011 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2011/06/chrome-extension-url-to-qr-code/</guid><description>URL to QR-Code 是一个 Chrome 扩展,适用于 Chrome 浏览页面的同时希望把在手机设备(当然手机得支持 QR-Code的扫描)也能访问.我总结可以适用于以下情景: 这个网页...</description><content:encoded><![CDATA[<p>URL to QR-Code 是一个 Chrome 扩展,适用于 Chrome 浏览页面的同时希望把在手机设备(当然手机得支持 QR-Code的扫描)也能访问.我总结可以适用于以下情景:</p>
<ul>
<li>这个网页必须使用手机设备访问</li>
<li>这个网页是一个手机应用的安装链接(AppStore/Google Market),用手机访问可以直接安装</li>
<li>我就是想用手机浏览此网页,怎么着</li>
</ul>
<p>好吧,基于以上情景,我做了一个 Chrome 扩展,恩,没错,只适用于 Chrome,也许会有人说,这个东西网上已经有了,为什么你还要重造轮子.我的理由是,虽然我的功能非常简单,鉴于目前现有的一些应用,都会把功能显示在 Chrome 的 Tab 上面,其实这个功能用的几率并不多,放在 Tab 实在是浪费了太大的空间,我的 Tab 的 Icons 已经负载过多了(大家可参考我之前分享的 <a href="http://icyleaf.com/2011/06/11/im-using-chrome-extensions-software-list/">我常用的 Chrome 扩展集合</a>),因此我决定把 Icon 丢在地址栏的右侧,这里相对于的利用空间更小.点击之后直接弹出
QR-Code,方便手机扫描.</p>
<p>安装地址: http://icyleaf.googlecode.com/svn/javascript/Chrome/url_to_qr_code_v0.1.crx</p>
<p>&mdash;&mdash;&mdash;&mdash;&ndash;需要更新的分割线&mdash;&mdash;&mdash;&mdash;&mdash;-</p>
<p>发现 Google Chart API 居然提供支持 QR-Code,文档在此后面准备更换生成QR-Code的服务接口支持选文字生成和文字链的原始链接的生成.这里算是埋下一个坑,大家可以提醒我来填满。。。</p>
<p>文档地址：http://code.google.com/apis/chart/image/docs/gallery/qr_codes.html</p>
]]></content:encoded></item><item><title>魔豆及其豆瓣 API 测试平台开源咯</title><link>https://icyleaf.com/2011/05/modou-and-douban-api-console-is-open-source-now/</link><pubDate>Mon, 02 May 2011 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2011/05/modou-and-douban-api-console-is-open-source-now/</guid><description>这是作为 2011 年 5 月 1 日劳动节的福利发放，欢迎各位 Kohana 开发者及其爱好者围观领取，领取内容及其使用方式请前往本人 Github 的项目地址：https://git...</description><content:encoded>&lt;p>这是作为 2011 年 5 月 1 日劳动节的福利发放，欢迎各位 Kohana 开发者及其爱好者围观领取，领取内容及其使用方式请前往本人 Github 的项目地址：https://github.com/icyleaf/modou&lt;/p></content:encoded></item><item><title>如何在开发和发布环境使用 Android Map Key</title><link>https://icyleaf.com/2011/05/how-to-using-android-map-key-both-in-development-and-production/</link><pubDate>Mon, 02 May 2011 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2011/05/how-to-using-android-map-key-both-in-development-and-production/</guid><description>在项目中第一次使用并涉及 Google Map 的功能，而由于 Google 的限制，Google Map 模块出来需要单独下载模块之外，对于每一个应用还都必须具有一个 Google Map Key，这...</description><content:encoded><![CDATA[<p>在项目中第一次使用并涉及 Google Map 的功能，而由于 Google 的限制，Google Map 模块出来需要单独下载模块之外，对于每一个应用还都必须具有一个 Google Map Key，这点和使用 Web 开发调用 Google Map API 是一致的。</p>
<p>对于 Android 采用的 Google Map Key 来说，是由一串 MD5 值（类似这样：94:1E:43:49:87:73:BB:E6:A6:88:D7:20:F1:8E:B5:98）生成的。那么这个 MD5 是哪来的呢？</p>
<p>​1. 开发环境的 Google Map Key</p>
<p>这个比较简单，网上大面积教程所采用的 android 系统默认带有一个 debug.keystore。假如开发使用 Eclipse，在其 windows -&gt; Preference -&gt; Android -&gt; Build 下，其中 Default debug keystore 的值便是 debug.keystore 的路径。</p>
<p>在命令行或者终端执行下面命令（注意指明 debug.keystore 的路径）即可获取到 MD5 值。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ keytool -list -keystore debug.keystore
</span></span></code></pre></div><p>​2. 发布环境的 Google Map Key</p>
<p>假如你的应用需要上线到官方的 Google Market 上面，则需要根据其 apk 的签名证书（keystore）的 MD5 值去生成，方法也很简单，发布的签名同样可以使用 Eclipse 的 Export 工具制作。制作完毕后（或许这个生成的签名没有 .keystore 后缀，不用在意）。同样也使用上面的命令获取其 MD5 值。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1"># 比如，证书路径 /home/icyleaf/android/ews</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">$ keytool -list -keystore /home/icyleaf/android/ews...
</span></span><span class="line"><span class="ln">3</span><span class="cl">
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1">#  查询到了 MD5 值</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">Certificate fingerprint <span class="o">(</span>MD5<span class="o">)</span>: 94:1E43:49:87:73:BB:E6:A6:88:D7:20:F1:8E:B5:98
</span></span></code></pre></div><p>使用其 MD5 值在 <a href="http://code.google.com/android/maps-api-signup.html">Sign Up for the Android Maps API</a> 页面填写生成即可。</p>
<p>接下来的步骤就没什么了，又是搜索出千篇一律的教程，大家 Google 之。</p>
]]></content:encoded></item><item><title>为 ShareKit 增加国内相关微博/SNS 服务</title><link>https://icyleaf.com/2011/05/append-related-services-into-sharekit-from-china/</link><pubDate>Mon, 02 May 2011 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2011/05/append-related-services-into-sharekit-from-china/</guid><description>在 iDev 圈内，众所周知 ShareKit是一个家喻户晓的分享框架，很多人都在问哪有支持国内相关微博/SNS服务（比如，新浪微博，腾讯微博，豆瓣，开...</description><content:encoded><![CDATA[<p>在 iDev 圈内，众所周知 ShareKit是一个家喻户晓的分享框架，很多人都在问哪有支持国内相关微博/SNS服务（比如，新浪微博，腾讯微博，豆瓣，开心网，校内等）的类似框架或者谁去做贡献，造福那些拿来主义的人类。正好碰巧我刚刚接触 iOS 开发不久，为了验证文章开头的那段话，恰巧我开发的应用也需要设计这块的内容，我就只好啃下了这块“硬面包”，实际上在熟悉整个 ShareKit 的代码后，外加上对于 OAuth 协议又非常的了解，做一个扩展还是很轻松的，虽然我对 Objective-C 代码并不是很熟悉，这一切得益于 ShareKit。</p>
<p>ShareKit 在整体上，代码写的比较完美，对于新增的服务可以轻松实现，而且另外最最大的一个好处在于国内的这些服务实际上都是 Copy to China，这有大大减少了移植的开发量，比较恶心的事，国内为了证明我们的结构和功能不同于原版，对其有做了细微的调整，这就导致使用标准化的协议不能通过，这对于只是想用的人来说就是一种灾难。</p>
<blockquote>
<p>天下事有难易乎？为之，则难者亦易矣；不为，则易者亦难矣。人之为学有难易乎？学之，则难者亦易矣；不学，则易者亦难矣。</p>
</blockquote>
<p>上面是从 V2EX某帖子挖出来的一个评论，实际上这段文字大家在学校的时候应该并不陌生，随后又看到了《<a href="http://huajun.w18.net/?p=388">凭什么是我们</a>》这篇文章，更是印证了上面这段话。</p>
<p>为什么我要说上面这段和标题并不沾边的文字呢，实际上现在要发布的日志本来在我看来是非常没有必要的，因为这个项目我已经在 git 上面 fork 并贡献了关于国内相关微博/SNS服务的代码，我以为大家可以通过搜索引擎搜索到，可想还是有人来问我，那好吧，为了减少询问我的次数，以及这篇日志的SEO，我还是写下了这个日志。</p>
<p>Github 项目地址：https://github.com/icyleaf/ShareKit</p>
<p>衷心希望这个 fork 的代码对热情开发的人有所帮助！</p>
]]></content:encoded></item><item><title>个人常用 OS X 软件集合</title><link>https://icyleaf.com/2011/03/im-using-osx-software-list/</link><pubDate>Tue, 29 Mar 2011 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2011/03/im-using-osx-software-list/</guid><description>用了 OS X 已经半年多了，整理下日常常用的软件。大多数都是开源或者免费软件，少数需要购买 AppCleaner：卸载软件必备，适合用于第三方安装和...</description><content:encoded><![CDATA[<p>用了 OS X 已经半年多了，整理下日常常用的软件。大多数都是开源或者免费软件，少数需要购买</p>
<ul>
<li>AppCleaner：卸载软件必备，适合用于第三方安装和 App Store</li>
<li>aliwangwang：淘宝用户必备</li>
<li>DiffMerge：文件、文件夹对比的工具，貌似对中文支持有问题（没有细研究）</li>
<li>Dropbox：改 hosts 还能继续用的多平台文件云同步软件</li>
<li>DoubanFM：豆瓣电台</li>
<li>Cdto：可以快速从 Finder 切换当前路径到 terminal 里</li>
<li>Evernote：笔记整理同步必备</li>
<li>Facetime：大家都知道，免费版， HD 是收费版</li>
<li>Firefox：就是一火狐</li>
<li>FIT：免费开源的 OSX 输入法</li>
<li>fraise：文本编辑器，个人比较喜欢，比 TextWrangler 好用</li>
<li>git：SCM 软件</li>
<li>brew：terminal 下的软件包管理器</li>
<li>Chrome：浏览网页的神器</li>
<li>Growl：消息半透明窗提醒，Ubuntu 都模仿</li>
<li>iOS Simulator Cropper：可以截 iOS 模拟器截图</li>
<li>iTerm：Cocoa 重写的 Terminal，支持 Linux 下快捷键切换 Tab</li>
<li>MesaSQLite：SQLite 数据库管理软件</li>
<li>MPlayerX：视频播放器</li>
<li>mysql workbench：Mysql 建模软件</li>
<li>OmniDiskSweeper：磁盘空间使用率情况</li>
<li>PHPStorm：Jetbrain 的新一神器，PHP IDE（收费）</li>
<li>PlistEditPro：plist 编辑器</li>
<li>PowerWord：金山词霸（最新版是 08 年，汗颜）</li>
<li>Reeder：Google Reader for OSX</li>
<li>Sequel pro：Mysql 数据库管理软件</li>
<li>SIMBL</li>
<li>Simple Comic：漫画软件</li>
<li>Skitch：处理截图的好工具</li>
<li>Sparrow：Gmail 客户端</li>
<li>TextWrangler：又一文本编辑器</li>
<li>The Unarchiver: 最智能且免费的解压缩软件</li>
<li>TotalFinder：Finder 增强型工具，强烈推荐（收费）</li>
<li>VirtualBox：开源虚拟机</li>
<li>Xcode 4：Apple 开发必备</li>
</ul>
<p>睡觉前的粗略整理，待续&hellip;</p>
]]></content:encoded></item><item><title>2010年度总结</title><link>https://icyleaf.com/2011/01/2010-year-in-review/</link><pubDate>Wed, 05 Jan 2011 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2011/01/2010-year-in-review/</guid><description>2011年已至，又到了一年一度的年终终结的时候了。上个星期还和 @CNBorn同学聊了年终总结的事情，今天在看翻 Google Reader 发现订阅的很多人都写了总结...</description><content:encoded><![CDATA[<p>2011年已至，又到了一年一度的年终终结的时候了。上个星期还和 @<a href="http://cnborn.net">CNBorn</a>同学聊了年终总结的事情，今天在看翻 Google Reader 发现订阅的很多人都写了总结，虽然晚了几步，还得赶紧跟上。提炼过往的一年内所经历的事情，所感受到的一些事物&hellip;</p>
<p>整体来说 2010 年对我来说是憧憬的一年。</p>
<p><a href="http://icyleaf.com/2008/12/2008-year-in-review/">2008</a> 年是起步并定制计划的一年，<a href="http://icyleaf.com/2010/01/2009-year-in-review/">2009</a> 年是 2008 年计划沉淀后发挥的一年，2010 年在事业，技术，思想得到了逐步提高，这次总结大致按照性质为工作，技术，生活等几类：</p>
<h3 id="工作">工作</h3>
<p>2010年可谓是 Twitter 年，作为一名从 2007 年就开始使用的轻度用户到现在随时关注的中度用户。之所谓不能说重度用户，现在已经逐渐减少了 Twitter 的牢骚，慢慢的沉淀浮躁的心，做一些自认为有意义的事情。其中最大的也是让我最满意的一件就是通过 Twitter 让我成功的从 Java 转到了 PHP 开发，感谢  @<a href="http://twitter.com/lnsoso">lnsoso</a> 给我这个机会。对个人来说，比较遗憾的是在转入 PHP 这一行业之前，曾尝试以移动互联网开发者的身份“杀入”豆瓣，后因逢遇高人 @<a href="http://www.douban.com/people/flycondor/">flycondor</a> 告知个人能力有待提高，未遂。</p>
<p>虽然没能进入豆瓣，但能转入互联网开发领域已经让人欣喜了，在<a href="http://house.sina.com.cn">新浪乐居</a>的一年内，由于公司技术氛围很融洽，经常会在一起讨论一些技术，分享会。给个人有很好的成长空间和发挥能力。同时非常欣喜能遇上这么多好好的同事和领导 :)</p>
<h3 id="技术">技术</h3>
<ul>
<li>
<p>PHP/Kohana
​1. 2009 年提到的 Douban API Package 以开源的形式正式发布到了<a href="https://github.com/icyleaf/douban">github</a> 上面。
​2. <a href="https://github.com/icyleaf/alpaca">alpaca</a>社区系统在整个一年之中虽然没太多的功能增加，但其代码在不断的重构（最近在读<a href="http://book.douban.com/subject/4262627/">重构</a>更加确定了重构的重要性）
​3. 学习了一个轻量级的模版引擎框架 <a href="http://www.twig-project.org/">twig-php</a>，虽然也是今年开始熟悉 Smarty 的，但是我更喜欢 twig，语义清晰，解析速度迅速，其实框架的灵感来自于 Django 自身的模版系统，而且易于扩展开发。 详情请看作者在最初的<a href="http://fabien.potencier.org/article/34/templating-engines-in-php">介绍</a>。
​4. gears 项目一个类似于 ROR 下面 Redmine 的项目需求管理系统，由于 PHP 上面没也太好的系统，自己着手开发并熟悉下复杂逻辑的开发，项目尚在开发中，没有源码发布 :(</p>
</li>
<li>
<p>JAVA/Android
在 2010 年的后半年因好奇和对 Google 开源的个人憧憬心态开始对 Android 开发做了一些研究，开始东拼西凑的做了一些小的应用，后被公司看中正式着手一个公司项目的 App，历时近 3 个月，边学习边琢磨边专注 Android 界面设计，在 12 月中旬终于可以缓一口气，并可以拍拍胸脯说这个软件可以在同等行业内软件的用户体验是可以最棒的！当然功能也不差的 :) 不过该项目还没有最后的完成，等待发布吧！</p>
</li>
<li>
<p>Objective-C/iOS
接触 iOS 开发的时间在 Android 之后，正好在做完一两个 Android 应用的时候拥有的人生的第一台 MacBook Pro，破不急奈的安装了 Xcode 一展其 IDE 和 Interface Builder 的风采，体验完之后傻了，相对于 Android 的界面设计，我真想发泄一下摔些东西。同等的时间在 Android 下只能设计界面，而在 Xcode 里面设计界面只是几分钟的时候（参考<a href="http://developer.apple.com/library/mac/#documentation/UserExperience/Conceptual/AppleHIGuidelines/XHIGIntro/XHIGIntro.html">Apple HIG</a>）其余的时间可尽情的编码。于是从头开始学 Objective-C 下一步尝试 iOS 开发。</p>
</li>
</ul>
<p>另外很高兴成功 <a href="http://www.beijing-open-party.org/">Beijng Open Party</a> 活动的志愿者，希望在新的一年中可以努力为 OP 加油&amp;奋斗！</p>
<h3 id="数码设备">数码设备</h3>
<ol>
<li>
<p>Mac Book Pro
本来是期待身边的朋友购买的，因某人坚持不下，自己集资购入该设备，为今后 iOS 开发打好前期准备。</p>
</li>
<li>
<p>BlackBerry 8900
再一次下定觉得购入了第二台 bb 设备，第一台 8310 走完了它自己人生光辉的一年，主要是被我蹂躏了不成样子了，作为 RIM 公司后期拥有绝对血统的 8900 和 9000，果断入手前者，同时对 @cooku 童鞋当时问她为什么不买 9000 自我推倒- -！</p>
</li>
<li>
<p>iPad
啊哈，有一个推倒前期自我反对思想的奢侈品，作为一个较长期的苹果用户，其产品具有一定的“洗脑”作用。当然目前 iPad 使用频率最高的是 iBook、Twitter 和浏览器，偶尔玩玩游戏和体验一些有趣的 app。</p>
</li>
<li>
<p>Canon 50mm/1.8f
第一个也可能是唯一个佳能的镜头，用的次数并不是很多 &gt;.&lt;</p>
</li>
</ol>
<h3 id="读书">读书</h3>
<p>书里面水分很多，夹杂了一些曾经看到的漫画和小说，但也阅读了一些有信仰，有深刻含义的图书，比如 1984，动物庄园，切·格瓦拉传，刀锋，不去会死，苹果往事。</p>
<p>技术图书推荐：Rework(Olivda 合译本)，用户故事，重构，Pro Git，给大家看的设计书</p>
<p>![](<a href="http://chart.apis.google.com/chart?chs=400x200&amp;cht=bvs&amp;chd=s:CEUEIKSEcIrQ&amp;chxt=y,x,x&amp;chxl=0">http://chart.apis.google.com/chart?chs=400x200&amp;cht=bvs&amp;chd=s:CEUEIKSEcIrQ&amp;chxt=y,x,x&amp;chxl=0</a>:|0|5|10|15|20|25|30|1:|1|2|3|4|5|6|7|8|9|10|11|12|2:|month&amp;chxp=2,100&amp;chf=c,lg,90,76A4FB,0.5,ffffff,0|bg,s,EFEFEF&amp;chco=0000ff&amp;chtt=82%20books+you+added+in+year+2010|divided+by+month</p>
<h3 id="电影">电影</h3>
<p>这一年的电影可没少看，因总看恐怖片被 @CNBorn 无比鄙视，因此开始计划看完[IMDB Top 250]<a href="%5B%E7%94%B5%E9%A9%B4%E4%B8%8B%E8%BD%BD%5D%5B%5D"></a>，起初计划每天一部，逐渐到后来因各种工作或其他事情只能减少频率，啊，现在已经看满编号的第 100 部了（不包括下面已经看过的）！今年继续努力！</p>
<h3 id="音乐">音乐</h3>
<p>这方面还是比较随心所欲，没有太大的变动，只不过开始听古典（莫扎特），开始小听下电影的
OST （曾一度在网上搜索关键词写成 OTA）</p>
<h3 id="日志">日志</h3>
<p>好吧，我承认我没有达到去年说的要求：“2010年的日志数量和2009年类似”，刚才统计了结果，发现
2009 年度共计发布了 31 篇日志，而 2010 年加上 09 年的总结在内也仅仅只有 10 篇，数量下降了 1/3 左右，汗颜。今年开始经过会多发布技术相关的日志，早期一些分享软件或框架的内容会少一些，比较不能再这么水下去了&hellip;</p>
<h3 id="运动">运动</h3>
<p>很遗憾，2010 年度并没也什么运动了&hellip;需要恢复！我要减灰 Orz&hellip;</p>
<h3 id="言而总之">言而总之</h3>
<p>2010 年读了许多书，也看了不少电影，在个人修养上面有很大的提高，早晨 6 点 50 起床是一个长期考验而且我坚持下来了，也算是摆脱了很大的“懒”的坏习惯。今年最大的开发实践准备尝试敏捷开发流程 + TDD以及重构相结合的开发模式双结合。</p>
<p>新的一年，加油！</p>
]]></content:encoded></item><item><title>OSX</title><link>https://icyleaf.com/2010/12/switer-between-finder-and-terminal-in-osx/</link><pubDate>Wed, 08 Dec 2010 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2010/12/switer-between-finder-and-terminal-in-osx/</guid><description>在 Finder 打开 Terminal 并切换到当前目录 安装一个开源的 Finder 辅助工具：cdto。功能只有一个就是实现在 Finder 打开 Terminal 并切换到当前 Finder 目录。找到你系统的版本的 app （支持当...</description><content:encoded><![CDATA[<p><strong>在 Finder 打开 Terminal 并切换到当前目录</strong></p>
<p>安装一个开源的 Finder 辅助工具：<a href="http://code.google.com/p/cdto/">cdto</a>。功能只有一个就是实现在 Finder
打开 Terminal 并切换到当前 Finder 目录。找到你系统的版本的 app （支持当前
OS X 10.4 以上版本，应该都是雪豹了 吧）拷贝到 Applications 下并把它拖到
Finder 的工具栏上即可。</p>
<p><strong>从 Terminal 中用 Finder 打开当前路径的目录</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ open .
</span></span></code></pre></div><p>PS，如果是 Ubuntu 系统的话请安装 nautilus，然后在 Terminal 里面输入</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ nautilus .
</span></span></code></pre></div>]]></content:encoded></item><item><title>Ubuntu 解决 public key is not available 问题</title><link>https://icyleaf.com/2010/11/apt-get-gpg-error-public-key-not-available/</link><pubDate>Wed, 03 Nov 2010 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2010/11/apt-get-gpg-error-public-key-not-available/</guid><description>自 Ubuntu 10.04 升级至 10.10 之后，系统就有些不注意的小毛病，包括系统的各个软件的配置文件可能有改动，加上常年累计尝试并添加很多 ppa 的源，自定义的软件源在升级...</description><content:encoded><![CDATA[<p>自 Ubuntu 10.04 升级至 10.10 之后，系统就有些不注意的小毛病，包括系统的各个软件的配置文件可能有改动，加上常年累计尝试并添加很多 ppa</p>
<p>的源，自定义的软件源在升级兼容的考虑下全部金禁用了导致原本软件源的注解名称也没有了，自己不知道各个软件源是干什么的&hellip;于是手动在软件源管理（a本放在了 Applications -&gt; Ubuntu Software Center 程序里面 Edit 菜单下面）清理。</p>
<p>第一开始是凭记忆清理了一部分不再使用的软件的源，退出后更新发现失败&hellip;再次清理 Authentication 里面的 Public key，发现还是有问题，最后下定狠心把所有的源和 public key 全部删除了再更新发现还是有错误 T_T 其实错误提示的是一种类型的：</p>
<blockquote>
<p>W: GPG error: <a href="http://ppa.launchpad.net">http://ppa.launchpad.net</a> jaunty Release: The following signatures couldn&rsquo;t be verified because the public key is not available: NO_PUBKEY 12DE1BCB04E5E17B5</p>
</blockquote>
<p>自己动手丰衣足食&hellip;Google 之发现有两种解决方案，第一个是在 launchpad keyserver 网站搜索 key 从而找到 public
key，详情请看[这里][]。第二种则相对于比较简单：命令行流。</p>
<p>​1. 复制报错的尾部 NO_PUBKEY 后面的串的后 8
位（以上面的为例：4E5E17B5），执行:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ gpg --keyserver keyserver.ubuntu.com --recv 4E5E17B5# 返回信息gpg: requesting key 4E5E17B5 from hkp server keyserver.ubuntu.comgpg: key 4E5E17B5: public key <span class="s2">&#34;Launchpad PPA for chromium-daily&#34;</span> importedgpg: no ultimately trusted keys foundgpg: Total number processed: 1gpg:               imported: <span class="m">1</span>  <span class="o">(</span>RSA: 1<span class="o">)</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">$ gpg --export --armor 4E5E17B5 <span class="p">|</span> sudo apt-key add -# 返回信息OK
</span></span></code></pre></div><p>解决！</p>
]]></content:encoded></item><item><title>水果属性概述</title><link>https://icyleaf.com/2010/09/fruit-properties-overview/</link><pubDate>Sat, 25 Sep 2010 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2010/09/fruit-properties-overview/</guid><description>热性水果：适合寒性体质 榴连、黑枣 温性水果：适合寒性体质 芒果、荔枝、桃子、龙眼、红毛丹、水蜜桃、板栗、释迦、椰子肉、金桔、乌梅、樱桃、红枣、 李...</description><content:encoded><![CDATA[<p><strong>热性水果</strong>：适合寒性体质</p>
<p>榴连、黑枣</p>
<p><strong>温性水果</strong>：适合寒性体质</p>
<p>芒果、荔枝、桃子、龙眼、红毛丹、水蜜桃、板栗、释迦、椰子肉、金桔、乌梅、樱桃、红枣、</p>
<p>李子(微温)</p>
<p><strong>平性水果</strong>：适合各种体质</p>
<p>百香果、柠檬、番石榴、酪梨、凤梨、葡萄、莲雾、柳橙、甘蔗、木瓜、橄榄、梅子、印度枣</p>
<p><strong>凉性水果</strong>：适合热性体质</p>
<p>火龙果、梨、苹果、杨桃、山竹、葡萄柚、草莓、枇杷</p>
<p><strong>寒性水果</strong>：适合热性体质</p>
<p>蕃茄(微寒)、西瓜、香蕉、奇异果、甜瓜、柚子、橘子、柿子、椰子水、桑椹</p>
]]></content:encoded></item><item><title>Nginx+FastCGI 环境搭建 Kohana</title><link>https://icyleaf.com/2010/05/nginx-with-fastcgi-build-kohana/</link><pubDate>Mon, 31 May 2010 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2010/05/nginx-with-fastcgi-build-kohana/</guid><description>Kohana 默认仅对 Apache 环境提供的部署支持，其实对于 Nginx+FastCGI 也是很容易支持的。本文搭建环境是 Ubuntu 10.4 并采用 apt-get 方式安装，喜爱编译的朋友可以自行解决 :) 1. 安装 MySQL 1$ sudo apt-get install...</description><content:encoded><![CDATA[<p>Kohana 默认仅对 Apache 环境提供的部署支持，其实对于 Nginx+FastCGI
也是很容易支持的。本文搭建环境是 Ubuntu 10.4 并采用 apt-get
方式安装，喜爱编译的朋友可以自行解决 :)</p>
<h3 id="1-安装-mysql">1. 安装 MySQL</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ sudo apt-get install mysql-server mysql-client
</span></span></code></pre></div><p>安装过程在会提示设置 root 账户的密码，如果是本机测试开发可以留空后稍候设置。</p>
<h3 id="2-安装-nginx">2. 安装 Nginx</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1"># 安装 Nginx</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">$ sudo apt-get install nginx
</span></span><span class="line"><span class="ln">3</span><span class="cl">
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1"># 启动 Nginx</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">$ sudo /etc/init.d/nginx start
</span></span></code></pre></div><p>完成上面两步之后，打开浏览器，输入 localhost 或 127.0.0.1 如果看到 <strong>Welcome to Nginx!</strong> 字样就说明安装成功了，是不是很简单 :)</p>
<p>注意，如果你的机器上面如果安装了其他 web 容器（比如 Apache，Lighttd等），启动
ngnix 的时候肯定会报错，因为这些 web 容器启动均占用的 80
端口，更改的方法如下：</p>
<p>编辑 <code>/etc/nginx/sites-available/default</code> 文件，修改 server 段中的 listen
为 localhost:8080，其中 8080 是更改的监听端口：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="ln">1</span><span class="cl">server {
</span></span><span class="line"><span class="ln">2</span><span class="cl">listen   localhost:8080;
</span></span><span class="line"><span class="ln">3</span><span class="cl">server_name  localhost;
</span></span><span class="line"><span class="ln">4</span><span class="cl"># [...]
</span></span></code></pre></div><p>保存后重启 Nginx：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ sudo /etc/init.d/nginx restart
</span></span></code></pre></div><h3 id="3-安装-php5">3. 安装 PHP5</h3>
<p>PHP 在 Nginx 下是通过 FastCGI 模式运行的，使用 Debain 的包管理可以安装
PHP5 和一些必须的（比如，php5-mysql）和可选的扩展（比如，Kohana 要求的
php5-curl，php5-gd，php5-mcrypt），下面前 5
个是必须的，其他可以依据个人需求添加或减少：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ sudo apt-get install php5-cgi php5-mysql php5-curl php5-gd php5-mcrypt php5-idn php-pear php5-imagick php5-imap php5-memcache php5-mhash php5-ming php5-pspell php5-recode php5-snmp php5-tidy php5-xmlrpc php5-xsl
</span></span></code></pre></div><p>安装完毕后，需要编辑 php 的配置：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1"># 编辑 /etc/php5/cgi/php.ini 文件</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="c1"># 修改 cgi.fix_pathinfo 的值为 1（如果此项被注解掉了，请删除前面的 # 符号）	cgi.fix_pathinfo = 1</span>
</span></span></code></pre></div><p>至此 PHP5 已经安装完毕，但是还没有结束，因为我们还没有让它支持 FastCGI
嗯，由于 Debain 包并没有提供单独的 FastCGI 守护程序，因此我们可以使用其他的方式实现，通常使用的是 lighttpd 项目提供的 spawn-fcgi（本文也用的这个，但是它总会出现小毛病，导致 Nginx 服务 Down 掉，稍候也会给出一点解决方案）或者是 <a href="http://php-fpm.org/">PHP-FPM</a>（专门为 PHP 提供 FastCGI 进程管理的软件）</p>
<p>好吧，让我们在安装 lighttpd：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ sudo apt-get install lighttpd
</span></span></code></pre></div><p>安装完毕后会你发现一些错误信息：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">Starting web server: lighttpd
</span></span><span class="line"><span class="ln">2</span><span class="cl">2010-05-31 10:44:51: <span class="o">(</span>network.c.300<span class="o">)</span> can not <span class="nb">bind</span> to port: <span class="m">80</span> Address already in use failed!
</span></span></code></pre></div><p>还是上面提到的重复占用端口的问题，不过由于我们只是使用它的 spawn-fcgi 因此我们可以不让它当作服务启动：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ sudo update-rc.d -f lighttpd remove
</span></span></code></pre></div><p>好了，让我们开启 FastCGI 守护进程：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ /usr/bin/spawn-fcgi -a 127.0.0.1 -p <span class="m">9000</span> -u www-data -g www-data -f /usr/bin/php5-cgi -P /var/run/fastcgi-php.pid
</span></span></code></pre></div><p>其中 -a 代表 ip 地址， -p 是进程的端口， -u 是用户， -g 是用户组，-f 是 <code>php5-cgi</code> 的执行路径，-P 是进程的 pid，可以适当的在后面在加一个 -C 参数，这个数创建的进程数，本机开发的话一般设置在 3 - 5 左右即可（也可以使用 ab 测试以设置适当的进程数，这样可以防止 Nginx 的无辜 Down 掉）</p>
<p>提示：spawn-fcgi 必须在运行的状况下才能使得 Nginx 支持 PHP
运行，因此可以把上面的启动代码追加到 /etc/rc.local 文件的尾部保存（在 exit
命令之前）。</p>
<h3 id="4-配置-nginx">4. 配置 Nginx</h3>
<p>Nginx 的配置相对比较简单，语法很像 PHP 代码，如果不了解的可以参考这个：<a href="http://wiki.nginx.org/NginxFullExample">范例1</a>和<a href="http://wiki.nginx.org/NginxFullExample2">范例2</a></p>
<p>编辑 <strong>/etc/nginx/nginx.conf</strong> 文件并作如下修改：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="ln">1</span><span class="cl">[...]
</span></span><span class="line"><span class="ln">2</span><span class="cl">worker_processes  5;
</span></span><span class="line"><span class="ln">3</span><span class="cl">[...]
</span></span><span class="line"><span class="ln">4</span><span class="cl">keepalive_timeout   2;
</span></span><span class="line"><span class="ln">5</span><span class="cl">[...]
</span></span></code></pre></div><p>定义虚拟主机的配置项存放在 <code>/etc/nginx/conf.d/</code> 目录下面，每个虚拟主机配置一个文件并以 .conf 为文件后缀即可，默认是 default，也就是上面修改 Nginx 默认监听端口的文件，这里还要进一步对它配（点击右侧展开）：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="ln"> 1</span><span class="cl">[...]
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">server {
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">listen   80;
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">server_name  _;
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">access_log  /var/log/nginx/localhost.access.log;
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">location / {
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">root   /var/www/nginx-default;
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">index  index.php index.html index.htm;
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">}
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl">location /doc {
</span></span><span class="line"><span class="ln">12</span><span class="cl">root   /usr/share;
</span></span><span class="line"><span class="ln">13</span><span class="cl">autoindex on;
</span></span><span class="line"><span class="ln">14</span><span class="cl">allow 127.0.0.1;
</span></span><span class="line"><span class="ln">15</span><span class="cl">deny all;
</span></span><span class="line"><span class="ln">16</span><span class="cl">}        l
</span></span><span class="line"><span class="ln">17</span><span class="cl">
</span></span><span class="line"><span class="ln">18</span><span class="cl">ocation /images {
</span></span><span class="line"><span class="ln">19</span><span class="cl">root   /usr/share;
</span></span><span class="line"><span class="ln">20</span><span class="cl">autoindex on;
</span></span><span class="line"><span class="ln">21</span><span class="cl">}
</span></span><span class="line"><span class="ln">22</span><span class="cl">
</span></span><span class="line"><span class="ln">23</span><span class="cl"># error_page  404  /404.html;
</span></span><span class="line"><span class="ln">24</span><span class="cl"># redirect server error pages to the static page /50x.html
</span></span><span class="line"><span class="ln">25</span><span class="cl"># error_page   500 502 503 504  /50x.html;
</span></span><span class="line"><span class="ln">26</span><span class="cl">location = /50x.html {
</span></span><span class="line"><span class="ln">27</span><span class="cl">root   /var/www/nginx-default;
</span></span><span class="line"><span class="ln">28</span><span class="cl">}
</span></span><span class="line"><span class="ln">29</span><span class="cl">
</span></span><span class="line"><span class="ln">30</span><span class="cl"># proxy the PHP scripts to Apache listening on 127.0.0.1:80
</span></span><span class="line"><span class="ln">31</span><span class="cl">#location ~ \.php$ {
</span></span><span class="line"><span class="ln">32</span><span class="cl">#proxy_pass   http://127.0.0.1;
</span></span><span class="line"><span class="ln">33</span><span class="cl">#}
</span></span><span class="line"><span class="ln">34</span><span class="cl">
</span></span><span class="line"><span class="ln">35</span><span class="cl"># pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
</span></span><span class="line"><span class="ln">36</span><span class="cl">location ~ \.php$ {
</span></span><span class="line"><span class="ln">37</span><span class="cl">fastcgi_pass   127.0.0.1:9000;
</span></span><span class="line"><span class="ln">38</span><span class="cl">fastcgi_index  index.php;
</span></span><span class="line"><span class="ln">39</span><span class="cl">fastcgi_param  SCRIPT_FILENAME  /var/www/nginx-default$fastcgi_script_name;
</span></span><span class="line"><span class="ln">40</span><span class="cl">include        fastcgi_params;
</span></span><span class="line"><span class="ln">41</span><span class="cl">}
</span></span><span class="line"><span class="ln">42</span><span class="cl">
</span></span><span class="line"><span class="ln">43</span><span class="cl"># deny access to .htaccess files, if Apache&#39;s document root        # concurs with nginx&#39;s one
</span></span><span class="line"><span class="ln">44</span><span class="cl"># location ~ /\.ht {
</span></span><span class="line"><span class="ln">45</span><span class="cl">deny  all;
</span></span><span class="line"><span class="ln">46</span><span class="cl">}
</span></span><span class="line"><span class="ln">47</span><span class="cl">}
</span></span><span class="line"><span class="ln">48</span><span class="cl">
</span></span><span class="line"><span class="ln">49</span><span class="cl">[...]
</span></span></code></pre></div><p>说明下里面的个别参数：</p>
<p><strong>server_name</strong> 是虚拟主机的服务器入口名称，可以是 IP 也可以是域名。</p>
<p><strong>location</strong> 段，我在 index 追加了 index.php， root 路径是 <code>/var/www/nginx-default</code> 说明该虚拟主机的根目录在这里。</p>
<p>最重要的是关于 PHP 部分的 location 段：<strong>~ \.php$ {}</strong>，Nginx 默认没有开启，我们要确保它开启并在 fastcgi_param 一行更改了参数（因为浏览器调用的默认 PHP 解析器无法找到 PHP 脚本）：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="ln">1</span><span class="cl">fastcgi_param SCRIPT_FILENAME /var/www/nginx-default$fastcgi_script_name;
</span></span></code></pre></div><p>最后确保在 include 和 fastcgi_params 之间隔出几个空格（BUG）</p>
<p>重启 Nginx，然后编辑一个 info.php 文件：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="ln">1</span><span class="cl">// 创建 /var/www/nginx-default/info.php 文件
</span></span></code></pre></div><p>保存后在浏览器访问（比如：http://localhost/info.php 或
http://localhost:8080/info.php)，如看到 phpinfo
的参数页面说明配置安装成功 :)</p>
<h3 id="5-安装配置-kohana">5. 安装&amp;配置 Kohana</h3>
<p>Kohana 采用的 v3 版本，<a href="http://v3.kohana.cn/guide/tutorials.git">安装步骤</a>（本文把 kohana 存放在 <code>/home/icyleaf/php/kohana</code> 目录）</p>
<p>添加 Nginx 虚拟主机配置文件：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="ln"> 1</span><span class="cl"># 创建 /etc/nginx/conf.d/kohana.conf 文件
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">server {
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">listen   kohana.local:8080;
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">server_name  kohana.local;
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">access_log  /var/log/nginx/kohana.access.log;
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"># define server root path
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">set $root_path /home/icyleaf/php/kohana;
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl">location / {
</span></span><span class="line"><span class="ln">11</span><span class="cl">root   $root_path;       index  index.php index.html index.htm;
</span></span><span class="line"><span class="ln">12</span><span class="cl">if (!-e $request_filename) {
</span></span><span class="line"><span class="ln">13</span><span class="cl">rewrite ^/(.*)$ /index.php?kohana_uri=/$1 last;
</span></span><span class="line"><span class="ln">14</span><span class="cl">}
</span></span><span class="line"><span class="ln">15</span><span class="cl">}
</span></span><span class="line"><span class="ln">16</span><span class="cl">
</span></span><span class="line"><span class="ln">17</span><span class="cl"># pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
</span></span><span class="line"><span class="ln">18</span><span class="cl">location ~ \.php$ {
</span></span><span class="line"><span class="ln">19</span><span class="cl">root   $root_path;
</span></span><span class="line"><span class="ln">20</span><span class="cl">fastcgi_pass   127.0.0.1:9000;
</span></span><span class="line"><span class="ln">21</span><span class="cl">fastcgi_index  index.php;
</span></span><span class="line"><span class="ln">22</span><span class="cl">fastcgi_param  SCRIPT_FILENAME  $root_path$fastcgi_script_name;      include fastcgi_params;
</span></span><span class="line"><span class="ln">23</span><span class="cl">}
</span></span><span class="line"><span class="ln">24</span><span class="cl">}
</span></span></code></pre></div><p>配置中首先定义了一个变量 $root_path 指定 Kohana 的源码的路径，对于
Kohana 的 URL rewrite url 重点是 location 段的：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="ln">1</span><span class="cl">if (!-e $request_filename) {
</span></span><span class="line"><span class="ln">2</span><span class="cl">rewrite ^/(.*)$ /index.php?kohana_uri=/$1 last;
</span></span><span class="line"><span class="ln">3</span><span class="cl">}
</span></span></code></pre></div><p>编辑完成后重载 Nginx 配置：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ sudo /etc/init.d/nginx reload
</span></span></code></pre></div><p>至此教程结束，额外说明的是 Kohana 默认的 .htaccess 对 Nginx 无效可有可无
:)</p>
]]></content:encoded></item><item><title>如何获取 Element 的 XPath [PHP/Javascript]</title><link>https://icyleaf.com/2010/04/how-to-get-xpath-of-an-element-for-php-and-javascript/</link><pubDate>Fri, 02 Apr 2010 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2010/04/how-to-get-xpath-of-an-element-for-php-and-javascript/</guid><description>这两天研究 HTML 的 DOM 需要寻找某个 Element 元素的完整 XPath 路径，由于使用的是 PHP Simple HTML DOM Parser 开源库，这个库类的使用方法几乎兼容 Javascript 的 DOM 语法并附带 DOM 选择器。虽然功能强...</description><content:encoded><![CDATA[<p>这两天研究 HTML 的 DOM 需要寻找某个 Element 元素的完整 XPath 路径，由于使用的是 <a href="http://simplehtmldom.sourceforge.net/manual.htm">PHP Simple HTML DOM Parser</a> 开源库，这个库类的使用方法几乎兼容 Javascript 的 DOM 语法并附带 DOM 选择器。虽然功能强大但是并不能直接获取 Element 的 XPath。这个怎么办呢，依稀记得 Firebug 有一个功能，选择某个元素在它的控制台可以显示 XPath。嗯，着手实践一下发现不仅可以显示而且还可以复制 XPath。</p>
<p>于是想，如果可以找到 Javascript 版的相关代码就一定可以改成 PHP 版本的，结果在 Google 搜索找到了&hellip;</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kd">var</span> <span class="nx">elt</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;table&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kd">var</span> <span class="nx">xpath</span> <span class="o">=</span> <span class="nx">getElementXPath</span><span class="p">(</span><span class="nx">elt</span><span class="p">);</span><span class="nx">alert</span><span class="p">(</span><span class="nx">xpath</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1">// Get full XPath of an element
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="nx">getElementXPath</span><span class="p">(</span><span class="nx">elt</span><span class="p">){</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">	<span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">	<span class="k">for</span> <span class="p">(;</span> <span class="nx">elt</span> <span class="o">&amp;&amp;</span> <span class="nx">elt</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">==</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">elt</span> <span class="o">=</span> <span class="nx">elt</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">		<span class="nx">idx</span> <span class="o">=</span> <span class="nx">getElementIdx</span><span class="p">(</span><span class="nx">elt</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">		<span class="nx">xname</span> <span class="o">=</span> <span class="nx">elt</span><span class="p">.</span><span class="nx">tagName</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="nx">idx</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="nx">xname</span> <span class="o">+=</span> <span class="s2">&#34;[&#34;</span> <span class="o">+</span> <span class="nx">idx</span> <span class="o">+</span> <span class="s2">&#34;]&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">		<span class="nx">path</span> <span class="o">=</span> <span class="s2">&#34;/&#34;</span> <span class="o">+</span> <span class="nx">xname</span> <span class="o">+</span> <span class="nx">path</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">	<span class="k">return</span> <span class="nx">path</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="c1">// Get Idx of an element
</span></span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="nx">getElementIdx</span><span class="p">(</span><span class="nx">elt</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">	<span class="kd">var</span> <span class="nx">count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">	<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">sib</span> <span class="o">=</span> <span class="nx">elt</span><span class="p">.</span><span class="nx">previousSibling</span><span class="p">;</span> <span class="nx">sib</span> <span class="p">;</span> <span class="nx">sib</span> <span class="o">=</span> <span class="nx">sib</span><span class="p">.</span><span class="nx">previousSibling</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">		<span class="k">if</span><span class="p">(</span><span class="nx">sib</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">sib</span><span class="p">.</span><span class="nx">tagName</span> <span class="o">==</span> <span class="nx">elt</span><span class="p">.</span><span class="nx">tagName</span><span class="p">)</span>  <span class="nx">count</span><span class="o">++</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">	<span class="k">return</span> <span class="nx">count</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>PHP 改进版：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1">// Use it before import PHP Simple HTML DOM Parser
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="c1"></span><span class="nv">$html</span> <span class="o">=</span> <span class="nx">file_get_html</span><span class="p">(</span><span class="s1">&#39;http://www.google.com/&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1">// find a sample element by id
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="c1"></span><span class="nv">$elt1</span> <span class="o">=</span> <span class="nv">$html</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;#footer&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="c1">// find a sample element by tag name
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="c1"></span><span class="nv">$elt2</span><span class="o">=</span> <span class="nv">$html</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="c1">// it will return if found it: [@id=&#34;footer&#34;]
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="c1"></span><span class="nv">$xpath</span> <span class="o">=</span> <span class="nx">getElementXPath</span><span class="p">(</span><span class="nv">$elt1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="c1">// it will return if found it: html/body/div[10]
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1"></span><span class="nv">$xpath</span> <span class="o">=</span> <span class="nx">getElementXPath</span><span class="p">(</span><span class="nv">$elt2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="k">function</span> <span class="nf">getElementXPath</span><span class="p">(</span><span class="nv">$elt</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">	<span class="nv">$path</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">	<span class="nv">$first</span> <span class="o">=</span> <span class="k">TRUE</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">	<span class="k">for</span><span class="p">(;</span> <span class="p">(</span><span class="nv">$elt</span> <span class="k">AND</span> <span class="nv">$elt</span><span class="o">-&gt;</span><span class="na">nodetype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">);</span> <span class="nv">$elt</span> <span class="o">=</span> <span class="nv">$elt</span><span class="o">-&gt;</span><span class="na">parent</span><span class="p">())</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">		<span class="nv">$xname</span> <span class="o">=</span> <span class="nv">$elt</span><span class="o">-&gt;</span><span class="na">tag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">		<span class="nv">$idx</span> <span class="o">=</span> <span class="nx">getElementIdx</span><span class="p">(</span><span class="nv">$elt</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="nv">$first</span> <span class="k">AND</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$elt</span><span class="o">-&gt;</span><span class="na">attr</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]))</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">			<span class="nv">$path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&#34;&#39;</span> <span class="o">.</span> <span class="nv">$elt</span><span class="o">-&gt;</span><span class="na">attr</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;&#34;]&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">			<span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">
</span></span><span class="line"><span class="ln">29</span><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="nv">$idx</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">			<span class="o">%</span><span class="nx">xname</span> <span class="o">.=</span> <span class="s1">&#39;[&#39;</span> <span class="o">.</span> <span class="nv">$idx</span> <span class="o">.</span> <span class="s1">&#39;]&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">
</span></span><span class="line"><span class="ln">34</span><span class="cl">		<span class="nv">$path</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="nv">$xname</span><span class="o">.</span><span class="nv">$path</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">		<span class="nv">$first</span> <span class="o">=</span> <span class="k">FALSE</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">
</span></span><span class="line"><span class="ln">38</span><span class="cl">	<span class="k">return</span> <span class="nv">$path</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">
</span></span><span class="line"><span class="ln">41</span><span class="cl"><span class="k">function</span> <span class="nf">getElementIdx</span><span class="p">(</span><span class="nv">$elt</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">	<span class="nv">$count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">	<span class="k">for</span><span class="p">(</span><span class="nv">$sib</span> <span class="o">=</span> <span class="nv">$elt</span><span class="o">-&gt;</span><span class="na">prev_sibling</span><span class="p">();</span> <span class="nv">$sib</span> <span class="p">;</span> <span class="nv">$sib</span> <span class="o">=</span> <span class="nv">$sib</span><span class="o">-&gt;</span><span class="na">prev_sibling</span><span class="p">())</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl">		<span class="k">if</span><span class="p">(</span><span class="nv">$sib</span><span class="o">-&gt;</span><span class="na">nodetype</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nv">$sib</span><span class="o">-&gt;</span><span class="na">tag</span> <span class="o">==</span> <span class="nv">$elt</span><span class="o">-&gt;</span><span class="na">tag</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl">			<span class="nv">$count</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="ln">50</span><span class="cl">	<span class="k">return</span> <span class="nv">$count</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">51</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>大家同样可以把上面的代码直接 crack 到 PHP Simple HTML DOM Parser 库中。</p>
]]></content:encoded></item><item><title>Douban API Package 发布！</title><link>https://icyleaf.com/2010/01/douban-api-package/</link><pubDate>Fri, 08 Jan 2010 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2010/01/douban-api-package/</guid><description>Douban API Package 是一个使用 PHP 开发且基于 Kohana v3 开发的一个扩展（Module）。 它对豆瓣 API 进行重新封包。它使用起来非常方便，可以快速开发一个 web 应用。 为什么要...</description><content:encoded><![CDATA[<p>Douban API Package 是一个使用 PHP 开发且基于 Kohana v3 开发的一个扩展（Module）。</p>
<p>它对<a href="http://www.douban.com/">豆瓣</a> <a href="http://www.douban.com/service/apidoc/">API</a> 进行重新封包。它使用起来非常方便，可以快速开发一个 web 应用。</p>
<p><strong>为什么要另外封包？</strong></p>
<p>对，豆瓣官方提供了一种 PHP 的解决方案，可是需要庞大的支持库：GData（20M左右）以及可能无法修改的环境配置（租用的空间主机会遇到这样的问题）。虽说 Douban API Package 也是基于框架开发，不过 Kohana 是一个纯 PHP5 模式且体积小巧（仅有 478KB），优秀迅捷的框架。<strong>最重要的是</strong>，Douban API Package 提供了目前官方所有功能的支持。并有线上网站：<a href="http://modou.us/">魔豆</a> 和<a href="http://modou.us/console">豆瓣 API 控制台</a>长期运营。</p>
<p><em>虽然它是基于 Kohana 框架开发，但是并没有使用太多的依赖，稍微熟悉可以轻松分离出来！</em></p>
<p><strong>安装需求</strong></p>
<ul>
<li>PHP 5.2+ with curl module</li>
<li><a href="http://github.com/kohana/kohana">Kohana v3</a> - 一款纯 PHP 5 框架，它的特点就是<strong>高安全性</strong>，<strong>轻量级代码</strong>，<strong>容易使用</strong>。</li>
</ul>
<p><strong>安装步骤</strong></p>
<p>步骤 0: 部署 Kohana v3</p>
<p>下载并安装 Kohana v3 的过程，请大家参考此教程：<a href="http://kohanaphp.cn/guide/tutorials.git">使用 Git 部署 Kohana 系统</a></p>
<p>步骤 1: 下载本扩展!</p>
<p>你可以在部署完毕的 Kohana 系统的根目录执行下面操作：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="ln">1</span><span class="cl">$ git submodule add git://github.com/icyleaf/douban.git modules/douban
</span></span></code></pre></div><p>完成！</p>
<p>或者你也可以从本<a href="http://github.com/icyleaf/douban">github 项目</a> 下载压缩包放置在 modules 文件夹下面。</p>
<p>步骤 2: 在 <code>bootstrap.php</code> 文件中启用该模块(默认情况下，存储在 <code>application</code> 文件夹)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="ln"> 1</span><span class="cl">/** * Enable modules. Modules are referenced by a relative or absolute path. *
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">/Kohana::modules(array(
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">	&#39;douban&#39;        =&gt; MODPATH.&#39;douban&#39;,     // Douban API Module    //
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">	&#39;database&#39;   =&gt; MODPATH.&#39;database&#39;,   // Database access    //
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">	&#39;image&#39;      =&gt; MODPATH.&#39;image&#39;,      // Image manipulation    //
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">	&#39;orm&#39;        =&gt; MODPATH.&#39;orm&#39;,        // Object Relationship Mapping (not complete)    //
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">	&#39;pagination&#39; =&gt; MODPATH.&#39;pagination&#39;, // Paging of results    //
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">	&#39;paypal&#39;     =&gt; MODPATH.&#39;paypal&#39;,     // PayPal integration (not complete)    //
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">	&#39;todoist&#39;    =&gt; MODPATH.&#39;todoist&#39;,    // Todoist integration    //
</span></span><span class="line"><span class="ln">10</span><span class="cl">	&#39;unittest&#39;   =&gt; MODPATH.&#39;unittest&#39;,   // Unit testing    // &#39;codebench&#39;  =&gt; MODPATH.
</span></span><span class="line"><span class="ln">11</span><span class="cl">	&#39;codebench&#39;,  // Benchmarking tool
</span></span><span class="line"><span class="ln">12</span><span class="cl">));
</span></span></code></pre></div><p><strong>目录结构</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="ln"> 1</span><span class="cl">douban
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">   +--- classes
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">   			+--- controller               # 豆瓣样例
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">   					+--- douban                   # Douban API Package
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">   							+--- api               # Douban API
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">   							+--- core.php          # Douban Core
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">   							+--- oauth.php         # Douban OAuth
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">   							+--- request.php       # Douban Requset
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">						   	+--- response.php      # Douban Response
</span></span><span class="line"><span class="ln">10</span><span class="cl">					+--- douban.php               # Douban API Class
</span></span><span class="line"><span class="ln">11</span><span class="cl">   +--- config
</span></span><span class="line"><span class="ln">12</span><span class="cl">   			+--- douban.php               # 豆瓣 API 配置文件
</span></span><span class="line"><span class="ln">13</span><span class="cl">   			+--- user_agents.php          # 奉送给大家一些手机 User agent 配置文件
</span></span><span class="line"><span class="ln">14</span><span class="cl">   +--- media
</span></span><span class="line"><span class="ln">15</span><span class="cl">   			+--- images                   # 奉送给大家豆瓣 API 用到的图像
</span></span><span class="line"><span class="ln">16</span><span class="cl">   +--- vendor
</span></span><span class="line"><span class="ln">17</span><span class="cl">   			+--- OAuth.php                # OAuth 官方推荐 PHP 库
</span></span><span class="line"><span class="ln">18</span><span class="cl">   			+--- LICENSE
</span></span><span class="line"><span class="ln">19</span><span class="cl">   +--- README.markdown
</span></span></code></pre></div><p><strong>快速上手</strong></p>
<p>Douban API Package 提供一些演示用例，系统部署完毕后可以通过<code>http://host/demo_douban</code> 访问。</p>
<p>文件路径：<code>classes/controller/douban_demo.php</code></p>
<p>源码库：<a href="http://github.com/icyleaf/douban">http://github.com/icyleaf/douban</a></p>
<p>祝你开发顺利！</p>
<p>如果任何疑问或者 Bugs 反馈，即可以在本项目中提交 Issue
或者给我发邮件：icyleaf.cn囧gmail.com （请替换 &ldquo;囧&rdquo; 为 @）</p>
]]></content:encoded></item><item><title>2009年度总结</title><link>https://icyleaf.com/2010/01/2009-year-in-review/</link><pubDate>Fri, 01 Jan 2010 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2010/01/2009-year-in-review/</guid><description>忙碌了一天下来，刚打开电脑看着 twitter 刷出来的消息发觉已经到了 2010 年。回顾去年的那篇年度总结感受颇多，年度总结这玩意对于自己来说算是一次思维的整理和...</description><content:encoded><![CDATA[<p>忙碌了一天下来，刚打开电脑看着 twitter 刷出来的消息发觉已经到了 2010 年。回顾去年的那篇<a href="http://icyleaf.com/2008/12/30/2008-year-in-review/">年度总结</a>感受颇多，年度总结这玩意对于自己来说算是一次思维的整理和归档。就算度过了没有硬性计划的 2009 年总结还是多少要写一些。</p>
<p>回顾整个 2009 年做的事情，发现其中一些持续的事情是在完善 2008 年度的计划：</p>
<ol>
<li>通过维护一个 PHP5 的轻量级开源框架 Kohana 的中文化社区，开始深层次的了解和读懂一个框架的逻辑和模式；通过参加一年的 OpernParty 开源社区的活动，（不完全）吸收了很多新鲜养分。</li>
<li>成立 <a href="http://kohana.cn">Kohana 中文社区</a>已经有一年多的时间也经历了很多：成功完成了对其<a href="http://khnfans.cn/docs">中文文档</a>的翻译工作；不断向社区提交和共享代码。然而对于社区的运营也感受颇多，虽然过程是辛苦的，但是我很欣慰。同时还得感谢<a href="http://iiiorz.net">非正常非人类</a>，e6nian，<a href="http://codeigniter.org.cn">Codeigniter中国</a>老大 Hex，daqing 对 Kohana 和我的支持！</li>
<li>2009年读了一些各种各样的书，这些书都是我以前几乎没有涉及过的种类。其中一大部分（感谢 <a href="http://cnborn.net">CNBorn</a>的推荐）得益于公司搬家，使得上下班几乎有两个小时的闲余时间，很多书籍都是在这段时间消灭的。以后还会继续读更多值得看的书，书再多还是不嫌多的。</li>
<li>2009年度入手了三个数码产品：iPod Touch ，Canon 450D 和 DELL 2209WA。正式成为 Apple 使用用户和摄影爱好者。</li>
<li>2008年的那些项目都难产掉了，2009年又有一些项目脚踏实地的进行着：<!-- raw HTML omitted --></li>
</ol>
<ul>
<li><a href="http://icyleaf.com/2009/06/22/modou/">魔豆</a>：一个用于移动终端，手持设备的非官方版豆瓣网移动版本。</li>
<li><a href="http://icyleaf.com/2009/07/06/douban-api-console/">豆瓣 API控制台</a>：魔豆附属项目，开发豆瓣 API 的辅助工具，仅适用于Firefox。</li>
<li><a href="http://kohana.cn">Aplaca</a>：一个轻量级的基于 Kohana v3 开发的论坛系统（目前已上线，因为在开发中暂无发布）。</li>
<li>Douban API Package：这是一个重构版本，最近一直在测试和写测试用例，近期会以开源协议的形式发布。</li>
</ul>
<ol start="6">
<li>新疆出差游：得益于 090705 事件造成那个地区封锁了网络，又因公司项目的事情前去出差，第一次坐灰机，第一次跑那么远的地方。详情请参见<a href="http://icyleaf.com/2009/11/18/xinjiang-yaxin-diary-1/">系列游记</a>。</li>
<li>随着寻找各种北京美食，加上工作的性质，对于运动少了许多，今年之中抽出了不少的周末参与到户外运动之中，即活动了筋骨，也提高了身体机能，还能认识很多驴友和漂亮的风景何乐而不为呢。</li>
</ol>
<p>总结完毕发现今年的日志数量急剧下降，或许以后的年度日志数量也会在这个数量左右徘徊，随着时间的推移，心智愈加成熟（自我感觉），心要慢慢的静下来（不能在浮躁了）深层次的学习一些技能，继续英语的学习和适当的户外运动，可能的话计划去某个地方游玩。再有就是不能把
2009 年的最大的遗憾留在今年，继续加油！</p>
<p>UPDATE: 最大的遗憾在 2010 年初已经完美 :)</p>
]]></content:encoded></item><item><title>新疆呼噜木齐随笔之五</title><link>https://icyleaf.com/2009/11/xinjiang-diary-5/</link><pubDate>Thu, 26 Nov 2009 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2009/11/xinjiang-diary-5/</guid><description>11月02日以后，基本上工作就忙完了，于是 04 日我准备一次暴走扫街，活动地点是市中心，人民广场附近以及红山公园南邻的人民公园。去那边坐的还是前...</description><content:encoded><![CDATA[<p>11月02日以后，基本上工作就忙完了，于是 04 日我准备一次暴走扫街，活动地点是市中心，人民广场附近以及红山公园南邻的人民公园。去那边坐的还是前往二道桥大巴扎的公交车，嗯，看来是热点线路，怪不得人那么的多。在上面的随笔我应该说过乌市是一个很现代化的城市，整个乌市和其他大城市没什么太大的差别，也就有一个区域是维族居住生活区。所以来到了人民广场对于周围的环境一点都不陌生，到处高楼大厦，商场一座座，虽然天有点凉，但是人很是很多，一点也看不出来那天是星期三，我直接避开了繁华的路段，转走些小巷细路的。也没发现太多的东西，嗯，可能这附近还是太大众化了，而且还有王府井&hellip;偶尔会有些卖囊的和大面积的买葡萄干之类的干活摊位。</p>
<p>其实那天的天气特别的糟糕，那个天气真想让我骂人，于是开始想是否买个 CPL 会好一些，接着开始询问附近是否有器材城，果不其然，闹市中必有所需，离我不远处正好有一个赛博电脑城，一进去就感觉整个市场就像菜市场一样混乱，但是并没有像海龙那样狗皮膏药的烦你。好不容易找到一家佳能店（奇怪，大多数的DSLR都是尼康的），问了一下，价格小贵，张口就是 180 元，不过一看都是肯高的，心里就有些没底，据说这东西假货居多，而且防伪已经换了不下 10 编了，有没有互联网，谁知道到底是真的假的，真的还好，如果是假的，我也总不能从北京再跑回去吧，琢磨了半天还是没买。不过回来之后听 CNBorn 说这样的鬼天气用 CPL 是没用的。呃，俺的相机至今也就一个配件：UV。主要保护镜头而已，嘿嘿。呃，跑题了&hellip;</p>
<p>那天只顾四处转，不知道哪了就看地图，一点也没有留意时间，转到哪是哪，累了就休息。我的第一个休息点是位于解放南路和北路交口附近的汗腾格里大寺。貌似这边开始就是维族区了，因为我在通过地下通道见到了都是维族乞丐以及路道两边都是维族人的摊位，而且不说汉语。因此我遇见了一个可爱的维族小女孩：身袭火红的外套，一路小跑的就跑过我的眼前，坐到了我的旁边。迅速抓起相机，调整焦距，对焦，按下快门，于是就抓拍到了小女孩的第一张照片。不过这样也被小女孩吸引到了，于是同时我也想办法去吸引她，留住她。这一交谈不要紧，果然又是满口的维语。没办法，我开始使用重复口语回答，比划，给她看我拍的照片，让她玩我的相机，算是暂时不跑开了，刚开始小女孩还有些不适应，到后来越来越有镜头感。这也是我来新疆后最满意的一部分。</p>
<p>不过小女孩还是呆不住的，玩了一会就跑到大寺一层的商场里（哈，熟悉吧，大巴扎的清真寺一层也是商场，好怪异哦），我也休息的差不多了，准备去对面的新华书店找找旅游的书看看乌市还有些什么好玩的地方。说道看书，我这里岔题下，之前有去过市图书馆（离我住宿的地方很近），临时进入，需要投放一元钱，然后会给你一个临时卡，进入到各层之后就发现，馆藏的图书甚少，而且借书还有年费，不过里面人还是蛮多的，还有专门的维文藏馆。但是最重要的是自习室好多美女哦，我还趁机搭讪了一把，哈哈～这些我信了新疆出美女这句话。咱们再把话题转回新华书店，进入需要存包，无论是家乐福超市还是这里，就算是封闭的背包也需要存，当开始由于我手拿着相机进入的，误被人当成了记者，不过回头想想也是，身穿的这身行头，再配个单反相机，还真可能在非帝都，魔都这样的城市误解（以前在天津的时候也有被人误当成记者&hellip;）。由于我把寄存的话会不安全，我也不放心，还是垂头丧气的出了书店。闹市！必有士兵巡逻把守，最重要的是我看到了一个很帅气的武警站岗，刚开始我踱步看着他走了过去，心里不甘，于是又折回走到武警身边向他说明了情况（给他拍相），估计他也把我当记者了还是很热心肠，走到了防暴盾牌中间，摆出了帅气的姿势，等待我的拍照，娃哈哈～</p>
<p>拍完之后，我的计划准备走前往人民公园（见上路线图从大寺到人民公园的路程），这段路程是最长而且也是让我最迷茫的路程，地图看了半天找不到走到了哪里，所以绕了一些地方，不过我发现我走到人民公园的那些路段都是繁华路段，到处商场一座座，人来人往，兵来兵往的。向西走的这些路段都是汉族区，所以让我比较郁闷，即使到了一个很大型的服装批发集散地，也找不到一点点的维族服装&hellip;本还想可以买几顶小方帽呢，集散地的西边尽头就是人民公园，不过在那边并没有找到公园的入口，问路人，他们说不远处有个缺口走进去就行了，呃&hellip;看来这也是一个不收费的公园，果不其然，这座公园并没有太多的人，也许跟天气有关系，因为我从图书馆仅有的一点资料了解到，这边公园会有群众载歌载舞。看来我来的时候正好错过了，到处都是光秃秃。转了很大一圈发现真的没什么的东西就回去找地方吃饭。谁知道让我走到了红山公园才能看到一个回去的公交车站&hellip;</p>
<p>本次随笔到此结束，留下最后一部分作为美食的简单汇总。</p>
<p>如果觉得今天的文字太枯燥，看看下面的石榴解解馋</p>
]]></content:encoded></item><item><title>新疆呼噜木齐随笔之四</title><link>https://icyleaf.com/2009/11/xinjiang-yaxin-diary-4/</link><pubDate>Tue, 24 Nov 2009 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2009/11/xinjiang-yaxin-diary-4/</guid><description>就在清真寺旁边有一道短街有好几家当地的新疆维族饭馆，来回转了几圈，看看这家看看那家犹豫不定，不知道是吃手抓饭好呢，还是烤串，烤馕这些的好，突...</description><content:encoded><![CDATA[<p>就在清真寺旁边有一道短街有好几家当地的新疆维族饭馆，来回转了几圈，看看这家看看那家犹豫不定，不知道是吃手抓饭好呢，还是烤串，烤馕这些的好，突然看见有家是在外面放的一个大锅，一边架子放着带肉的羊骨头，锅里是翻滚的红红的汤，看着新鲜和卖家比划了几下，说要一碗尝尝（汉语也不是很熟练），然后进了里屋，哇，里面坐满了维族人，操着维语不知道在谈论些什么。然而他们的目光大多投向了手持相机的我，心里有些胆怯，找了一个小角落坐了下面重新打量四周，内部也是常见的清真的建筑风格，看来我来到店家还挺不错，而且价格也非常的便宜。不一会一份看着不咋地的饭端了上来，嗯，这应该是囊包肉，看来也不想其他非新疆城市做的那么好看，里面有南瓜，囊，和羊骨头肉，不过还不赖，汤浓肉劲，一会功夫一碗就被我消灭掉了。噢！差点忘记交代，本来想要一份酸奶的，可惜卖家告诉我这个只有早上才有的，但是我在其他地方吃过，味道和乌鲁木齐驻京办事处的差不多，只不过盛酸奶的容器和勺子并没那么精致。</p>
<p>最后给大家看一下这家位处国际市集大巴扎旁边饭馆的菜单价格：</p>
<p>趁着吃完饭，看着小伙计在炒手抓饭，抓拍的几张，然后正好被老板看到，和我叽哩咕嘟的说了一通，当开始以为是不让拍呢，搞了半天才明白，原来是让我给他的小伙计拍一张，于是就有了下面这张照片：</p>
<p>烤串，这样串串分三种，一种是常见的竹签，一种是粗树枝（乌鲁木齐驻京办事处也是），一种是木边的金属串：</p>
<p>啊，还有新疆特有的囊，嗯，这个烤馕的烤具和我们家乡烙火烧的家什一样，这个拍的是肉囊（6元一个）：</p>
<p>美食拍的差不多了，就开始在大巴扎的外围四周溜达，过程中认识一个外地游客的老乡，说是老乡实际上就是想互相拍个照，反正没事一起走走吧，于是就有了下面这张照片，这张是那个老乡（应该有40 岁左右了吧）找到当地的保安合影的。</p>
<p>转来转去这附近也就集市，观光塔和清真寺，后者进门都是收费的，现在是反季，门票都是 10元，我都没有进去，观光塔其实并不高，而且外面宣传的太邪乎；清真寺更搞，一层居然是商场，二层以上才是清真寺，由于不能拍照和在做礼拜，无法进去。最后就站在公交车站，手持地图寻找下一个目标。经过询问，还真巧，正好问着一个导游，据他说，乌市市区除了这里（大巴扎）就只有红山公园可以看看，因为那里可以俯瞰整个乌市，询问好路线，顺便抓拍了一张当时的路面状况就撤离了这里。</p>
<p>在找另外一个公交车站时，经过地下通道拍到的，嗯，也和北京差不多，过道两边摆的小摊位和零星的乞讨者。以及路边看到的唯一一家卖葡萄干的老大爷，于是我也顺便买了些，嗯，购买的时候又遇到了语言障碍&hellip;</p>
<p>买完葡萄干后发现做公交车的零钱花掉了&hellip;哈，居然这都给忘记了，看到二道桥商场旁边有个大棚的市场，心想买些小玩意换些零钱，这不买不知道，居然让我知道了惊天的秘密！为什么这么说呢，对于一个外地人又没有经过了解就过来玩，对于这边的物价是毫无概念的，尤其是整改后面向国际的大巴扎。其实对面的大棚卖的东西和大巴扎里面的是一模一样的，买纯羊毛的东西，卖家上来也是掏出打火机去燎一点边（不明白的见上面随笔三），而且可能大棚的卖家不是本地人，我知道内幕的那家卖家是山西（还是陕西的？），<strong>我买了 3 个纯羊毛的围巾，经过砍价后居然 120 元就买到了！之前一件就花了我 80 元。天啊！这是何等的利润啊！</strong></p>
<p>买完这几件后手里就只剩下几块的交通费了，而且东西还蛮多蛮沉的，于是先回了趟宾馆放东西然后在去的红山公园（公交车只有不到 10 站地），说来不行，这要我外出的那几天天气一直的不好，尤其是到午后的时间，整个天空弥漫着一层似烟似雾的障碍物，就和北京的天气一样恶心。公园没有入园门票，但院内的其他部分地方和设施是单向收费的（寺庙，远眺楼，摩天轮，以及各种娱乐小项目），其实这样蛮好，可惜北京人太多，否则我想应该也会是这样的模式。进去之后人并不是很多，其实这个时候天气也算是蛮凉的了，大多数的娱乐项目都已经关闭，湖面也是干涸的。我就四处溜达了一圈，跑到远眺楼上面呆了一会，里面没什么东西，乌市包括亚心的介绍性文字，和大量的图片（新旧城市对比）。</p>
<p>在回去的时候，看到有一群人在拍照（经询问是给合唱团拍外景），我就凑了过去和摄影师的助理聊上了，他说一般每年的 5 月中下旬和 10 月初来新疆玩是最好的，当然是说周边的风景区，市里实在没什么大多的东西，喀什稍微好些，市里的古建筑更多一些，好像从乌市到喀什坐飞机还得1个多小时。然后有说了一串串让我记不住的风景区的名字还让我看了他们拍的照片，那叫一个美啊&hellip;有兴趣的朋友们可以去那个助理给我推荐的新疆天山网（由于疆内的网络还是封锁的，大家可以等开网了之后去看看），这是一个当地的门户网站，里面有一些关于旅行的活动可以参加。</p>
<p>告别了他们之后，我也结束了今天的行程，打道回府（实际上是去吃夜市了，这个我准备放在随笔的最后一节写一些关于新疆美食的总结吧）。今天的随笔就到这样，让大家等候多时了，希望这部分的随笔还能让大家满意 :)</p>
<p>明天的随笔是暴走扫街！想知道我都拍到了什么吗？哈哈，下回书接着记录。</p>
]]></content:encoded></item><item><title>新疆呼噜木齐随笔之三</title><link>https://icyleaf.com/2009/11/xinjiang-yaxin-diary-3/</link><pubDate>Fri, 20 Nov 2009 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2009/11/xinjiang-yaxin-diary-3/</guid><description>幸好我们的客户是中国移动，人家休息了我们也可以放松一下。 10 月 31 日（星期六），我耐不住性子抓上相机勇敢的出门了。出门前还是到酒店的前台确认了一...</description><content:encoded><![CDATA[<p>幸好我们的客户是中国移动，人家休息了我们也可以放松一下。 10 月 31 日（星期六），我耐不住性子抓上相机勇敢的出门了。出门前还是到酒店的前台确认了一下外出是否有生命危险，呃，比较没经历过嘛&hellip;买了一份带有公交路线的地图，前往了今天的第一站，乌市最有特色的维族区市集&ndash;大巴扎。</p>
<p>大巴扎位于城中心偏南的二道桥，其中“巴扎”在维语里就是集市的意思，它是新疆商业与旅游繁荣的象征，也是乌鲁木齐作为少数民族城市的景观建筑，又是一座标志性建筑。国际大巴扎具有浓郁的伊斯兰建筑风格，在涵盖了建筑的功能性和时代感的基础上，重现了古丝绸之路的繁华，集中体现了浓郁西域民族特色和地域文化（以上文字描述摘自网络）。</p>
<p>这边的公交车也很有特色，也是汉语和维语分别报站和提醒，我还特意录了一段，去大巴扎方向的人非常的多，所以车上人很挤，最初我还是非常小心的自己的贵重物品，和以防扎针事件的发生&hellip;不过到后来坐多了，也不顾及那么多了，因为实际上并没有想象中的那么可怕。到了大巴扎后，第一反应是环顾四周不停的看：熙熙攘攘的街道上全是维族人，感觉就像到达了另个一个国家，一切是那么新鲜。这边分为二道桥市场和新疆国际大巴扎两个部分，既然冲着大巴扎来的，那就先逛它吧，大巴扎是又一个典型化的商业区，有些类似北京的大栅栏，崭新的建筑就像是北京的老胡同扒倒重新再盖一样的，整个集市分了好些区域，大多数都是吸引外地游客前来购买新疆特色。</p>
<p>起初的时候，相机还不敢拿出来，毕竟对于外地人来说，新疆人的第一印象并不是很好，而且这里又是 July 5th 的突发现场，先后拿着相机诚惶诚恐的拍了几张又放了包里，主要是因为这个时候（大概 11 点多）我还没有看到一个外地人，而且集市上的卖家还都是在店里坐着，偶尔遇到朋友了，亲切的握个手，闲谈起来。幸好的是一个拿着相机的游客引入我的眼帘，这一下子让我放下了顾虑和担心，开始对着别人，展示的物品肆无忌惮的拍起来，看到新鲜的玩意儿就抓起来瞅瞅，店里的挂毯，围巾，披肩，到小摊位的铜镜，各种管制刀具，玉器，还有狼牙，由于不知道是狼牙真的假的，就随随便问了问，然后就发现了一个问题，这个卖家不怎会说汉语，当我问她多少钱的时候，“10 koi”，“恩? 10koi?”，“10 koi”，我试着笔出手指，然后说 10元一个？卖家赶紧“恩，恩”的点点头，这下明白了，原来 “koi”就是“元”的意思啊，不过心里一琢磨，一颗小小的狼牙这也太贵了吧，说声谢谢就离开了。</p>
<p>经过四处溜达一圈的经验，我发现，我拿着相机拍别人的商品的时候，他们都会热心的上前来询问有什么需要购买的，然后利用任何可以“勾引”的新鲜玩意和把戏把你“勾搭”回来。我得承认他们卖东西很有一套，而且很和蔼，涉及到买围巾，披肩等服饰的店面，大多数都是年轻的美女，看中哪个，二话不说，取下来就往自己身上展示，如果涉及到纯羊毛，迅雷不及掩耳之势点着了打火机，拽着一点边毛就点着了，吹灭，让你凑上闻闻，伸手搓一下，嗯，果然，没错，是纯羊毛的。下面，最重要的来了，大家肯定很关心价格问题，好吧，他们喊价也很常见，上来张开一个高价，然后在声称平时（以 July 5th 为由）卖一个更高的价格，而且我每到一家都是说，开门价，第一单生意，给你便宜些，但是我心里没底啊，不过他们张口报的高价其实比北京这边购买还是要便宜的很多的，我看中的第一件商品是想送给妈妈的围巾，卖家报“120”，心里踌躇的半天，卖家看到我犹豫，上来就说，“你给个价格吧”心里琢磨了半天，一边按照常规砍价学给出了一个半价 60 元，一边心里自问，这个价格会不会找来一顿爆骂，然后把我扫地出门（嗯，这种事可以在天津发生，从此之后买东西还价有些害怕），谁知道卖家并没有怒火，而是很亲切的和我讨价还价，他让一小步，我也让一小步，最后我拿出杀手锏，我就这 80 元，你这围巾卖不卖，如果得到答案不卖，里面转头走人，果不其然，卖家同意了，趁着没事，和美女卖家聊了起来，问了问最近的情况。顺便又趁机戴了几顶帽拍了一下，由于担心外面太短，也没敢没拿太多钱，所以很不错的帽子到最后也没有买，另外至于价格的最终秘密我会放到下一部分的随笔揭秘（不是不是，是时候未到，哈哈 o(∩_∩)o&hellip;）：</p>
<p>告别美女卖家之后又去其他店面去祸害：</p>
<p>到目前为止集市是逛的差不多了，到四周随便转转，就来到了大巴扎的中心小广场，这里有座观光塔，它的前面有一个大巴扎的金字塔标志，后面的旁边是清真寺（下图左边）</p>
<p>哈，还有摆摊卖石榴汁的：</p>
<p>看到这些突然想起来，这一早上还没有吃饭呢，嗯，找当地特色饭馆去&hellip;精彩继续稍后回来，请明天这个时候准时收看
XD</p>
]]></content:encoded></item><item><title>新疆呼噜木齐随笔之二</title><link>https://icyleaf.com/2009/11/xinjiang-diary-2/</link><pubDate>Thu, 19 Nov 2009 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2009/11/xinjiang-diary-2/</guid><description>差不多 11 点钟，飞机就到达了乌市地窝堡机场，打听好同事的住处就赶了过去，坐在出租车上面发现副驾驶的右角居然有摄像头，对于初次到达乌市，第一印象...</description><content:encoded><![CDATA[<p>差不多 11 点钟，飞机就到达了乌市地窝堡机场，打听好同事的住处就赶了过去，坐在出租车上面发现副驾驶的右角居然有摄像头，对于初次到达乌市，第一印象和普通的省会城市差不多，环境也不是太好。幸好乌市并不是太大，出租车的费用也不很贵（起步 6 元，每公里 1.3元）。半个小时的时间就到达了同事所在的如家快捷酒店。附近有市政府所以也比较安全（也就可能不安全，为什么这么说呢。众所周知，自 July 5th 之后那边发生了一些事情，导致不少流血事件的发生，以及群众前往市政府游行，闹的同事晚上都不敢在外出，随时都能看到持棍的人见到不是同族的就会发生冲突）。另外一个重要原因是自 July 5th 之后，随着网上的曝光，整个疆内的网络，包括短信全部停运（最初是可以发短信不能打电话），现在是只能打电话，所以我们这边的项目也只有我前来现场开发。这也是为什么我会在那天之后消失在网上，甚至在 twitter 上面飞机起飞前说完“乌市见”后就没有音讯的原因&hellip;说来安全是指，附近（还包括人群嚷嚷的街区）都有警察，武警，特警上街巡逻和士兵哨点把守，好家伙每队中起码有一个持长枪。</p>
<p>这边昼夜温差好大，刚去的那些天天气还都不错，白天有太阳和北京的天气差不多，不过到了晚上气温骤降，大概晚上 7 点和同事出去吃饭，我穿了带过去的所有衣服（一件Tee，一件线衣，一个带背心的小西服）都是浑身打颤，只有吃完一碗面之后才能抵御下外面的冷空气。除此之外，差不多还有 2 个小时的时差，其实这没有任何的影响。这里上班时间都是 10:00，早上 8 点的时候外面还是黑乎乎的一片，于是我又钻到被窝里呼呼睡一统 XD</p>
<p>由于我没有通行证无法进移动公司，我主要是做远程开发，工作日的大部分时间都是在宾馆编程，看看电视（无奈之举，只有看 CCTV 获得一些外界的信息），虽然疆内的网站是开着的，不过由于宾馆的网速慢的要死，疆内突发的高访问量，导致各个网站都是很慢很慢的，不过新闻大多数还都是那些疆内新闻和无关紧要的要闻&hellip;.</p>
<p>下图大家可以看出，乌市所有的指示的文字都是汉语和维语双文，这是为什么呢？接下来的随笔记着说明，待续&hellip;（这次图片少了些，后面的更精彩哦）</p>
]]></content:encoded></item><item><title>新疆呼噜木齐随笔之一</title><link>https://icyleaf.com/2009/11/xinjiang-diary-1/</link><pubDate>Wed, 18 Nov 2009 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2009/11/xinjiang-diary-1/</guid><description>突遇一次机遇能有幸到新疆出差，由于时间紧急，没有来得及做准备工作就飞了过去，来了之后才明白我为什么才有机会出差走一遭&amp;hellip;一共在那...</description><content:encoded><![CDATA[<p>突遇一次机遇能有幸到新疆出差，由于时间紧急，没有来得及做准备工作就飞了过去，来了之后才明白我为什么才有机会出差走一遭&hellip;一共在那边呆了有 11 天（10月27日-11月6日）的时间，除了工作外还抽出来了些时间在市里暴走，扫街。顺便品尝了不少的当地美食。最近刚刚可以闲的下来整理了一下照片，写下了下面的随笔记录：</p>
<p>11 月 27 日早在 T1 坐的海航飞往乌鲁木齐（以下简称乌市）的飞机，我专门挑了一个靠窗户的座位。这是我第一次做飞机，也在打机票的时候闹了一个很囧的事情，我选择的是电子自主出票，尤其是可以选择座位，最开始我总以为，飞机的窗户是大窗户而不是每个靠边的座位都能占到窗户，于是傻乎乎的问了机场服务人员&hellip;</p>
<p>那天阳光灿烂， 由于起飞的时候正好是早上 8 点多钟，从北京飞往乌市需要 4 个小时的时间，起初新鲜抓着相机拍了好多的云彩和大大的太阳，一抹蓝蓝的天空，后来飞机一直在厚厚的云层中飞行，抓起书继续阅读《向加泰罗尼亚致敬》一书，偶尔和身边的新疆人随便闲扯几句，他是一个很粗犷但心很细的中年人，从事销售行业。和他聊起了第一印象还是很不错的，没有传说中的那么恶略。趁下机的时候还给了我一些提醒。</p>
<p>当飞机经过甘肃，莫高窟之后，透过飞机出窗户看到的就是另一番风景：一望无际的沙漠，蜿蜒的山脉，旷阔的牧地，曲折的河流，水库和巍巍的天山被银白的白雪覆盖，相机是一直不断的刷刷刷的拍个不停，那个时候阳光已经非常明媚，而且加上窗户的反光，阳光的光晕，以及不小心就能拍到机翼，导致废掉了好多照片。</p>
<p>待续&hellip;</p>
]]></content:encoded></item><item><title>几本和 Git 相关的书</title><link>https://icyleaf.com/2009/09/books-about-git/</link><pubDate>Mon, 28 Sep 2009 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2009/09/books-about-git/</guid><description>切换到 Git开发已经有一段的时间了，之前一直在使用 svn，现在部分代码还在 Google Code 托管。不过自换了 Git 之后发现 Git 更方便且效率更高，不过用来用去常用...</description><content:encoded><![CDATA[<p>切换到 Git开发已经有一段的时间了，之前一直在使用 svn，现在部分代码还在
Google Code 托管。不过自换了 Git 之后发现 Git 更方便且效率更高，不过用来用去常用的就拿几个命令，很多时候都要去找一些参考资料和教程。从学习到现在一个接触了一个文档，三本书。文档就是官方的文档手册，这个就不再说了，安装完 git 也都会默认内置的，对于这三本书，依次为 <a href="http://book.git-scm.com/">Git Community Book</a>，<a href="http://progit.org/">ProGit</a>，<a href="http://zh-cn.whygitisbetterthanx.com/">Why Git is Better Than X</a>（X 代表其他 SCM 软件，如
svn，bzr等）。</p>
<ul>
<li>Why Git is Better Than X 已经有国内友人翻译完毕，一一介绍了 Git 与其他 SCM 软件有什么优势和特色</li>
<li>ProGit 不久前开启了<a href="http://progit.org/2009/08/19/translate-this.html">翻译计划</a>，中文目前还在<a href="http://groups.google.com/group/progit-zh">翻译过程</a>中，这本书很适合作为入门使用和工具书，欢迎前来 <a href="http://github.com/progit/progit">Fork</a></li>
<li>Git Community Book 就是一个由社区维护的手册，内容很全讲解的很详细，就是还没有中文</li>
</ul>
<p>可喜的是，这些书籍都是可以在线观看或下载的，当然如果能进一份力量，请去购买正版，或有一腔热血为 Git 贡献，就请加入到翻译之中。</p>
]]></content:encoded></item><item><title>Kohana 官方 2.3，2.4，3.0 的最终裁决！</title><link>https://icyleaf.com/2009/07/official-2-3-2-4-3-0-decisions/</link><pubDate>Fri, 24 Jul 2009 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2009/07/official-2-3-2-4-3-0-decisions/</guid><description>更新：Kohana 官方已经做出最终裁决！ 两天前我(Shadowhand)曾经说过关于 2.4 和 3.0 版本的问题和它们之间的关系已经做出的解答。之后的今...</description><content:encoded><![CDATA[<blockquote>
<p>更新：Kohana 官方已经做出<a href="http://forum.khnfans.cn/topic/view/167/1.html">最终裁决</a>！</p>
</blockquote>
<p>两天前我(Shadowhand)曾经<a href="http://forum.kohanaphp.com/comments.php?DiscussionID=2835&amp;page=6#Item_12">说过</a>关于 2.4 和 3.0 版本的问题和它们之间的关系已经做出的解答。之后的今天和其他开发者见面（with more of the devs），这似乎是错误的。所以长话短说，我们现在有两个选择：</p>
<p>​1. 我们在一个月内分别发布 2.4 和 3.0。 2.4 将会经可能的兼容 2.3.x 版本但是其中 Database 和 i18n 是全新的不同于 2.3 的系统。 3.0 也将不同于 2.4 的 Database，但是 i18n 系统还是和 2.4 一致。</p>
<p>​2. 完全抛弃 2.4 而专攻 3.0 版本，它将会有一个全新的类似 2.4 版本的 Database 特性，但是语法和更多的特性稍有些不同。 3.0 在发布的同时，新的网站和用户手册也会同步完成。</p>
<p>2.4 和 3.0 版本大约将会在同一天发布（2009年的8月下旬或9月上旬）。两个版本都不会去兼容
2.3.4 版本。虽然升级至 2.4 版本将会少于升级至 3.0 的兼容工作。（请记住，我们从来没有建议和要求用户升级到哪个核心版本）</p>
<p>我本可以行使 <a href="http://lmgtfy.com/?q=bdfl">BDFL</a>（Benevolent Dictator For Life，代表少数开源软件开发者的领头人）权利做个强制决定，但是我觉得还是听一听社区的声音。你们认为哪个是 Kohana 在未来长期（至少 6 个月以上）开发基础的最好选择呢?</p>
<p><strong>更新</strong>： 选择第二项，将会抛弃 2.3.x 版本公开发布的版本修复</p>
<hr>
<p>原文：<a href="http://forum.kohanaphp.com/comments.php?DiscussionID=3043&amp;page=1">Official 2.3, 2.4, 3.0 Decisions - We need your feedback!</a></p>
<p>&mdash;&mdash;&mdash;我是华丽的分割线&mdash;&mdash;&mdash;&mdash;&ndash;</p>
<p>KO3 RC1 目前已经发布，详情请看<a href="http://forum.khnfans.cn/topic/view/168.html">这里</a>，希望大家喜欢 Kohana，关注
Kohana，使用 Kohana
的朋友留下你的看法，这对Kohana自身和社区用户都是有益的！</p>
<p>&mdash;&mdash;&ndash;关于 E-TextEditor  的分割线&mdash;&mdash;&mdash;&mdash;&mdash;</p>
<p>今天前去 Textmate clone 的软件 Intype论坛瞅了一眼，惊奇的发现同样是
Textmate clone 的 E-TextEditor 居然在今年3月份宣布开源，而5月份就在
Github 放出了源码！而且声称会开发 Linux 版本并且弘扬 Linux 的精神，Linux
版本统统免费！详情请看 <a href="http://intype.info/forums/discussion/827/eeditor-going-open-source-open-company/#Item_0">Intype 论坛</a></p>
<p>而且已经有Linux用户编译运行了 E-TextEditor 详情请看：<a href="http://fixnum.org/blog/2009/e_on_fedora">Building the E text
editor on Fedora 10</a></p>
<p>不知道身为 Textmate clone 的 Intype
会做何打算，它们目前正在全力开发新的版本（貌似内核和界面全部重新），拭目以待！</p>
]]></content:encoded></item><item><title>豆瓣API测试控制台</title><link>https://icyleaf.com/2009/07/douban-api-console/</link><pubDate>Mon, 06 Jul 2009 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2009/07/douban-api-console/</guid><description>项目已开源: http://github.com/icyleaf/modou 豆瓣 API 测试控制台的创造灵感来源于 Facebook Developers Tools 中的Facebook API Console， 或许大家知道，魔豆是我的另外一个豆瓣 API 应用，由于是...</description><content:encoded><![CDATA[<blockquote>
<p>项目已开源: <a href="http://github.com/icyleaf/modou">http://github.com/icyleaf/modou</a></p>
</blockquote>
<p>豆瓣 API 测试控制台的创造灵感来源于 Facebook Developers Tools 中的<a href="http://developers.facebook.com/tools.php">Facebook API Console</a>， 或许大家知道，魔豆是我的另外一个豆瓣 API 应用，由于是自己封装的 Douban
API（官方提供的库类要求太多，安装繁琐，这不属于我喜爱简洁，轻便的风格），每次想查看某个
API 接口返回的数据都要写一个 test 跑一下。麻烦不说，还容易出错，于是，使用自己封装的 Douban API，借鉴 Facebook API Console
的界面和类似的功能显示，终于小有所成，其中为了实现此控制台，封包的库类经过两次大改，虽然改的很辛苦，但从中学到了很多开发经验。</p>
<p>测试用户必须先进行用户验证才能进行测试，这主要是为了：</p>
<ol>
<li>避免提交查询中出现错误，并让测试者使用到全部API方法</li>
<li>防止恶意用户利用它做二次api调用，由于测试控制台的传输很简单，提交参数即可查询。</li>
</ol>
<p>查询方法：</p>
<ol>
<li>进行用户的登录验证</li>
<li>选择返回的数据类型（支持官方提供的 XML 和 JSON格式）</li>
<li>选择需要查询的API方法（这里我做了分类）</li>
<li>如果查询的方法存在参数，会在方法下面显示。</li>
<li>设置完毕参数后，点击“调用此方法”，稍等片刻即可。</li>
</ol>
<p>返回的数据结果会在右侧显示出来，其中，右上部分是调用相关 API 的 URL 地址；右下部分是返回的数据结果。</p>
<p>如果，参数设置错误，或者其他问题，返回的结果会以 [CODE] Content
的格式返回，其中 <strong>CODE</strong>代码返回的状态码，<strong>Content</strong> 是返回的信息。</p>
<p>通用参数解释：</p>
<ul>
<li>id  - 查询方法涉及到的 id 值（人，书影音，日记，广播，豆邮，同城等）</li>
<li>message - 广播发送的内容</li>
<li>title - 日记，豆邮的标题</li>
<li>content - 主题内容</li>
<li>city - 同城活动的城市代号（根据我判断，应该是中文的拼音，详细请看<a href="http://www.douban.com/location/world/">官方同城列表</a>中各个城市的url）</li>
<li>query - 搜索的关键字</li>
<li>index - 返回多个元素时，起始元素的下标（相当于豆瓣 api 文档中的start-index）</li>
<li>max - 返回多个entry时，每页最多的结果数（相当于豆瓣 api 文档中的max-results）</li>
</ul>
<p>其中某些方法（涉及到自身的数据，比如我的信息，我的广播，我的同城）在进行查询的时候可以把
id 留空或者设置为 ‘me’ （不带引号），这样调用结果显示的是自己的信息。</p>
<p>如果长时间(大于1分钟)处于“调用中”，可能是由于程序问题，请刷新后重试。</p>
<p>已知存在的问题：</p>
<ol>
<li>界面和方法列表在 Chrome 浏览器有不兼容的问题出现</li>
<li>返回数据结果头一行多出一个类似水平制表符的转义符似的</li>
</ol>
<p>由于目前为止豆瓣 API 还没有封装完成，现只提供用户，广播，书影音，豆邮和日记的不完全功能测试查询。
其余的 API 会尽快添加进去 :)</p>
<p>测试地址：<a href="http://ews.im/douban_console">http://ews.im/douban_console</a></p>
]]></content:encoded></item><item><title>魔豆：豆瓣网非官方移动版本</title><link>https://icyleaf.com/2009/06/modou/</link><pubDate>Mon, 22 Jun 2009 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2009/06/modou/</guid><description>项目已开源: http://github.com/icyleaf/modou 但不再维护。 魔豆，一个豆瓣网非官方移动版本，基于豆瓣 API开发的专门为移动终端（手持设备）定制的豆瓣移动版本。魔豆专注于豆瓣网...</description><content:encoded><![CDATA[<blockquote>
<p>项目已开源: <a href="http://github.com/icyleaf/modou">http://github.com/icyleaf/modou</a> 但不再维护。</p>
</blockquote>
<p><a href="http://modou.us" title="魔豆：豆瓣网非官方移动版本">魔豆</a>，一个<a href="http://douban.com">豆瓣网</a>非官方移动版本，基于<a href="http://www.douban.com/service/apidoc/" title="豆瓣 API">豆瓣
API</a>开发的专门为移动终端（手持设备）定制的豆瓣移动版本。魔豆专注于豆瓣网的<strong>广播</strong>及<strong>同城活动</strong>。</p>
<p>魔豆的来历：豆瓣移动版 -&gt; Douban mobile -&gt; moDouban -&gt; moDou -&gt;魔豆</p>
<p>目前魔豆发布的功能：</p>
<ol>
<li>友邻广播：支持显示广播，回复发起人和重播（重复发布其他发起者的广播）</li>
<li>同城活动：查看自己参与（包含参加/感兴趣）的活动以及用户所在城市的同城活动（需提前在豆瓣设置）</li>
<li>查看用户相册以及同城活动相册（仅限于从友邻广播）</li>
<li>搜索用户/书影音/同城活动</li>
<li>查看用户/书影音/同城活动信息</li>
<li>显示和查阅豆邮</li>
</ol>
<p>我，是一个重度豆瓣使用者，也许这和身在北京这所繁华的帝都有很大的关系。虽然豆瓣网直到现在为其定位在书影音这三大模块，但不可否认的，豆瓣小组，豆瓣广播，豆瓣同城甚至豆邮都起着重要的标志性作用。</p>
<p>或许和大家一样，一直期待着豆瓣网能够推出移动版本，可以用手机或其他移动设备查查书影音，看看友邻广播和未读豆邮，浏览下所在城市的同城活动，
光想想都是这么的惬意，于是我们在等，一直在等，几乎使我望穿秋水的时候，还是杳无音讯。平时在有 WIFI 网络的情况下，
使用 iTouch 访问一下豆瓣网还是可以，如果离开了它，以为这必须使用较昂贵的 GPRS 网络，经过漫长的 loading 才能看到自己感兴趣或自己想看的一点点信息&hellip;</p>
<p>于是，自己何不使用豆瓣API开发一个呢？紧接着通过查阅大量的文档和官方提供的演示代码，抛弃
Zend Framework 和 Gdata，使用自己维护中文化的 <a href="http://khnfans.cn" title="Kohana 中文爱好者">Kohana</a>框架，一点一点的搭建起了基础库，通过一个星期多的时间，开始一边做页面的展现，另一边继续完善基础库，直到目前为止，大体的框架已经完成，下面需要考虑如何对细节做修改和完善。</p>
<p>另外，由于 PHP 没有低耦合的 HTTP requset class，自己使用 curl 函数一点点抠出来的一个 RESTFul requset class，在进行提交 POST，PUT，DELETE 方法还存在一些技术问题，所以魔豆目前还不支持对书影音，同城活动进行操作（包含，想读/听/看，感兴趣，我要参加等等），我会尽快完善。</p>
<p>开发环境： <strong>Windows XP + XAMPP + E-texteditor</strong> (Office work) AND
<strong>Ubuntu 9.04 + XAMPP + Aptana</strong> (Laptop)</p>
<p>调试设备：iPod Touch + Blackberry 8310 + Nokia N-GAGE QD</p>
<p>由于设备有限，可能在其他设备上会出现设备误判或UI上的问题（大家可以在本日志下面留下误判设备型号），敬请谅解。后期会对不同设备进行专门的优化
:)</p>
<p>网站：<a href="http://modou.us">http://modou.us</a></p>
<p>开发进度：<a href="http://modou.us/timeline">http://modou.us/timeline</a></p>
<p>相关截图：<a href="http://www.getdropbox.com/gallery/45081/1/modou?h=b26d7e">http://www.getdropbox.com/gallery/45081/1/modou?h=b26d7e</a></p>
<p>欢迎大家前来测试和使用，心情愉快。</p>
<blockquote>
<p>更新于 2009年06月22日：由于 China Mobile 的原因，黑莓手机默认浏览器无法判别，请黑莓用户使用 Opera Mini 或其他浏览器访问，原因请看<a href="http://www.douban.com/group/topic/6946152/">这里</a>。</p>
</blockquote>
]]></content:encoded></item><item><title>话说相机二三事</title><link>https://icyleaf.com/2009/05/talk-about-camera/</link><pubDate>Mon, 11 May 2009 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2009/05/talk-about-camera/</guid><description>记忆中的童年，曾经在父母的衣柜底部发现了一部特老式的国产红梅HM-1相机，外观有些像莱卡，但要厚许多，镜头是从内部有上往下翻出来，镜头的链接...</description><content:encoded><![CDATA[<p>记忆中的童年，曾经在父母的衣柜底部发现了一部特老式的国产<a href="https://post.smzdm.com/p/180068/">红梅HM-1相机</a>，外观有些像莱卡，但要厚许多，镜头是从内部有上往下翻出来，镜头的链接还属于褶皱型的类似塑料，不知道怎么形容，于是Google了一下，发现学名叫120遮叠式皮腔相机。不过因当时年少不懂，几经折磨的相机被我玩坏了&hellip;而且是在没有胶卷的情况下，而后诚惶诚恐的把相机重新塞到父母的衣柜下面，从此封口不提此事，幸好后来也没有找我质问。后来才知道那相机是我父亲年轻时购买的机器，同时在家里的相册也发现了不是父亲外出拍摄的照片，当时都是黑白照，或许是父亲的基因遗传还是其他原因，从此对相机产生了浓厚的兴趣。或许对于高科技新鲜物品都是充满了美好的欲望：对于相机，对于电脑亦是&hellip;</p>
<p>学生时代，尤其喜欢把玩胶卷相机，记得在我们上初中的时候当时特流行也最易用的“傻瓜相机”，只要学校组织外出活动，就会想办法去借到一个相机，带上1-2卷胶卷，享受拍照的乐趣，尤其在胶卷用完之后就会跑到一个黑黑的角落，甚至回家后放在被窝里面取出胶卷，生怕一点的曝光出现。后来因有了电脑而着迷，但只要有机会接触到相机就会特兴奋。（下面附图的傻瓜相机应该还是高级货，网上找的其他的都太模糊）</p>
<p>后来，也就是2008年来北京工作的第一年，开始花自己钱的时候，给自己购买了一份生日礼物：柯达 C340，我的第一款数码相机，虽说是在淘宝上面淘过来的二手相机，歹说也 500 万像素呢～从此无论到哪都会随身携带着它，我还很清楚的记得，当初在购买此相机之后不久，另外一个在北京的朋友给我看来一本关于相机拍摄的初级入门电子书。就在我认真阅读第一节“一般来说数码相机都设有快门优先和光圈优先&hellip;”，抓起自己的相机“玩命”的寻找也没有发现这两个曝光功能，随之删除掉了那本入门电子书。开始就是抓什么拍什么，再也不看电子书教程和论坛经验之类的东西生怕受了打击&hellip;</p>
<p>很快一年的时间过去了，这部老爷机我也逐渐熟悉，照片技术也愈发熟练起来，同时也明白了它的优缺点，开机速度和快门速度都比较慢，微拍的时候最不容易对焦，对于较暗光线拍照效果急剧下降，最要命越用耗电量也越大，两节新的 AA 南孚电池在不开闪光灯的情况下最多撑3-4个小时。于此同时从 <a href="http://twitter.com/CNBorn">CNBorn</a> 和 <a href="http://twitter.com/yichi">yichi</a> 同学了解到一些单反相机的知识，于是心开始动摇了&hellip;</p>
<p>终于，于昨天（2009年05月10日）在 CNBorn 陪同下来到了北京五棵松器材城入手了属于自己的单反相机 —— 佳能 450D + 18-55 IS 套机。随后来到在这期《时尚先生》韩寒的外拍场地，北京世界风情园进行了第一次试拍。虽然因某些原因成为了烂尾工程，但这是一个非常适合练习拍摄的地方，重合了多国的建筑风格，荒废的场地还带着一些探险，寻找古籍的趣味，在一些建筑内，纵横交错的柱子又称了练习用光的有利条件。最最重要的是来到这里的人很少，或许会有少数的摄影爱好者前来外拍，但是最起码的我们不会再因为人多等等原因而延误拍摄的痛苦和无奈。</p>
<p>从此揭开了新的拍摄乐章&hellip;</p>
<hr>
<p>最后特别感谢山居的<a href="http://www.shanju.org/">清隐子</a>对各种相机的看法，豆瓣的<a href="http://www.douban.com/people/mattony/">强哥</a>解答我的问题，yichi 的购买注意事项等问题的解答，CNBorn
帮我这单反小白验机和使用光圈，快门知识；相机包的挑选！ :P</p>
]]></content:encoded></item><item><title>Modules Library 和 DBManager Module</title><link>https://icyleaf.com/2009/03/modules-helper-and-dbmanager-module/</link><pubDate>Thu, 05 Mar 2009 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2009/03/modules-helper-and-dbmanager-module/</guid><description>Hi, Don&amp;rsquo;t understand Chinese? ok, No problem. Here to view Modules Library and DBManager Module 或许大家可能有了解到，本人目前一直在对 Kohana这个纯 PHP5 框架进行文档翻译和维护，同时也建立一个站点：Koha...</description><content:encoded><![CDATA[<blockquote>
<p>Hi, Don&rsquo;t understand Chinese? ok, No problem. Here to view <a href="http://forum.kohanaphp.com/comments.php?DiscussionID=2117&amp;page=1">Modules Library</a> and <a href="http://forum.kohanaphp.com/comments.php?DiscussionID=2156&amp;page=1">DBManager Module</a></p>
</blockquote>
<p>或许大家可能有了解到，本人目前一直在对 <a href="http://kohanaphp.com">Kohana</a>这个纯 PHP5
框架进行文档翻译和维护，同时也建立一个站点：<a href="http://khnfans.cn/" title="Kohana爱好者">Kohana爱好者</a>。
站点提供中文化的文档，包含中文语言包的中文镜像下载支持以及中文化论坛。Kohana 
凭借着基于 CodeIgniter
框架+PHP5，赢得了一群使用者，我也希望无论是国外的还是国内的使用者都能共享自己的力量。</p>
<p>恩&hellip;以上算是给自己打个广告。Modules Library 和 DBManager Module 均是为
Kohana 框架编写的，以后会根据自己和大家的寻求做适当的更新。</p>
<p><strong>Modules Library</strong>，中文译为 扩展管理库，是一个方便管理 Kohana
系统自身扩展配置的库类，通过它使用代码就可以轻松实现获取当前所有 Modules
信息，已激活的 Moduels， 未激活的 Modules，最重要的是还可以添加
Modules，激活和关闭 Module。</p>
<p>范例代码：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1">// Instance Module library
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="c1"></span><span class="nv">$module</span> <span class="o">=</span> <span class="nx">Module</span><span class="o">::</span><span class="na">instance</span><span class="p">();</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1">// list all modules of application in application/config/config.php
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nx">Kohana</span><span class="o">::</span><span class="na">debug</span><span class="p">(</span><span class="nv">$module</span><span class="o">-&gt;</span><span class="na">list_all</span><span class="p">());</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="c1">// list active modules of application in application/config/config.php
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nx">Kohana</span><span class="o">::</span><span class="na">debug</span><span class="p">(</span><span class="nv">$module</span><span class="o">-&gt;</span><span class="na">list_active</span><span class="p">());</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="c1">// list inactive modules of application in application/config/config.ph	p
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="c1"></span><span class="k">echo</span> <span class="nx">Kohana</span><span class="o">::</span><span class="na">debug</span><span class="p">(</span><span class="nv">$module</span><span class="o">-&gt;</span><span class="na">list_inactive</span><span class="p">());</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="c1">// active &#39;auth&#39; module
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1"></span><span class="nv">$module</span><span class="o">-&gt;</span><span class="na">active</span><span class="p">(</span><span class="s1">&#39;auth&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="c1">// inactive &#39;auth&#39; module
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="c1"></span><span class="nv">$module</span><span class="o">-&gt;</span><span class="na">inactive</span><span class="p">(</span><span class="s1">&#39;auth&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="c1">// add &#39;sample_module&#39; module with description.
</span></span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="c1"></span><span class="nv">$module</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;sample_module&#39;</span><span class="p">,</span> <span class="s1">&#39;Just a sample module&#39;</span><span class="p">);</span>
</span></span></code></pre></div><p><strong>DBManager Module</strong>灵感来自 WordPress 插件 WP_DBManager，就连名字都很类似，其实对于其功能也是按照它实现。哈哈～～</p>
<p>目前对于此扩展实现的功能如下：</p>
<ul>
<li>获得当前 Mysql 版本以及 Kohana 连接数据库等信息</li>
<li>获取当前所有表数据</li>
<li>备份数据库（支持Gzip压缩和自动备份）</li>
<li>优化数据库（支持自动优化）</li>
<li>修复数据库</li>
<li>获得，下载，删除数据库备份文件</li>
</ul>
<p>此扩展支持配置和 i18n，以及对目前来说一个简易的演示页面。</p>
<p>目前还没有对实现自动备份后进行 Email 通知的功能，以及以后会对多种数据库支持。和限制最大化数据库备份文件。至于是否可以在进行数据库表数据的操作（比如查询，删除表，修改表等）是否还需要支持？</p>
<p>以后对自己发布的 Kohana 相关的代码都会托管在 Google Code 上面，地址：<a href="http://code.google.com/p/kohana-fans-cn/">http://code.google.com/p/kohana-fans-cn/</a></p>
]]></content:encoded></item><item><title>Mockups：手绘界面设计软件</title><link>https://icyleaf.com/2009/02/mockups-best-ui-design-software/</link><pubDate>Wed, 18 Feb 2009 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2009/02/mockups-best-ui-design-software/</guid><description>忘记如何知道 Mockups 这款软件了，不过也是今天搜索是无意中发现的一款很棒的界面设计软件，无论你在设计一个软件的外观或者是一个网站的界面甚至说更为细节...</description><content:encoded><![CDATA[<p>忘记如何知道 Mockups
这款软件了，不过也是今天搜索是无意中发现的一款很棒的界面设计软件，无论你在设计一个软件的外观或者是一个网站的界面甚至说更为细节的一个小的功能模块的展现都可以使用这个软件完成。</p>
<p>这款软件的亮点可以想 VB 或者 Dreamware
之类的界面拖拽的方式即拖即现，点击拖拽后的控件（可以这么称之为吧），就提示相关的参数属性设置。而且控件库都是可视化显示，无论对于初入这个软件还是不懂设计的和画画的朋友都可以很轻松的上手而且还是手绘的效果，虽然界面不精细但是作为演示的草图已经足够了。而且最为重要的舍弃了笔和纸，也减去了自己拿软件自己进行鼠绘界面设计的痛苦。</p>
<p>软件分为线上和客户端和嵌入式三个版本，不过作为线上版还是客户端均采用了
Flex 开发，这样可以避免二次语言看法，只需要做部分的调整，就可以作为线上版和
AIR 客户端版本。嵌入式主要是说 Mockups
可以集成到Confluence，JIRA，和XWiki中的版本。</p>
<p>线上版的地址：<a href="http://www.balsamiq.com/demos/mockups/Mockups.html">http://www.balsamiq.com/demos/mockups/Mockups.html</a></p>
<p>对于想尝试客户端的朋友请注意，需要 AIR 支持，请先到 Adboe 官方<a href="http://get.adobe.com/air/">下载 AIR</a>，然后在进行 <a href="http://www.balsamiq.com/demos/mockupsAir/MockupsForDesktop.air">Mockups 安装</a>。AIR 客户端适用于 Windows/Linux/Mac 系统。</p>
<p>在下载并安装之后，运行起来，大家就能看到一个精美的界面和预置六十多个界面元素控件的控件管理和下面的展现界面。</p>
<p>对于完成之后的界面可以导出为 XML 标记语言以方便管理和导入及其他工具或者是保持为 PNG
图片格式。除此之外，软件还支持导入以及添加更多的界面元素控件，这么好的软件当然不可能免费，购买的话需要 $79 刀的注册费用（对于Confluence，JIRA，和XWiki版本的费用还有所不同），不过官方有说明，注册之后的 Licenses 可以相互使用。对于买不起软件的朋友作者也给出了不同的方式以免费获取 Licenses。</p>
<p>如果你做到东西需要给大家演示，直接按快捷键 Ctrl + F，会开启全屏功能，在这个全屏功能中，将无法进行编辑，鼠标移动会有一个蓝色的大箭头在界面设计的周围移动，这个主要为了方便演示而制作的功能，可以看出软件作者的细心程度。</p>
<blockquote>
<p><strong>更新</strong>：在发布完此日志之后随后又给官方指定地址发了一封免费获取 Lincense 的邮件，没想到不过 3分钟，一个价值 $79 刀的 Lincense 真的发过来了！</p>
</blockquote>
<p>官方网址：[http://www.balsamiq.com/products/mockups][]</p>
<p>[<img loading="lazy" src="http://icyleaf.com/wp-content/uploads/2009/02/2009-02-18_00044.jpg"
  
  
  alt="mockups snapshot"></img>
]: <a href="http://icyleaf.com/wp-content/uploads/2009/02/2009-02-18_00044.jpg">http://icyleaf.com/wp-content/uploads/2009/02/2009-02-18_00044.jpg</a>
[http://www.balsamiq.com/products/mockups]: <a href="http://www.balsamiq.com/products/mockups">http://www.balsamiq.com/products/mockups</a></p>
]]></content:encoded></item><item><title>与SPAM战斗到底：CSS篇</title><link>https://icyleaf.com/2009/02/fighting-spam-with-css/</link><pubDate>Sun, 08 Feb 2009 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2009/02/fighting-spam-with-css/</guid><description>SPAM，现在还没有一个非常严格的定义。一般来说，凡是未经用户许可就强行发送到用户的邮箱中的任何电子邮件。现在应该已经广泛各种网络应用上面。...</description><content:encoded><![CDATA[<p>SPAM，现在还没有一个非常严格的定义。一般来说，凡是未经用户许可就强行发送到用户的邮箱中的任何电子邮件。现在应该已经广泛各种网络应用上面。对于网站来说，网站知名度小的时候或许还可以免于“侵犯”，可是一旦在搜索引擎收录的数量做出一些成绩，SPAM 就会主动找上门来，各种垃圾信息就会扑面而来，然而对SPAM 的战斗一起在进行，这是一场没有硝烟的战争，为了防范
SPAM，大家各显其能，招招新颖，当然还有一些专门为 SPAM 创建防御服务的网站，比如说 WordPress 自带的 <a href="http://akismet.com/">Akismet</a>。对于各种防御方法，我想应该可以写成一个系列，这个系列的内容或许是从网络上搜集或许是自己突发奇想想出来的奇招（目前应该还不可能哈）。</p>
<p>今天我带给大家的是方法另辟其境：<strong>CSS</strong>。总所周知，CSS 是一种层样式表，只是为了网站界面的展现做出重要贡献的角色。那么它怎么实现防御 SPAM 的呢？ok，接着下看。</p>
<p><strong>原理</strong></p>
<p>为了不上了就代码让大家感到迷惑，先讲一下原理：首先在创建表单的时候，添加一个对
SPAM 校验的 input
标签，然后再提交的时候进行对这个标签进行判断其值是否为空，因判断是否为
SPAM（如果你不明白 SPAM 的实现原理请看<a href="http://www.codewall.cn/blog/?p=7">这里</a>）。（看官：不就是设置成
hidden 类型吗，这谁都知道）错！我承认这是一个最常见的判断 SPAM
的流程，但这里添加的 input 类型使用的是 text 类型，这是为了防止 SPAM
在进行抓取页面进行对 input 类型判断是否有 hidden
类型为设置的，那么怎么隐藏这个 input 标签呢？那么就可以利用到 CSS 的
display 属性，哈哈，是不是明白了？好吧，看代码吧。</p>
<p><strong>代码</strong></p>
<p>HTML 代码：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="ln">1</span><span class="cl">Name:&lt;input name=&#34;name&#34; /&gt;&lt;br /&gt;
</span></span><span class="line"><span class="ln">2</span><span class="cl">Email:&lt;input name=&#34;email&#34; /&gt;&lt;br /&gt;
</span></span><span class="line"><span class="ln">3</span><span class="cl">Comment:&lt;input name=&#34;comment&#34; /&gt;&lt;br /&gt;
</span></span><span class="line"><span class="ln">4</span><span class="cl">&lt;input type=&#34;hidden&#34; class=&#34;special&#34; /&gt;
</span></span><span class="line"><span class="ln">5</span><span class="cl">&lt;input type=&#34;submit&#34; value=&#34;Post it&#34; /&gt;
</span></span></code></pre></div><p>CSS 代码：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="ln">1</span><span class="cl">body {line-height:35px;font-family:Arial, Helvetica, sans-serif;color:#333;font-size:14px;}
</span></span><span class="line"><span class="ln">2</span><span class="cl">.special {display:none;}
</span></span></code></pre></div><p>上述代码中 class 为 special 的 input 标签即为判断 SPAM 的标志。使用 CSS
对其隐藏，就在提交表单后进行对这个 input 进行判断是否为空即可。这样就简单避免 SPAM 对 input 的 hidden 判断的避免而轻松达到防御的目的。</p>
<p><strong>声明</strong></p>
<p>CSS 防御 SPAM 的实现方法来自<a href="http://www.modernblue.com/web-design-blog/fighting-spam-with-css/">Modernblue</a>
网站发布的文章。本人只是做翻译工作，特此声明。</p>
]]></content:encoded></item><item><title>回顾 2008 年度及总结报告</title><link>https://icyleaf.com/2008/12/2008-year-in-review/</link><pubDate>Tue, 30 Dec 2008 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2008/12/2008-year-in-review/</guid><description>2008 年是一个不平凡的一年，这一年发生了很多大事件：南方雪灾，西藏拉萨暴力事件，四川汶川大地震，北京奥运会，三鹿奶粉事件，0807（本人毕业）&amp;...</description><content:encoded><![CDATA[<p>2008 年是一个不平凡的一年，这一年发生了很多大事件：<strong>南方雪灾，西藏拉萨暴力事件，四川汶川大地震，北京奥运会，三鹿奶粉事件，0807（本人毕业）</strong>&hellip;就在去年的 12 月份，我踏入北京开始了北漂的生活，而且预先给自己制订了一个新的 08 计划：<a href="http://icyleaf.com/2007/12/27/2008-a-new-i/">2008，一个全新的我</a>。下面针对 08 计划做一下总结：</p>
<ol>
<li>
<p><strong>专心一致的提高自身的专业知识水平</strong>
这一年还算是不错吧，对于公司的工作每一项都认真的去完成，同时在工作中学到了很多的知识和经验，对于业余爱好来说，可能还是没有把握一个方向：PHP，中间总是会去岔题去研究其他方面的互联网开发的东西，还好没有偏离互联网开发这个方向。同时深深感谢 <a href="http://wordpress.org/">WordPress</a>和  <a href="http://twitter.com/">Twitter</a>，这两个让我了解了很多，学到了很多。</p>
</li>
<li>
<p><strong>提高自己的社交能力</strong>
幸好自己处在北京这么一个大城市，才得以让我参加各种各种的活动：美食，聚会，技术交流，闲谈，娱乐等，这里重点要感谢<a href="http://www.douban.com">豆瓣网</a>，使它让我充实了每一个空闲的周末。同时从最初的 [V2EX聚会][]到回来大大小小的活动，我也很高兴认识了一群志同道合的朋友。当然还有一些在网上认识的朋友。</p>
</li>
<li>
<p><strong>提供英语的读写能力</strong>
很惭愧，一项未完成的项目，虽然经常的订阅一些国外的一些网站，翻译一些博文，但我发现这样对自己学习英语的提高并不是很大，很多都仅仅是能看懂，如何翻译的更好，如何自己写出来还是不是很如意，还有很惭愧的是，自己还承担了 <a href="http://khnfans.cn/docs/">Kohana 中文文档</a>的翻译和维护工作。</p>
</li>
<li>
<p><strong>计划好了就要努力完成</strong></p>
<p>虽然我都是在努力的去完成计划的工作，可惜自己给自己定的计划太多了以至于到现在不是未完成就是出于收尾的状态。自己做了很久的 Todo List 项目，到现在也没有完成&hellip;这里要向 <a href="http://blog.donews.com/CNBorn/">CNBorn</a> 同学学习，每天利用下班的时间来做自己的项目，当然同样也是一个 Todo List 服务：<a href="http://www.checknerds.com/">CheckNerds</a>，目前正在刚刚完成 mobile 版本:) 可能会有人问，为什么你们做同样的项目，恩，是这样的，由于我们在认识之前我就已经开始在进行自己的项目，而且我们的想法还是有些差异，所以可能对针对的人群和开发的功能还不太一样。</p>
</li>
<li>
<p><strong>摆脱&quot;懒&quot;的恶习</strong>
同样很遗憾，还是没有摆脱&hellip;我会在今后的日子继续努力，继续摆脱的！</p>
</li>
</ol>
<p>对我来说，这一年发生了很多，让我也改变了许多，这一年也让我如愿以偿的拥有了自己的笔记本，更换了自己的手机，给喜欢摄影的我新添了一个老爷相机（本人只有在拥有什么了才会去深入研究，所以先买一个玩玩，等深入了，我会考虑单反&hellip;），还在豆瓣组织了
<a href="../2008/11/04/one-shot-everyday/">一日一摄</a> 活动。最重要的是，让我认识了一群志同道合的朋友！</p>
<p>今年马上就要结束，新的一年又即将开始，结束今年并不代表可以忘记，他永远都是过去，过去的不足自己会努力改正，新的开始还需新的计划，我想等元旦的假期好好整理一下自己的思路，计划一下新的一年。</p>
<p>同时，祝福大家在 2009 年<strong>牛气冲天</strong>！</p>
]]></content:encoded></item><item><title>正式入黑莓系</title><link>https://icyleaf.com/2008/12/join-into-blackberry/</link><pubDate>Tue, 16 Dec 2008 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2008/12/join-into-blackberry/</guid><description>真的忘记了为什么要买黑莓手机，也许是自己手机太老已没有软件支持；也许是受 P阿姨 的不断诱惑；也许是因为黑莓的软件是 Java 编写的；更也许是 iPhone&amp;amp;G1 太贵了让...</description><content:encoded><![CDATA[<p>真的忘记了为什么要买黑莓手机，也许是自己手机太老已没有软件支持；也许是受 <a href="http://www.ipoisson.net">P阿姨</a> 的不断诱惑；也许是因为黑莓的软件是 Java 编写的；更也许是 iPhone&amp;G1 太贵了让我望尘却步&hellip;不管怎么说，我于2008年12月14日正式入黑莓系，控应该还达不到 XD。</p>
<p>本来想要买 8820，主要是考虑到在北京可能 WIFI用到的比较多，不过后来听说黑莓对 WIFI 的支持不是很好，而且我也很热衷于 8310 red 版的外观&hellip;后来想想还是先买一个 8310，如果用 WIFI 的话就在买一个 iTouch&hellip;（iTouch 是受 <a href="http://utombox.com">Utom</a> 同学的诱惑）</p>
<p>说道买黑莓还得感谢 <a href="http://blog.donews.com/CNBorn/">CNBorn</a> 同学的推荐的店家，价格合适且质量还过的去，而且卖家因我白去一趟还特意给我一个小小的惊喜：原装耳机和4G的内存卡，而且服务还不错。不过幸好没有在大学生联盟的天津卖家，七楼那里购买（<a href="http://www.52blackberry.com/thread-159426-1-1.html">原因看这里</a>），实在是让人汗颜&hellip;</p>
<p>最后还是感谢 <a href="http://www.ipoisson.net">P阿姨</a> 再我购机之前的指点以及分享相关软件，主题和资料 :P</p>
]]></content:encoded></item><item><title>初学 git 入门</title><link>https://icyleaf.com/2008/11/new-guy-to-git/</link><pubDate>Fri, 07 Nov 2008 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2008/11/new-guy-to-git/</guid><description>Git 是用于 Linux 内核开发的版本控制工具。与常用的版本控制工具 CVS, Subversion 等不同，它采用了分布式版本库的方式，不必服务器端软件支持，使源代码的发布和交流极其...</description><content:encoded><![CDATA[<blockquote>
<p>Git 是用于 Linux 内核开发的版本控制工具。与常用的版本控制工具 CVS, Subversion 等不同，它采用了分布式版本库的方式，不必服务器端软件支持，使源代码的发布和交流极其方便。Git 的速度很快，这对于诸如 Linux kernel 这样的大项目来说自然很重要。Git 最为出色的是它的合并跟踪（merge tracing）能力。</p>
</blockquote>
<p>当前大多数人用的还应该是 SVN 服务，不过上次见到 <a href="http://blog.donews.com/CNBorn">CNBorn</a> 同学使用 <del>git</del>（Bazzer） 做版本控制，其实知道它很早不过没有过多的了解，在我稍微了解之后发现 git 比 svn 更具潜力，可惜对于 PHP 的用户来说还没有多少人开始用 git 甚至我在 PHPChina 的论坛看到有人问 git 的问题，居然有人回答 git 是什么&hellip;</p>
<p>同样 git 支持多平台且对于 Windows 的用户也有 GUI 的管理界面。通过几天的了解是使用稍微掌握了一点入门的东西（以下都是命令行的东西，如果你想学习使用 GUI 的操作请看<a href="http://gitcasts.com/posts/git-on-windows">此讲解视频</a>）；</p>
<p>首先是下载并安装 <a href="http://git-scm.com/download">git</a>。接着设置用户标识：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="ln">1</span><span class="cl">$ git config --global user.name yourname
</span></span><span class="line"><span class="ln">2</span><span class="cl">$ git config --global user.email example@mail.com
</span></span></code></pre></div><p>然后创建一个目录作为版本库：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="ln">1</span><span class="cl">$ mkdir examplecd examplegit init
</span></span></code></pre></div><p>把本地文件同步到远程 git host 服务网站上面</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="ln"> 1</span><span class="cl"># 添加文件
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">$ git add filename
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"># 提交说明并提交
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">$ git commit -m &#39;first commit&#39;
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"># 添加到远程地址，这个地址不固定，以 git hosts 提供地址为准
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">$ git remote add origin git@example.com:username/example.git
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl"># 提交 origin 到 master
</span></span><span class="line"><span class="ln">11</span><span class="cl">$ git push origin master
</span></span></code></pre></div><p>另外，如果使用网上的 git host 服务，还涉及到设置 ssh public key 的问题，各个平台有些细微的差别，大家看 github 网站的<a href="http://github.com/guides/providing-your-ssh-key">相关帮助</a>。</p>
<p>如果你想系统的学习 git， 不妨通读下 <a href="http://roclinux.cn/?p=914">《看日记学git》系列文章</a></p>
]]></content:encoded></item><item><title>校内网，海内网，开心网用户隐私查看器</title><link>https://icyleaf.com/2008/10/the-school-network-network-happy-at-home-and-network-user-privacy-viewer/</link><pubDate>Fri, 10 Oct 2008 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2008/10/the-school-network-network-happy-at-home-and-network-user-privacy-viewer/</guid><description>更新：目前校内网已经修补了此漏洞，所以大家可以放弃了，除非你想抓住那 1% 的机会 你想查看他或她的私隐信息吗？如果你说的他或她是校内网，海内网，开...</description><content:encoded><![CDATA[<blockquote>
<p><strong>更新</strong>：目前校内网已经修补了此漏洞，所以大家可以放弃了，除非你想抓住那 1% 的机会</p>
</blockquote>
<p>你想查看他或她的私隐信息吗？如果你说的他或她是校内网，海内网，开心网的用户，那么请你尝试一下，校内网，海内网，开心网用户隐私查看器。通过这个工具，你可以轻松的获得用户的相册照片，日志文章以及状态（迷你博客）的内容。恩&hellip;趁着目前都还没有打补丁之前。不要做坏事哦～</p>
<p><strong>工具</strong></p>
<p><a href="http://labs.icyleaf.com/tools/sns_user_informations.php">校内网，海内网，开心网用户隐私查看器</a></p>
<p>此工具重点做的是校内网的功能模块，对于海内网和开心网的用户，只是显示了用户的相关链接。</p>
<p><strong>使用说明</strong></p>
<p>首先！必须先登录网站系统之后才进行操作！
无论是校内网，海内网还是开心网的用户，首先都需要获得用户的ID，那么怎么获得呢，很简单，只要打开用户的个人界面，查看地址的末尾的数字。一般会以下列的方式出现：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="ln">1</span><span class="cl">http://xiaonei.com/profile.do?id=123456
</span></span><span class="line"><span class="ln">2</span><span class="cl">http://www.hainei.com/user?r=123456
</span></span><span class="line"><span class="ln">3</span><span class="cl">http://www.kaixin001.com/home/?uid=123456
</span></span></code></pre></div><p>数字前面的就可以看出来是用户ID。获得用户ID之后，只要把用户ID填入到校内网，海内网，开心网用户隐私查看器的相应输入框，并选择是哪个网站的用户，点击”Get it!“，稍等片刻就会获得用户的相关链接。</p>
<p><strong>原理</strong></p>
<p>由于校内网和海内网均属于一个团队开发出来的，所以在系统但自身机制上的问题，可以通过地址绕过的方式查看用户的相册，日志，状态记录等等非用户资料信息。但是开心网可能考虑到用户的安全性，在默认选项上安全系数提高了一级。那么到底是哪里提供了呢，好的，我简单讲解一下，对于校内网和海内网，用户无论是创建相册还是添加日志和状态记录，默认的隐私属性（谁能浏览）为”全站用户可见”，这就导致了校内网，海内网，开心网用户隐私查看器的出现。而开心网除了日志之外，其相册，记录默认为“好友可见”。所以，可查看的资源只有日志，还有极少数的用户可能会把相册的隐私属性设置为”全站用户可见”。</p>
<p><strong>补救方法</strong></p>
<ol>
<li>等待系统的修改，或者系统可能就是为了这样&hellip;</li>
<li>手动修改&hellip;把隐私属性修改为“好友可见”或其他。</li>
</ol>
<p><strong>特别声明</strong></p>
<p>本工具只为技术交流使用，请勿做非法事情，如有此事请自己承担法律责任！切记！切记！</p>
]]></content:encoded></item><item><title>入手 HP6520</title><link>https://icyleaf.com/2008/06/buyed-hp6520/</link><pubDate>Mon, 30 Jun 2008 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2008/06/buyed-hp6520/</guid><description>前天在中关村入手的，哈哈 o(∩_∩)o&amp;hellip;惠普6520(054)，多年的梦想终于完成了，我的075Q计划延期完成，虽然晚了半年之...</description><content:encoded><![CDATA[<p>前天在中关村入手的，哈哈
o(∩_∩)o&hellip;惠普6520(054)，多年的梦想终于完成了，我的075Q计划延期完成，虽然晚了半年之久，但是能遇到一个自己喜欢的机型和价位比那个时候为了限制价格买本还是很满足的。</p>
<p>昨天把卖家给我的系统格掉了，装了自己刻的系统（WinodwsXP+Linux
Mint），由于还没有怎么测试，这里初步说一下这两天的使用感受，买本是贴了屏膜和键盘保护，外加了1G的内存，在玩奥妮之刃(oniblade)的时候音效全开，一点也不卡，画面细腻。而在玩鬼泣4PC试玩版的时候，由于本的显卡仅支持Dx9c，所以使用的这个进入的游戏，画面效果很好，跑起来却非常的卡&hellip;我不知道到哪开启帧的监测&hellip;</p>
<p>在安装一些大体积的程序（MyEclipse，PhotoShop CS3，Fireworks
CS3的时候，安装速度这叫一个快，看来那1G内存不是白加的，哈哈。</p>
<p>机器本身的音箱效果一般，就比普通的喇叭好些，而且只有在右边安放，在使用中感觉只有单声道的效果，不过我对这个并不感冒，外配一个好的耳机或外设音箱就ok了:)</p>
<p>Linux的安装也很顺利，我安装了Ubuntu和Linux
Mint，安装速度也是很快的，完成后不需要自己在另装驱动，不错。</p>
<p>另外网上所说的硬盘“嘎嘎”响的问题我这也有出现，不过是在进行读写硬盘大操作的时候才会出现，正常现象。散热效果还是蛮理想的，一下午的时候也只是温温的感觉。</p>
<p>机器基本上还没有怎么使用，现在激活电池阶段，以后就好了～～呵呵(^___^)</p>
<p>更过实物照片：<a href="https://photos.google.com/album/AF1QipOB4CrCHGUJcyRHj-79K4evKEd13xjqVKS1bY92">Picasa</a></p>
]]></content:encoded></item><item><title>标签(Tag)的数据库设计</title><link>https://icyleaf.com/2008/06/tags-database-schemas/</link><pubDate>Sat, 21 Jun 2008 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2008/06/tags-database-schemas/</guid><description>原文来自：Then each went to his own home 原文作者：Philipp Keller 译者注：本文在涉及到专业术语或者译者表达不明白的地方均会保留原英文。 最近，在del....</description><content:encoded><![CDATA[<p>原文来自：<a href="http://www.pui.ch/phred/archives/2005/04/tags-database-schemas.html">Then each went to his own home</a></p>
<p>原文作者：<a href="http://www.pui.ch/phred/about">Philipp Keller</a></p>
<p>译者注：本文在涉及到专业术语或者译者表达不明白的地方均会保留原英文。</p>
<p>最近，在<a href="http://lists.del.icio.us/pipermail/discuss/2005-April/002827.html">del.icio.us mailinglist</a>（译者按：应该是美味书签的讨论版块。以下del.icio.us翻译为<strong>美味书签</strong>）上面发了一个问题：“有人知道美味书签的数据库设计吗？”。之后我得到了一些回复，所以我想把这部分东西的知识分享给大家。</p>
<h2 id="疑问">疑问</h2>
<p>当你要为一个书签添加你认为需要的一个或多个标签时（或日志或其他）其数据库是如何设计的？然后，执行查询时取消这些书签中标签的合集（<a href="http://en.wikipedia.org/wiki/Union_%28set_theory%29">union</a>）或交集（<a href="http://en.wikipedia.org/wiki/Intersection_%28set_theory%29">intersection</a>）。也能从搜索结果中减少一些标签。</p>
<p>大致有三种不同的解决方案：（<strong>注意</strong>：如果你开发了一个网站使得任何人都可以添加标签，而且是一个较大规模的网站则请务必看下其作者写的另外一篇文章：<a href="http://www.pui.ch/phred/archives/2005/06/tagsystems-performance-tests.html">标签系统的性能测试</a>）</p>
<h2 id="mysqlicious-方法solution">“MySQLicious” 方法(solution)</h2>
<p>在这个方法中仅架构了一个表，它是去规范化（<a href="http://en.wikipedia.org/wiki/Denormalization">denormalized</a>）表。</p>
<p>这个类型被叫做“MySQLicious
方法(solution)”，因为MySQLicious使用这种结构可以把美味书签的数据导入到一个表中。</p>
<p>译者注：MySQLicious是一个把del.icio.us书签镜像到MySQL数据库中的工具。</p>
<h3 id="交集and">交集(AND)</h3>
<p>查询方式： “search+webservice+semweb”:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="ln">1</span><span class="cl">SELECT *FROM `delicious`WHERE tags LIKE &#34;%search%&#34;AND tags LIKE &#34;%webservice%&#34;AND tags LIKE &#34;%semweb%&#34;
</span></span></code></pre></div><h3 id="合集or">合集(OR)</h3>
<p>查询方式： “search|webservice|semweb”:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="ln">1</span><span class="cl">SELECT *FROM `delicious`WHERE tags LIKE &#34;%search%&#34;OR tags LIKE &#34;%webservice%&#34;OR tags LIKE &#34;%semweb%&#34;
</span></span></code></pre></div><h3 id="减少exclusion">减少(Exclusion)</h3>
<p>查询方式： “search+webservice-semweb”</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="ln">1</span><span class="cl">SELECT *FROM `delicious`WHERE tags LIKE &#34;%search%&#34;AND tags LIKE &#34;%webservice%&#34;AND tags NOT LIKE &#34;%semweb%&#34;
</span></span></code></pre></div><h3 id="结论">结论</h3>
<p>优点：</p>
<ul>
<li>只用一个表。</li>
<li>查询方式简单易懂。</li>
<li>一次就能获得全文搜索结果，可能速度快一些。</li>
<li>我猜测查询在基于[良好][]的[参数][]下是相当的快（[Peter Cooper][]的博客也提到：去规范化！去规范化！去规范化！)</li>
<li>[在我随后的日志交待使用MySQL fulltext出来有关标签的事情][]。</li>
</ul>
<p>缺点：</p>
<ul>
<li>每个书签的标签数量是有限的。通常情况下是在数据库中使用一个256字节的域（VCHAIR），否则，假设你用 <strong>Text</strong> 或类似的域，则速度将会慢下来。</li>
<li>如果你注意了（就像[Patrice][]那样）你会发现当你以 “websearch” 使用 <strong>Like “%search”</strong>  搜索标签时它也能搜索到，当你修改并使用 <strong>Like “%search%”</strong> 时你最终必须使用一个混乱的解决方法：在标签头添加一个空格，这样才能使其工作。</li>
</ul>
<h2 id="scuttle-方法solution">“Scuttle” 方法(solution)</h2>
<p>分离（Scuttle）字段，并归类到两个表中。右图表“scCategories”是一个标签表，通过一个外来的ID链接书签表。</p>
<h3 id="交集and-1">交集(AND)</h3>
<p>查询方式：“bookmark+webservice+semweb”:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="ln">1</span><span class="cl">SELECT b.*FROM scBookmarks b, scCategories cWHERE c.bId = b.bIdAND (c.category IN (&#39;bookmark&#39;, &#39;webservice&#39;, &#39;semweb&#39;))GROUP BY b.bIdHAVING COUNT( b.bId )=3
</span></span></code></pre></div><p>首先，当搜索的标签为“bookmark”，“webservice“或“semweb”（例如：<strong><code>c.category IN ('bookmark', 'webservice', 'semweb')</code></strong> ）时所有名为&quot;bookmark&quot;的标签都会被搜索，然后所有包含这三个标签的书签将筛选出来 (<strong><code>HAVING COUNT(b.bId)=3</code></strong>)。</p>
<h3 id="合集or-1">合集(OR)</h3>
<p>查询方式：“bookmark|webservice|semweb”:</p>
<p>Just leave out the <code>HAVING</code> clause and you have union:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="ln">1</span><span class="cl">SELECT b.*FROM scBookmarks b, scCategories cWHERE c.bId = b.bIdAND (c.category IN (&#39;bookmark&#39;, &#39;webservice&#39;, &#39;semweb&#39;))GROUP BY b.bId
</span></span></code></pre></div><h3 id="减少exclusion-1">减少(Exclusion)</h3>
<p>查询方式：“bookmark+webservice-semweb”，意味着：<code>bookmark AND webservice AND NOT semweb</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="ln">1</span><span class="cl">SELECT b. *FROM scBookmarks b, scCategories cWHERE b.bId = c.bIdAND (c.category IN (&#39;bookmark&#39;, &#39;webservice&#39;))AND b.bId NOTIN (SELECT b.bId FROM scBookmarks b, scCategories c WHERE b.bId = c.bId AND c.category = &#39;semweb&#39;)GROUP BY b.bIdHAVING COUNT( b.bId ) =2
</span></span></code></pre></div><p>省略掉 <strong><code>HAVING COUNT</code></strong> 会导致搜索方式变为“bookmark|webservice-semweb”.</p>
<p>信息来源：[Rhomboid][]写的[helping me out with this query][].</p>
<h3 id="结论-1">结论</h3>
<p>我猜测这个解决方案主要有利点是使得他更正常化，比第一个解决方案比较而言，好处在于可以为每一个书签添加无限数量的标签。</p>
<h2 id="toxi-方法solution">“Toxi” 方法(solution)</h2>
<p>[Toxi][] 提出了一个三个表的结构，通过表”tagmap“的书签和标签的n-to-m关联。每一个标签都可以在不同的书签一期使用，反之亦然。这种数据库结构也被用在[Wordpress][]之中。</p>
<h3 id="交集and-2">交集(AND)</h3>
<p>查询方式：“bookmark+webservice+semweb”</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="ln">1</span><span class="cl">SELECT b.*FROM tagmap bt, bookmark b, tag tWHERE bt.tag_id = t.tag_idAND (t.name IN (&#39;bookmark&#39;, &#39;webservice&#39;, &#39;semweb&#39;))AND b.id = bt.bookmark_idGROUP BY b.idHAVING COUNT( b.id )=3
</span></span></code></pre></div><h3 id="合集or-2">合集(OR)</h3>
<p>查询方式：“bookmark|webservice|semweb”</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="ln">1</span><span class="cl">SELECT b.*FROM tagmap bt, bookmark b, tag tWHERE bt.tag_id = t.tag_idAND (t.name IN (&#39;bookmark&#39;, &#39;webservice&#39;, &#39;semweb&#39;))AND b.id = bt.bookmark_idGROUP BY b.id
</span></span></code></pre></div><h3 id="减少exclusion-2">减少(Exclusion)</h3>
<p>查询方式：“bookmark+webservice-semweb”，意味：bookmark AND webservice AND NOT semweb.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="ln">1</span><span class="cl">SELECT b. *FROM bookmark b, tagmap bt, tag tWHERE b.id = bt.bookmark_idAND bt.tag_id = t.tag_idAND (t.name IN (&#39;Programming&#39;, &#39;Algorithms&#39;))AND b.id NOT IN (SELECT b.id FROM bookmark b, tagmap bt, tag t WHERE b.id = bt.bookmark_id AND bt.tag_id = t.tag_id AND t.name = &#39;Python&#39;)GROUP BY b.idHAVING COUNT( b.id ) =2
</span></span></code></pre></div><p>省略掉 <strong><code>HAVING COUNT</code></strong> 会导致搜索方式变为“bookmark|webservice-semweb”.</p>
<p>信息来源：[Rhomboid][]写的[helping me out with this query][].</p>
<h3 id="结论-2">结论</h3>
<p>优点：</p>
<ul>
<li>可以为每个标签节省额外的信息（描述，分类等）</li>
<li>这是一个最正常化的解决方案（即，第三范式：[3NF][]）</li>
</ul>
<p>缺点：</p>
<ul>
<li>
<p>当修改或删除书签后，需要删除中间表的相应数据（When altering or deleting bookmarks you can end up with tag-orphans）。</p>
<p>如果你想要更复杂的查询，比如”<strong>(bookmarks OR bookmark) AND (webservice or WS) AND NOT (semweb or semanticweb)</strong>“这样的查询语句，我建议参见以下查询/计算过程：</p>
</li>
</ul>
<ol>
<li>为每一个标签出现在你的”“tag-query”时执行一个查询（Run a query for each tag appearing in your
“tag-query”）：<strong><code>SELECT b.id FROM tagmap bt, bookmark b, tag t WHERE bt.tag_id = t.tag_id AND b.id = bt.bookmark_id AND t.name = &quot;semweb&quot;</code></strong></li>
<li>把每一个编号集从结果中导到一个数值里面（使用你喜欢的编码语言），这样可以缓存你想要的数组。</li>
<li>使用合集或交集或其他方式限制数组。</li>
</ol>
<p>通过这种方式，你也可以查询<code>&quot;(del.icio.us|delicious)+(semweb|semantic_web)-search&quot;，这种类型的查询（即，括号内）利用去规范化的</code>“MySQLicious solution”<code>不能这样做。</code></p>
<p>这是最灵活的数据结构和我猜想它的效果相当好（即，使用一些缓存技术）。<!-- raw HTML omitted --></p>
<p><strong>2006年5月更新</strong>：这篇文章获得了大家的注视。我真的不是为此而准备的！看来大家不断的提到了他，甚至一些网站转载我的文章，我认为，这些不同方式的理论的知识应该归功于：[MySQLicious][],
[scuttle][], [Toxi][]以及所有参与并贡献的评论者（请务必阅读！）</p>
<p>p.s. 感谢[Toxi][]发给我关于三个表结构的疑问，Benjamin
Reitzammer为我指点的[文章][]（一个很好的标签查询参考）和powerlinux提供的[scuttle][]指引。</p>
<h2 id="扩展阅读">扩展阅读</h2>
<ul>
<li>
<p>[Taglist: a mailing list dedicated to schemas with tagging][]</p>
</li>
<li>
<p>[Tagschema: A blog dedicated to tagging schemas][]</p>
</li>
<li>
<p>[Tag-related Queries on Snippets][]</p>
</li>
<li>
<p>[Freetag][] is a php “library” with which you can add tags to whatever object you like. It actually uses the “toxi schema”.</p>
</li>
<li>
<p>Hammy [gives an insight][] how he did his tagging system with “less DB and more code” (that is: regular expressions), interesting!</p>
</li>
<li>
<p>Brad Choate [has got some ideas][] which tag queries should be possible</p>
</li>
<li>
<p>Feedmaker has written [a sort of reply to this article][]</p>
<p>[]: <a href="http://www.pui.ch/phred/modules/mysqlicious_structure.png">http://www.pui.ch/phred/modules/mysqlicious_structure.png</a>
[1]: <a href="http://www.pui.ch/phred/modules/mysqlicious_data.png">http://www.pui.ch/phred/modules/mysqlicious_data.png</a>
[良好]: <a href="http://www.pui.ch/phred/archives/2005/04/tags-database-schemas.html#comment-57">http://www.pui.ch/phred/archives/2005/04/tags-database-schemas.html#comment-57</a>
[参数]: <a href="http://www.pui.ch/phred/archives/2005/04/tags-database-schemas.html#comment-62">http://www.pui.ch/phred/archives/2005/04/tags-database-schemas.html#comment-62</a>
[Peter Cooper]: <a href="http://www.petercooper.co.uk/archives/000648.html">http://www.petercooper.co.uk/archives/000648.html</a>
[在我随后的日志交待使用MySQL fulltext出来有关标签的事情]: <a href="http://www.pui.ch/phred/archives/2005/05/tags-with-mysql-fulltext.html">http://www.pui.ch/phred/archives/2005/05/tags-with-mysql-fulltext.html</a>
[Patrice]: <a href="http://www.pui.ch/phred/archives/2005/04/tags-database-schemas.html#comment-63">http://www.pui.ch/phred/archives/2005/04/tags-database-schemas.html#comment-63</a>
[2]: <a href="http://www.pui.ch/phred/modules/scuttle_structure.png">http://www.pui.ch/phred/modules/scuttle_structure.png</a>
[Rhomboid]: <a href="http://www.metafilter.com/user/26222">http://www.metafilter.com/user/26222</a>
[helping me out with this query]: <a href="http://ask.metafilter.com/mefi/34897#544185">http://ask.metafilter.com/mefi/34897#544185</a>
[3]: <a href="http://www.pui.ch/phred/modules/toxi_structure.png">http://www.pui.ch/phred/modules/toxi_structure.png</a>
[Toxi]: <a href="http://toxi.co.uk/">http://toxi.co.uk/</a>
[Wordpress]: <a href="http://wordpress.org/">http://wordpress.org/</a>
[3NF]: <a href="http://en.wikipedia.org/wiki/3NF">http://en.wikipedia.org/wiki/3NF</a>
[MySQLicious]: <a href="http://nanovivid.com/projects/mysqlicious/">http://nanovivid.com/projects/mysqlicious/</a>
[scuttle]: <a href="http://sourceforge.net/projects/scuttle/">http://sourceforge.net/projects/scuttle/</a>
[文章]: <a href="http://laughingmeme.org/archives/002918.html">http://laughingmeme.org/archives/002918.html</a>
[Taglist: a mailing list dedicated to schemas with tagging]: <a href="http://lists.tagschema.com/mailman/listinfo/tagdb">http://lists.tagschema.com/mailman/listinfo/tagdb</a>
[Tagschema: A blog dedicated to tagging schemas]: <a href="http://tagschema.com/blogs/tagschema/">http://tagschema.com/blogs/tagschema/</a>
[Tag-related Queries on Snippets]: <a href="http://www.bigbold.com/snippets/tags/tagging">http://www.bigbold.com/snippets/tags/tagging</a>
[Freetag]: <a href="http://www.getluky.net/freetag/">http://www.getluky.net/freetag/</a>
[gives an insight]: <a href="http://hellojoseph.com/tags-howto.php">http://hellojoseph.com/tags-howto.php</a>
[has got some ideas]: <a href="http://bradchoate.com/weblog/2004/10/06/delicious">http://bradchoate.com/weblog/2004/10/06/delicious</a>
[a sort of reply to this article]: <a href="http://blog.feedmarker.com/2005/04/26/tagging-in-mysql/">http://blog.feedmarker.com/2005/04/26/tagging-in-mysql/</a></p>
</li>
</ul>
]]></content:encoded></item><item><title>如何制定免费短信提醒新邮件</title><link>https://icyleaf.com/2008/06/how-to-prepare-for-free-sms-alerts-for-new-mail/</link><pubDate>Mon, 16 Jun 2008 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2008/06/how-to-prepare-for-free-sms-alerts-for-new-mail/</guid><description>邮箱每个人都有，而且大部分应该还不只一个而已，分类使用，工作用一个，生活用一个，申请会员/社区再用一个&amp;hellip;.不过多少个一般都会有...</description><content:encoded><![CDATA[<p>邮箱每个人都有，而且大部分应该还不只一个而已，分类使用，工作用一个，生活用一个，申请会员/社区再用一个&hellip;.不过多少个一般都会有一个比较重要的，和朋友交流的email。比如我，平时和朋友聊天以及WordPress的留言自动邮件都是发到一个指定的邮件里。一旦到了周六，周日休息的时候，可能会错过一些重要的邮件，而用手机上网收发邮件虽然可以，但是我们总可能一直在刷新吧，所以几天突然想起来邮箱都是由自动转发功能的，那么利用什么做中间介质发短信通知到自己的手机上呢？</p>
<p>中国移动间接的为我们提供了一个非常棒的服务：<a href="http://mail.139.com">手机邮箱(</a>又名139邮箱)，中国移动免费提供1G的服务，直接申请就可以了，然后无论什么时候，只要139邮箱有了新邮件，它就会发一个免费短信到自己的手机上，而且还支持在手机上阅读哦！那么我们开始行动吧。</p>
<p><strong>如果你要设定转发所有的邮件请按照这个步骤：</strong></p>
<p>这里我拿Gmail做例子，点击设置（settings）-&gt; 转发和POP/IMAP（Forwarding and POP/IMAP）。
勾选“转发邮件副本到（Forward a copy of incoming mail to）”再在后面填写上你的手机邮箱填上，在保存即可。</p>
<p><strong>如果你要设定转发符合条件的邮件请按照这个步骤：</strong></p>
<p>同样以Gmail为例子，点击设置（settings）-&gt;过滤器（Filters），点击新建过滤器（Create a new filter)，
然后根据提示的配置框填写你指定的参数即可，填写完成后，点击”测试搜索&quot;可以预览你的设置是否符合你的要求，如果没有达到，请重新设置，再测试，直到达成你的要求后点击下一步，然后勾选倒数第二项，“转发到（Forward it to）”然后再在后面填写上你的手机邮箱填上，在保存即可。</p>
<p>注意：<strong>这两个方法不能同时实现，任选其一</strong>。</p>
<p>再找一个邮件测试下，一会你就能听到自己手机的短信铃声咯～祝大家好运!</p>
]]></content:encoded></item><item><title>北京的卤煮</title><link>https://icyleaf.com/2008/05/beijings-lu-zhu/</link><pubDate>Mon, 26 May 2008 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2008/05/beijings-lu-zhu/</guid><description>卤煮火烧在北京是一种尽人皆知的食品，它是将火烧和炖好的猪肠和猪肺放在一起煮（有时也用猪腰子），买一碗主食副食和热汤都有了。 据我所知，这火烧每...</description><content:encoded><![CDATA[<blockquote>
<p>卤煮火烧在北京是一种尽人皆知的食品，它是将火烧和炖好的猪肠和猪肺放在一起煮（有时也用猪腰子），买一碗主食副食和热汤都有了。</p>
</blockquote>
<p>据我所知，这火烧每个地方都是不一样的，有的甚至都不是一个种东西，天津的烧饼有些像千层饼，北京的这个卤煮火烧我感觉和发面饼差不多-
-！上次去西单明珠商场6楼吃过一次卤煮火烧，不知道就是那样，还是我买的那家不正宗，蛮难吃的&hellip;.刚才在豆瓣溜达的时候发现了，一个介绍<a href="http://www.douban.com/group/beijingluzhu/">北京卤煮的小组</a>，到目前也只有2个帖子。我无耻的人家的辛苦劳动扒了过来。同时感谢<a href="http://www.douban.com/group/beijingluzhu/">北京卤煮的小组</a>的组长让我知道了真正的卤煮，回来有时间一定再去尝尝。</p>
<p>历数北京小吃，只要没有宗教禁忌的，顶多五个之内就会数到卤煮火烧，好这口儿的人都亲切地称它“卤煮”。跟豆汁儿不一样的是这不是北京独有，在新疆喀什和
乌鲁木齐的夜市上有与其非常相似的做法跟馍一同沉浮的是羊下水，也巨香，西安的著名小吃“葫芦头泡馍”大约也可以归入这类。北京过去还有一种叫赵火烧的，
也类似现如今的这一口吃食。</p>
<p>据说卤煮二字的意思就是与多种香料同煮，火烧二字则说明了其主料。卤煮火烧是从宫廷的苏造肉演变而来，为降低成本，把五花肉换成了下水，
既顶事儿又价廉，因而深得俺们这类贫苦大众的喜爱。具体制作过程是这样的：把处理好的猪小肠和猪肺投入用多种香料、调料配制的卤汤煮，快好时放入死面火
烧、炸豆腐片，待到肠、肺烂熟，火烧煮透又不脱形的时候捞出，小肠切段，肺、火烧、炸豆腐切块，浇卤汁，加蒜汁、酱豆腐汁、香菜，醋、辣椒油根据口味自行
添加。得和~</p>
<p>看起来不复杂，做起来可费了劲儿了，再加上这东东又不贵，所以大多数人都在外头吃，除了我，没听说过几个自己做的。</p>
<p>一，气味</p>
<p>猪小肠毕竟处于消化道的偏下位置，所以一定要洗得干净。洗不干净的话，煮出来的异味儿是加多少蒜汁、辣椒都压不下去的</p>
<p>二，火候</p>
<p>小肠要煮至烂软，不能跟橡皮筋似的嚼不断、吞不下；火烧要煮到吸足卤汤，切开以后没有白碴儿，但也不能表层与内层完全分离脱落，变成一锅烂粥；炸豆腐要外硬里软，充满空洞</p>
<p>三，分量</p>
<p>既然是劳苦大众的享受，就一定要分量够，而且最好吃也相对最贵的小肠所占比例越高越好。师傅们经年累月地干同一件事情，早就熟能生巧了，别看不象肯德基、麦当劳似的有定量的控制，可一份菜底儿该加多少肠、多少肺头，手底下都跟有杆秤似的</p>
<p>京城的所有卤煮店里，最负盛名的毫无疑问就是前门的陈记卤煮小肠了，如今已经搬到了取灯胡同。卤煮火烧是一口儿重的吃食儿，所以得多加蒜
汁儿和香菜，最好再配上一“小二”，倒不是说啤的镇不住，主要是忒占地儿。既然是下水货，您就甭太拿自个儿的解剖知识当回事儿，要夹起块肺头就琢磨：这白
了咕叽的一小截管子究竟是气管还是支气管呢？然后试图把几块东西拼到一起恢复猪的某器官，那这顿饭就甭吃了。“吱溜”走一口白酒，夹块肥肠儿，半寸长的香
菜杆儿在口中脆响，这会儿要有人问您：“吃鱼翅么？”估计您得回一句：“鱼翅是谁？”</p>
<p>陈记卤煮小肠店（又名<strong>小肠陈</strong>）</p>
<p>地址: 北京崇文区（<strong>前门</strong>）取灯胡同东口</p>
<p>还有一份北京卤煮点的详单：<a href="http://www.douban.com/group/topic/2867917/">北京卤煮店一览</a></p>
]]></content:encoded></item><item><title>CSS 中 background-image 的另类使用</title><link>https://icyleaf.com/2008/05/css-background-image-in-the-use-of-alternative/</link><pubDate>Sat, 10 May 2008 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2008/05/css-background-image-in-the-use-of-alternative/</guid><description>在CSS众多的样式当中，background可以说是扮演着重要的角色，它可以设置对象的背景样式。如颜色或者使用一张图片代替，今天我要多说两句...</description><content:encoded><![CDATA[<p>在CSS众多的样式当中，background可以说是扮演着重要的角色，它可以设置对象的背景样式。如颜色或者使用一张图片代替，今天我要多说两句的就是使用一张图片的参数：image。准确的来说应该是background-image。我们可以这样用它：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="ln">1</span><span class="cl">body{background-image: url(http://www.icyleaf.cn/logo.jpg);
</span></span></code></pre></div><p>这都是可以的，所以说css的自由度很高，这点我很喜欢。其实css显示图片分3种，第一种是单纯的显示一个图片；第二种称之为<strong>CSS Sprites</strong>，也就是说把若干小图片合成一个大图片，然后通过background的postion参数实现效果，第三种就是我们今天说的另类用法，它也有学名称之为<strong>Inline images</strong>。实现声明一点，这个方法不适用于IE浏览器，恩，没错，IE，我们都遗弃你了。（关于CSS Sprites 的描述信息来自<a href="http://7career.org/2008/02/hpws-1.html">7career.org</a>）</p>
<p>CSS Sprites是一种把所有的图片都以base64编码以源代码的形式写在CSS文件里，格式是这样的：<strong>data:[&lt;mediatype&gt;][;base64],<!-- raw HTML omitted --></strong></p>
<p><code>data:URL</code> 标签是在1995年第一次提出，按<a href="http://tools.ietf.org/html/rfc2397">RFC2397规范的描述</a>：它是&quot;allows
inclusion of small data items as &lsquo;immediate&rsquo; data.（允许在页面中包含一些小的即时数据）&quot;。如一个内嵌的的图片可以这样引用：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="ln">1</span><span class="cl">body{background-image:url(data:image/gif;base64,R0lGODlhCAAIAJEAAOnp6eTk5O7m8AAAACH5BAEAAAIALAAAAAAIAAgAAAINjAMJh2q6DnxOVsqmLQA7);}
</span></span></code></pre></div><p>这段代码可以在firefox浏览器运行，恩，图片是我取自[mg12][]当前模板的背景图，呵呵(^___^)</p>
<p>base64编码简单的说是，Base64内容传送编码被设计用来把任意序列的8位字节描述为一种不易被人直接识别的形式。最早使用在windows系统的电子邮件传输的，主要是附件的传输。在那个时候的黑客们也流行过一段base64编码版的木马和病毒。为了简单篇幅，想了解的看<a href="http://www.5dmail.net/html/2004-1-30/200413084348.htm">这里</a>。</p>
<p>第一次我也是通过这个方法获取的图片的base64编码，主要原因是网上没有现成的转换这种编码的工具，估计已经被大家所遗忘掉了。我这里简单的写了个PHP代码，实现了图片编码的转换：</p>
<p>这个在线转换的背景就是上面那段代码，大家可以通过查看网页源码看到。图片的代码转换原理也很简单，通过读取图片的文件并把图片储存在一个数组（或字符串）里面，然后使用base64_encode转换即可～ok，讲解完毕。</p>
]]></content:encoded></item><item><title>防止电脑操作者患上职业病</title><link>https://icyleaf.com/2008/04/prevention-of-occupational-diseases-computer-operator/</link><pubDate>Tue, 15 Apr 2008 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2008/04/prevention-of-occupational-diseases-computer-operator/</guid><description>早餐应吃好，营养充分，以保证旺盛的精力，并有足够的热量。 中餐应多吃含蛋白质高的食物，如瘦猪肉、牛肉、羊肉、鸡鸭、动物内脏、各种鱼、豆类及豆制...</description><content:encoded><![CDATA[<p>早餐应吃好，营养充分，以保证旺盛的精力，并有足够的热量。
中餐应多吃含蛋白质高的食物，如瘦猪肉、牛肉、羊肉、鸡鸭、动物内脏、各种鱼、豆类及豆制品。
晚餐宜清淡，多吃含维生素高的食物，如各种新鲜蔬菜，饭后吃点新鲜水果。</p>
<p>同时，选用含磷脂高的食物以利健脑，例如蛋黄、鱼、虾、核桃、花生等。</p>
<p>还要有意识多选用保护眼睛的食物、保护眼睛健康，防止近视及其他眼疾，健眼的食物有各种动物的肝脏、牛奶、羊奶、奶油、小米、核桃、胡萝卜、青菜、菠菜、大白菜、西红柿、黄花菜、空心菜、枸杞子及各种新鲜水果。</p>
<p>此外，电脑操作者在工作1-2个小时后，应活动一下全身，做眼保健操，只要注意膳食结构和劳逸结合，就能增强身体的抵抗力，防止有关疾病发生。</p>
<p>“网清茶”又称“电脑茶”,采用以湖北神农架原始决明子、枸杞子、桑叶、菊花和富硒野山茶等为主料，经过现代生物技术精心加工而成。它含有丰富的人体所需决明素(obtusin)、枸杞多糖（LBP）、β-胡萝卜素、维生素A、VC、VE、茶多酚(Camellia sinensis)等天然抗氧化物，能迅速清除体内过量的自由基，阻止脂质过氧化，具抗辐射、消除疲劳、明目健脑和排毒养颜作用，能有效解决电磁辐射引起的电脑网络综合症。</p>
<p>老用电脑的人，健康会受到多方面的危害。除了不可避免地要接触到电磁辐射外，电脑荧光屏的频繁闪动对眼睛也有较强的刺激作用，让人出现流泪、视力减退、头昏脑涨等不适症状。平时多喝绿茶不仅能起到一定的抗辐射作用，还可以让你的眼睛更舒服一些。</p>
<p>绿茶中含有的维生素C、维生素E，特别是茶多酚，具有很强的抗氧化活性，可以清除人体内的氧自由基，从而起到抗辐射、增强机体免疫力的作用。此外，茶叶中含有胡萝卜素，它在肠壁和肝脏的作用下，可以转变为维生素A。而维生素A具有滋养眼睛、缓解视疲劳、防治夜盲症的作用。</p>
<p>茶叶对人体造血机能也有显著的保护作用。二战期间，美国向日本的广岛、长崎上空投掷原子弹后，辐射给那里的人带来了巨大的健康危害。但科学家调查发现，原来有饮茶习惯的人，受辐射损伤较轻，血液病发病率较低，由辐射所引起的死亡率也较低。所以，日本人又把茶称之为“原子时代的饮料”。</p>
<p>不久前，英国科学家研究还发现，喝茶可以阻止人体中一种酶的合成，这种酶会破坏脑细胞间传递信息的媒介乙酰胆碱。因此，喝茶对常用电脑的上班族来说，又多了项好处——使大脑更敏。</p>
]]></content:encoded></item><item><title>脖子落枕怎么办及治疗方法</title><link>https://icyleaf.com/2008/04/how-do-stiff-neck-and-neck-treatment/</link><pubDate>Sun, 06 Apr 2008 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2008/04/how-do-stiff-neck-and-neck-treatment/</guid><description>前天在朋友家过夜，他的枕头好硬，硬的可以和石头相比较，第二天直接，脖子落枕&amp;hellip;脖子落枕真的是很难受啊，如何治疗呢？在网上搜了下*...</description><content:encoded><![CDATA[<p>前天在朋友家过夜，他的枕头好硬，硬的可以和石头相比较，第二天直接，脖子落枕&hellip;脖子落枕真的是很难受啊，如何治疗呢？在网上搜了下**.落枕**是指人在睡觉或外伤后突感颈部肌肉疼痛，尤以头颈部转动时更甚，引起落枕的原因有：</p>
<ol>
<li>睡眠时头颈姿势不当；</li>
<li>枕头垫得过高、软硬不当或高低不平；</li>
<li>颈部外伤；</li>
<li>颈部受风着凉；</li>
<li>如为颈椎病引起，可反复“落枕”。</li>
</ol>
<p>最难受的这落枕，好则一天就能恢复，坏则两三天还是很疼，很难受，唔，我就是后者，好长时间没有落枕过了&hellip;人一生中难免不发生落枕，落枕后自感痛苦，由于它可以“自愈”，很少有人去医院就诊，大部分病人是在家人或同事帮助下进行简易处理，家庭护理显得更为重要。
下面摘几则治疗的方法：</p>
<p><strong>按摩</strong>：立落枕者身后，用一指轻按颈部，找出最痛点，然后用一拇指从该侧颈上方开始，直到肩背部为止，依次按摩，对最痛点用力按摩，直至感明显酸胀即
表示力量已够，如此反复按摩2～3遍，再以空心拳轻叩按摩过的部位，重复2～3遍。重复上述按摩与轻叩，可迅速使痉挛的颈肌松弛而止痛。</p>
<p><strong>热敷</strong>：采用热水袋、电热手炉、热毛巾及红外线灯泡照射均可起到止痛作用。必须注意防止烫伤。</p>
<p><strong>选用正红花油</strong>、甘村山风湿油、云香精等，痛处擦揉，每天2～3次，有一定效果。</p>
<p>伤湿止痛膏、膨香止痛音外贴颈部痛处，每天更换一次，止痛效果较理想，但病人自感贴膏后颈部活动受到一定限制，孕妇忌用。</p>
<p><strong>耳针</strong>：耳针埋穴于颈、枕区，以食指尖按压上述耳穴5～10分钟，或以食指端按摩上述耳穴。</p>
<p><strong>针刺</strong>：不能前后俯仰者，取大抒、京骨穴、昆仑穴；不能左右回顾者，取肩外俞、后溪、风池穴。一般可取悬钟穴，位于足外洞上三寸，针4～5分，灸3～7壮，亦可按摩此穴，每次15分钟。</p>
<p><strong>口服去痛片1片</strong>，有临时止痛之效。</p>
<p><strong>改变睡眠姿势</strong>，调整枕头高低，自己扭动脖子。</p>
<p><strong>如为颈椎病引起</strong>，在体疗科医师指导下，进行家庭自我颈椎牵引疗法。</p>
<p><strong>落枕严重者</strong>，局部注射025％奴夫卡因10毫升，止痛效果明显。</p>
<p>另外提供按摩治疗法：</p>
<ol>
<li>将左手或右手中、食、无名指并拢，在颈部疼痛处寻找压痛点（多在胸锁乳突肌、斜方肌等处），由轻到重按揉5分钟左右。可左右手交替进行。</li>
<li>用小鱼际由肩颈部从上到下，从下到上轻快迅速击打两分钟左右。</li>
<li>用拇指和食指拿捏左右风池穴、肩井穴1－2分钟。</li>
<li>以拇指或食指点按落枕穴（手背第2、3掌骨间，指掌关节后5分处），待有酸张感觉时再持续2－3分钟。</li>
<li>最后进行头颈部前屈、后仰、左右侧偏及旋转等活动，此动作应缓慢进行，切不可用力过猛。</li>
</ol>
<p>像我这一个人生活的只有选择按摩和热敷，多做些颈部活动好了&hellip;.</p>
]]></content:encoded></item><item><title>如何使用VirtualBox安装Linux系统</title><link>https://icyleaf.com/2008/03/how-to-use-linux-systems-installed-virtualbox/</link><pubDate>Thu, 13 Mar 2008 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2008/03/how-to-use-linux-systems-installed-virtualbox/</guid><description>VirtualBox也已经介绍过了， 昨天是实实在在的用VirtualBox体验了一下 Linux Mint 系统。 这篇日志我就大概的说下如何用VirtualBo...</description><content:encoded><![CDATA[<p><a href="http://www.icyleaf.cn/2008/03/12/virtualbox-free-cross-platform-open-source-virtual-machine/">VirtualBox</a>也已经介绍过了，
昨天是实实在在的用VirtualBox体验了一下 <a href="http://www.linuxmint.com/">Linux Mint</a> 系统。
这篇日志我就大概的说下如何用VirtualBox安装和汉化Linux Mint系统，大家先看一个经过简单设置有的效果图：</p>
<p>这个背景是系统自带的一个，呵呵(^___^)，在介绍 <a href="http://www.icyleaf.cn/2008/03/12/virtualbox-free-cross-platform-open-source-virtual-machine/">VirtualBox</a>
的文章里面的截图是系统默认的背景。那么如何使用 VirtualBox 安装 Linux 系统呢，其实很简单的，
VirtualBox 这个软件从官方网站下载的时候看似是英文的，其实他支持多国语言，安装之后它就会因系统的语言而变化，
Linux Mint 系统就从官方上面下载最新版本的镜像文件就可以了，当前最新版本是4.0。
这里我就不复述下载的过程~~</p>
<p>两者都下载并安装VirtualBox之后，打开它的界面，点菜单的“新建”，安装向导的指示下一步有序操作：先点“下一步”，在随后出来的窗口的名称填入你喜欢的名字，
如Linux Mint或者其他以便自己识别，在系统类型里面他并没有列出具体的Linux的发行版号，只能靠内核的版本确定，这里LinuxMint的内核是Linux2.6。接着是配置虚拟内存，
如果你机器的实际内存比较大如1G以上，可以配置虚拟内存到400M-512M。再下一步是设置虚拟硬盘，第一次使用是没有硬盘存在，需要”新建&quot;，如果你不是第一次添加，
则通过它的下拉菜单可选是那块虚拟硬盘。如果你是初级用户，在新建硬盘的时候，选择“动态扩展硬盘”即可，现在就完成了运行前的操作。</p>
<p>之后直接点击菜单的“启动”就可以了，恩，没错直接启动就可以。VirtualBox提供了一个人性化的设置，如果你使用的是一个新建的虚拟硬盘，在它首次允许之后会弹出一个“首次运行向导”让你选择引导方式。恩，这和VM有些差别，VM提供一个虚拟的BIOS程序，而VrtualBox没有，不过他提供了一个开机引导方式的快捷键<strong>F12</strong>，而且也支持LAN的方式，这点很强。</p>
<p>在“首次允许向导”的戒指位置选择上图的操作，并在下拉菜单选择今天我们要按照的LinuxMint硬盘就可以了。
从下图可以看出来，虽然LinuxMint系统是基于Ubuntu系统开发的，但是它默认并不支持多国语言，仅仅只有英语：</p>
<p>我们选择“Start Linux Mint&quot;启动系统，这就是像LiveCD版的了，随后会进行系统加载并进入到界面，点击桌面的”Install“会出现一个和Ubuntu以及gOS一样的安装系统的窗体，如果你安装过gOS，也许你会在网上搜如何汉化，他们的汉化方式有些变态，其实也是正确的，在选择系统语言环境的时候在选择框的倒数第二个是简体中文，但是如果你选择了，整个的界面全部会变成乱码。这样不利于我们的操作，所以我采取使用默认的英文，在安装好系统之后再进行汉化，相比之下，英文肯定比看乱码舒服多了。呵呵(^___^)</p>
<p>Linux Mint安装就很简单了，我就不用说了吧，网上搜搜Ubuntu是如何安装的就知道了～嘿嘿，我就不多打字了～记得找LiveCD的安装教程，Ubuntu还提供了一个文本安装的方式：）</p>
<p>安装完成之后，在登录界面输入完成你在安装时设置的用户名和密码随后会弹出一个询问向导。主要是为了提示是否开启Root并设置密码以及设置终端在打开时是否随机显示一段英文短句（我没自己看写的是什么），对于root一定要开启并设置一个密码，因为Linux的安全机制问题，尤其涉及到后面的安装软件问题，非常重要哦！</p>
<p>登录界面之后，首先是要解决中文化的问题，首先确保你的机器已经连接到了互联网上面。连上网之后再进行操作：点击左下角的Mint图标，其实和Windows系统差不多，
选择里面的”Control Center“，在弹出的窗口寻找”Language Support“。随后Language Support窗口会扫描当然的语言文件，
已经提示是否下载，我们选择”Let me later&quot;，然后再Supported Language列表中寻找Chinese，并在它后面的方框点击选中，然后再点Apply（应用），程序会从网上下载系统的程序的中文语言文件。这个时候我们就等待吧，如果网速好的话差不多，一杯咖啡的时间：）</p>
<p>下载完成之后，点击“OK”并关闭Linux Mint系统，其实是要重启，为什么要先关闭呢，因为现在还是开机光盘引导，当然我们要去掉光盘引导。先选择你要启动的系统，
然后点击菜单的“设置”，在左侧的列表选择“光驱&quot;之后去掉右边的”加载光驱“，然后再保存。之后就可以启动系统了，启动到grub菜单，选择第一个正常启动。第二个是安全模式，不过我没进去过&hellip;菜单选择时间默认是4秒。</p>
<p>又到了登录界面，我们先不急于登录，而是选择登录界面的&quot;Language&quot;，在选择语言窗口选择”Chinese（China Mainland）“，
在点”Change Language“。系统立即弹出一个窗口，询问是否在以后登录也使用改变后的语言，我们当然是选择是了，之后我们看到我们熟悉的中国字了！尽情享受吧。</p>
<p>不过他的中文化也不是非常的完美的，不过还有些地方并没有得到汉化，对于日常的使用并没有什么影响的。
昨天我在Linux Mint下面安装了不少的东西：SciTE，komodo edit，甚至VirtualBox，本来想在Linux下虚拟一个XP，
无奈的是不想再下一个600多M的镜像了&hellip;不过我还是特别想看到XP虚拟跑Linux,再在虚拟的Linux在虚拟XP，这个场面肯定很壮观，哈哈 o(∩_∩)o&hellip;</p>
<p>同时也希望我这简单的教程对大家会有所帮助：）</p>
]]></content:encoded></item><item><title>家常饭：炒馍</title><link>https://icyleaf.com/2008/03/family-meal-a-large-sum-of-speculation/</link><pubDate>Mon, 03 Mar 2008 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2008/03/family-meal-a-large-sum-of-speculation/</guid><description>恩，这几天闹肚子，不知道是我生日那天吃肉太多的关系还是昨天晚上吃臊子面的问题，今天是好难受&amp;hellip; 今中午也没敢在外面吃，空着肚子到现...</description><content:encoded><![CDATA[<p>恩，这几天闹肚子，不知道是我生日那天吃肉太多的关系还是昨天晚上吃臊子面的问题，今天是好难受&hellip;</p>
<p>今中午也没敢在外面吃，空着肚子到现在，现在特想吃我爸爸做的炒馍，可惜人在外地，一会自己摸索着做吧&hellip;</p>
<p>这就是炒馍咯，网上称这个叫做炒馍花&hellip;呃，真的很不好听&hellip;</p>
<p>下面是我认为的做法：以后称之为王氏菜谱，娃哈哈～～～～</p>
<p><strong>一、准备材料</strong></p>
<p>主料:馍（也称馒头）1-2个馒头</p>
<p>辅料:鸡蛋1-2个，大葱或者蒜苗少许，也可以用番茄1个</p>
<p>调料:盐，味精（或鸡精），花生油，也可以用十三香</p>
<p><strong>二、做法</strong></p>
<p>1.凉馒头，一定要是凉的，要不炒的时候会一塌糊涂的，切成小块。</p>
<p>最好选择硬一些的馒头，这样炒出来的馍花口感更好。</p>
<p>2.准备鸡蛋，打开放入碗中，放少许盐搅拌至起泡；洗葱并切成细丝备用。</p>
<p>如果使用番茄的话就洗净切小块备用。</p>
<p>3.热油，把搅拌后的鸡蛋放入锅中，并放入切好的葱花放入锅中，之后馒头块下去，加盐调味等炒2-3分钟即可。</p>
<p>如果使用番茄的话，在鸡蛋炒好之后先腾出，然后再炒番茄，等番茄一半熟之后再放入鸡蛋，葱花等。</p>
<p>日志是定时发布的，说不定这个时候我正在品尝着炒馍呢^_^</p>
<p><strong>Update:</strong>
娃哈哈，昨天做到炒馍超赞的，就是盐稍微放多了那么一点点，炒的一大瓷碗，吃的我撑死了，呵呵：）</p>
<p><strong>Continue
update</strong>：娃哈哈，从买了一个相机，已经会有很多作品出现，这次更新的是今日又做了炒馍，特拍了两张，如下</p>
]]></content:encoded></item><item><title>2008，春节吉祥</title><link>https://icyleaf.com/2008/01/2008-spring-hello/</link><pubDate>Wed, 30 Jan 2008 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2008/01/2008-spring-hello/</guid><description>更新 2月 3, 2008 昨天晚上接到几个短信都问我吃麻糖了么，恩，我承认我有些忘记开封的东西了，上面的文章居然把麻糖叫成了灶糖。。。 娃哈哈，刚刚买到车票...</description><content:encoded><![CDATA[



<div class="updated">
  <header class="updated-header">
    <h4 class="updated-title">更新</h4>
    
    <p class="updated-meta">2月 3, 2008</p>
    
  </header>
  <article class="updated-body">
    <ol>
<li>昨天晚上接到几个短信都问我吃麻糖了么，恩，我承认我有些忘记开封的东西了，上面的文章居然把麻糖叫成了灶糖。。。</li>
<li>娃哈哈，刚刚买到车票了，我可以回家了，而且还是卧铺，感谢青菜！！</li>
</ol>

  </article>
</div>


<p>春节马上就要到了，今年是奥运年，所以今年的春节是非常特别的。</p>
<p>在这个特别的日子，请您在这里留下您的祝福！</p>
<p>首先最先的是祭灶，不知道大家知不知道这个节日，腊月23日，也就是今天。我们家那边到了，就会买<del>灶糖</del>（<strong>麻糖</strong>）吃。那怎么会吃糖呢，其实在为了用糖塞住灶王爷的嘴，让他别说坏话，因为灶王爷要在腊月23日回天上向玉帝汇报这一家人的善行或恶行，玉帝根据灶王爷的汇报，再将这一家在新的一年中应该得到的吉凶祸福的命运交于灶王爷之手。因此，对一家人来说，灶王爷的汇报实在具有重大利害关系。更多请看百度知道。</p>
<p>可惜北京这边没有这个习俗，要么就是我还不知道- -</p>
<p>快过年了，不知道在异地的朋友买到回家的车票了么，我到现在还没有买到，家那边下了很大的雪，而且还要过郑州这个大的交通枢纽，所以车票是巨难买，另外我坐车只能保证1-2个小时不晕车，再长我还没有锻炼过= =，所以做汽车回家还是就此打住&hellip;</p>
<p>整个假期只有短短7天假，挺緊的，回去要好好享受开封的小吃，吃到满足在说，老老实实和父母呆上1-2天，或许假期后又要1年不能见面了。</p>
<p>今天我感冒了，很难受，唉，不说了，说实话北京很冷，我们住的地方暖气时有时无的让人受不了，而且热水器坏了，希望今天能修好。</p>
<p>买笔记本的计划又要耽搁了，年前申办的招商银行的信用卡没有通过，原因是综合评定不足，搞不懂- -</p>
<p>总结：祝大家春节愉快！~~我要回家！~~我要买本！</p>
]]></content:encoded></item><item><title>2008，一个全新的我</title><link>https://icyleaf.com/2007/12/2008-a-new-i/</link><pubDate>Thu, 27 Dec 2007 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2007/12/2008-a-new-i/</guid><description>看着漫步等人参与的号召：使我的新年目标成功！活动让我情不自禁。希望有兴趣的朋友也可以参与进来！ 其实我是一个有些冲动的人，什么事情都想要尝试，...</description><content:encoded><![CDATA[<p>看着<a href="http://roamlog.cn/">漫步</a>等人参与的<a href="http://www.mifengtd.cn/articles/mifengtd-my-new-years-resolutions.html">号召：使我的新年目标成功！</a>活动让我情不自禁。希望有兴趣的朋友也可以参与进来！</p>
<p>其实我是一个有些冲动的人，什么事情都想要尝试，但又有些3分钟热度，也许是家族遗传的原因。我个人很少制定计划，向来喜欢随心所欲，为所欲为，不愿受人束缚，别人也是严格要求我，我却背道而驰。</p>
<p>2007年下半年的时候那个时候我还在Opera的博客上面终于下定决定制定了一个[075Q计划][]，其实应该是075K计划(想看要用[梯子][]哦)。不过最终还是没有完成那个计划&hellip;</p>
<p>2008年即将到来，我将要以一个全新的我面对新的一年。以此我也要制定一些计划督促自己，改变自己！</p>
<p>在2007年的年末开始了我实习生的工作，至此我也即将走出校园，开始新的生活，面对社会，我目前还没有做好准备。</p>
<p>2008年势必会有更多的事情需要我自己来面对&hellip;</p>
<p>虽然我还没有开始空想未来，但是还是借用右边图片上的一句话勉励自己：<strong>停止空想未来，开始创造未来！</strong></p>
<p>2008，一个全新的我”是一个很大的项目，此工程下面有几个计划：</p>
<p><strong>Plan 1：专心一致的提高自身的专业知识水平</strong></p>
<p>由于自己不时会3分钟热度，耐心不高等因素的原因，使得我学的东西一变再变。从最早的网站制作，黑客技术，软件编程，美工，又到现在回归B/S这方面的东西，整整花了我4年多的时间&hellip;这段时间学的真的很杂，但学又仅仅是皮毛。为了能彻底改掉这个坏习惯，因此我要专心一致的研究我目前工作所用的东西，要彻底的提高自身的专业知识水平。</p>
<p><strong>2：提高自己的社交能力</strong></p>
<p>呃，可以这样说，我是典型的程序员，天天闷在电脑前鼓捣。通过看我的博客也能了解到，除去自己懂的一些知识，无法和别人侃侃而谈，及其的不善于书面表达和社交沟通&hellip;</p>
<p>“蜀道难，难于上青天”。我再不说真的就像那句词所说的了。</p>
<p>这个计划可谓是我08年最最重要也是最最困难的一个。这点我要向[漫步][]同学学习，认识了这么多的人&hellip;羡慕，就这还居然也要提高沟通能力=。=</p>
<p><strong>Plan 3：提供英语的读写能力</strong></p>
<p>英语啊，英语，你咋认识我我去不认识你呢？</p>
<p>在很小的时候，听过我的某哥哥英语总是学不好，总是挂掉，我当时心想英语是啥玩意，有这么难学么。上初中的时候知道了什么是英语，还好的是当时英语还不错，成绩都在90分以上，到了高中之后就开始堕落了，因为家里买电脑了。</p>
<p>自从有了电脑整个人已经迷上去了，当然最初的时候迷的是游戏&hellip;</p>
<p>措施：</p>
<ol>
<li>看美国大片- -！</li>
<li>翻译一些好的文章，文字。</li>
<li>尝试把自己用的东西全部替换成英语版本。</li>
</ol>
<p><strong>Plan 4 ：计划好了就要努力完成</strong></p>
<p>其实自己有很多的想法，总想恩，这个不错，回来研究下，那个把它做成什么什么的。到了最后新的事物和想法又蹦了出来，之前的方法就这么搁浅了。</p>
<p>措施：</p>
<ol>
<li>这个主要靠用纸记下来或者Google日历提醒自己。</li>
<li>每个的想法如果实施一定要给自己一个时间的约束。</li>
</ol>
<p><strong>Plan 5： 摆脱&quot;懒&quot;的恶习</strong></p>
<p>我自认为我是一个很懒的人，在TX的城市达人上面我申请的是懒达人。如果不懒的话，我本可以做很多的事情，也不会导致我制定的075Q计划失败，我能获得的更多，改变的更多！</p>
<p>措施：目前还没有具体的方案-。-</p>
]]></content:encoded></item><item><title>初学教程：正则表达式</title><link>https://icyleaf.com/2007/12/beginner-guide-a-regular-expression/</link><pubDate>Mon, 10 Dec 2007 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2007/12/beginner-guide-a-regular-expression/</guid><description>正则表达式（英文全称regular expression）描述了一种字符串匹配的模式，可以用来检查一个串是否含有某种子串、将匹配的子串做替换或...</description><content:encoded><![CDATA[<blockquote>
<p><strong>正则表达式</strong>（英文全称regular expression）描述了一种字符串匹配的模式，可以用来检查一个串是否含有某种子串、将匹配的子串做替换或者从某个串中取出符合某个条件的子串等。</p>
</blockquote>
<p>正则表达式的用途：</p>
<p>通过使用正则表达式，可以：</p>
<ul>
<li>测试字符串内的模式。
例如，可以测试输入字符串，以查看字符串内是否出现电话号码模式或信用卡号码模式。这称为数据验证。</li>
<li>替换文本。
可以使用正则表达式来识别文档中的特定文本，完全删除该文本或者用其他文本替换它。</li>
<li>基于模式匹配从字符串中提取子字符串。
可以查找文档内或输入域内特定的文本。</li>
</ul>
<p>例如，您可能需要搜索整个 Web 站点，删除过时的材料，以及替换某些 HTML 格式标记。在这种情况下，可以使用正则表达式来确定在每个文件中是否出现该材料或该 HTML 格式标记。此过程将受影响的文件列表缩小到包含需要删除或更改的材料的那些文件。然后可以使用正则表达式来删除过时的材料。最后，可以使用正则表达式来搜索和替换标记。</p>
<p>正则表达式在 JScript 或 C
等语言中也很有用，这些语言的字符串处理能力还不为人们所知。</p>
<p>想要在很短的时间学会
正则表达式也不是一件很容易的事情，现在在网上有一份教程，应该是很火的，名叫&quot;<strong><a href="http://unibetter.com/deerchao/zhengzhe-biaodashi-jiaocheng-se.htm">正则表达式30分钟入门教程</a></strong>&quot;，这也是我推荐的初学入门教程。教程来自<a href="http://www.unibetter.com/">unibetter大学生社区</a>。</p>
<p>教程中用到的测试正则表达式的工具是在.NET支持。这里我推荐一个由<a href="http://www.chken.com/">CHKen</a>（<a href="http://www.chken.com/ViewSoft.asp?id=1">CHKenPlayer</a>的作者）使用纯API编写的测试正则表达式工具：<a href="http://www.chken.com/Soft/Other/RegExp.zip" title="点击直接下载">RegExp</a>。</p>
<p>另外在<a href="http://www.williamlong.info">月光博客</a>还收集了很多“<a href="http://www.williamlong.info/archives/433.html">常用的正则表达式</a>”是实际应用中也许对大家会有所帮助。</p>
]]></content:encoded></item><item><title>博客串联：5 个关于你的问题</title><link>https://icyleaf.com/2007/12/blog-series-five-on-your-question/</link><pubDate>Sat, 01 Dec 2007 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2007/12/blog-series-five-on-your-question/</guid><description>记得是漫步好几天前在饭否给我发的信息，让我参与这个活动，由于这几天一直再忙，耽搁了，今天补上：） 你从什么时候开始 Blogging 的？ 上大学的时候接触到了博...</description><content:encoded><![CDATA[<p>记得是<a href="http://roamlog.cn/archives/5-questions-about-you.html">漫步</a>好几天前在饭否给我发的信息，让我参与这个活动，由于这几天一直再忙，耽搁了，今天补上：）</p>
<ol>
<li>
<p>你从什么时候开始 Blogging 的？
上大学的时候接触到了博客，偶尔玩玩，而真正开始博客的时候大概是在05年9月份。博客的名字一直是灵狼天，关于它的意义所在，大家自己猜想吧。猜对有糖吃哦呵呵(^__________^)</p>
</li>
<li>
<p>你为什么博客？</p>
<p>刚开始在MyOpera申请的一个提供300M空间的博客服务，本来是要做一个家乡的图片博客，后来发现此平台上有很多IT界“有名人士”以及归隐者，受他们影响开始安心的blogging。不过刚开始大部分都是转载一些我喜欢和我收藏的文章。
去年5.1黄金周后，MyOpera因涉嫌某些东西被GFW掉，后来就有了自己搭站的念头。
我在MyOpera的地址：http://my.opera.com/icyleaf</p>
</li>
<li>
<p>你是否尝试在网上赚钱或已经开始在网上赚钱？
一直有尝试过，但是由于个人原因和经营不善问题，一直处于白忙活状态，呵呵，凭着纯乐呵的状态做这件事情，赚不赚钱并不重要，当然有钱赚更好。</p>
</li>
<li>
<p>你喜欢网络的三个理由
信息，朋友，Enjoy myself
通过网络我可以获得我所喜欢的各种信息，让自己充实；
通过网络我可以结识到很多志同道合的朋友，但由于我不善于言表，都没有太深的交谈&gt;____&lt;我的一大痛处；
通过网络，Enjoy myself也是一种快乐。</p>
</li>
<li>
<p>你 Blogging 的目标是什么？将如何实现？
对于目前来说。博自己所喜欢的，无论是单纯的生活日志还是混杂的各种信息技术也好都会在一个博客上面展现，本来嘛博客就是记录自己的方方面面，但是由于各种原因使得人们博的心态和目的都已经歪曲。但路是要靠自己来走，我还是凭着一颗单纯的心做自己的博客。</p>
</li>
</ol>
]]></content:encoded></item><item><title>如何治疗嘴唇破皮</title><link>https://icyleaf.com/2007/11/how-to-treat-lips-popi/</link><pubDate>Fri, 09 Nov 2007 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2007/11/how-to-treat-lips-popi/</guid><description>嘴唇破皮确实是一件很痛苦的事情，我也是身受体会，最近嘴唇的皮还是一点一点的起皮。我自称是耐渴性人物，可是嘴唇一开始破皮，就总想用舌头舔，结果...</description><content:encoded><![CDATA[<p>嘴唇破皮确实是一件很痛苦的事情，我也是身受体会，最近嘴唇的皮还是一点一点的起皮。我自称是耐渴性人物，可是嘴唇一开始破皮，就总想用舌头舔，结果是越舔越干，每当皮翘起来的时候，我还会把它揪掉。</p>
<p>冬天正在慢慢的来临，在着北方的天气干且燥，风又大，更是嘴唇破皮的季节&gt;_&lt;这不刚刚去陪mm逛街的时候买了一管润唇膏。要不我又该受不了了，买润唇膏后就想上网查查嘴唇破皮是什么原因，恩&hellip;原因概括可以分6种：&lt; p&gt;</p>
<ul>
<li>天气干燥，身体缺水分。</li>
<li>上火也有可能导致嘴唇破皮。</li>
<li>也有可能是习惯性的会用舌头來舔嘴唇。</li>
<li>嘴唇皮肤比较纤薄幼细，嘴唇很容易被紫外线灼伤而引起脱皮。</li>
<li>身体缺少维生素B2，也有可能导致嘴唇破皮。（甚至会有口角发炎、龟裂，舌头发炎的现象。）</li>
<li>主要针对女性，若是使用了过度干燥的口紅，或是对口红过敏也有可能造成嘴唇的破皮。</li>
</ul>
<p>刚问了问家在南方的室友，原来他那边冬天也有很多嘴唇破皮的，可以这么说，导致嘴唇破皮的最主要的原因是<strong>天气干燥，身体缺水分</strong>。然而嘴唇干燥，破皮不舒服，很多人会下意识地舔唇，结果却往往越舔越干，越干越舔，形成一个恶性循环，甚至舔得口唇周围皮肤粗糙变厚，甚至嘴唇肿胀，形成医学上的“<strong>舌舔皮炎</strong>”。无论是从健康还是美观的角度考虑，还是改掉舔唇这个不太雅观的习惯吧。（更多详细可以看<a href="http://www.xiaojd.com/qa/b6b35dc764">这里</a>）</p>
<p>**治疗嘴唇破皮的最简单的方法就是多喝水！**当然治疗嘴唇干燥，破皮不可是是一朝一夕就治疗的，大家可以选用润唇膏消除因干燥而带来的不舒服。是唇膏，不要买唇彩或唇油，这些对于嘴唇破皮无效。</p>
<p>下面我说一个土方，我家传的，一般在家的朋友可以试下：</p>
<blockquote>
<p>晚上的时候，用筷子沾2-3的小磨油（香油）涂在嘴唇上面，如果嘴唇破皮的不厉害，一般2-3天就好了。</p>
</blockquote>
]]></content:encoded></item><item><title>人为什么会上火</title><link>https://icyleaf.com/2007/10/why-do-people-at-fire/</link><pubDate>Tue, 30 Oct 2007 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2007/10/why-do-people-at-fire/</guid><description>我发现我现在浑身是病，特开“养生之道”专栏，给自己给大家介绍一些发生在我身上的一些问题和解决方法。希望大家喜欢 上火对我来说可以说是家常便饭，...</description><content:encoded><![CDATA[<p>我发现我现在浑身是病，特开“<strong>养生之道</strong>”专栏，给自己给大家介绍一些发生在我身上的一些问题和解决方法。希望大家喜欢</p>
<p>上火对我来说可以说是家常便饭，三天两头的上上火，无论我吃任何的败火（感慨：人类造词的真是高明啊）的药一点用途都没有，只是光往厕所跑的事情了- -!所以我现在根本都不吃药，都是硬挺的。虽说常上火，对我来说一般都是<strong>口腔溃疡</strong>的症状。但还是不能完全忽视掉那种痛感。太痛苦，太受折磨了&hellip;</p>
<p><a href="http://zhidao.baidu.com/question/28887798.html?si=1">上火是中医的理论，西医一直没有明确支持</a>。中国人一般都是这么叫的。人体里本身是有火的，如果没有火那么生命也就停止了，也就是所谓的生命之火。当然火也应该保持在一定的范围内，比如体温应该在37度左右，如果火过亢人就会不舒服，会出现很多红、肿、热、痛、烦等具体表现。<a href="http://zhidao.baidu.com/question/15539369.html?fr=qrl3">上火的症状有哪些？吃什么东西可以败火？</a></p>
<p>网上对上火有很多种分类，一般分实虚两种（只是个人观点，不对实际的对与否做解释）。对于口腔溃疡的症状属于<strong>实火旺</strong>，表现为口腔溃疡、口干、尿黄、心烦易怒等；除了实火旺还有<strong>虚火</strong>，主要表现有心烦、口干、盗汗、睡眠不安等。按病位分有出来三种：</p>
<ul>
<li><strong>上焦有火</strong>（上焦指心肺部位），症见口干、舌烂、唇裂、目赤、耳鸣，甚则微咳。</li>
<li><strong>中焦有火</strong>（中焦指脾胃部位），表现为时而胃火亢盛，食不知饱，时而嗳腐吞酸，呃气上逆，脘腹胀满，饮食少进。</li>
<li><strong>下焦有火</strong>（下焦指肝、肾、膀胱、大小肠部位），表现为大便干，小便少且黄赤，混浊有味，阴部时痒，妇女白带多，甚至带黄。</li>
</ul>
<p><strong>如何败火？</strong></p>
<ul>
<li><a href="http://www.39.net/zhongyi/yaoshan/yaoshan/71927.html">经常&quot;上火&quot;者的饮食治疗</a></li>
<li><a href="http://zhidao.baidu.com/question/872372.html">容易上火应多吃什么食物？</a></li>
<li><a href="http://www.39.net/Treatment/jktx/jkkd/94705.html">上火吃泻火药为何无效</a></li>
<li><a href="http://zhidao.baidu.com/question/1663301">最快的败火方法是什么</a></li>
<li><a href="">败火的三道凉菜</a><a href="http://life.people.com.cn/GB/35076/4534013.html">http://life.people.com.cn/GB/35076/4534013.html</a>)</li>
</ul>
<p><strong>口腔溃疡专栏</strong></p>
<blockquote>
<p>口腔溃疡发生的部位多见于口腔粘膜及舌的边缘，常是白色溃疡，周围有红晕，十分疼痛，特别是遇酸、咸、辣的食物时，疼痛更加厉害，以致美味佳肴都不愿品尝。虽是口腔小疾，却令人痛苦不堪，甚至坐卧不宁，寝食不安，情绪低落。</p>
</blockquote>
<p><a href="http://health.sohu.com/2004/06/17/62/article220586282.shtml">人为什么会口腔溃疡</a>？（说的比较悬乎&hellip;)那么人为什么会反复口腔溃疡？</p>
<p><strong>如何预防口腔溃疡？</strong></p>
<p>口腔溃疡在很大程度上与个人身体素质有关，因此要想完全避免其发生可能性不大，但如果尽量避免诱发因素，仍可降低发生率。</p>
<p><a href="http://bk.baidu.com/view/60479.htm">具体措施</a>)是：</p>
<ul>
<li>注意口腔卫生，避免损伤口腔黏膜，避免辛辣性食物和局部刺激。</li>
<li>保持心情舒畅，乐观开朗，避免事情和着急。</li>
<li>保证充足的睡眠时间，避免过度疲劳。</li>
<li>注意生活规律性和营养均衡性，养成一定排便习惯，防止便秘。</li>
</ul>
]]></content:encoded></item><item><title>如何降低胆固醇</title><link>https://icyleaf.com/2007/10/how-to-reduce-cholesterol/</link><pubDate>Mon, 29 Oct 2007 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2007/10/how-to-reduce-cholesterol/</guid><description>忘记了一个小小重要的事情，上次去北京献血时的验血结果，护士告诉我胆固醇有些过高，说是熬夜导致，熬夜肯定是有的通宵唱K嘛，但是我有些疑惑，为什...</description><content:encoded><![CDATA[<p>忘记了一个小小重要的事情，上次去北京献血时的验血结果，护士告诉我胆固醇有些过高，说是熬夜导致，熬夜肯定是有的通宵唱K嘛，但是我有些疑惑，为什么胆固醇有些过高是由熬夜导致的？这难道能从血液里面看出来？还是说我身体的胆固醇本身就有些过高？</p>
<p>听说胆固醇过高很危险，小米说少吃鸡蛋就可以了，鸡蛋含的胆固醇是很高的。而我坚持每天1-2个鸡蛋，
在学校本身就没什么好吃的，在不补补营养怎么能行，呵呵。难道因为鸡蛋含的胆固醇是很高而不吃鸡蛋？赶紧搜了搜关于胆固醇的知识（<a href="http://baike.baidu.com/view/24827.htm">详细说明</a>）：</p>
<blockquote>
<p><strong>胆固醇</strong>又称胆甾醇。一种环戊烷多氢菲的衍生物。早在18世纪人们已从胆石中发现了胆固醇，1816年化学家本歇尔将这种具脂类性质的物质命名为胆固醇。胆固醇广泛存在于动物体内，尤以脑及神经组织中最为丰富，在肾、脾、皮肤、肝和胆汁中含量也高。其溶解性与脂肪类似，不溶于水，易溶于乙醚、氯仿等溶剂。胆固醇是动物组织细胞所不可缺少的重要物质，它不仅参与形成细胞膜，而且是合成胆汁酸，维生素D以及甾体激素的原料。</p>
<p>一般都知道，脂类物质主要分为两大类。脂肪（主要是甘油三酯）是人体内含量最多的脂类，是体内的一种主要能量来源；另一类叫类脂，是生物膜的基本成分，约占体重的5%，除包括磷脂、糖脂外，还有很重要的一种叫<strong>胆固醇</strong>。</p>
<p>通常，将每100克食物中胆固醇含量低于100毫克的食物称为**<!-- raw HTML omitted -->低胆固醇食物<!-- raw HTML omitted -->**，如鳗鱼、娼鱼、鲤鱼、猪瘦肉、牛瘦肉、羊瘦肉、鸭肉等；将每100克食物中胆固醇含量为100～200毫克的食物称为<!-- raw HTML omitted --><strong>中度胆固醇食物</strong><!-- raw HTML omitted -->，如草鱼、鲫鱼、鲢鱼、黄鳝、河鳗、甲鱼、蟹肉、猪排、鸡肉等；而将每100克食物中胆固醇含量为200～300毫克的食物称<!-- raw HTML omitted --><strong>高胆固醇食物</strong><!-- raw HTML omitted -->，如猪肾、猪肝、猪肚、蚌肉、蛀肉、蛋黄、蟹黄等。高胆固醇血症的患者应尽量少吃或不吃高胆固醇的食物。</p>
</blockquote>
<p><strong>那么如何降低胆固醇？</strong></p>
<p>经常食用几种常见的食物就能降低胆固醇：早餐一碗约75克燕麦粥，配一杯无糖豆浆；看电视时吃一把约二十来颗甜杏仁。</p>
<p>下面在摘录一些搜索到的信息，给自己同时也给大家做参考。</p>
<ul>
<li><a href="http://news.xinhuanet.com/health/2006-07/16/content_4840049.htm">十种食物能吃掉胆固醇</a></li>
<li><a href="http://www.china.com.cn/chinese/health/85030.htm">27种保持低胆固醇的方法</a></li>
<li><a href="http://www.china.com.cn/chinese/health/85030.htm">你应该如何降低胆固醇</a></li>
<li><a href="http://www.china.com.cn/chinese/health/373873.htm">4类食物能降低胆固醇29%</a></li>
</ul>
]]></content:encoded></item><item><title>推荐一本书</title><link>https://icyleaf.com/2007/09/recommend-a-book-stan-lais-creative-learning/</link><pubDate>Fri, 28 Sep 2007 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2007/09/recommend-a-book-stan-lais-creative-learning/</guid><description>书名：赖声川的创意学 作者：赖声川 出版社：中信出版社 ISBN：7508607457 纸张：胶版纸 出版日期：2006-9-1 定价：36元 内容提要：...</description><content:encoded><![CDATA[<p><img loading="lazy" src="http://images.dangdang.com/images/9214908_b.jpg"
  
  
  alt="创意"></img>
</p>
<blockquote>
<p>书名：赖声川的创意学</p>
<p>作者：赖声川</p>
<p>出版社：中信出版社</p>
<p>ISBN：7508607457</p>
<p>纸张：胶版纸</p>
<p>出版日期：2006-9-1</p>
<p>定价：36元</p>
</blockquote>
<p><strong>内容提要：</strong></p>
<p>创意是人类最向往的一种能力，但是我们却不了解它，也不知道如何才能拥有它。专家学者预测，世界即将从&quot;资讯时代&quot;转向所谓&quot;概念时代&quot;，创意也将成为新时代中最重要的工具。最大胆的预测还认为，MFA&ndash;艺术硕士（Master
of Fine Arts）将击败MBA，成为工商社会最受欢迎的学位。</p>
<p>在美国斯坦福大学开设&quot;创意&quot;讲座的赖声川，发明了&quot;创意金字塔&quot;，提出一套生活哲学解构创意，教你在日常生活中运用崭新的&quot;看&quot;法学创意、领风骚。</p>
<p>作者简介：
赖声川，创意源源不绝的创作人。一九五四年生于美国华盛顿，美国加州柏克莱大学戏剧博士，现任国立台北艺术大学教授、美国史丹福大学客座教授及驻校艺术家、【表演工作坊】艺术总监。他二十九岁开始剧场创作，至今编导舞台剧二十七部（包括轰动亚洲的七小时史诗《如梦之梦》）、电影二部（包括享誉国际的《暗恋桃花源》）、电视影集三百集（包括家喻户晓的《我们一家都是人》），另有剧场导演作品二十二部（包括莫扎特歌剧三部）等。</p>
<hr>
<p>这是我最近刚从图书馆借来的一本书，目前只是读了一个开头，不过光是开头给我的感触就很深的一句话：</p>
<blockquote>
<p>社会忙着将创意格式化，却没有考虑到创意是超越格式化和既定框架的。</p>
</blockquote>
<p>这是一个僵化的社会，我们做什么事情基本都是一个凭着一个标准，一个框架，一个准则，无论是上学，就业，生活这些大方面，就连编程等这些小的方面也是如此。创意不是凭空制作出来的，懂得超与格式化创造创意的人已经高高在上，成为了富豪。前几天我在网上略微看了几章《互联网草根革命》，一个新的创意也并不能说明，你立即成为富豪，还需要想办法去宣传，推广，为了我们的明天，让我们一起努力吧！</p>
<p>工作之余可以看看这本书，我想可以消除工作的疲乏:)</p>
]]></content:encoded></item><item><title/><link>https://icyleaf.com/draft/create-talos-vm-with-cloud-init-in-proxmox/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://icyleaf.com/draft/create-talos-vm-with-cloud-init-in-proxmox/</guid><description/><content:encoded></content:encoded></item><item><title/><link>https://icyleaf.com/draft/photo-mechanic/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://icyleaf.com/draft/photo-mechanic/</guid><description/><content:encoded></content:encoded></item></channel></rss>