<!doctype html><html lang=zh><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Puma æ›¿æ¢ Unicorn è·‘ Gitlab | icyleaf</title><link rel=prev href=https://icyleaf.com/2014/01/homebrew-hidden-commands/><link rel=next href=https://icyleaf.com/2015/01/speed-up-cocoapods/><link rel=canonical href=https://icyleaf.com/2014/01/moving-unicorn-to-puma-on-gitlab/><link rel=apple-touch-icon sizes=180x180 href=https://icyleaf.com/images/icyleaf-icon.png><link rel=icon type=image/png sizes=32x32 href=https://icyleaf.com/images/icyleaf-icon.png><link rel=icon type=image/png sizes=16x16 href=https://icyleaf.com/images/icyleaf-icon.png><link rel=stylesheet href=https://icyleaf.com/css/main.min.css><link rel=stylesheet href=https://icyleaf.com/font/iconfont.css><link rel=stylesheet href=https://icyleaf.com/font-ali/iconfont.css><meta name=title content="Puma æ›¿æ¢ Unicorn è·‘ Gitlab | icyleaf"><meta name=author content="icyleaf"><meta name=description content="æ—¥å¸¸å†™ä»£ç çƒ­çˆ±æˆ·å¤–çš„æ¢¦æƒ³å®¶"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/icyleaf.com\/"},"articleSection":"posts","name":"Puma æ›¿æ¢ Unicorn è·‘ Gitlab","headline":"Puma æ›¿æ¢ Unicorn è·‘ Gitlab","description":"å‰ç¯‡ä»‹ç»åˆ°å¦‚ä½•åœ¨ã€ŠCentoOS ä¸Šé¢å®‰è£… Gitlabã€‹ä¸€æ–‡ï¼Œgitlab é»˜è®¤ä½¿ç”¨çš„æ˜¯ unicorn ä½œä¸ºå†…éƒ¨çš„ app serverï¼Œå†ç”¨ nginx åšä»£ç†è½¬å‘ã€‚ä¹‹å‰æ˜¯åœ¨å…¬","inLanguage":"zh","author":"icyleaf","creator":"icyleaf","publisher":"icyleaf","accountablePerson":"icyleaf","copyrightHolder":"icyleaf","copyrightYear":"2014","datePublished":"2014-01-26 12:34:56 \u002b0800 \u002b0800","dateModified":"2014-01-26 12:34:56 \u002b0800 \u002b0800","url":"https:\/\/icyleaf.com\/2014\/01\/moving-unicorn-to-puma-on-gitlab\/","wordCount":"767","keywords":["Ruby","Git","Gitlab","Puma","Unicorn","icyleaf"]}</script></head><body><div class=wrapper><nav class=navbar><progress class=content_progress max=0 value=0></progress><div class=container><div class="navbar-header header-logo"><a href=https://icyleaf.com/>icyleaf</a></div><div class=navbar-right><span class=menu><a class=menu-item href=https://icyleaf.com/about title>About</a>
<a class=menu-item href=https://icyleaf.com/index.xml title>Feed</a>
<span class=divide></span><a href=javascript:void(0); class=theme-switch><i class="iconfont icon-dark-mode"></i></a></span></div></div></nav><nav class=navbar-mobile id=nav-mobile style=display:none><progress class=content_progress max=0 value=0></progress><div class=container><div class=navbar><div class="navbar-header header-logo"><a href=https://icyleaf.com/>icyleaf</a></div><div class=navbar-right><div><a href=javascript:void(0); class=theme-switch><i class="iconfont icon-dark-mode"></i></a></div><div class=menu-toggle><span></span><span></span><span></span></div></div></div><div class=menu id=mobile-menu><nav class=mb-md><a class=menu-item href=https://icyleaf.com/about title><h3>About</h3><div class=menu-active></div></a><a class=menu-item href=https://icyleaf.com/index.xml title><h3>Feed</h3><div class=menu-active></div></a></nav></div></div></nav><main class=main><div class=container><article class=post-warp itemscope itemtype=http://schema.org/Article><header class=post-header><h1 class=post-title itemprop="name headline">Puma æ›¿æ¢ Unicorn è·‘ Gitlab</h1><div class=post-meta><time datetime=2014-01-26 itemprop=datePublished>January 26, 2014</time>
Â·
<span class=tags>Ruby, Git, Gitlab, Puma, Unicorn</span>
Â·
<span class=post-word-count>767 words Â· 3 minutes</span></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title></h2><div class="post-toc-content always-active"><nav id=TableOfContents><ul><li><a href=#puma>puma</a></li><li><a href=#æ•™ç¨‹>æ•™ç¨‹</a></li><li><a href=#æˆ‘æƒ³ç”¨-apache-æ€ä¹ˆåŠ>æˆ‘æƒ³ç”¨ Apache æ€ä¹ˆåŠï¼Ÿ</a></li></ul></nav></div></div><div class=post-content><p>å‰ç¯‡ä»‹ç»åˆ°å¦‚ä½•åœ¨ã€Š<a href=http://icyleaf.com/2013/09/how-to-install-gitlab-on-centos/>CentoOS ä¸Šé¢å®‰è£… Gitlab</a>ã€‹ä¸€æ–‡ï¼Œgitlab é»˜è®¤ä½¿ç”¨çš„æ˜¯ <code>unicorn</code> ä½œä¸ºå†…éƒ¨çš„ app serverï¼Œå†ç”¨ <code>nginx</code> åšä»£ç†è½¬å‘ã€‚ä¹‹å‰æ˜¯åœ¨å…¬å¸å†…éƒ¨æ­å»ºäº†ä¸€ä¸ªå¹³å°ï¼Œç”¨ç€è¿˜ç®—å¯ä»¥ã€‚æœ‰æ‰“ç®—åœ¨ <a href="https://www.linode.com/?r=66b0730eca572d3e45f083e29b1b3f8781b2a009">Linode è´­ä¹°çš„ VPS</a> ä¸Šé¢ï¼Œä½¿ç”¨ <code>unicorn</code> è·‘æœåŠ¡çš„æ—¶å€™ <code>ruby</code> çš„è¿›ç¨‹å±…ç„¶å äº† 400-500M å·¦å³ï¼Œå¯¹äº Linode åˆšåˆšå…è´¹å‡çº§ä¹‹åæ‰æœ‰ 1G å†…å­˜çš„ç¯å¢ƒä¸Šï¼Œæˆ‘è¿˜çœŸæœ‰ç‚¹æ”¾å¼ƒå®‰è£…å®ƒçš„æ¬²æœ›ã€‚äºæ˜¯åœ¨æƒ³æ˜¯å¦å¯ä»¥ä½¿ç”¨ <code>puma</code> æ›¿æ¢æ‰åŸå…ˆçš„ã€‚</p><h2 id=puma>puma</h2><p>ç®€å•ä»‹ç»ä¸‹ <a href=http://puma.io/><code>puma</code></a>ï¼Œå®ƒæ˜¯ä¸€ä¸ªç”± ruby ç¼–å†™çš„è½¬ä¸º <a href=http://rack.github.io/><code>rack</code></a> è®¾è®¡çš„ app serverï¼Œåœ¨æ€§èƒ½å’Œèµ„æºå æœ‰ä¸Šå´æœ‰æå¤§çš„ä¼˜åŠ¿ï¼ˆä¸‹è¡¨æ•°æ®æ¥è‡ªå®˜æ–¹ï¼‰</p><div class=highlight><pre class=chroma><code class=language-txt data-lang=txt><span class=ln>1</span>PUMA - 78 Mb
<span class=ln>2</span>RAINBOWS! (1X16) - 120 Mb
<span class=ln>3</span>UNICORN - 1076 Mb
<span class=ln>4</span>RAINBOWS! (16X32) - 1138 Mb
</code></pre></div><p>è€Œä¸”é›†æˆä¹Ÿéå¸¸çš„ç®€å•ï¼Œè‹¥ä½¿ç”¨ rails æˆ–è€… sinatraï¼ˆåŠ padrinoï¼‰éƒ½å·²ç»æ”¯æŒï¼Œç›´æ¥ <code>gem install puma</code>ï¼Œç„¶åè·‘é»˜è®¤çš„ <code>rails/padrino server</code> ä¼šè‡ªåŠ¨åŠ è½½ã€‚</p><h2 id=æ•™ç¨‹>æ•™ç¨‹</h2><p>Okayï¼Œç»è¿‡ä¸€ç•ªæŸ¥æ‰¾ï¼Œå®˜æ–¹åœ¨æ”¶é›†çš„ <a href=https://gitlab.com/gitlab-org/gitlab-recipes/tree/master>repices</a> é‡Œé¢æœ‰å…³äº <code>puma</code> çš„ä¸€äº›é…ç½®ã€‚ä»–ä»¬ä¹Ÿæ˜¯æ”¶é›†çš„éå®˜æ–¹èµ„æ–™ï¼Œé‡Œé¢çš„èµ„æ–™åªæœ‰å€Ÿé‰´æ„ä¹‰ï¼ŒçœŸæ­£æ‹¿æ¥ç”¨çš„æ—¶å€™å„ç§é—®é¢˜ï¼Œæ‰€ä»¥æ‰æœ‰äº†æœ¬ç¯‡æ–‡å­—ã€‚</p><p>é¦–å…ˆæ˜¯å…³é—­å¯åŠ¨çš„ <code>gitlab</code> æœåŠ¡</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=ln>1</span>$ <span class=o>(</span>sudo<span class=o>)</span> service gitlab stop
</code></pre></div><p>å…³é—­ä¹‹åï¼Œæ·»åŠ  puma gemï¼Œæ‰“å¼€ <code>Gemfile</code></p><div class=highlight><pre class=chroma><code class=language-ruby data-lang=ruby><span class=ln>1</span><span class=n>group</span> <span class=ss>:unicorn</span> <span class=k>do</span>
<span class=ln>2</span>  <span class=n>gem</span> <span class=s1>&#39;unicorn&#39;</span><span class=p>,</span> <span class=s1>&#39;~&gt; 4.6.3&#39;</span>
<span class=ln>3</span>	<span class=n>gem</span> <span class=s1>&#39;unicorn-worker-killer&#39;</span>
<span class=ln>4</span><span class=k>end</span>
</code></pre></div><p>æ‰¾åˆ°ä¸Šé¢çš„è¿™æ®µ group æ›¿æ¢æˆï¼š</p><div class=highlight><pre class=chroma><code class=language-ruby data-lang=ruby><span class=ln>1</span><span class=n>gem</span> <span class=s1>&#39;puma&#39;</span>
</code></pre></div><p>å†è€…ä¿®æ”¹ <code>config.ru</code>ï¼ŒæŠŠä¸‹é¢è¿™æ®µä»£ç åšä¸‹æ›¿æ¢ï¼Œåˆ é™¤ unicorn çš„ä»£ç ï¼ŒåŠ è½½ pumaï¼š</p><div class=highlight><pre class=chroma><code class=language-ruby data-lang=ruby><span class=ln>1</span><span class=k>unless</span> <span class=n>defined?</span><span class=p>(</span><span class=no>PhusionPassenger</span><span class=p>)</span>
<span class=ln>2</span>  <span class=nb>require</span> <span class=s1>&#39;unicorn&#39;</span>
<span class=ln>3</span>  <span class=c1># Unicorn self-process killer</span>
<span class=ln>4</span>  <span class=nb>require</span> <span class=s1>&#39;unicorn/worker_killer&#39;</span>
<span class=ln>5</span>  <span class=c1># Max memory size (RSS) per worker</span>
<span class=ln>6</span>  <span class=n>use</span> <span class=no>Unicorn</span><span class=o>::</span><span class=no>WorkerKiller</span><span class=o>::</span><span class=no>Oom</span><span class=p>,</span> <span class=p>(</span><span class=mi>200</span> <span class=o>*</span> <span class=p>(</span><span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=mi>20</span><span class=p>)),</span> <span class=p>(</span><span class=mi>250</span> <span class=o>*</span> <span class=p>(</span><span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=mi>20</span><span class=p>))</span>
<span class=ln>7</span><span class=k>end</span>
</code></pre></div><p>æ›´æ–°æˆ</p><div class=highlight><pre class=chroma><code class=language-ruby data-lang=ruby><span class=ln>1</span><span class=k>unless</span> <span class=n>defined?</span><span class=p>(</span><span class=no>PhusionPassenger</span><span class=p>)</span>
<span class=ln>2</span>  <span class=nb>require</span> <span class=s1>&#39;puma&#39;</span>
<span class=ln>3</span><span class=k>end</span>
</code></pre></div><p>æ›¿æ¢å®Œæ¯•æ›´æ–° <code>gem</code></p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=ln>1</span><span class=c1># mysql æ•°æ®åº“</span>
<span class=ln>2</span>bundle install --without development <span class=nb>test</span> postgres --path vendor/bundle --no-deployment
<span class=ln>3</span><span class=c1># postgres æ•°æ®åº“</span>
<span class=ln>4</span>bundle install --without development <span class=nb>test</span> mysql --path vendor/bundle --no-deployment
</code></pre></div><p>æœ€åè¿˜æœ‰ä¸¤å¤„éœ€è¦ä¿®æ”¹ï¼Œæ·»åŠ  <code>config/puma.rb</code>ï¼ˆæ›¿ä»£ <code>config/unicorn.rb</code>ï¼‰ ä»¥åŠæ›¿æ¢ <code>/etc/init.d/gitlab</code> æœåŠ¡è„šæœ¬ä»£ç ã€‚</p><p><code>config/puma.rb</code>çš„ä»£ç åœ¨<a href=https://gitlab.com/gitlab-org/gitlab-recipes/blob/master/app-server/puma/puma.rb>è¿™é‡Œå¯ä»¥ä¸‹è½½</a>ï¼Œæ— éœ€åšä»»ä½•çš„ä¿®æ”¹ã€‚</p><p><code>/etc/init.d/gitlab</code> æœåŠ¡è„šæœ¬ï¼š<a href=https://gitlab.com/gitlab-org/gitlab-recipes/tree/master/init/sysvinit/centos>CentOS</a> | <a href=https://gitlab.com/gitlab-org/gitlab-recipes/tree/master/init/sysvinit/debian>Debian(Ubuntu)</a></p><blockquote><p>æœåŠ¡è„šæœ¬éœ€è¦è®¾ç½®ä¸‹æ‰§è¡Œæƒé™ï¼š chmod +x /etc/init.d/gitlab</p></blockquote><p>æœ€åå¼€å¯æœåŠ¡åº”è¯¥å°±å®Œç¾äº†</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=ln>1</span>$ <span class=o>(</span>sudo<span class=o>)</span> service gitlab start
</code></pre></div><h2 id=æˆ‘æƒ³ç”¨-apache-æ€ä¹ˆåŠ>æˆ‘æƒ³ç”¨ Apache æ€ä¹ˆåŠï¼Ÿ</h2><p>å—¯ï¼Œæˆ‘æ²¡å°è¯•è¿‡ï¼Œå®˜æ–¹æœ‰æä¾›æ”¶é›†çš„èµ„æ–™ï¼Œ<a href=https://gitlab.com/gitlab-org/gitlab-recipes/tree/master/web-server>è‡ªå·±æŸ¥çœ‹ä¸‹å§</a>ï¼Œè®°å¾—è¦æ´»å­¦æ´»ç”¨ï¼Œç›´æ¥å¥—è‚¯å®šä¼šå‡ºé—®é¢˜çš„ã€‚</p></div><div class=post-nav><a href=https://icyleaf.com/2014/01/homebrew-hidden-commands/ class=prev rel=prev title="Homebrew éšè—å‘½ä»¤"><i class="iconfont icon-left"></i>&nbsp;Homebrew éšè—å‘½ä»¤</a>
<a href=https://icyleaf.com/2015/01/speed-up-cocoapods/ class=next rel=next title="æé€ŸåŒ– CocoaPods">æé€ŸåŒ– CocoaPods&nbsp;<i class="iconfont icon-right"></i></a></div><div class=post-comment></div></article></div></main><footer class=footer><div class=copyright>&copy;
<span itemprop=copyrightYear>2005 - 2021</span>
<span>ğŸº</span>
<span class=author itemprop=copyrightHolder><a href=https://icyleaf.com/>icyleaf</a></span></div></footer><script src=https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js crossorigin=anonymous></script><script defer src=https://icyleaf.com/js/vendor_main.min.js></script><script src=https://cdn.jsdelivr.net/npm/pangu@4.0.7/dist/browser/pangu.min.js integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin=anonymous></script><script>pangu.spacingPage()</script><script>(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)})(window,document,'script','//www.google-analytics.com/analytics.js','ga'),ga('create','UA-2570916-5','auto'),ga('send','pageview')</script></div></body></html>