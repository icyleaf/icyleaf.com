<!doctype html><html lang=zh><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>å­¦ä¹  Ansible + Vagrant | icyleaf</title><link rel=prev href=https://icyleaf.com/2013/12/activerecord-tips/><link rel=next href=https://icyleaf.com/2013/12/2013-in-review/><link rel=canonical href=https://icyleaf.com/2013/12/learning-ansible-and-vagrant/><link rel=apple-touch-icon sizes=180x180 href=https://icyleaf.com/images/icyleaf-icon.png><link rel=icon type=image/png sizes=32x32 href=https://icyleaf.com/images/icyleaf-icon.png><link rel=icon type=image/png sizes=16x16 href=https://icyleaf.com/images/icyleaf-icon.png><link rel=stylesheet href=https://icyleaf.com/css/main.min.css><link rel=stylesheet href=https://icyleaf.com/font/iconfont.css><link rel=stylesheet href=https://icyleaf.com/font-ali/iconfont.css><link rel=stylesheet href=https://icyleaf.com/photoswipe/photoswipe.css><meta name=title content="å­¦ä¹  Ansible + Vagrant | icyleaf"><meta name=author content="icyleaf"><meta name=description content="æ—¥å¸¸å†™ä»£ç çƒ­çˆ±æˆ·å¤–çš„æ¢¦æƒ³å®¶"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/icyleaf.com\/"},"articleSection":"posts","name":"å­¦ä¹  Ansible \u002b Vagrant","headline":"å­¦ä¹  Ansible \u002b Vagrant","description":"Ansible is a radically simple IT orchestration engine that makes your applications and systems easier to deploy. Avoid writing scripts or custom code to deploy and update your applicationsâ€” automate in a language that approaches plain English, using SSH, with no agents to install on remote systems. ç®€å•æ¥è¯´ Ansible æ˜¯ä¸€ä¸ªæç®€åŒ–","inLanguage":"zh","author":"icyleaf","creator":"icyleaf","publisher":"icyleaf","accountablePerson":"icyleaf","copyrightHolder":"icyleaf","copyrightYear":"2013","datePublished":"2013-12-21 12:34:56 \u002b0800 \u002b0800","dateModified":"2013-12-21 12:34:56 \u002b0800 \u002b0800","url":"https:\/\/icyleaf.com\/2013\/12\/learning-ansible-and-vagrant\/","wordCount":"1096","keywords":["Vagrant","Ruby","icyleaf"]}</script></head><body><div class=wrapper><nav class=navbar><progress class=content_progress max=0 value=0></progress><div class=container><div class="navbar-header header-logo"><a href=https://icyleaf.com/>icyleaf</a></div><div class=navbar-right><span class=menu><a class=menu-item href=https://icyleaf.com/about title>About</a>
<a class=menu-item href=https://icyleaf.com/index.xml title>Feed</a>
<span class=divide></span><a href=javascript:void(0); class=theme-switch><i class="iconfont icon-dark-mode"></i></a></span></div></div></nav><nav class=navbar-mobile id=nav-mobile style=display:none><progress class=content_progress max=0 value=0></progress><div class=container><div class=navbar><div class="navbar-header header-logo"><a href=https://icyleaf.com/>icyleaf</a></div><div class=navbar-right><div><a href=javascript:void(0); class=theme-switch><i class="iconfont icon-dark-mode"></i></a></div><div class=menu-toggle><span></span><span></span><span></span></div></div></div><div class=menu id=mobile-menu><nav class=mb-md><a class=menu-item href=https://icyleaf.com/about title><h3>About</h3><div class=menu-active></div></a><a class=menu-item href=https://icyleaf.com/index.xml title><h3>Feed</h3><div class=menu-active></div></a></nav></div></div></nav><main class=main><div class=container><article class=post-warp itemscope itemtype=http://schema.org/Article><header class=post-header><h1 class=post-title itemprop="name headline">å­¦ä¹  Ansible + Vagrant</h1><div class=post-meta><time datetime=2013-12-21 itemprop=datePublished>December 21, 2013</time>
Â·
<span class=tags>Vagrant, Ruby</span>
Â·
<span class=post-word-count>1096 words Â· 4 minutes</span></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title></h2><div class="post-toc-content always-active"><nav id=TableOfContents></nav></div></div><div class=post-content><div id=post-gallery><blockquote><p>Ansible is a radically simple IT orchestration engine that makes your applications and systems easier to deploy. Avoid writing scripts or custom code to deploy and update your applicationsâ€” automate in a language that approaches plain English, using SSH, with no agents to install on remote systems.</p></blockquote><p>ç®€å•æ¥è¯´ <a href=https://github.com/ansible/ansible>Ansible</a> æ˜¯ä¸€ä¸ªæç®€åŒ–çš„åº”ç”¨å’Œç³»ç»Ÿéƒ¨ç½²å·¥å…·ï¼Œç±»ä¼¼ <a href=https://github.com/puppetlabs/puppet>Puppet</a>ã€<a href=https://github.com/opscode/chef>Chef</a>ã€<a href=https://github.com/saltstack/salt>SaltStack</a>ã€‚ç”±äºé»˜è®¤ä½¿ç”¨ <code>ssh</code> ç®¡ç†æœåŠ¡å™¨ï¼ˆé›†ç¾¤ï¼‰ï¼Œé…ç½®æ–‡ä»¶é‡‡ç”¨ yaml è€Œä¸æ˜¯æŸä¸€ç§ç‰¹å®šè¯­è¨€åˆ¶å®šã€‚æ–¹ä¾¿è‡³æã€‚</p><p>å¾ˆå¤šäººè¯´ salt ä¹Ÿå¾ˆç”¨çš„ï¼Œä¸ºä»€ä¹ˆä¸è€ƒè™‘å‘¢ï¼Œæˆ‘ä¸ªäººè§‰å¾—ï¼Œansible çš„é…ç½®æ–‡ä»¶ç¼–å†™èµ·æ¥æ¯”è¾ƒæ–¹ä¾¿ï¼Œä¸éœ€è¦ä½¿ç”¨ <a href=http://jinja.pocoo.org/>jinja2</a> æ¨¡æ¿å¼•æ“é€‚åˆé <code>python</code> ç”¨æˆ·ç®¡ç†ã€‚è€Œä¸”æˆ‘ä¹Ÿè¾ƒåŒæ„ &ldquo;<a href=http://missingm.co/2013/06/ansible-and-salt-a-detailed-comparison/>Ansible and Salt: A detailed comparison</a>&rdquo; æ–‡ç« çš„è¯„æµ‹ã€‚</p><p>ç”±äºä¸ªäººä¹‹å‰æ²¡ç”¨è¿‡ä»»ä½•å…¶ä»–å·¥å…·ï¼Œè‡³äºä½ æƒ³çŸ¥é“ä¸Šé¢å“ªäº›ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«çš„è¯ï¼Œå‚è§æ­¤æ–‡ï¼š<a href="http://www.infoworld.com/d/data-center/review-puppet-vs-chef-vs-ansible-vs-salt-231308?page=0,0">Review: Puppet vs. Chef vs. Ansible vs. Salt</a> æˆ– &ldquo;<a href=http://ttyn.me/2013/02/19/ansible_intro.html>å¼€å§‹ä½¿ç”¨é…ç½®å’Œå‘å¸ƒç®¡ç†</a>&rdquo; ä¸€æ–‡ä¸­ä¹Ÿæœ‰æåˆ°å…¶ç‰¹æ€§ã€‚</p><h1 id=å®‰è£…>å®‰è£…</h1><p>å¤§å®¶ç§»æ­¥ LinuxToy çš„ <a href=https://linuxtoy.org/archives/hands-on-with-ansible.html>Ansible å¿«é€Ÿä¸Šæ‰‹</a> ä¸€æ–‡ï¼Œä»¥åŠ <a href=http://gogojimmy.net/2013/05/26/vagrant-tutorial/>ä½¿ç”¨Vagrantç·´ç¿’ç’°å¢ƒä½ˆç½²</a> ä½œä¸ºå­¦ä¹ é“ºå«ï¼Œæˆ‘å°±ä¸å†å¤šå†™ã€‚è¿™é‡Œæˆ‘æƒ³é‡ç‚¹ä»‹ç»ä¸‹ Ansible + Vagrant é…åˆä½¿ç”¨æŠ€å·§ã€‚</p><blockquote><p>å…¶å®ä¸Šé¢ &ldquo;ä½¿ç”¨Vagrantç·´ç¿’ç’°å¢ƒä½ˆç½²&rdquo; æåˆ°çš„é…ç½®æ–‡ä»¶æ˜¯ Vagrantfile config version = 1 æ—¶å€™çš„ï¼Œå½“å‰ vagrant ç‰ˆæœ¬æ˜¯ 1.4.1ï¼Œ Vagrantfile config version = 2ï¼Œå› æ­¤é…ç½®çš„éƒ¨åˆ†å·²ç»æœ‰æ‰€å˜åŠ¨ã€‚å¤§å®¶éœ€è¦åšä¸‹æ›´æ–°ã€‚</p></blockquote><p>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ Vagrant 1.4.0+ï¼Œå·¥å…·å·²ç»å®Œå…¨é›†æˆäº†ä¸Šè¿°çš„ DevOps å·¥å…·ï¼ˆç”šè‡³ Dockerï¼Œå¦å¤–ä¸€ç¥å™¨ï¼Œåç»­çœ‹çœ‹èƒ½å¦ç»™ä¸ªä»‹ç»ï¼‰ã€‚é»˜è®¤é…ç½®æ–‡ä»¶åªåŒ…å«äº† Puppet å’Œ Chefï¼Œå¤§å®¶éœ€è¦çœ‹<a href=http://docs.vagrantup.com/v2/provisioning/index.html>å®˜æ–¹æ–‡æ¡£</a>ã€‚</p><p>å¦‚æœä½ æ˜¯ Mac OS ç”¨æˆ·ï¼Œå¯ä»¥é€šè¿‡ <code>brew</code> å’Œ <code>brew-cask</code> å‘½ä»¤å®‰è£…ï¼š</p><pre><code>$ brew update
$ brew install ansible
$ brew cask install vagrant
</code></pre><h1 id=åˆ›å»º-vagrant-å®ä¾‹>åˆ›å»º Vagrant å®ä¾‹</h1><p>é¦–å…ˆåˆ›å»ºå­¦ä¹ ç›®å½•(<code>~/src/learn_ansible</code>)å’Œä¸€ä¸ªå®ä¾‹ï¼Œé‡‡ç”¨ CentOS 6.5 x64 ç³»ç»Ÿï¼š</p><pre><code>$ vagrant init centos65 https://github.com/2creatives/vagrant-centos/releases/download/v6.5.1/centos65-x86_64-20131205.box
</code></pre><p>ä¸‹è½½å®Œæ¯•ä¹‹åï¼Œç¼–è¾‘ <code>Vagrantfile</code> æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p><pre><code>config.vm.network :private_network, ip: &quot;33.33.33.10&quot;
config.vm.provision :ansible do |ansible|

ansible.inventory_path = &quot;ansbile/hosts&quot;
	ansible.playbook = &quot;ansbile/playbook.yml&quot;

	# é»˜è®¤ä½¿ç”¨ sudo æƒé™
	ansible.sudo = true
	# å¼€å¯è°ƒè¯•ä¿¡æ¯æ¨¡å¼
	ansible.verbose = 'vvv'
end
</code></pre><p>å¹¶åœ¨å­¦ä¹ ç›®å½•åˆ›å»º <code>ansible</code> ç›®å½•ä»¥åŠä¸‹é¢ä¸¤ä¸ªæ–‡ä»¶ï¼Œç»“æ„å¦‚ä¸‹ï¼š</p><pre><code>$ tree
.
â”œâ”€â”€ Vagrantfile
â””â”€â”€ ansible
    â”œâ”€â”€ hosts
    â””â”€â”€ playbook.yml
1 directory, 3 files

`hosts` æ–‡ä»¶å†…å®¹ï¼Œip åœ°å€å’Œä¸Šé¢ `Vagrantfile` è®¾ç½®çš„ä¸€è‡´ï¼š

</code></pre><p>[webserver]
33.33.33.10</p><pre><code>
`playbook.yml` æ–‡ä»¶å†…å®¹ï¼š

</code></pre><hr><h1 id=ansbile-çš„é…ç½®æ–‡ä»¶è¿™é‡ŒæŒ‡å®šåªä½œç”¨äº-webserver-æœåŠ¡å™¨>ansbile çš„é…ç½®æ–‡ä»¶ï¼Œè¿™é‡ŒæŒ‡å®šåªä½œç”¨äº webserver æœåŠ¡å™¨</h1><h1 id=ä½¿ç”¨-vagrant-çš„-sudu-æƒé™æ‰§è¡Œä»»åŠ¡>ä½¿ç”¨ vagrant çš„ sudu æƒé™æ‰§è¡Œä»»åŠ¡</h1><ul><li>hosts: webserver
user: vagrant
sudo: yes
tasks:<h1 id=ä»»åŠ¡åªæœ‰ä¸€ä¸ªå°±æ˜¯å®‰è£…-nginx>ä»»åŠ¡åªæœ‰ä¸€ä¸ªï¼Œå°±æ˜¯å®‰è£… nginx</h1><ul><li>name: Install Nginx
yum: name=nginx state=present</li></ul></li></ul><pre><code>

# è¿æ¥ &amp; éƒ¨ç½²

ä½¿ç”¨ Vagrant çš„å¥½å¤„åœ¨äºï¼Œå®ƒé›†æˆäº†è¿™äº›å·¥å…·ï¼Œå¹¶é€šè¿‡ `vagrant provision` è¿™ä¸ªå‘½ä»¤å°±èƒ½è¿æ¥æœåŠ¡å™¨å¹¶éƒ¨ç½²ã€‚è¿™é‡Œæˆ‘æƒ³è®©å¤§å®¶å­¦ä¹ åˆ°å¦‚ä½•é€šè¿‡ä¼ ç»Ÿ ssh é“¾æ¥ vagrant è™šæ‹Ÿæœºçš„æ–¹æ³•ï¼š

ä»ä¸Šé¢çš„é…ç½®æ–‡ä»¶æˆ‘ä»¬å¾—çŸ¥ï¼ŒæœåŠ¡å™¨çš„ ip æ˜¯ `33.33.33.10` è€Œä¸”é»˜è®¤ç™»å½•åˆ°è™šæ‹Ÿæœºä¸Šçš„ç”¨æˆ·æ˜¯ vagrantï¼ˆå¯†ç ä¹Ÿæ˜¯ç”¨æˆ·åï¼‰ï¼Œé“¾æ¥ç«¯å£æ˜¯ 22ã€‚æˆ‘ä»¬å…ˆæ‹·è´ ssh public key åˆ°æœåŠ¡å™¨ä¸Šï¼š

</code></pre><p>$ ssh-copy-id <a href=mailto:vagrant@33.33.33.10>vagrant@33.33.33.10</a></p><pre><code>
å®Œæˆä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä¸‹é¢å‘½ä»¤æµ‹è¯•æ˜¯å¦é…ç½®æˆåŠŸï¼š

</code></pre><p>$ ansible -u vagrant -i ansible/hosts all -m ping</p><p>webserver | success &#187; {
&ldquo;changed&rdquo;: false,
&ldquo;ping&rdquo;: &ldquo;pong&rdquo;
}</p><pre><code>
è¿”å› `ping: pong` å³ä¸ºè¿æ¥æˆåŠŸå¹¶å¯ä»¥è¿›è¡Œéƒ¨ç½²ã€‚è‹¥ä½ ä¹‹å‰æ‰§è¡Œäº† `vagrant provision` å°±ä¼šè‡ªåŠ¨æ‰§è¡Œ `playbook.yml` çš„å†…å®¹ã€‚


ä»Šå¤©åˆæ¢å°±åˆ°æ­¤ç»“æŸï¼Œå¸Œæœ›é€šè¿‡æœ¬ç¯‡æ–‡å­—å¤§å®¶å¯¹å®ƒæœ‰ä¸ªå¤§æ¦‚çš„äº†è§£ã€‚
</code></pre></div></div><div class=post-nav><a href=https://icyleaf.com/2013/12/activerecord-tips/ class=prev rel=prev title="ActiveRecord ä½¿ç”¨ç§˜ç¬ˆ"><i class="iconfont icon-left"></i>&nbsp;ActiveRecord ä½¿ç”¨ç§˜ç¬ˆ</a>
<a href=https://icyleaf.com/2013/12/2013-in-review/ class=next rel=next title="2013 å¹´ç»ˆæ€»ç»“">2013 å¹´ç»ˆæ€»ç»“&nbsp;<i class="iconfont icon-right"></i></a></div><div class=post-comment></div></article></div></main><footer class=footer><div class=copyright>&copy;
<span itemprop=copyrightYear>2005 - 2022</span>
<span>ğŸº</span>
<span class=author itemprop=copyrightHolder><a href=https://icyleaf.com/>icyleaf</a></span></div></footer><script src=https://fastly.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js crossorigin=anonymous></script><script defer src=https://icyleaf.com/js/vendor_main.min.js></script><script src=https://fastly.jsdelivr.net/npm/pangu@4.0.7/dist/browser/pangu.min.js integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin=anonymous></script><script>pangu.spacingPage()</script><script type=module>
  
  import PhotoSwipeLightbox from '\/photoswipe\/photoswipe-lightbox.esm.js';

  const lightbox = new PhotoSwipeLightbox({
    gallery: '#post-gallery',
    children: 'a.gallery-item',
    pswpModule: '\/photoswipe\/photoswipe.esm.js',
  });
  lightbox.init();
</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-TKQBZ7R259"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-TKQBZ7R259')</script></div></body></html>