<!doctype html><html lang=zh><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Fastlane - iOS 和 Android 的自动化构建工具 | icyleaf</title><link rel=prev href=https://icyleaf.com/2015/12/a-history-of-my-blog/><link rel=next href=https://icyleaf.com/2016/07/gitlab-api-wrapper-for-crystal/><link rel=canonical href=https://icyleaf.com/2016/07/intro-fastlane-automation-for-ios-and-android/><link rel=apple-touch-icon sizes=180x180 href=https://icyleaf.com/images/icyleaf-icon.png><link rel=icon type=image/png sizes=32x32 href=https://icyleaf.com/images/icyleaf-icon.png><link rel=icon type=image/png sizes=16x16 href=https://icyleaf.com/images/icyleaf-icon.png><link rel=stylesheet href=https://icyleaf.com/css/main.min.css><link rel=stylesheet href=https://icyleaf.com/font/iconfont.css><link rel=stylesheet href=https://icyleaf.com/font-ali/iconfont.css><link rel=stylesheet href=https://icyleaf.com/photoswipe/photoswipe.css><meta name=title content="Fastlane - iOS 和 Android 的自动化构建工具 | icyleaf"><meta name=author content="icyleaf"><meta name=description content="日常写代码热爱户外的梦想家"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/icyleaf.com\/"},"articleSection":"posts","name":"Fastlane - iOS 和 Android 的自动化构建工具","headline":"Fastlane - iOS 和 Android 的自动化构建工具","description":"系列索引 Fastlane - iOS 和 Android 的自动化构建工具 深入浅出 Fastlane 一看你就懂 你虐我千百遍，我待你如初恋，直到我遇到 match 前言 这篇文章整理了很久，发现在一篇文章里无法一","inLanguage":"zh","author":"icyleaf","creator":"icyleaf","publisher":"icyleaf","accountablePerson":"icyleaf","copyrightHolder":"icyleaf","copyrightYear":"2016","datePublished":"2016-07-11 12:36:07 \u002b0800 \u002b0800","dateModified":"2016-07-11 12:36:07 \u002b0800 \u002b0800","url":"https:\/\/icyleaf.com\/2016\/07\/intro-fastlane-automation-for-ios-and-android\/","wordCount":"2589","keywords":["iOS","Android","CI","CD","Ruby","Fastlane","icyleaf"]}</script></head><body><div class=wrapper><nav class=navbar><progress class=content_progress max=0 value=0></progress><div class=container><div class="navbar-header header-logo"><a href=https://icyleaf.com/>icyleaf</a></div><div class=navbar-right><span class=menu><a class=menu-item href=https://icyleaf.com/about title>About</a>
<a class=menu-item href=https://icyleaf.com/projects title>Projects</a>
<a class=menu-item href=https://icyleaf.com/index.xml title>Feed</a>
<span class=divide></span>
<a href=javascript:void(0); class=theme-switch><i class="iconfont icon-dark-mode"></i></a></span></div></div></nav><nav class=navbar-mobile id=nav-mobile style=display:none><progress class=content_progress max=0 value=0></progress><div class=container><div class=navbar><div class="navbar-header header-logo"><a href=https://icyleaf.com/>icyleaf</a></div><div class=navbar-right><div><a href=javascript:void(0); class=theme-switch><i class="iconfont icon-dark-mode"></i></a></div><div class=menu-toggle><span></span><span></span><span></span></div></div></div><div class=menu id=mobile-menu><nav class=mb-md><a class=menu-item href=https://icyleaf.com/about title><h3>About</h3><div class=menu-active></div></a><a class=menu-item href=https://icyleaf.com/projects title><h3>Projects</h3><div class=menu-active></div></a><a class=menu-item href=https://icyleaf.com/index.xml title><h3>Feed</h3><div class=menu-active></div></a></nav></div></div></nav><main class=main><div class=container><article class=post-warp itemscope itemtype=http://schema.org/Article><header class=post-header><h1 class=post-title itemprop="name headline">Fastlane - iOS 和 Android 的自动化构建工具</h1><div class=post-meta><time datetime=2016-07-11 itemprop=datePublished>July 11, 2016</time>
·
<span class=tags>iOS, Android, CI, CD, Ruby, Fastlane</span>
·
<span class=post-word-count>2589 words · 11 minutes</span></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title></h2><div class="post-toc-content always-active"><nav id=TableOfContents><ul><li><ul><li><a href=#系列索引>系列索引</a></li></ul></li><li><a href=#前言>前言</a></li><li><a href=#初次邂逅>初次邂逅</a></li><li><a href=#基本构成>基本构成</a></li><li><a href=#安装>安装</a></li><li><a href=#初始化>初始化</a></li><li><a href=#android-的支持>Android 的支持</a></li></ul></nav></div></div><div class=post-content><div id=post-gallery><h3 id=系列索引>系列索引</h3><ol><li><a href=https://icyleaf.com/2016/07/intro-fastlane-automation-for-ios-and-android/>Fastlane - iOS 和 Android 的自动化构建工具</a></li><li><a href=https://icyleaf.com/2016/07/fastlane-in-action/>深入浅出 Fastlane 一看你就懂</a></li><li><a href=https://icyleaf.com/2017/03/fastlane-match-in-action/>你虐我千百遍，我待你如初恋，直到我遇到 match</a></li></ol><h2 id=前言>前言</h2><p>这篇文章整理了很久，发现在一篇文章里无法一一讲述和全面的覆盖，初步打算是把这个做成一个系列，想到哪里就写到哪里，如果恰好有读者爱戴并有一些建议反馈，我也会根据大家的需要调整内容的方向和深度。论美剧的编剧的重要性(笑)。</p><h2 id=初次邂逅>初次邂逅</h2><p>初时 fastlane 的时候是去年的 11 月份，看到大就感觉遇到了神器一般的惊喜。它一个针对于 iOS 和 Android（后来才支持的）全方位自动化流程的工具，请看下图</p><p><img src=https://fastlane.tools/assets/img/intro-fastlane-tree.png alt=fastlane-flow loading=lazy></p><p>流程图中每个环节都是独立的工具，每个工具只干一件事情，分工非常的明确。以下是我在团队项目中用到的：</p><ul><li><a href=https://github.com/fastlane/fastlane/tree/master/scan>scan</a> 自动化测试工具，很好的封装了 Unit Test</li><li><a href=https://github.com/fastlane/fastlane/tree/master/sigh>sigh</a> 针对于 iOS 项目开发证书和 Provision file 的下载工具</li><li><a href=https://github.com/fastlane/fastlane/tree/master/match>match</a> 同步团队每个人的证书和 Provision file 的超赞工具，规范<a href=https://codesigning.guide/>代码签名</a>（虽然里面有些设定比较损）</li><li><a href=https://github.com/fastlane/fastlane/tree/master/gym>gym</a> 针对于 iOS 打包和签名的自动化工具，完爆 <code>xctool</code>，而 <code>shenzhen</code> 也放弃维护</li><li><a href=https://github.com/icyleaf/fastlane-qyer>qyer</a> 团队定制的工具，用于检测包和上传到自己的内部分发平台</li><li><a href=https://github.com/fastlane/fastlane>fastlane</a> 简单理解就是控制整体流程和实现的框架容器</li></ul><p>利用目前支持的工具可以做所有包含自动化和可持续化构建的每个环节，比如单元测试、截图、分发渠道、上传元数据和 ipa 包提交审核等等。看到这这些是不是很兴奋？
反正我看到之后就像黑夜看到了光明，果断抛弃自己维护的脚本。</p><h2 id=基本构成>基本构成</h2><p>Fastlane 提供的流程的众多工具都是可以独立存在和使用（提供 cli 命令），也可以统一由 fastlane 来控制。它在使用中提出了两个概念：</p><ul><li><code>action</code>: Fastlane 的插件，截至当前内置 165 个至多，不过每个动作的颗粒度大小不一。<a href=https://github.com/fastlane/fastlane/blob/master/fastlane/docs/Actions.md>查看详情</a></li><li><code>lane</code>: Fastlane 的任务（或者可以理解为命令），一个可以包含多个 lanes，通过 <code>fastlane</code> cli 传入制定的 lane 来执行。</li></ul><p>光说不干假把式，看法宝：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=ln> 1</span><span class=cl><span class=n>lane</span> <span class=ss>:adhoc</span> <span class=k>do</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>  <span class=c1># build version 自动加一</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>  <span class=n>increment_build_number</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>  <span class=c1># 执行 pod install</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>  <span class=n>cocoapods</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>  <span class=c1># 调用 facebook 的 xctool 进行单元测试</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>  <span class=n>xctool</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>  <span class=c1># 对模拟器运行的 App 进行截图</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>  <span class=n>snapshot</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>  <span class=c1># 安装团队证书和 profiles</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>  <span class=n>match</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>  <span class=c1># 上传 App 元数据和签名的 ipa 到 iTunes Conneects</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>  <span class=n>deliver</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>  <span class=c1># 把截图套进一个设备外壳</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>  <span class=n>frameit</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>  <span class=c1># 允许自定义的脚本文件</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>  <span class=n>sh</span> <span class=s2>&#34;./customScript.sh&#34;</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>  <span class=c1># 发消息到 slack</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>  <span class=n>slack</span>
</span></span><span class=line><span class=ln>20</span><span class=cl><span class=k>end</span>
</span></span></code></pre></div><h2 id=安装>安装</h2><p>工具的起源本身是专门针对 iOS 项目，因此目前依赖于 macOS 10.9 以上系统，Ruby 是一个众所周知的轮子发明者，很多知名的工具都是它开发的，fastlane 也不例外。以下是依赖环境：</p><ul><li>macOS 10.9+</li><li>Ruby 2.0+ (推荐 rvm 或 rbenv 安装)</li><li>Xcode + command line tools</li></ul><p>以上依赖配置好之后就可以通过 rubygem 进行安装：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>$ <span class=o>[</span>sudo<span class=o>]</span> gem install fastlane
</span></span></code></pre></div><p>fastlane 默认会把核心工具都会进行安装，需要大家耐心等待一会&mldr;</p><h2 id=初始化>初始化</h2><p>有两种方法可以初始化，一种是通过命令，一种是自己创建指定的（至少包含一个）约束文件 <code>Fastfile</code>。首先我先介绍大家使用命令初始化:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln> 1</span><span class=cl><span class=c1># 切换只你开发的 iOS 项目根目录</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>$ <span class=nb>cd</span> to/your/ios/project
</span></span><span class=line><span class=ln> 3</span><span class=cl>$ fastlane init
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=o>[</span>11:46:34<span class=o>]</span>: Detected iOS/Mac project in current directory...
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=o>[</span>11:46:34<span class=o>]</span>: This setup will <span class=nb>help</span> you get up and running in no time.
</span></span><span class=line><span class=ln> 6</span><span class=cl><span class=o>[</span>11:46:34<span class=o>]</span>: fastlane will check what tools you<span class=s1>&#39;re already using and set up
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=s1>[11:46:34]: the tool automatically for you. Have fun!
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=s1>[11:46:34]: Created new folder &#39;</span>./fastlane<span class=s1>&#39;.
</span></span></span><span class=line><span class=ln> 9</span><span class=cl><span class=s1>...
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=s1>Your Apple ID (e.g. fastlane@krausefx.com): xxx@gmail.com
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=s1>[11:46:59]: Verifying if app is available on the Apple Developer Portal and iTunes Connect...
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=s1>[11:46:59]: Starting login with user &#39;</span>xxx@gmail.com<span class=s1>&#39;
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=s1>Multiple teams found on the Developer Portal, please enter the number of the team you want to use:
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=s1>1) XXXXXXXXXX &#34;XXXXXXXXXX&#34; (In-House)
</span></span></span><span class=line><span class=ln>15</span><span class=cl><span class=s1>2) YYYYYYYYYY &#34;YYYYYYYYYY&#34; (Company/Organization)
</span></span></span><span class=line><span class=ln>16</span><span class=cl><span class=s1>+----------------+----------------------------------------------------------------------------+
</span></span></span><span class=line><span class=ln>17</span><span class=cl><span class=s1>|                                       Detected Values                                       |
</span></span></span><span class=line><span class=ln>18</span><span class=cl><span class=s1>+----------------+----------------------------------------------------------------------------+
</span></span></span><span class=line><span class=ln>19</span><span class=cl><span class=s1>| Apple ID       | xxx@gmail.com                                                              |
</span></span></span><span class=line><span class=ln>20</span><span class=cl><span class=s1>| App Name       | Hello Fastlane                                                             |
</span></span></span><span class=line><span class=ln>21</span><span class=cl><span class=s1>| App Identifier | com.icyleaf.demo.HelloFastlane                                             |
</span></span></span><span class=line><span class=ln>22</span><span class=cl><span class=s1>| Workspace      | /Users/icyleaf/Development/iOS/HelloFastlane.xcworkspace                   |
</span></span></span><span class=line><span class=ln>23</span><span class=cl><span class=s1>+----------------+----------------------------------------------------------------------------+
</span></span></span><span class=line><span class=ln>24</span><span class=cl><span class=s1>
</span></span></span><span class=line><span class=ln>25</span><span class=cl><span class=s1>[11:48:36]: This app identifier doesn&#39;</span>t exist on iTunes Connect yet, it will be created <span class=k>for</span> you
</span></span><span class=line><span class=ln>26</span><span class=cl>Please confirm the above values <span class=o>(</span>y/n<span class=o>)</span> n
</span></span><span class=line><span class=ln>27</span><span class=cl>App Identifier <span class=o>(</span>com.krausefx.app<span class=o>)</span>: com.icyleaf.demo.HelloFastlane
</span></span><span class=line><span class=ln>28</span><span class=cl><span class=o>[</span>11:50:04<span class=o>]</span>: Created new file <span class=s1>&#39;./fastlane/Appfile&#39;</span>. Edit it to manage your preferred app metadata information.
</span></span><span class=line><span class=ln>29</span><span class=cl>Optional: The scheme name of your app <span class=o>(</span>If you don<span class=s1>&#39;t need one, just hit Enter): AppDemo
</span></span></span><span class=line><span class=ln>30</span><span class=cl><span class=s1>[11:50:40]: &#39;</span>snapshot<span class=s1>&#39; not enabled.
</span></span></span><span class=line><span class=ln>31</span><span class=cl><span class=s1>[11:50:40]: &#39;</span>cocoapods<span class=s1>&#39; enabled.
</span></span></span><span class=line><span class=ln>32</span><span class=cl><span class=s1>[11:50:40]: &#39;</span>carthage<span class=s1>&#39; not enabled.
</span></span></span><span class=line><span class=ln>33</span><span class=cl><span class=s1>[11:50:40]: Created new file &#39;</span>./fastlane/Fastfile<span class=err>&#39;</span>. Edit it to manage your own deployment lanes.
</span></span><span class=line><span class=ln>34</span><span class=cl><span class=o>[</span>11:50:40<span class=o>]</span>: fastlane will send the number of errors <span class=k>for</span> each action to
</span></span><span class=line><span class=ln>35</span><span class=cl><span class=o>[</span>11:50:40<span class=o>]</span>: https://github.com/fastlane/enhancer to detect integration issues
</span></span><span class=line><span class=ln>36</span><span class=cl><span class=o>[</span>11:50:40<span class=o>]</span>: No sensitive/private information will be uploaded
</span></span><span class=line><span class=ln>37</span><span class=cl><span class=o>[</span>11:50:40<span class=o>]</span>: Successfully finished setting up fastlane
</span></span></code></pre></div><p>这部分会进行联网，并提示输入你的 Apple ID 来验证你的应用是否存在（没有也会帮你自动创建）并获取相应的关键信息，通过一系列的流程下来把获取的信息会创建一个 <code>fastlane</code> 目录
并并写入相应的文件（如果某些信息没有填写会忽略某些文件的生成）：</p><ul><li><code>Fastfile</code>: 核心文件，主要用于 cli 调用和处理具体的流程，<a href=https://github.com/fastlane/fastlane/tree/master/fastlane/docs#fastfile>了解详情</a></li><li><code>Appfile</code>: 从 Apple Developer Portal 获取和项目相关的信息，<a href=https://github.com/fastlane/fastlane/blob/master/fastlane/docs/Appfile.md>了解详情</a></li><li><code>Deliverfile</code>: 从 iTunes Connect 获取和项目相关的信息，<a href=https://github.com/fastlane/fastlane/blob/master/deliver/Deliverfile.md>了解详情</a></li></ul><p>抛开其他的几个文件先不说，大家先把注意力放到刚创建好的 <code>Fastfile</code> 文件上面（可能有变化，仅作参考），如果大家对 Ruby 有了解的话，它定义的 DSL 语言非常类似 <a href=https://github.com/ruby/rake>rake</a>，但流程上有参考的 <a href=https://github.com/rspec/rspec>rspec</a>，一旦不满足需求还可以使用 Ruby 代码来实现。单凭 DSL 语言来说就算对于 Ruby 没有基础的也能很快掌握，大多都是比较简单易懂的语法。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=ln> 1</span><span class=cl><span class=c1># Customise this file, documentation can be found here:</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl><span class=c1># https://github.com/fastlane/fastlane/tree/master/fastlane/docs</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=c1># All available actions: https://github.com/fastlane/fastlane/blob/master/fastlane/docs/Actions.md</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=c1># can also be listed using the `fastlane actions` command</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>
</span></span><span class=line><span class=ln> 6</span><span class=cl><span class=c1># Change the syntax highlighting to Ruby</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl><span class=c1># All lines starting with a # are ignored when running `fastlane`</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>
</span></span><span class=line><span class=ln> 9</span><span class=cl><span class=c1># If you want to automatically update fastlane if a new version is available:</span>
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=c1># update_fastlane</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>
</span></span><span class=line><span class=ln>12</span><span class=cl><span class=c1># This is the minimum version number required.</span>
</span></span><span class=line><span class=ln>13</span><span class=cl><span class=c1># Update this, if you use features of a newer version</span>
</span></span><span class=line><span class=ln>14</span><span class=cl><span class=n>fastlane_version</span> <span class=s2>&#34;1.95.0&#34;</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>
</span></span><span class=line><span class=ln>16</span><span class=cl><span class=n>default_platform</span> <span class=ss>:ios</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>
</span></span><span class=line><span class=ln>18</span><span class=cl><span class=n>platform</span> <span class=ss>:ios</span> <span class=k>do</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>  <span class=c1># 执行所有命令前都会先执行这里</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>  <span class=n>before_all</span> <span class=k>do</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>    <span class=c1># ENV[&#34;SLACK_URL&#34;] = &#34;https://hooks.slack.com/services/...&#34;</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>    <span class=n>cocoapods</span>
</span></span><span class=line><span class=ln>23</span><span class=cl>  <span class=k>end</span>
</span></span><span class=line><span class=ln>24</span><span class=cl>
</span></span><span class=line><span class=ln>25</span><span class=cl>  <span class=n>desc</span> <span class=s2>&#34;Runs all the tests&#34;</span>
</span></span><span class=line><span class=ln>26</span><span class=cl>  <span class=n>lane</span> <span class=ss>:test</span> <span class=k>do</span>
</span></span><span class=line><span class=ln>27</span><span class=cl>    <span class=nb>scan</span>
</span></span><span class=line><span class=ln>28</span><span class=cl>  <span class=k>end</span>
</span></span><span class=line><span class=ln>29</span><span class=cl>
</span></span><span class=line><span class=ln>30</span><span class=cl>  <span class=n>desc</span> <span class=s2>&#34;Submit a new Beta Build to Apple TestFlight&#34;</span>
</span></span><span class=line><span class=ln>31</span><span class=cl>  <span class=n>desc</span> <span class=s2>&#34;This will also make sure the profile is up to date&#34;</span>
</span></span><span class=line><span class=ln>32</span><span class=cl>  <span class=n>lane</span> <span class=ss>:beta</span> <span class=k>do</span>
</span></span><span class=line><span class=ln>33</span><span class=cl>    <span class=c1># match(type: &#34;appstore&#34;) # more information: https://codesigning.guide</span>
</span></span><span class=line><span class=ln>34</span><span class=cl>    <span class=n>gym</span><span class=p>(</span><span class=ss>scheme</span><span class=p>:</span> <span class=s2>&#34;AppDemo&#34;</span><span class=p>)</span> <span class=c1># Build your app - more options available</span>
</span></span><span class=line><span class=ln>35</span><span class=cl>    <span class=n>pilot</span>
</span></span><span class=line><span class=ln>36</span><span class=cl>
</span></span><span class=line><span class=ln>37</span><span class=cl>    <span class=c1># sh &#34;your_script.sh&#34;</span>
</span></span><span class=line><span class=ln>38</span><span class=cl>    <span class=c1># You can also use other beta testing services here (run `fastlane actions`)</span>
</span></span><span class=line><span class=ln>39</span><span class=cl>  <span class=k>end</span>
</span></span><span class=line><span class=ln>40</span><span class=cl>
</span></span><span class=line><span class=ln>41</span><span class=cl>  <span class=n>desc</span> <span class=s2>&#34;Deploy a new version to the App Store&#34;</span>
</span></span><span class=line><span class=ln>42</span><span class=cl>  <span class=n>lane</span> <span class=ss>:appstore</span> <span class=k>do</span>
</span></span><span class=line><span class=ln>43</span><span class=cl>    <span class=c1># match(type: &#34;appstore&#34;)</span>
</span></span><span class=line><span class=ln>44</span><span class=cl>    <span class=c1># snapshot</span>
</span></span><span class=line><span class=ln>45</span><span class=cl>    <span class=n>gym</span><span class=p>(</span><span class=ss>scheme</span><span class=p>:</span> <span class=s2>&#34;AppDemo&#34;</span><span class=p>)</span> <span class=c1># Build your app - more options available</span>
</span></span><span class=line><span class=ln>46</span><span class=cl>    <span class=n>deliver</span><span class=p>(</span><span class=ss>force</span><span class=p>:</span> <span class=kp>true</span><span class=p>)</span>
</span></span><span class=line><span class=ln>47</span><span class=cl>    <span class=c1># frameit</span>
</span></span><span class=line><span class=ln>48</span><span class=cl>  <span class=k>end</span>
</span></span><span class=line><span class=ln>49</span><span class=cl>
</span></span><span class=line><span class=ln>50</span><span class=cl>  <span class=c1># 你可以定义属于自己的 lane（任务）</span>
</span></span><span class=line><span class=ln>51</span><span class=cl>  <span class=n>lane</span> <span class=ss>:hello</span> <span class=k>do</span>
</span></span><span class=line><span class=ln>52</span><span class=cl>    <span class=nb>puts</span> <span class=s2>&#34;hello world&#34;</span>
</span></span><span class=line><span class=ln>53</span><span class=cl>  <span class=k>end</span>
</span></span><span class=line><span class=ln>54</span><span class=cl>
</span></span><span class=line><span class=ln>55</span><span class=cl>  <span class=c1># 仅当上述流程全部执行成功后才会走这里。其实应该定义为 after_success</span>
</span></span><span class=line><span class=ln>56</span><span class=cl>  <span class=n>after_all</span> <span class=k>do</span> <span class=o>|</span><span class=n>lane</span><span class=o>|</span>
</span></span><span class=line><span class=ln>57</span><span class=cl>    <span class=c1># slack(</span>
</span></span><span class=line><span class=ln>58</span><span class=cl>    <span class=c1>#   message: &#34;Successfully deployed new App Update.&#34;</span>
</span></span><span class=line><span class=ln>59</span><span class=cl>    <span class=c1># )</span>
</span></span><span class=line><span class=ln>60</span><span class=cl>  <span class=k>end</span>
</span></span><span class=line><span class=ln>61</span><span class=cl>
</span></span><span class=line><span class=ln>62</span><span class=cl>  <span class=c1># 如果流程发生异常会走这里并终止</span>
</span></span><span class=line><span class=ln>63</span><span class=cl>  <span class=n>error</span> <span class=k>do</span> <span class=o>|</span><span class=n>lane</span><span class=p>,</span> <span class=n>exception</span><span class=o>|</span>
</span></span><span class=line><span class=ln>64</span><span class=cl>    <span class=c1># slack(</span>
</span></span><span class=line><span class=ln>65</span><span class=cl>    <span class=c1>#   message: exception.message,</span>
</span></span><span class=line><span class=ln>66</span><span class=cl>    <span class=c1>#   success: false</span>
</span></span><span class=line><span class=ln>67</span><span class=cl>    <span class=c1># )</span>
</span></span><span class=line><span class=ln>68</span><span class=cl>  <span class=k>end</span>
</span></span><span class=line><span class=ln>69</span><span class=cl><span class=k>end</span>
</span></span></code></pre></div><p>通过上面的注解，我想大家对它已经有了初步的了解，那么定义完之后该如何执行呢？回到刚才的终端（关闭了？那再切换到刚才的 iOS 项目的根目录）：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln> 1</span><span class=cl>$ fastlane ios hello
</span></span><span class=line><span class=ln> 2</span><span class=cl><span class=o>[</span>11:56:24<span class=o>]</span>: -------------------------------------------------
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=o>[</span>11:56:24<span class=o>]</span>: --- Step: Verifying required fastlane version ---
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=o>[</span>11:56:24<span class=o>]</span>: -------------------------------------------------
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=o>[</span>11:56:24<span class=o>]</span>: fastlane version valid
</span></span><span class=line><span class=ln> 6</span><span class=cl><span class=o>[</span>11:56:24<span class=o>]</span>: ------------------------------
</span></span><span class=line><span class=ln> 7</span><span class=cl><span class=o>[</span>11:56:24<span class=o>]</span>: --- Step: default_platform ---
</span></span><span class=line><span class=ln> 8</span><span class=cl><span class=o>[</span>11:56:24<span class=o>]</span>: ------------------------------
</span></span><span class=line><span class=ln> 9</span><span class=cl><span class=o>[</span>11:56:24<span class=o>]</span>: Driving the lane <span class=s1>&#39;ios hello&#39;</span> 🚀
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=o>[</span>11:56:24<span class=o>]</span>: -----------------------
</span></span><span class=line><span class=ln>11</span><span class=cl><span class=o>[</span>11:56:24<span class=o>]</span>: --- Step: cocoapods ---
</span></span><span class=line><span class=ln>12</span><span class=cl><span class=o>[</span>11:56:24<span class=o>]</span>: -----------------------
</span></span><span class=line><span class=ln>13</span><span class=cl><span class=o>[</span>11:56:24<span class=o>]</span>: $ pod install
</span></span><span class=line><span class=ln>14</span><span class=cl>...
</span></span><span class=line><span class=ln>15</span><span class=cl><span class=o>[</span>11:56:28<span class=o>]</span>: hello world
</span></span><span class=line><span class=ln>16</span><span class=cl>
</span></span><span class=line><span class=ln>17</span><span class=cl>+------+-------------------------------------+-------------+
</span></span><span class=line><span class=ln>18</span><span class=cl><span class=p>|</span>                     fastlane summary                     <span class=p>|</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>+------+-------------------------------------+-------------+
</span></span><span class=line><span class=ln>20</span><span class=cl><span class=p>|</span> Step <span class=p>|</span> Action                              <span class=p>|</span> Time <span class=o>(</span>in s<span class=o>)</span> <span class=p>|</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>+------+-------------------------------------+-------------+
</span></span><span class=line><span class=ln>22</span><span class=cl><span class=p>|</span> <span class=m>1</span>    <span class=p>|</span> Verifying required fastlane version <span class=p>|</span> <span class=m>0</span>           <span class=p>|</span>
</span></span><span class=line><span class=ln>23</span><span class=cl><span class=p>|</span> <span class=m>2</span>    <span class=p>|</span> default_platform                    <span class=p>|</span> <span class=m>0</span>           <span class=p>|</span>
</span></span><span class=line><span class=ln>24</span><span class=cl><span class=p>|</span> <span class=m>3</span>    <span class=p>|</span> cocoapods                           <span class=p>|</span> <span class=m>4</span>           <span class=p>|</span>
</span></span><span class=line><span class=ln>25</span><span class=cl>+------+-------------------------------------+-------------+
</span></span><span class=line><span class=ln>26</span><span class=cl>
</span></span><span class=line><span class=ln>27</span><span class=cl><span class=o>[</span>11:56:28<span class=o>]</span>: fastlane.tools finished successfully 🎉
</span></span></code></pre></div><p>哒哒！一个简单的任务执行完毕！</p><p>如果大家注意观察上面的文件可能注意到一些小细节：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=ln> 1</span><span class=cl><span class=c1># 自动更新 fastlane 工具，需要 rubygems &gt;= 2.1.0</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl><span class=n>update_fastlane</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=c1># 最低兼容版本，由于 fastlane 还是逐步健壮的阶段更新速度还是蛮快的，</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=c1># 为了防止新特性在旧版本的不支持会强制设置一个最低兼容版本</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl><span class=c1># 不过工具特别贴心的会在每次执行之后会检查是否有新版本，如果有会在最后末尾追加新版本提醒</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl><span class=n>fastlane_version</span> <span class=s2>&#34;1.95.0&#34;</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>
</span></span><span class=line><span class=ln> 9</span><span class=cl><span class=c1># 默认使用平台是 ios，也就是说文件可以定义多个平台，</span>
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=c1># 通过上述执行的命令也能看出来是执行的 ios 平台下面的 hello 任务。</span>
</span></span><span class=line><span class=ln>11</span><span class=cl><span class=c1># 这个的作用是可以在执行 fastlane 的时候省略 ios，不信你执行 fastlane hello 试试。</span>
</span></span><span class=line><span class=ln>12</span><span class=cl><span class=n>default_platform</span> <span class=ss>:ios</span>
</span></span></code></pre></div><h2 id=android-的支持>Android 的支持</h2><p>这个的支持我觉得关键是社区的呼声太大，加上贡献者的热情（我提交过许多 issues 和个别 PL，响应非常的迅速）很快就加上了其支持，
但具体的特性不是特别多，主要是对于 <code>gradle</code> 的封装，我先不做展开介绍，大家可以先看看<a href=https://github.com/fastlane/fastlane/blob/master/fastlane/docs/Android.md>官方文档</a>，如果后续有特别不明白的地方我在做具体的讲解。</p><p>今天就先写到这里后续我会继续整理更多的使用指南和实战范例共大家参考，最后给大家附赠官方给大家的一些<a href=https://github.com/fastlane/examples>范例</a>。</p></div></div><div class=post-nav><a href=https://icyleaf.com/2015/12/a-history-of-my-blog/ class=prev rel=prev title=博客迁徙记><i class="iconfont icon-left"></i>&nbsp;博客迁徙记</a>
<a href=https://icyleaf.com/2016/07/gitlab-api-wrapper-for-crystal/ class=next rel=next title="Gitlab API Wrapper for Crystal">Gitlab API Wrapper for Crystal&nbsp;<i class="iconfont icon-right"></i></a></div><div class=post-comment><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//icyleaf.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></article></div></main><footer class=footer><div class=copyright>&copy;
<span itemprop=copyrightYear>2005 - 2022</span>
<span>🍺</span>
<span class=author itemprop=copyrightHolder><a href=https://icyleaf.com/>icyleaf</a></span></div></footer><script src=https://fastly.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js crossorigin=anonymous></script>
<script defer src=https://icyleaf.com/js/vendor_main.min.js></script>
<script src=https://fastly.jsdelivr.net/npm/pangu@4.0.7/dist/browser/pangu.min.js integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin=anonymous></script>
<script>pangu.spacingPage()</script><script type=module>
  
  import PhotoSwipeLightbox from '\/photoswipe\/photoswipe-lightbox.esm.js';

  const lightbox = new PhotoSwipeLightbox({
    gallery: '#post-gallery',
    children: 'a.gallery-item',
    pswpModule: '\/photoswipe\/photoswipe.esm.js',
  });
  lightbox.init();
</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-TKQBZ7R259"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-TKQBZ7R259")</script></div></body></html>