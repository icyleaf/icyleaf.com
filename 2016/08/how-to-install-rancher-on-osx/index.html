<!doctype html><html lang=zh-cn dir=auto></html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>如何在 OS X 上安装 Rancher | icyleaf</title><meta name=keywords content="Mac,OSX,Docker,Rancher"><meta name=description content="Rancher 0.x 版本部署指南"><meta name=author content="icyleaf"><link rel=canonical href=https://icyleaf.com/2016/08/how-to-install-rancher-on-osx/><link rel=icon href=https://icyleaf.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://icyleaf.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://icyleaf.com/favicon-32x32.png><link rel=icon type=image/png sizes=192x192 href=https://icyleaf.com/android-chrome-192x192.png><link rel=icon type=image/png sizes=512x512 href=https://icyleaf.com/android-chrome-512x512.png><link rel=apple-touch-icon href=https://icyleaf.com/apple-touch-icon.png><link rel=mask-icon href=https://icyleaf.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=stylesheet href=https://icyleaf.com/css/main.min.css><link rel=stylesheet href=https://icyleaf.com/font/iconfont.min.css><link rel=stylesheet href=https://icyleaf.com/font-ali/iconfont.min.css><link rel=stylesheet href=https://icyleaf.com/photoswipe/photoswipe.min.css><link rel=canonical href=https://icyleaf.com/2016/08/how-to-install-rancher-on-osx/><meta property="og:title" content="如何在 OS X 上安装 Rancher"><meta property="og:description" content="Rancher 0.x 版本部署指南"><meta property="og:type" content="article"><meta property="og:url" content="https://icyleaf.com/2016/08/how-to-install-rancher-on-osx/"><meta property="og:image" content="https://icyleaf.com/uploads/2016/08/05/rancher_overview.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2016-08-05T17:21:08+08:00"><meta property="article:modified_time" content="2016-08-05T17:21:08+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://icyleaf.com/uploads/2016/08/05/rancher_overview.png"><meta name=twitter:title content="如何在 OS X 上安装 Rancher"><meta name=twitter:description content="Rancher 0.x 版本部署指南"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://icyleaf.com/posts/"},{"@type":"ListItem","position":2,"name":"如何在 OS X 上安装 Rancher","item":"https://icyleaf.com/2016/08/how-to-install-rancher-on-osx/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"如何在 OS X 上安装 Rancher","name":"如何在 OS X 上安装 Rancher","description":"Rancher 0.x 版本部署指南","keywords":["Mac","OSX","Docker","Rancher"],"articleBody":" 更新 Feb 22, 2022\n以下内容写于 Rancker 0.x 版本，后续版本变更比较大本文不再有没有参考。 Rancher 是 Docker 编排解决方案的一种，好处在于可以做容器编排，网络，存储，负载均衡，还能够支持云服务器（比如 Amazon EC2/Azure/DigitalOcean）也能够兼容 Docker Swarm/Mesos/Kubernetes 等其他的解决方案。自它还没有发布 1.0 版本之前也有持续的关注。它自身还有个 RancherOS 对于 CoreOS 也是一个不小的威胁。\n由于它提供非常优化的后台管理界面，同时也提供 REST API，日常开发使用中异常的方便。如果非要说出一点不好的，那可能就是它对内存有点小要求：最小 1GB 内存，因此如果想放在自己 VPS 上的童鞋需要评估下了。\nMac 安装 这块也趁着 Docker for Mac 的好处，终于摆脱的 docker-machine 的折磨，不用在依赖 VirtualBox，也不在每次装载 machine 的变量和查找虚拟机的 IP。映射的端口端口都通过 localhost 访问。\nRancher 通过 Docker 来安装本来说是非常简单的，它分为服务端和客户端。本教程以 Single Node 来讲解，不考虑 Multi Node。\n这块网上一直没有太好的解决方案，我看很多国外给出的解决方案也比较麻烦，主要是由于 Docker for mac 使用的是 xhyve 作为轻量化的虚拟化方案，而 rancher 安装 server 端没有任何问题，在添加主机的时候需要通过 HTTP 来连接 server 端而失败。下面我来带大家用最简单的方案来拆解。无需任何第三方的辅助。\n服务端 如果网速连接 docker hub 过慢可考虑使用代理设置或者国内的镜像服务，我这里分享一个 https://docker.mirrors.ustc.edu.cn，可在 Docker -\u003e Preferences… -\u003e Advanced -\u003e Registry Mirror 添加。\n1$ docker run -d --name rancher-server --restart=always -p 8080:8080 rancher/server 2$ docker logs -f rancher-server 3 4time=\"2016-08-05T16:48:52Z\" level=info msg=\"Creating schema machine, roles [service]\" id=1ds17 5time=\"2016-08-05T16:48:53Z\" level=info msg=\"Creating schema machine, roles [project member owner]\" id=1ds18 6time=\"2016-08-05T16:48:53Z\" level=info msg=\"Creating schema machine, roles [admin user readAdmin]\" id=1ds19 7time=\"2016-08-05T16:48:53Z\" level=info msg=\"Creating schema machine, roles [readonly]\" id=1ds20 看到如上类似的日志说明服务已经初始化完毕，通过浏览器访问 http://localhost:8080 就可以看到后台管理界面。\n客户端 先不着急继续页面操作，回到终端上执行如下命令获取 rancher-server 容器的 IP 地址备用\n1$ docker inspect --format '{{ .NetworkSettings.IPAddress }}' rancher-server 2172.17.0.2 接着上面的步骤，在打开页面能看到 Add Host 按钮并点击对于弹出 “Host Registration URL” 选择 “Something else:” 在后面的输入框填入上面的 IP 和端口号 http://172.17.0.2:8080 并保存。\n之后就是给你一个客户端（部署主机）的选项，由于我们只添加本机作为部署主机使用，因此这里选择 Custom，其他不用任何设置，直接滑倒最底部找到一个执行 docker 命令的区域：\n1$ docker run -d --privileged -v /var/run/docker.sock:/var/run/docker.sock -v /var/lib/rancher:/var/lib/rancher rancher/agent:v1.0.2 http://172.17.0.2:8080/v1/scripts/676576FFEC2212A68391:1470416400000:tfqxfdglHL6Qw8dpLVtbOesYY4 你会发现执行可能会报错：\n1docker: Error response from daemon: Mounts denied: 2The path /var/lib/rancher 3is not shared from OS X and is not known to Docker. 4You can configure shared paths from Docker -\u003e Preferences... -\u003e File Sharing. 5See https://docs.docker.com/docker-for-mac/osxfs/#namespaces for more info. 目前有可能是一个 Docker 的 Bug，因为 /var/lib/rancher 是挂载到已经默认添加 /private 文件共享，但是它还是报错，如果你在 Docker 设置的 File Sharing 添加的话它也不会让你添加，因此我们需要做一点小修改：\n1$ docker run -d --privileged -v /var/run/docker.sock:/var/run/docker.sock -v ${HOME}/docker/rancher/var/lib/rancher:/var/lib/rancher rancher/agent:v1.0.2 http://172.17.0.2:8080/v1/scripts/676576FFEC2212A68391:1470416400000:tfqxfdglHL6Qw8dpLVtbOesYY4 25cf22a10cf28b4182b6e205fa631146e86d67c3c9d86901ff8cf7ab087319a29 最后点击页面的 Close 后会跳转到 Host 的列表，你就能惊喜的发现添加成功了！\n结尾 本篇只先解决这一个问题，更多使用的资料请看Rancher 实战红宝书。\n","wordCount":"1106","inLanguage":"zh-cn","image":"https://icyleaf.com/uploads/2016/08/05/rancher_overview.png","datePublished":"2016-08-05T17:21:08+08:00","dateModified":"2016-08-05T17:21:08+08:00","author":{"@type":"Person","name":"icyleaf"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://icyleaf.com/2016/08/how-to-install-rancher-on-osx/"},"publisher":{"@type":"Organization","name":"icyleaf","logo":{"@type":"ImageObject","url":"https://icyleaf.com/favicon.ico"}}}</script></head><body><div class=wrapper><nav class=navbar><progress class=content_progress max=0 value=0></progress><div class=container><div class="navbar-header header-logo"><a href=https://icyleaf.com/>icyleaf</a></div><div class=navbar-right><span class=menu><a class=menu-item href=https://icyleaf.com/series/homelab title>homelab 系列</a>
<a class=menu-item href=https://icyleaf.com/projects title>开源项目</a>
<a class=menu-item href=https://icyleaf.com/about title>关于</a>
<span class=divide></span>
<a href=javascript:void(0); class=theme-switch><i class="iconfont icon-dark-mode"></i></a></span></div></div></nav><nav class=navbar-mobile id=nav-mobile style=display:none><progress class=content_progress max=0 value=0></progress><div class=container><div class=navbar><div class="navbar-header header-logo"><a href=https://icyleaf.com/>icyleaf</a></div><div class=navbar-right><div><a href=javascript:void(0); class=theme-switch><i class="iconfont icon-dark-mode"></i></a></div><div class=menu-toggle><span></span><span></span><span></span></div></div></div><div class=menu id=mobile-menu><nav class=mb-md><a class=menu-item href=https://icyleaf.com/series/homelab title><h3>homelab 系列</h3><div class=menu-active></div></a><a class=menu-item href=https://icyleaf.com/projects title><h3>开源项目</h3><div class=menu-active></div></a><a class=menu-item href=https://icyleaf.com/about title><h3>关于</h3><div class=menu-active></div></a></nav></div></div></nav><main class=main><div class=post-cover><img src=https://icyleaf.com/uploads/2016/08/05/rancher_overview.png loading=lazy></div><div class=container><article class=post-warp itemscope itemtype=http://schema.org/Article><header class=post-header><h1 class=post-title itemprop=description>如何在 OS X 上安装 Rancher</h1><div class=post-description>Rancher 0.x 版本部署指南</div><div class=post-meta><time datetime=2016-08-05 itemprop=datePublished>2016-08-05</time>
·
<span class=tags>Mac, OSX, Docker, Rancher</span>
·
<span class=post-word-count>1106 words · 5 minutes</span></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>目录</h2><div class="post-toc-content always-active"><nav id=TableOfContents><ul><li><a href=#mac-安装>Mac 安装</a><ul><li><a href=#服务端>服务端</a></li><li><a href=#客户端>客户端</a></li></ul></li><li><a href=#结尾>结尾</a></li></ul></nav></div></div><div class=post-content><div id=post-gallery><div class=updated><header class=updated-header><h4 class=updated-title>更新</h4><p class=updated-meta>Feb 22, 2022</p></header><article class=updated-body>以下内容写于 Rancker 0.x 版本，后续版本变更比较大本文不再有没有参考。</article></div><p>Rancher 是 Docker 编排解决方案的一种，好处在于可以做容器编排，网络，存储，负载均衡，还能够支持云服务器（比如 Amazon EC2/Azure/DigitalOcean）也能够兼容 Docker Swarm/Mesos/Kubernetes 等其他的解决方案。自它还没有发布 <a href=http://rancher.com/announcing-rancher-1-0-ga/>1.0</a> 版本之前也有持续的关注。它自身还有个 <a href=http://www.infoq.com/cn/news/2015/03/rancheros-docker-linux>RancherOS</a> 对于 CoreOS 也是一个不小的威胁。</p><p>由于它提供非常优化的后台管理界面，同时也提供 REST API，日常开发使用中异常的方便。如果非要说出一点不好的，那可能就是它对内存有点小要求：<strong>最小 1GB 内存</strong>，因此如果想放在自己 VPS 上的童鞋需要评估下了。</p><h2 id=mac-安装>Mac 安装</h2><p>这块也趁着 <a href=https://docs.docker.com/docker-for-mac/>Docker for Mac</a> 的好处，终于摆脱的 <code>docker-machine</code> 的折磨，不用在依赖 VirtualBox，也不在每次装载 machine 的变量和查找虚拟机的 IP。映射的端口端口都通过 <code>localhost</code> 访问。</p><p>Rancher 通过 Docker 来安装本来说是非常简单的，它分为服务端和客户端。本教程以 <a href=http://docs.rancher.com/rancher/latest/en/installing-rancher/installing-server/>Single Node</a> 来讲解，不考虑 <a href=http://docs.rancher.com/rancher/latest/en/installing-rancher/installing-server/multi-nodes/>Multi Node</a>。</p><p>这块网上一直没有太好的解决方案，我看很多国外给出的<a href=https://gist.github.com/axnux/09dc375d71398cbbee44ebd23ba35a08>解决方案</a>也比较麻烦，主要是由于 Docker for mac 使用的是 xhyve 作为轻量化的虚拟化方案，而 rancher 安装 server 端没有任何问题，在添加主机的时候需要通过 HTTP 来连接 server 端而失败。下面我来带大家用最简单的方案来拆解。无需任何第三方的辅助。</p><h3 id=服务端>服务端</h3><blockquote><p>如果网速连接 docker hub 过慢可考虑使用代理设置或者国内的镜像服务，我这里分享一个 <code>https://docker.mirrors.ustc.edu.cn</code>，可在 Docker -> Preferences&mldr; -> Advanced -> Registry Mirror 添加。</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>$ docker run -d --name rancher-server --restart<span class=o>=</span>always -p 8080:8080 rancher/server
</span></span><span class=line><span class=ln>2</span><span class=cl>$ docker logs -f rancher-server
</span></span><span class=line><span class=ln>3</span><span class=cl>
</span></span><span class=line><span class=ln>4</span><span class=cl><span class=nv>time</span><span class=o>=</span><span class=s2>&#34;2016-08-05T16:48:52Z&#34;</span> <span class=nv>level</span><span class=o>=</span>info <span class=nv>msg</span><span class=o>=</span><span class=s2>&#34;Creating schema machine, roles [service]&#34;</span> <span class=nv>id</span><span class=o>=</span>1ds17
</span></span><span class=line><span class=ln>5</span><span class=cl><span class=nv>time</span><span class=o>=</span><span class=s2>&#34;2016-08-05T16:48:53Z&#34;</span> <span class=nv>level</span><span class=o>=</span>info <span class=nv>msg</span><span class=o>=</span><span class=s2>&#34;Creating schema machine, roles [project member owner]&#34;</span> <span class=nv>id</span><span class=o>=</span>1ds18
</span></span><span class=line><span class=ln>6</span><span class=cl><span class=nv>time</span><span class=o>=</span><span class=s2>&#34;2016-08-05T16:48:53Z&#34;</span> <span class=nv>level</span><span class=o>=</span>info <span class=nv>msg</span><span class=o>=</span><span class=s2>&#34;Creating schema machine, roles [admin user readAdmin]&#34;</span> <span class=nv>id</span><span class=o>=</span>1ds19
</span></span><span class=line><span class=ln>7</span><span class=cl><span class=nv>time</span><span class=o>=</span><span class=s2>&#34;2016-08-05T16:48:53Z&#34;</span> <span class=nv>level</span><span class=o>=</span>info <span class=nv>msg</span><span class=o>=</span><span class=s2>&#34;Creating schema machine, roles [readonly]&#34;</span> <span class=nv>id</span><span class=o>=</span>1ds20
</span></span></code></pre></div><p>看到如上类似的日志说明服务已经初始化完毕，通过浏览器访问 <code>http://localhost:8080</code> 就可以看到后台管理界面。</p><h3 id=客户端>客户端</h3><p>先不着急继续页面操作，回到终端上执行如下命令获取 rancher-server 容器的 IP 地址备用</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>$ docker inspect --format <span class=s1>&#39;{{ .NetworkSettings.IPAddress }}&#39;</span> rancher-server
</span></span><span class=line><span class=ln>2</span><span class=cl>172.17.0.2
</span></span></code></pre></div><p>接着上面的步骤，在打开页面能看到 Add Host 按钮并点击对于弹出 “Host Registration URL” 选择 “Something else:” 在后面的输入框填入上面的 IP 和端口号 <code>http://172.17.0.2:8080</code> 并保存。</p><p>之后就是给你一个客户端（部署主机）的选项，由于我们只添加本机作为部署主机使用，因此这里选择 Custom，其他不用任何设置，直接滑倒最底部找到一个执行 docker 命令的区域：</p><p><img loading=lazy src=http://ww2.sinaimg.cn/large/006tNbRwjw1f6jdkffiqhj31ee150k0c.jpg alt="add rancher host"></img></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>$ docker run -d --privileged -v /var/run/docker.sock:/var/run/docker.sock -v /var/lib/rancher:/var/lib/rancher rancher/agent:v1.0.2 http://172.17.0.2:8080/v1/scripts/676576FFEC2212A68391:1470416400000:tfqxfdglHL6Qw8dpLVtbOesYY4
</span></span></code></pre></div><p>你会发现执行可能会报错：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>docker: Error response from daemon: Mounts denied:
</span></span><span class=line><span class=ln>2</span><span class=cl>The path /var/lib/rancher
</span></span><span class=line><span class=ln>3</span><span class=cl>is not shared from OS X and is not known to Docker.
</span></span><span class=line><span class=ln>4</span><span class=cl>You can configure shared paths from Docker -&gt; Preferences... -&gt; File Sharing.
</span></span><span class=line><span class=ln>5</span><span class=cl>See https://docs.docker.com/docker-for-mac/osxfs/#namespaces <span class=k>for</span> more info.
</span></span></code></pre></div><p>目前有可能是一个 Docker 的 Bug，因为 <code>/var/lib/rancher</code> 是挂载到已经默认添加 <code>/private</code> 文件共享，但是它还是报错，如果你在 Docker 设置的 File Sharing 添加的话它也不会让你添加，因此我们需要做一点小修改：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=ln>1</span><span class=cl>$ docker run -d --privileged -v /var/run/docker.sock:/var/run/docker.sock -v <span class=si>${</span><span class=nv>HOME</span><span class=si>}</span>/docker/rancher/var/lib/rancher:/var/lib/rancher rancher/agent:v1.0.2 http://172.17.0.2:8080/v1/scripts/676576FFEC2212A68391:1470416400000:tfqxfdglHL6Qw8dpLVtbOesYY4
</span></span><span class=line><span class=ln>2</span><span class=cl>5cf22a10cf28b4182b6e205fa631146e86d67c3c9d86901ff8cf7ab087319a29
</span></span></code></pre></div><p>最后点击页面的 Close 后会跳转到 Host 的列表，你就能惊喜的发现添加成功了！</p><p><img loading=lazy src=http://ww2.sinaimg.cn/large/006tNbRwjw1f6jdidcojkj315y0m4dik.jpg alt="rancher host"></img></p><h2 id=结尾>结尾</h2><p>本篇只先解决这一个问题，更多使用的资料请看<a href=http://rancher.hidocker.io/>Rancher 实战红宝书</a>。</p></div></div><div class=post-nav><a href=https://icyleaf.com/2016/07/fastlane-in-action/ class=prev rel=prev title="深入浅出 Fastlane 一看你就懂"><i class="iconfont icon-left"></i>&nbsp;深入浅出 Fastlane 一看你就懂</a>
<a href=https://icyleaf.com/2016/12/docker-with-centos/ class=next rel=next title="Docker 摸爬滚打对抗 CentOS 6">Docker 摸爬滚打对抗 CentOS 6&nbsp;<i class="iconfont icon-right"></i></a></div><div class=post-comment><script>var getTheme=window.localStorage&&window.localStorage.getItem("blog-dark-mode"),getTheme=getTheme??"github-light";let theme=getTheme==="dark"?"github-dark":"github-light",s=document.createElement("script");s.src="https://utteranc.es/client.js",s.setAttribute("repo","icyleaf/icyleaf.com"),s.setAttribute("issue-term","pathname"),s.setAttribute("theme",theme),s.setAttribute("crossorigin","anonymous"),s.setAttribute("async",""),document.querySelector("div.post-comment").innerHTML="",document.querySelector("div.post-comment").appendChild(s)</script></div></article></div></main><footer class=footer><div class=copyright>&copy;
<span itemprop=copyrightYear>2005 - 2023</span>
<span>🍺</span>
<span class=author itemprop=copyrightHolder><a href=https://icyleaf.com/>icyleaf</a></span></div></footer><script defer src=https://fastly.jsdelivr.net/npm/jquery@3.6.4/dist/jquery.min.js crossorigin=anonymous></script><script defer src=https://icyleaf.com/js/vendor_main.min.js></script>
<script type=module>
  
  import PhotoSwipeLightbox from '\/photoswipe\/photoswipe-lightbox.esm.js';

  const lightbox = new PhotoSwipeLightbox({
    gallery: '#post-gallery',
    children: 'a.gallery-item',
    pswpModule: () => import('\/photoswipe\/photoswipe.esm.js'),
  });
  lightbox.init();
</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-TKQBZ7R259"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-TKQBZ7R259")</script></div></body></html>