<!doctype html><html lang=zh><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta property=og:title content="如何获取 Element 的 XPath [PHP/Javascript] &middot;  icyleaf"><meta property=og:site_name content=icyleaf><meta property=og:url content=https://icyleaf.com/2010/04/how-to-get-xpath-of-an-element-for-php-and-javascript/><meta property=og:type content=article><meta property=og:article:published_time content=2010-04-02T12:34:56&#43;08:00><meta property=og:article:tag content=PHP><meta property=og:article:tag content=Javascript><title>如何获取 Element 的 XPath [PHP/Javascript] &middot; icyleaf</title><meta name=description content=热爱户外的码农、下厨初心者><meta name=HandheldFriendly content=True><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://icyleaf.com/images/favicon.ico><link rel=apple-touch-icon href=https://icyleaf.com/images/apple-touch-icon.png><link rel=stylesheet href=https://icyleaf.com/css/screen.css><link rel=stylesheet href=https://icyleaf.com/css/nav.css><link rel=stylesheet href=https://icyleaf.com/css/highlight/tomorrow-night.css><script src=https://icyleaf.com/js/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script><link href=https://icyleaf.com/index.xml rel=alternate type=application/rss+xml title=icyleaf><meta name=generator content="Hugo 0.47.1"><link rel=canonical href=https://icyleaf.com/2010/04/how-to-get-xpath-of-an-element-for-php-and-javascript/><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-2570916-5','auto');ga('send','pageview');</script></head><body class=nav-closed><div class=nav><h3 class=nav-title>Menu</h3><a href=# class=nav-close><span class=hidden>Close</span></a><ul><li class=nav-opened role=presentation><a href=https://icyleaf.com/>Home</a><li class=nav-opened role=presentation><a href=https://icyleaf.com/categories/technology>Technology</a><li class=nav-opened role=presentation><a href=https://icyleaf.com/tags>Tags</a><li class=nav-opened role=presentation><a href=https://icyleaf.com/about>About</a></ul><a class="subscribe-button icon-feed" href=https://icyleaf.com/2010/04/how-to-get-xpath-of-an-element-for-php-and-javascript/>Subscribe</a></div><span class=nav-cover></span><div class=site-wrapper><header class="main-header post-head no-cover"><nav class="main-nav overlay clearfix"><a class=blog-logo href=https://icyleaf.com/><img src=https://icyleaf.com/images/icyleaf-icon.png alt="Blog Logo"></a>
<a class=menu-button href=#><span class=burger>&#9776;</span><span class=word>Menu</span></a></nav></header><main class=content role=main><article class="post post"><header class=post-header><h1 class=post-title>如何获取 Element 的 XPath [PHP/Javascript]</h1><small></small><section class=post-meta><time class=post-date datetime=2010-04-02T12:34:56&#43;08:00>Apr 2, 2010</time>
<span class="post-tag small"><a href=https://icyleaf.com/tags/php/>#PHP</a></span>
<span class="post-tag small"><a href=https://icyleaf.com/tags/javascript/>#Javascript</a></span></section></header><section class=post-content><p>这两天研究 HTML 的 DOM 需要寻找某个 Element 元素的完整 XPath 路径，由于使用的是 <a href=http://simplehtmldom.sourceforge.net/manual.htm>PHP Simple HTML DOM Parser</a> 开源库，这个库类的使用方法几乎兼容 Javascript 的 DOM 语法并附带 DOM 选择器。虽然功能强大但是并不能直接获取 Element 的 XPath。这个怎么办呢，依稀记得 Firebug 有一个功能，选择某个元素在它的控制台可以显示 XPath。嗯，着手实践一下发现不仅可以显示而且还可以复制 XPath。<p>于是想，如果可以找到 Javascript 版的相关代码就一定可以改成 PHP 版本的，结果在 Google 搜索找到了&hellip;<pre><code>var elt = document.getElementById('table');
var xpath = getElementXPath(elt);alert(xpath);

// Get full XPath of an element
function getElementXPath(elt){  
	var path = &quot;&quot;;   
	for (; elt &amp;&amp; elt.nodeType == 1; elt = elt.parentNode)   
	{        
		idx = getElementIdx(elt);        
		xname = elt.tagName;     
		if (idx &gt; 1) xname += &quot;[&quot; + idx + &quot;]&quot;;       
		path = &quot;/&quot; + xname + path;   
	}
	return path;    
}

// Get Idx of an element
function getElementIdx(elt){    
	var count = 1;    
	for (var sib = elt.previousSibling; sib ; sib = sib.previousSibling)    
	{        
		if(sib.nodeType == 1 &amp;&amp; sib.tagName == elt.tagName)  count++    
	}        
	return count;
}
</code></pre><p>PHP 改进版：<pre><code>// Use it before import PHP Simple HTML DOM Parser
$html = file_get_html('http://www.google.com/');

// find a sample element by id
$elt1 = $html-&gt;find('#footer', 0);

// find a sample element by tag name
$elt2= $html-&gt;find('div', 10);

// it will return if found it: [@id=&quot;footer&quot;]
$xpath = getElementXPath($elt1);

// it will return if found it: html/body/div[10]
$xpath = getElementXPath($elt2);

function getElementXPath($elt){    
	$path = '';  
	$first = TRUE;   
	for(; ($elt AND $elt-&gt;nodetype == 1); $elt = $elt-&gt;parent())
	{        
		$xname = $elt-&gt;tag;      
		$idx = getElementIdx($elt);           
		if ($first AND isset($elt-&gt;attr['id']))      
		{            
			$path = '//*[@id=&quot;' . $elt-&gt;attr['id'] . '&quot;]';           
			break;      
		}             

		if ($idx &gt; 1)       
		{            
			%xname .= '[' . $idx . ']';      
		}             

		$path = '/'.$xname.$path;             
		$first = FALSE;  
	}     

	return $path;
}

function getElementIdx($elt){    
	$count = 1;    
	for($sib = $elt-&gt;prev_sibling(); $sib ; $sib = $sib-&gt;prev_sibling())    
	{        
		if($sib-&gt;nodetype == 1 &amp;&amp; $sib-&gt;tag == $elt-&gt;tag)        
		{         
			$count++;        
		}    
	}        
	return $count;
}
</code></pre><p>大家同样可以把上面的代码直接 crack 到 PHP Simple HTML DOM Parser 库中。</section><footer class=post-footer><figure class=author-image><a class=img href=https://icyleaf.com/ style=background-image:url(/images/icyleaf-icon.png)><span class=hidden>icyleaf's Picture</span></a></figure><section class=author><h4><a href=https://icyleaf.com/>icyleaf</a></h4><p>热爱户外的码农、下厨初心者<div class=author-meta><span class="author-location icon-location">Beijing, China</span>
<span class="author-link icon-link"><a href=https://icyleaf.com>https://icyleaf.com</a></span></div></section><section class=share><h4>Share this post</h4><a class=icon-twitter href="https://twitter.com/share?text=%e5%a6%82%e4%bd%95%e8%8e%b7%e5%8f%96%20Element%20%e7%9a%84%20XPath%20%5bPHP%2fJavascript%5d&nbsp;-&nbsp;icyleaf&amp;url=https%3a%2f%2ficyleaf.com%2f2010%2f04%2fhow-to-get-xpath-of-an-element-for-php-and-javascript%2f" onclick="window.open(this.href,'twitter-share','width=550,height=235');return false;"><span class=hidden>Twitter</span></a>
<a class=icon-facebook href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ficyleaf.com%2f2010%2f04%2fhow-to-get-xpath-of-an-element-for-php-and-javascript%2f" onclick="window.open(this.href,'facebook-share','width=580,height=296');return false;"><span class=hidden>Facebook</span></a>
<a class=icon-weibo href="http://service.weibo.com/share/share.php?url=https%3a%2f%2ficyleaf.com%2f2010%2f04%2fhow-to-get-xpath-of-an-element-for-php-and-javascript%2f&amp;title=%e5%a6%82%e4%bd%95%e8%8e%b7%e5%8f%96%20Element%20%e7%9a%84%20XPath%20%5bPHP%2fJavascript%5d&nbsp;-&nbsp;icyleaf" onclick="window.open(this.href,'weibo-share','width=580,height=296');return false;"><span class=hidden>新浪微博</span></a>
<a class=icon-douban href="https://www.douban.com/recommend/?url=https%3a%2f%2ficyleaf.com%2f2010%2f04%2fhow-to-get-xpath-of-an-element-for-php-and-javascript%2f&title=%e5%a6%82%e4%bd%95%e8%8e%b7%e5%8f%96%20Element%20%e7%9a%84%20XPath%20%5bPHP%2fJavascript%5d&v=1" onclick="window.open(this.href,'douban-share','width=580,height=300');return false;"><span class=hidden>豆瓣</span></a></section><div id=disqus_thread></div><script>var disqus_config=function(){this.page.url="https:\/\/icyleaf.com\/2010\/04\/how-to-get-xpath-of-an-element-for-php-and-javascript\/";this.page.identifier="https:\/\/icyleaf.com\/2010\/04\/how-to-get-xpath-of-an-element-for-php-and-javascript\/";};(function(){var d=document,s=d.createElement('script');s.src='https://icyleaf.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></footer></article></main><aside class=read-next><a class=read-next-story style=no-cover href=https://icyleaf.com/2010/05/nginx-with-fastcgi-build-kohana/><section class=post><h2>Nginx&#43;FastCGI 环境搭建 Kohana</h2></section></a><a class="read-next-story prev" style=no-cover href=https://icyleaf.com/2010/01/douban-api-package/><section class=post><h2>Douban API Package 发布！</h2></section></a></aside><footer class="site-footer clearfix"><section class=copyright><a href>icyleaf</a> All rights reserved - 2019</section><section class=poweredby>Proudly generated by <a class=icon-hugo href=http://gohugo.io>HUGO</a>, with <a class=icon-theme href=https://github.com/vjeantet/hugo-theme-casper>Casper</a> theme</section></footer></div><script src=https://icyleaf.com/js/jquery.js></script><script src=https://icyleaf.com/js/jquery.fitvids.js></script><script src=https://icyleaf.com/js/index.js></script></body></html>