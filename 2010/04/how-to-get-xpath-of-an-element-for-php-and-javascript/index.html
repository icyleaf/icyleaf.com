<!doctype html><html lang=zh><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>如何获取 Element 的 XPath [PHP/Javascript] | icyleaf</title><link rel=prev href=https://icyleaf.com/2010/01/douban-api-package/><link rel=next href=https://icyleaf.com/2010/05/nginx-with-fastcgi-build-kohana/><link rel=canonical href=https://icyleaf.com/2010/04/how-to-get-xpath-of-an-element-for-php-and-javascript/><link rel=apple-touch-icon sizes=180x180 href=https://icyleaf.com/images/icyleaf-icon.png><link rel=icon type=image/png sizes=32x32 href=https://icyleaf.com/images/icyleaf-icon.png><link rel=icon type=image/png sizes=16x16 href=https://icyleaf.com/images/icyleaf-icon.png><link rel=stylesheet href=https://icyleaf.com/css/main.min.css><link rel=stylesheet href=https://icyleaf.com/font/iconfont.css><link rel=stylesheet href=https://icyleaf.com/font-ali/iconfont.css><link rel=stylesheet href=https://icyleaf.com/photoswipe/photoswipe.css><meta name=title content="如何获取 Element 的 XPath [PHP/Javascript] | icyleaf"><meta name=author content="icyleaf"><meta name=description content="日常写代码热爱户外的梦想家"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/icyleaf.com\/"},"articleSection":"posts","name":"如何获取 Element 的 XPath [PHP\/Javascript]","headline":"如何获取 Element 的 XPath [PHP\/Javascript]","description":"这两天研究 HTML 的 DOM 需要寻找某个 Element 元素的完整 XPath 路径，由于使用的是 PHP Simple HTML DOM Parser 开源库，这个库类的使用方法几乎兼容 Javascript 的 DOM 语法并附带 DOM 选择器。虽然功能强","inLanguage":"zh","author":"icyleaf","creator":"icyleaf","publisher":"icyleaf","accountablePerson":"icyleaf","copyrightHolder":"icyleaf","copyrightYear":"2010","datePublished":"2010-04-02 12:34:56 \u002b0800 \u002b0800","dateModified":"2010-04-02 12:34:56 \u002b0800 \u002b0800","url":"https:\/\/icyleaf.com\/2010\/04\/how-to-get-xpath-of-an-element-for-php-and-javascript\/","wordCount":"527","keywords":["PHP","Javascript","icyleaf"]}</script></head><body><div class=wrapper><nav class=navbar><progress class=content_progress max=0 value=0></progress><div class=container><div class="navbar-header header-logo"><a href=https://icyleaf.com/>icyleaf</a></div><div class=navbar-right><span class=menu><a class=menu-item href=https://icyleaf.com/about title>About</a>
<a class=menu-item href=https://icyleaf.com/projects title>Projects</a>
<a class=menu-item href=https://icyleaf.com/index.xml title>Feed</a>
<span class=divide></span>
<a href=javascript:void(0); class=theme-switch><i class="iconfont icon-dark-mode"></i></a></span></div></div></nav><nav class=navbar-mobile id=nav-mobile style=display:none><progress class=content_progress max=0 value=0></progress><div class=container><div class=navbar><div class="navbar-header header-logo"><a href=https://icyleaf.com/>icyleaf</a></div><div class=navbar-right><div><a href=javascript:void(0); class=theme-switch><i class="iconfont icon-dark-mode"></i></a></div><div class=menu-toggle><span></span><span></span><span></span></div></div></div><div class=menu id=mobile-menu><nav class=mb-md><a class=menu-item href=https://icyleaf.com/about title><h3>About</h3><div class=menu-active></div></a><a class=menu-item href=https://icyleaf.com/projects title><h3>Projects</h3><div class=menu-active></div></a><a class=menu-item href=https://icyleaf.com/index.xml title><h3>Feed</h3><div class=menu-active></div></a></nav></div></div></nav><main class=main><div class=container><article class=post-warp itemscope itemtype=http://schema.org/Article><header class=post-header><h1 class=post-title itemprop=description>如何获取 Element 的 XPath [PHP/Javascript]</h1><div class=post-meta><time datetime=2010-04-02 itemprop=datePublished>April 2, 2010</time>
·
<span class=tags>PHP, Javascript</span>
·
<span class=post-word-count>527 words · 2 minutes</span></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title></h2><div class="post-toc-content always-active"><nav id=TableOfContents></nav></div></div><div class=post-content><div id=post-gallery><p>这两天研究 HTML 的 DOM 需要寻找某个 Element 元素的完整 XPath 路径，由于使用的是 <a href=http://simplehtmldom.sourceforge.net/manual.htm>PHP Simple HTML DOM Parser</a> 开源库，这个库类的使用方法几乎兼容 Javascript 的 DOM 语法并附带 DOM 选择器。虽然功能强大但是并不能直接获取 Element 的 XPath。这个怎么办呢，依稀记得 Firebug 有一个功能，选择某个元素在它的控制台可以显示 XPath。嗯，着手实践一下发现不仅可以显示而且还可以复制 XPath。</p><p>于是想，如果可以找到 Javascript 版的相关代码就一定可以改成 PHP 版本的，结果在 Google 搜索找到了&mldr;</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=ln> 1</span><span class=cl><span class=kd>var</span> <span class=nx>elt</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s1>&#39;table&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl><span class=kd>var</span> <span class=nx>xpath</span> <span class=o>=</span> <span class=nx>getElementXPath</span><span class=p>(</span><span class=nx>elt</span><span class=p>);</span><span class=nx>alert</span><span class=p>(</span><span class=nx>xpath</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=c1>// Get full XPath of an element
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=c1></span><span class=kd>function</span> <span class=nx>getElementXPath</span><span class=p>(</span><span class=nx>elt</span><span class=p>){</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>	<span class=kd>var</span> <span class=nx>path</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>	<span class=k>for</span> <span class=p>(;</span> <span class=nx>elt</span> <span class=o>&amp;&amp;</span> <span class=nx>elt</span><span class=p>.</span><span class=nx>nodeType</span> <span class=o>==</span> <span class=mi>1</span><span class=p>;</span> <span class=nx>elt</span> <span class=o>=</span> <span class=nx>elt</span><span class=p>.</span><span class=nx>parentNode</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>	<span class=p>{</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>		<span class=nx>idx</span> <span class=o>=</span> <span class=nx>getElementIdx</span><span class=p>(</span><span class=nx>elt</span><span class=p>);</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>		<span class=nx>xname</span> <span class=o>=</span> <span class=nx>elt</span><span class=p>.</span><span class=nx>tagName</span><span class=p>;</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>		<span class=k>if</span> <span class=p>(</span><span class=nx>idx</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>)</span> <span class=nx>xname</span> <span class=o>+=</span> <span class=s2>&#34;[&#34;</span> <span class=o>+</span> <span class=nx>idx</span> <span class=o>+</span> <span class=s2>&#34;]&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>		<span class=nx>path</span> <span class=o>=</span> <span class=s2>&#34;/&#34;</span> <span class=o>+</span> <span class=nx>xname</span> <span class=o>+</span> <span class=nx>path</span><span class=p>;</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>	<span class=k>return</span> <span class=nx>path</span><span class=p>;</span>
</span></span><span class=line><span class=ln>15</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>
</span></span><span class=line><span class=ln>17</span><span class=cl><span class=c1>// Get Idx of an element
</span></span></span><span class=line><span class=ln>18</span><span class=cl><span class=c1></span><span class=kd>function</span> <span class=nx>getElementIdx</span><span class=p>(</span><span class=nx>elt</span><span class=p>){</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>	<span class=kd>var</span> <span class=nx>count</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>	<span class=k>for</span> <span class=p>(</span><span class=kd>var</span> <span class=nx>sib</span> <span class=o>=</span> <span class=nx>elt</span><span class=p>.</span><span class=nx>previousSibling</span><span class=p>;</span> <span class=nx>sib</span> <span class=p>;</span> <span class=nx>sib</span> <span class=o>=</span> <span class=nx>sib</span><span class=p>.</span><span class=nx>previousSibling</span><span class=p>)</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>	<span class=p>{</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=nx>sib</span><span class=p>.</span><span class=nx>nodeType</span> <span class=o>==</span> <span class=mi>1</span> <span class=o>&amp;&amp;</span> <span class=nx>sib</span><span class=p>.</span><span class=nx>tagName</span> <span class=o>==</span> <span class=nx>elt</span><span class=p>.</span><span class=nx>tagName</span><span class=p>)</span>  <span class=nx>count</span><span class=o>++</span>
</span></span><span class=line><span class=ln>23</span><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=ln>24</span><span class=cl>	<span class=k>return</span> <span class=nx>count</span><span class=p>;</span>
</span></span><span class=line><span class=ln>25</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>PHP 改进版：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=ln> 1</span><span class=cl><span class=c1>// Use it before import PHP Simple HTML DOM Parser
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=c1></span><span class=nv>$html</span> <span class=o>=</span> <span class=nx>file_get_html</span><span class=p>(</span><span class=s1>&#39;http://www.google.com/&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>
</span></span><span class=line><span class=ln> 4</span><span class=cl><span class=c1>// find a sample element by id
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=c1></span><span class=nv>$elt1</span> <span class=o>=</span> <span class=nv>$html</span><span class=o>-&gt;</span><span class=na>find</span><span class=p>(</span><span class=s1>&#39;#footer&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>
</span></span><span class=line><span class=ln> 7</span><span class=cl><span class=c1>// find a sample element by tag name
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=c1></span><span class=nv>$elt2</span><span class=o>=</span> <span class=nv>$html</span><span class=o>-&gt;</span><span class=na>find</span><span class=p>(</span><span class=s1>&#39;div&#39;</span><span class=p>,</span> <span class=mi>10</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=c1>// it will return if found it: [@id=&#34;footer&#34;]
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=c1></span><span class=nv>$xpath</span> <span class=o>=</span> <span class=nx>getElementXPath</span><span class=p>(</span><span class=nv>$elt1</span><span class=p>);</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>
</span></span><span class=line><span class=ln>13</span><span class=cl><span class=c1>// it will return if found it: html/body/div[10]
</span></span></span><span class=line><span class=ln>14</span><span class=cl><span class=c1></span><span class=nv>$xpath</span> <span class=o>=</span> <span class=nx>getElementXPath</span><span class=p>(</span><span class=nv>$elt2</span><span class=p>);</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>
</span></span><span class=line><span class=ln>16</span><span class=cl><span class=k>function</span> <span class=nf>getElementXPath</span><span class=p>(</span><span class=nv>$elt</span><span class=p>){</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>	<span class=nv>$path</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>	<span class=nv>$first</span> <span class=o>=</span> <span class=k>TRUE</span><span class=p>;</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>	<span class=k>for</span><span class=p>(;</span> <span class=p>(</span><span class=nv>$elt</span> <span class=k>AND</span> <span class=nv>$elt</span><span class=o>-&gt;</span><span class=na>nodetype</span> <span class=o>==</span> <span class=mi>1</span><span class=p>);</span> <span class=nv>$elt</span> <span class=o>=</span> <span class=nv>$elt</span><span class=o>-&gt;</span><span class=na>parent</span><span class=p>())</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>	<span class=p>{</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>		<span class=nv>$xname</span> <span class=o>=</span> <span class=nv>$elt</span><span class=o>-&gt;</span><span class=na>tag</span><span class=p>;</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>		<span class=nv>$idx</span> <span class=o>=</span> <span class=nx>getElementIdx</span><span class=p>(</span><span class=nv>$elt</span><span class=p>);</span>
</span></span><span class=line><span class=ln>23</span><span class=cl>		<span class=k>if</span> <span class=p>(</span><span class=nv>$first</span> <span class=k>AND</span> <span class=nx>isset</span><span class=p>(</span><span class=nv>$elt</span><span class=o>-&gt;</span><span class=na>attr</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>]))</span>
</span></span><span class=line><span class=ln>24</span><span class=cl>		<span class=p>{</span>
</span></span><span class=line><span class=ln>25</span><span class=cl>			<span class=nv>$path</span> <span class=o>=</span> <span class=s1>&#39;//*[@id=&#34;&#39;</span> <span class=o>.</span> <span class=nv>$elt</span><span class=o>-&gt;</span><span class=na>attr</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>]</span> <span class=o>.</span> <span class=s1>&#39;&#34;]&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=ln>26</span><span class=cl>			<span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=ln>27</span><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=ln>28</span><span class=cl>
</span></span><span class=line><span class=ln>29</span><span class=cl>		<span class=k>if</span> <span class=p>(</span><span class=nv>$idx</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=ln>30</span><span class=cl>		<span class=p>{</span>
</span></span><span class=line><span class=ln>31</span><span class=cl>			<span class=o>%</span><span class=nx>xname</span> <span class=o>.=</span> <span class=s1>&#39;[&#39;</span> <span class=o>.</span> <span class=nv>$idx</span> <span class=o>.</span> <span class=s1>&#39;]&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=ln>32</span><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=ln>33</span><span class=cl>
</span></span><span class=line><span class=ln>34</span><span class=cl>		<span class=nv>$path</span> <span class=o>=</span> <span class=s1>&#39;/&#39;</span><span class=o>.</span><span class=nv>$xname</span><span class=o>.</span><span class=nv>$path</span><span class=p>;</span>
</span></span><span class=line><span class=ln>35</span><span class=cl>		<span class=nv>$first</span> <span class=o>=</span> <span class=k>FALSE</span><span class=p>;</span>
</span></span><span class=line><span class=ln>36</span><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=ln>37</span><span class=cl>
</span></span><span class=line><span class=ln>38</span><span class=cl>	<span class=k>return</span> <span class=nv>$path</span><span class=p>;</span>
</span></span><span class=line><span class=ln>39</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>40</span><span class=cl>
</span></span><span class=line><span class=ln>41</span><span class=cl><span class=k>function</span> <span class=nf>getElementIdx</span><span class=p>(</span><span class=nv>$elt</span><span class=p>){</span>
</span></span><span class=line><span class=ln>42</span><span class=cl>	<span class=nv>$count</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=ln>43</span><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=nv>$sib</span> <span class=o>=</span> <span class=nv>$elt</span><span class=o>-&gt;</span><span class=na>prev_sibling</span><span class=p>();</span> <span class=nv>$sib</span> <span class=p>;</span> <span class=nv>$sib</span> <span class=o>=</span> <span class=nv>$sib</span><span class=o>-&gt;</span><span class=na>prev_sibling</span><span class=p>())</span>
</span></span><span class=line><span class=ln>44</span><span class=cl>	<span class=p>{</span>
</span></span><span class=line><span class=ln>45</span><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=nv>$sib</span><span class=o>-&gt;</span><span class=na>nodetype</span> <span class=o>==</span> <span class=mi>1</span> <span class=o>&amp;&amp;</span> <span class=nv>$sib</span><span class=o>-&gt;</span><span class=na>tag</span> <span class=o>==</span> <span class=nv>$elt</span><span class=o>-&gt;</span><span class=na>tag</span><span class=p>)</span>
</span></span><span class=line><span class=ln>46</span><span class=cl>		<span class=p>{</span>
</span></span><span class=line><span class=ln>47</span><span class=cl>			<span class=nv>$count</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=ln>48</span><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=ln>49</span><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=ln>50</span><span class=cl>	<span class=k>return</span> <span class=nv>$count</span><span class=p>;</span>
</span></span><span class=line><span class=ln>51</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>大家同样可以把上面的代码直接 crack 到 PHP Simple HTML DOM Parser 库中。</p></div></div><div class=post-nav><a href=https://icyleaf.com/2010/01/douban-api-package/ class=prev rel=prev title="Douban API Package 发布！"><i class="iconfont icon-left"></i>&nbsp;Douban API Package 发布！</a>
<a href=https://icyleaf.com/2010/05/nginx-with-fastcgi-build-kohana/ class=next rel=next title="Nginx+FastCGI 环境搭建 Kohana">Nginx+FastCGI 环境搭建 Kohana&nbsp;<i class="iconfont icon-right"></i></a></div><div class=post-comment><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//icyleaf.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></article></div></main><footer class=footer><div class=copyright>&copy;
<span itemprop=copyrightYear>2005 - 2022</span>
<span>🍺</span>
<span class=author itemprop=copyrightHolder><a href=https://icyleaf.com/>icyleaf</a></span></div></footer><script src=https://fastly.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js crossorigin=anonymous></script>
<script defer src=https://icyleaf.com/js/vendor_main.min.js></script>
<script src=https://fastly.jsdelivr.net/npm/pangu@4.0.7/dist/browser/pangu.min.js integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin=anonymous></script>
<script>pangu.spacingPage()</script><script type=module>
  
  import PhotoSwipeLightbox from '\/photoswipe\/photoswipe-lightbox.esm.js';

  const lightbox = new PhotoSwipeLightbox({
    gallery: '#post-gallery',
    children: 'a.gallery-item',
    pswpModule: '\/photoswipe\/photoswipe.esm.js',
  });
  lightbox.init();
</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-TKQBZ7R259"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-TKQBZ7R259")</script></div></body></html>