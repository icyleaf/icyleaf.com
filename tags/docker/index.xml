<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/"><channel><title>Docker on icyleaf</title><link>https://icyleaf.com/tags/docker/</link><description>Recent content in Docker on icyleaf</description><language>zh-cn</language><lastBuildDate>Fri, 16 Sep 2022 13:58:31 +0800</lastBuildDate><atom:link href="https://icyleaf.com/tags/docker/index.xml" rel="self" type="application/rss+xml"/><item><title>Rails äº§å“ç¯å¢ƒé…ç½®åŠ å¯†å‡­è¯çš„å®Œç¾æ–¹æ¡ˆ</title><link>https://icyleaf.com/2022/09/perfect-solution-to-steup-rails-encrypted-credentials/</link><pubDate>Fri, 16 Sep 2022 13:58:31 +0800</pubDate><guid>https://icyleaf.com/2022/09/perfect-solution-to-steup-rails-encrypted-credentials/</guid><description>é¢å‘ç”¨æˆ·çš„é¡¹ç›®å¦‚ä½•ä¿è¯æ•°æ®å®‰å…¨çš„æƒ…å†µä¸‹ç»™ç”¨æˆ·æä¾›ä¸€ä¸ªä¾¿æ·éƒ¨ç½²æ–¹å¼</description><content:encoded><![CDATA[<p>ç»­æ¥ä¸Šæ–‡ï¼Œé¡¹ç›®å·²ç»æ„å»ºé•œåƒåä¸‹ä¸€æ­¥å¤§æ¦‚ç‡å°±è¦å¼€å§‹é¢å‘å—ä¼—äººç¾¤å»ä¼ æ’­ä½¿ç”¨ã€‚ä½ æœ‰æƒ³è¿‡è®©ç”¨æˆ·è‡ªå»ºæœåŠ¡æ—¶ä»–è¦è¸©çš„å‘å—ï¼Ÿé‚£ç»å¯¹å°±æ˜¯åŠ å¯†å‡­è¯çš„é…ç½®ã€‚</p>
<h2 id="rails-æ•™ä½ è¿™ä¹ˆåš">Rails æ•™ä½ è¿™ä¹ˆåš</h2>
<p>å¾ˆé—æ†¾é™¤äº† Rails å¯¥å¯¥å‡ ç¬”çš„é…ç½®ä»¥å¤–ä½ å‡ ä¹æ‰¾ä¸åˆ°ä»»ä½•ä¸ä¸€æ ·çš„æ–‡ç« ã€‚åŠ å¯†å‡­è¯çš„æ–‡ä»¶ç»“æ„å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="ln">1</span><span class="cl">â”œâ”€â”€ config
</span></span><span class="line"><span class="ln">2</span><span class="cl">â”‚  â”œâ”€â”€ master.key           <span class="c1"># æ ¸å¿ƒç§é’¥</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">â”‚  â”œâ”€â”€ credentials.yml.enc  <span class="c1"># åŠ å¯†å‡­è¯</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">â”‚  â””â”€â”€ ...
</span></span></code></pre></div><p><code>master.key</code> æ˜¯æŸç§ç®—æ³•éšæœºç”Ÿæˆçš„åŠ å¯†ä¸²ï¼Œ<code>credentials.yml.enc</code> æ˜¯å­˜å‚¨äº†å„ç§ keyã€tokenã€secret value çš„ YAML æ•°æ®åŠ å¯†åçš„å‡­è¯æ•°æ®ã€‚</p>
<p>Rails ä»¥å®‰å…¨ä¸ºç”±ï¼ˆæˆ‘çŒœçš„ï¼‰å¯¹å¼€å‘è€…ä¹Ÿâ€œå°é—­â€äº†åŠ å¯†è¿‡ç¨‹ï¼Œåªèƒ½é€šè¿‡ <code>rails credentials:edit</code> å‘½ä»¤è§£å¯† YAML æ•°æ®æ‰èƒ½ç¼–è¾‘å’Œä¿å­˜ã€‚æœ€è‡´å‘½çš„è¯¥å‘½ä»¤æ˜¯ä½¿ç”¨ <code>EDITOR</code> ç¯å¢ƒå˜é‡é…ç½®çš„æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œè¿™ä¸ªé€šå¸¸æ˜¯ vim, nano ç­‰ç»ˆç«¯æ–‡æœ¬ç¼–è¾‘å™¨ã€‚</p>
<p>è¿™å°±éœ€è¦åœ¨éƒ¨ç½²é¡¹ç›®çš„æ—¶å€™æ— æ³•ä¸€é”®éƒ¨ç½²ï¼Œå¿…é¡»åœ¨éƒ¨ç½²å‰è®©ä½¿ç”¨è€…æ•²ä¸€å †çš„å‘½ä»¤ã€è¿˜è¦åœ¨ç»ˆç«¯çš„æ–‡æœ¬ç¼–è¾‘å™¨å†æ•²ä¸€å †éœ€è¦é…ç½®çš„æ•°æ®ã€‚</p>
<p>æˆ‘æƒ³ä¸ä»…ä½¿ç”¨è€…ä¼šç–¯æ‰ï¼Œå¾ˆå¤š Rails å¼€å‘è€…æˆ–è®¸ä¹Ÿä¼šå‘æ€µã€‚</p>
<h2 id="æˆ‘çš„æœ€ä½³å®è·µ">æˆ‘çš„æœ€ä½³å®è·µ</h2>
<blockquote>
<p>æˆªæ­¢ 2022-10-20 ä¸ºæ­¢é€‚ç”¨äº Rails 7.x ç‰ˆæœ¬ã€‚</p>
</blockquote>
<p>ä¸Šé¢æåˆ°çš„â€œå°é—­â€çš„æ„æ€æ˜¯ä½¿ç”¨è€…ä¸å¯è§åŠ è§£å¯†è¿‡ç¨‹ï¼Œä½†å¯é€šè¿‡<a href="https://github.com/rails/rails/blob/7-0-stable/railties/lib/rails/commands/credentials/credentials_command.rb">å¼€æºä»£ç </a>ä¸€æ¢ç©¶ç«Ÿã€‚</p>
<p>æˆ‘çš„æ€è·¯å¾ˆç®€å•ï¼Œä¸æå‰ç”Ÿæˆå’ŒæŒ‚è½½ä¸Šé¢ä¸¤ä¸ªæ–‡ä»¶ï¼Œé€šè¿‡è®¾ç½® <code>RAILS_MASTER_KEY</code> å’Œ <code>RAILS_ENCRYPTED_CREDENTIALS</code> ä¸¤ä¸ªç¯å¢ƒå˜é‡å†å˜ç›¸å®ç°ã€‚</p>
<ul>
<li>
<p><code>RAILS_MASTER_KEY</code> æ˜¯ Rails å†…ç½®çš„å˜é‡ï¼Œå®ƒä¼š<a href="https://github.com/rails/rails/blob/7-0-stable/activesupport/lib/active_support/encrypted_file.rb#L53">ä¼˜å…ˆè¯»å–</a>æœ€åæ‰ä¼šè¯»å– <code>config/master.key</code>ã€‚</p>
</li>
<li>
<p><code>RAILS_ENCRYPTED_CREDENTIALS</code> ç¯å¢ƒå˜é‡ä¿å­˜ <code>credentials.yml.enc</code> æ–‡ä»¶çš„åŠ å¯†å‡­è¯æ•°æ®ï¼Œé¡¹ç›®å¯åŠ¨é˜¶æ®µé€šè¿‡è„šæœ¬é¢„å¤„ç†ã€‚</p>
</li>
</ul>
<h3 id="åŠ å¯†å‡­è¯ç”Ÿæˆå™¨">åŠ å¯†å‡­è¯ç”Ÿæˆå™¨</h3>
<p>é¢å‘ç”¨æˆ·è‡ªåŠ¨åŒ–é…ç½®ï¼Œè¿™å°±æ„å‘³ç€éœ€è¦é¡¹ç›®å¼€å‘è€…æä¾›å‚»ç“œå¼çš„é…ç½®å·¥å…·ã€‚</p>













  
  
    
      <figure data-pswp="2278x1206" data-size="800x"><a href="/uploads/2022/09/16/generate-encrypted-credentials-tools.png" class="gallery-item" target="_blank" data-pswp-width="2278" data-pswp-height="1206"><img src="/uploads/2022/09/16/generate-encrypted-credentials-tools_hu53cdae0c645814fab78a15ed8fe0af52_167183_800x0_resize_box_3.png"/></a><figcaption>

    <p>åŠ å¯†å‡­è¯ç”Ÿæˆå™¨</p></figcaption></figure>

<p>ä¸Šé¢æ˜¯ä¸€ä¸ªå®ç°åŠŸèƒ½çš„åŸºç¡€ç‰ˆæœ¬ï¼Œå¦‚æœéƒ¨ç½²æ–¹å¼æ˜¯ Docker æˆ– docker-compose ä¹Ÿå¯ä»¥æä¾›ç”Ÿæˆå¯¹åº”çš„éƒ¨ç½²è„šæœ¬æˆ–æ–‡ä»¶ã€‚</p>
<h4 id="æ ¸å¿ƒæºç ">æ ¸å¿ƒæºç </h4>
<p>ç”Ÿæˆè§„åˆ™å‡å€Ÿé‰´ Rails å†…éƒ¨ <code>ActiveSupport::EncryptedFile</code> å’Œ <code>ActiveSupport::EncryptedConfiguration</code> é€»è¾‘ï¼Œæ•°æ®åº“åŠ å¯†å‚è€ƒ <a href="https://github.com/rails/rails/blob/7-0-stable/activerecord/lib/active_record/railties/databases.rake#L531">database.rake</a>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">def</span> <span class="nf">create</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="n">env_key</span> <span class="o">=</span> <span class="s2">&#34;TEMP_MASTER_KEY&#34;</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="no">ENV</span><span class="o">[</span><span class="n">env_key</span><span class="o">]</span> <span class="o">=</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">EncryptedConfiguration</span><span class="o">.</span><span class="n">generate_key</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="n">generator</span> <span class="o">=</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">EncryptedConfiguration</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="ss">config_path</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="ss">key_path</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="ss">env_key</span><span class="p">:</span> <span class="n">env_key</span><span class="p">,</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="ss">raise_if_missing_key</span><span class="p">:</span> <span class="kp">false</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">  <span class="p">)</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="n">master_key</span> <span class="o">=</span> <span class="n">generator</span><span class="o">.</span><span class="n">key</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="n">contents</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="s2">&#34;secret_key_base&#34;</span> <span class="o">=&gt;</span> <span class="no">SecureRandom</span><span class="o">.</span><span class="n">alphanumeric</span><span class="p">(</span><span class="mi">64</span><span class="p">),</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="s2">&#34;active_record_encryption&#34;</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">      <span class="s2">&#34;primary_key&#34;</span> <span class="o">=&gt;</span> <span class="no">SecureRandom</span><span class="o">.</span><span class="n">alphanumeric</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">      <span class="s2">&#34;deterministic_key&#34;</span> <span class="o">=&gt;</span> <span class="no">SecureRandom</span><span class="o">.</span><span class="n">alphanumeric</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">      <span class="s2">&#34;key_derivation_salt&#34;</span> <span class="o">=&gt;</span> <span class="no">SecureRandom</span><span class="o">.</span><span class="n">alphanumeric</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">
</span></span><span class="line"><span class="ln">21</span><span class="cl">  <span class="no">ENV</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">env_key</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">  <span class="n">render</span> <span class="ss">json</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">    <span class="ss">master_key</span><span class="p">:</span> <span class="n">master_key</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">    <span class="ss">encrypted_credentials</span><span class="p">:</span> <span class="n">generator</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="ss">:encrypt</span><span class="p">,</span> <span class="no">YAML</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">contents</span><span class="p">)),</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="ss">contents</span><span class="p">:</span> <span class="n">contents</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl"><span class="k">end</span>
</span></span></code></pre></div><h3 id="è‡ªåŠ¨åŒ–å¤„ç†è„šæœ¬">è‡ªåŠ¨åŒ–å¤„ç†è„šæœ¬</h3>
<p>ç¯å¢ƒå˜é‡é…ç½®çš„ <code>RAILS_ENCRYPTED_CREDENTIALS</code> å˜é‡å¹¶ä¸ä¼šè¢« Rails è¯†åˆ«ï¼Œå¿…é¡»åœ¨ä¾èµ– Rails ç›¸å…³æœåŠ¡è¿è¡Œå‰ï¼ˆåŒ…æ‹¬ Sidekiqï¼‰æŠŠå˜é‡çš„å€¼è½¬æ¢æˆå¯¹åº”çš„æ–‡ä»¶å³å¯ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="n">namespace</span> <span class="ss">:app</span> <span class="k">do</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="n">task</span> <span class="ss">:credentials</span> <span class="k">do</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">    <span class="n">master_key_path</span> <span class="o">=</span> <span class="no">Rails</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;config&#39;</span><span class="p">,</span> <span class="s1">&#39;credentials&#39;</span><span class="p">,</span> <span class="s1">&#39;production.key&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="n">encrypted_file_path</span> <span class="o">=</span> <span class="no">Rails</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;config&#39;</span><span class="p">,</span> <span class="s1">&#39;credentials&#39;</span><span class="p">,</span> <span class="s1">&#39;production.yml.enc&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="n">encrypted_credentials</span> <span class="o">=</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;RAILS_ENCRYPTED_CREDENTIALS&#39;</span><span class="o">].</span><span class="n">presence</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="k">if</span> <span class="n">encrypted_credentials</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="n">encrypted_file_path</span><span class="p">)</span> <span class="o">||</span> <span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">encrypted_file_path</span><span class="p">)</span><span class="o">.</span><span class="n">empty?</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">      <span class="nb">puts</span> <span class="s2">&#34;Write encrypted data into </span><span class="si">#{</span><span class="n">encrypted_file_path</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">      <span class="no">File</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">encrypted_file_path</span><span class="p">,</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;RAILS_ENCRYPTED_CREDENTIALS&#39;</span><span class="o">]</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">    <span class="k">end</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl">    <span class="n">encrypted</span> <span class="o">=</span> <span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">encrypted</span><span class="p">(</span><span class="n">encrypted_file_path</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">    <span class="k">if</span> <span class="n">encrypted</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">nil?</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">      <span class="nb">fail</span> <span class="o">[</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">        <span class="s2">&#34;Missing `RAILS_MASTER_KEY` enviroment value and not found file in </span><span class="si">#{</span><span class="n">master_key_path</span><span class="si">}</span><span class="s2">.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">        <span class="s2">&#34;Make sure generate one first and store it in a safe place.&#34;</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">      <span class="o">].</span><span class="n">join</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="k">end</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="k">next</span> <span class="k">if</span> <span class="n">encrypted_credentials</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">
</span></span><span class="line"><span class="ln">22</span><span class="cl">    <span class="k">begin</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">      <span class="n">data</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">empty?</span><span class="p">(</span><span class="n">encrypted_file_path</span><span class="p">)</span> <span class="p">?</span> <span class="p">{}</span> <span class="p">:</span> <span class="p">(</span><span class="no">YAML</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">encrypted</span><span class="o">.</span><span class="n">read</span><span class="p">)</span> <span class="o">||</span> <span class="p">{})</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">      <span class="nb">puts</span> <span class="s2">&#34;Preparing encrypted keys: secret_key_base, active_record_encryption ...&#34;</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">
</span></span><span class="line"><span class="ln">26</span><span class="cl">      <span class="c1"># Priority: environment &gt; rails builtin &gt; credentials.yml.enc data</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">      <span class="n">data</span><span class="o">[</span><span class="s1">&#39;secret_key_base&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;SECRET_TOKEN&#39;</span><span class="o">].</span><span class="n">presence</span> <span class="o">||</span> <span class="n">data</span><span class="o">[</span><span class="s1">&#39;secret_key_base&#39;</span><span class="o">]</span> <span class="o">||</span> <span class="no">SecureRandom</span><span class="o">.</span><span class="n">alphanumeric</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">
</span></span><span class="line"><span class="ln">29</span><span class="cl">      <span class="c1"># Support encrypted_key in model</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">      <span class="n">data</span><span class="o">[</span><span class="s1">&#39;active_record_encryption&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">        <span class="s1">&#39;primary_key&#39;</span> <span class="o">=&gt;</span> <span class="no">SecureRandom</span><span class="o">.</span><span class="n">alphanumeric</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">        <span class="s1">&#39;deterministic_key&#39;</span> <span class="o">=&gt;</span> <span class="no">SecureRandom</span><span class="o">.</span><span class="n">alphanumeric</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">        <span class="s1">&#39;key_derivation_salt&#39;</span> <span class="o">=&gt;</span> <span class="no">SecureRandom</span><span class="o">.</span><span class="n">alphanumeric</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">
</span></span><span class="line"><span class="ln">36</span><span class="cl">      <span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">encrypted</span><span class="p">(</span><span class="n">encrypted_file_path</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="no">YAML</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">    <span class="k">rescue</span> <span class="no">OpenSSL</span><span class="o">::</span><span class="no">Cipher</span><span class="o">::</span><span class="no">CipherError</span><span class="p">,</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">MessageEncryptor</span><span class="o">::</span><span class="no">InvalidMessage</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">      <span class="nb">puts</span> <span class="s2">&#34;Couldn&#39;t decrypt </span><span class="si">#{</span><span class="n">encrypted_file_path</span><span class="si">}</span><span class="s2">. Perhaps `RAILS_MASTER_KEY` enviroment value is incorrect?&#34;</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">    <span class="k">end</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">  <span class="k">end</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl"><span class="k">end</span>
</span></span></code></pre></div><h3 id="docker-é…ç½®">Docker é…ç½®</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="ln">1</span><span class="cl">docker run -d <span class="se">\
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="se"></span>  -e <span class="nv">RAILS_MASTER_KEY</span><span class="o">=</span><span class="s2">&#34;[master_key]&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="se"></span>  -e <span class="nv">RAILS_ENCRYPTED_CREDENTIALS</span><span class="o">=</span><span class="s2">&#34;[encrypted]&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="se"></span>  <span class="o">[</span>image_name<span class="o">]</span>
</span></span></code></pre></div><p>æˆ‘çš„æœ€ä½³å®è·µå¹¶ä¸ä»£è¡¨æ˜¯æœ€å®Œç¾çš„è§£å†³æ–¹æ¡ˆï¼Œæœ€èµ·ç èƒ½å¤Ÿè®©ç”¨æˆ·é¿å…ç¢°è§¦ä»£ç ä¹Ÿèƒ½å¤Ÿå¾ˆè½»æ¾çš„éƒ¨ç½²æ‰æ˜¯å‰æï¼Œä¸æ˜¯å—ï¼Ÿ</p>
]]></content:encoded></item><item><title>Rails æ„å»ºé•œåƒå®‰å…¨å¤„ç†åŠ å¯†å‡­è¯</title><link>https://icyleaf.com/2022/09/rails-build-docker-image-handle-encrypted-credentials-securely/</link><pubDate>Thu, 15 Sep 2022 13:58:31 +0800</pubDate><guid>https://icyleaf.com/2022/09/rails-build-docker-image-handle-encrypted-credentials-securely/</guid><description>Docker æ„å»ºé•œåƒè¯¥å¦‚ä½•æ­£ç¡®å¤„ç† master key å’Œ credentials.yml.enc</description><content:encoded><![CDATA[<p>æœ€è¿‘åœ¨åšä¸€ä¸ªå°çš„ Side Project ä½œä¸ºå…¬å…±æœåŠ¡é¦–è¦æ˜¯éœ€è¦ä¿è¯ç”¨æˆ·æ•°æ®çš„ç»å¯¹å®‰å…¨ï¼Œè¿™å°±éœ€è¦å¯¹æ•°æ®åº“æ•°æ®åšåŠ å¯†å¤„ç†ã€‚</p>
<p>Rails <a href="https://qiita.com/NaokiIshimura/items/2a179f2ab910992c4d39">5.2</a> å¼€å§‹æ”¯æŒ <code>credentials.yml.enc</code> åŠ å¯†å‡­è¯ï¼Œ
<a href="https://blog.saeloun.com/2019/10/10/rails-6-adds-support-for-multi-environment-credentials.html">6.0</a> æ”¯æŒå¤šç¯å¢ƒçš„ credentials åŠ å¯†å‡­è¯ï¼Œ
<a href="https://blog.saeloun.com/2021/06/09/rails-7-add-encryption-to-active-record.html">7.0</a> æ”¯æŒå¯¹ model æ•°æ®åº“è¡¨å­—æ®µåŠ å¯†å¤„ç†ï¼Œä½†æˆ‘ä» 5.1 æ”¯æŒ <code>secrets.yml</code> å¼€å§‹å°±æ²¡ä½¿ç”¨è¿‡ã€‚
æœ€è¿‘ä¸€å‘¨å¼€å‘åŠ æ‘¸ç´¢ä¸‹æ¥ï¼Œæ€»ç»“ä¸€å¥è¯ï¼š<strong>ä¸€ç›´åŠ å¯†ä¸€ç›´çˆ½ï¼Œå®¹å™¨åŒ–å¥”èµ´ç«è‘¬åœºã€‚</strong></p>
<h2 id="æœºåˆ¶åŸç†">æœºåˆ¶åŸç†</h2>
<p>åˆå§‹åŒ–ä¸€ä¸ª Rails 5.2+ é¡¹ç›®ä¼šåœ¨é¡¹ç›®æ ¹ç›®å½• <code>config</code> ç”Ÿæˆ <code>master.key</code> å’Œ <code>credentials.yml.enc</code> ä¸¤ä¸ªæ–‡ä»¶ï¼Œå‰è€…å¯ä»¥ç†è§£ä¸ºæ ¸å¿ƒå¯†é’¥ï¼Œåè€…æ˜¯ç”¨æ ¸å¿ƒå¯†é’¥é€šè¿‡
<a href="https://github.com/rails/rails/blob/7-0-stable/activesupport/lib/active_support/encrypted_configuration.rb">ActiveSupport::EncryptedConfiguration</a> åŠ å¯†ç±»ç”Ÿæˆçš„åŠ å¯†åçš„æ•°æ®æ–‡ä»¶ã€‚</p>
<p>åªéœ€è¦ä¿è¯ <code>master.key</code> ä¸ä¼šæ³„éœ²ï¼Œé€šè¿‡ <code>rails credentials:edit</code> é…ç½®æœåŠ¡æ‰€éœ€çš„å„è‡ªç§å¯† tokenã€secret key ä¹‹ç±»ä¹Ÿå¯ä»¥å®‰å…¨çš„æäº¤åˆ° Git ä»“åº“ä¸­ã€‚</p>
<h3 id="å­˜å‚¨è·¯å¾„">å­˜å‚¨è·¯å¾„</h3>
<p>å¯†é’¥å’ŒåŠ å¯†åçš„æ–‡ä»¶ä¼šå­˜åœ¨å¦‚ä¸‹ç›®å½•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1"># ç¼ºçœ</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">config/master.key
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">config/credentials.yml.enc
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="c1"># Rails ç”Ÿäº§ç¯å¢ƒå†³å®š (6.0 å¼€å§‹æ”¯æŒ)</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="c1"># å¦‚ä¸‹åˆ†åˆ«å¯¹åº” development å’Œ production ç¯å¢ƒ</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">config/credentials/development.key
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">config/credentials/development.yml.enc
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl">config/credentials/production.key
</span></span><span class="line"><span class="ln">11</span><span class="cl">config/credentials/production.yml.enc
</span></span></code></pre></div><h3 id="è§¦å‘æœºåˆ¶">è§¦å‘æœºåˆ¶</h3>
<p>åªè¦è¿è¡Œçš„ä»£ç ä¼šæ¶‰åŠ <code>config/environment.rb</code> æ–‡ä»¶è§£å¯†æµç¨‹å°±ä¼šè‡ªåŠ¨è¢«è§¦å‘ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li><code>rails server</code></li>
<li><code>rails console</code></li>
<li><code>Rakefile</code> é™„åŠ  <code>:environment</code> å‚æ•°çš„æ‰€æœ‰ tasks</li>
</ul>
<h3 id="å¸¸è§åŠ è§£å¯†æŠ¥é”™">å¸¸è§åŠ è§£å¯†æŠ¥é”™</h3>
<p>è§£å¯†æœºåˆ¶è¢«è§¦å‘çš„é‚£ä¸€åˆ»ï¼Œå®ƒä¼šä»å­˜å‚¨è·¯å¾„ä»ç¼ºçœåˆ°å½“å‰ç”Ÿäº§ç¯å¢ƒå»å¯»æ‰¾å¯¹åº”çš„æ–‡ä»¶ï¼Œmaster key ä¼šä¼˜å…ˆè¯»å– <code>RAILS_MASTER_KEY</code> ç¯å¢ƒå˜é‡çš„å€¼ï¼Œæ²¡æœ‰æ‰ä¼šå»å­˜å‚¨æ–‡ä»¶è¯»å–ï¼Œéƒ½æ²¡æœ‰æ‰¾åˆ°å°±æŠ¥é”™ <code>MissingKeyError</code> é”™è¯¯ã€‚</p>
<p>master key åœ¨ Rails 5.2 ~ 7 ç‰ˆæœ¬å¯†é’¥çš„é•¿åº¦å¿…é¡»ç¬¦åˆ aes-128-gcm ä¹Ÿå°±æ˜¯ 32 å­—èŠ‚ï¼Œè®¾ç½®é”™è¯¯ä¼šå¾—åˆ° <code>InvalidKeyLengthError</code> é”™è¯¯ã€‚</p>
<p><code>*.enc</code> æ–‡ä»¶ä¸å­˜åœ¨ä¼šè§¦å‘ <code>MissingContentError</code> é”™è¯¯ã€‚</p>
<p>å…¶ä»–çš„é”™è¯¯è¿˜æœ‰å¯èƒ½æ˜¯ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl"><span class="c1"># é€šå¸¸æ˜¯ credentials.yml.enc æ–‡ä»¶ç¼ºå¤±æˆ–æœªè®¾ç½® secret_key_base (SECRET_KEY_BASE) çš„å€¼</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">ArgumentError: Missing <span class="sb">`</span>secret_key_base<span class="sb">`</span> <span class="k">for</span> <span class="s1">&#39;production&#39;</span> environment, <span class="nb">set</span> this string with <span class="sb">`</span>bin/rails credentials:edit<span class="sb">`</span>
</span></span><span class="line"><span class="ln">3</span><span class="cl">
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="c1"># master key å¯†é’¥ä¸æ­£ç¡®æ— æ³•è§£å¯†</span>
</span></span><span class="line"><span class="ln">5</span><span class="cl">Unable to load application: ActiveSupport::MessageEncryptor::InvalidMessage: ActiveSupport::MessageEncryptor::InvalidMessage
</span></span><span class="line"><span class="ln">6</span><span class="cl">
</span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="c1"># é”™è¯¯åŒä¸Š</span>
</span></span><span class="line"><span class="ln">8</span><span class="cl">OpenSSL::Cipher::CipherError
</span></span></code></pre></div><p>æˆå°±å¤§ä½“éƒ½åˆ—å‡ºæ¥äº†ï¼Œè‡³äºä½ èƒ½åˆ°å“ªæ­¥å°±çœ‹ä½ çš„é€ åŒ–äº†ï¼ˆå¼€ç©ç¬‘ï¼‰ã€‚</p>
<h2 id="æ•°æ®åº“å­—æ®µåŠ å¯†">æ•°æ®åº“å­—æ®µåŠ å¯†</h2>
<p>Rails é»˜è®¤å¹¶ä¸ä¼šå¯¹æ•°æ®åº“å­—æ®µåŠ å¯†ï¼Œåœ¨ 7.0 å¼€å§‹å…è®¸å¼€å‘è€…å®šä¹‰åŠ å¯†å­—æ®µä¹Ÿå…è®¸è‡ªå®šä¹‰åŠ è§£å¯†æ–¹æ³•ã€‚è¿™ä¸ªä¸æ˜¯æœ¬æ–‡çš„è®¨è®ºèŒƒå›´ä¸å†å±•å¼€ã€‚</p>
<p>åˆå§‹åŒ–éœ€è¦é€šè¿‡å¦‚ä¸‹å‘½ä»¤ç”Ÿæˆä¸€ä¸ªéšæœºçš„ Keysï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ rails db:encryption:init
</span></span><span class="line"><span class="ln">2</span><span class="cl">Add this entry to the credentials of the target environment:
</span></span><span class="line"><span class="ln">3</span><span class="cl">
</span></span><span class="line"><span class="ln">4</span><span class="cl">active_record_encryption:
</span></span><span class="line"><span class="ln">5</span><span class="cl">  primary_key: KMw07GoiPScVwtmoNxlBv7YibFCnB4dU
</span></span><span class="line"><span class="ln">6</span><span class="cl">  deterministic_key: CTttlez04KZcy3MCMFtZ8FUEopSAmJOr
</span></span><span class="line"><span class="ln">7</span><span class="cl">  key_derivation_salt: FwUgrDWHX3wN7kKw5gYSsYEgzxRnYBWh
</span></span></code></pre></div><p>åœ¨é€šè¿‡ <code>rails credentials:edit</code> æŠŠä¸Šç«¯åŠ å¯†ä¸²åŠ åˆ° credentials é‡Œé¢ä¿å­˜å³å¯ï¼Œ<strong>ä¸åŒçš„åŠ å¯†ä¸²æ˜¯æ— æ³•è§£å¯†å·²ç»å­˜åœ¨æ•°æ®åº“ä¸­çš„æ•°æ®çš„ï¼Œåˆ‡è®°ï¼åˆ‡è®°ï¼åˆ‡è®°ï¼</strong>
å¦åˆ™ä½ ä¼šå†è·å¾—ä¸€ä¸ªæˆå°± <code>ActiveRecord::Encryption::Errors::Decryption</code> æŠ¥é”™ã€‚</p>
<h2 id="é•œåƒæ„å»ºå¤„ç†">é•œåƒæ„å»ºå¤„ç†</h2>
<blockquote>
<p>æ­å–œä½ ï¼Œä»ç°åœ¨å¼€å§‹ä½ æœ¬åº”å½“ç›´é¢ææƒ§ï¼Œå¯æƒœä½ å‘ç°äº†æˆ‘è¿™ç¯‡æ–‡ç« ç¼ºå°‘äº†ç‚¹æ‚²æƒ¨çš„ç»å†ã€‚</p>
</blockquote>
<p>åˆ¶ä½œ Docker é•œåƒæ— è®ºä»€ä¹ˆæƒ…å†µéƒ½è¦ä¿è¯ä¸ä¼šåŒ…å«ä»»ä½•ç§å¯†æ•°æ®ï¼ŒRails ç»•ä¸å¼€çš„ç‚¹ä¸»è¦æ˜¯ <code>rails assets:complie</code>ã€‚
ä¸Šé¢æˆ‘ä¹Ÿè¯´äº†åªè¦æ¶‰åŠ <code>:environment</code> å‚æ•°çš„æ‰€æœ‰ tasks éƒ½ä¼šèµ°è§£å¯†æµç¨‹ï¼Œå®ƒä¹Ÿä¸ä¾‹å¤–ã€‚</p>
<p>æ„å»ºæ–¹é¢æˆ‘é€šè¿‡ä¸‰ç§æ–¹å¼æ¥è§£æå¦‚æœä»ä¸å®‰å…¨åˆ°å®‰å…¨çš„æ„å»ºè¿‡ç¨‹ï¼š</p>
<h3 id="-æœ€ä¸å®‰å…¨çš„æ–¹å¼">ğŸš« æœ€ä¸å®‰å…¨çš„æ–¹å¼</h3>
<p>é•œåƒæ„å»ºå…è®¸è®¾ç½® <a href="https://docs.docker.com/engine/reference/commandline/build/#set-build-time-variables---build-arg">build-arg</a> ä¼ é€’ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">FROM</span><span class="s"> ruby:3.0.3</span><span class="err">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="err"></span><span class="k">ARG</span> master_key<span class="err">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="err"></span><span class="k">ENV</span> <span class="nv">RAILS_MASTER_KEY</span><span class="o">=</span><span class="nv">$master_key</span><span class="err">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="err"></span><span class="k">ENV</span> <span class="nv">RAILS_ENV</span><span class="o">=</span>production
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="c"># çœç•¥</span><span class="err">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="err"></span>...<span class="err">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="err"></span><span class="k">RUN</span> bin/rails assets:complie<span class="err">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="err"></span><span class="c"># æˆ–è€…</span><span class="err">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="err"></span><span class="k">RUN</span> <span class="nv">RAILS_MASTER_KEY</span><span class="o">=</span><span class="nv">$master_key</span> bin/rails assets:complie<span class="err">
</span></span></span></code></pre></div><p>æ‰§è¡Œæ„å»ºå‘½ä»¤ <code>docker build -t app --build-arg master_key=[32bits-length-key] .</code> æ„å»ºåè™½ç„¶å¯ä»¥è·å¾—é•œåƒï¼Œä½†æ„å»ºæ—¶è®¾ç½®çš„å€¼ä¹Ÿè¢«å°è£…åœ¨äº†å®¹å™¨ä¸­ï¼Œå°±ç®—æ²¡æœ‰å°è£…åˆ°å®¹å™¨ä¸­ä½¿ç”¨ <code>docker history</code> ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œå› æ­¤è¿™ç§æ–¹å¼æ˜¯ç»å¯¹ä¸å¯å–çš„ã€‚</p>
<h3 id="-æ”¹è¿›ç‰ˆ">â­•ï¸ æ”¹è¿›ç‰ˆ</h3>
<p>ä½ å¯èƒ½ä¼šçœ‹åˆ°æœ‰äº›é•œåƒçš„ Dockerfile é‡Œé¢ä¼šåŒ…å«å¤šä¸ª <code>FROM</code> çš„<a href="https://docs.docker.com/develop/develop-images/multistage-build/">å¤šé˜¶æ®µæ„å»º</a>ã€‚è¿™ä¸ªæ˜¯ä¸ºäº†åˆ©ç”¨éš”ç¦»èµ„æºï¼Œé‡å¤åˆ©ç”¨ç¼“å­˜æœºåˆ¶çš„æ–¹å¼ä½¿å¾—æœ€ç»ˆçš„å®¹å™¨æå¯èƒ½çš„å°å’Œå®‰å…¨ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å®ƒæŠŠç§å¯†æ•°æ®éš”ç¦»åœ¨å‰é¢çš„ä¸´æ—¶é•œåƒä¸­ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="k">FROM</span><span class="s"> ruby:3.0.3 as builder</span><span class="err">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="err"></span><span class="k">ARG</span> <span class="nv">workspace</span><span class="o">=</span>/app<span class="err">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="err"></span><span class="k">ARG</span> master_key<span class="err">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="err"></span><span class="k">ENV</span> <span class="nv">RAILS_MASTER_KEY</span><span class="o">=</span><span class="nv">$master_key</span><span class="err">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="err"></span><span class="k">ENV</span> <span class="nv">RAILS_ENV</span><span class="o">=</span>production
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="c"># çœç•¥</span><span class="err">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="err"></span>...<span class="err">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="err"></span><span class="k">WORKDIR</span><span class="s"> $workspace</span><span class="err">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="err"></span><span class="k">RUN</span> bin/rails assets:complie<span class="err">
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="err"></span><span class="c"># çœç•¥</span><span class="err">
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="err"></span>...<span class="err">
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> ruby:3.0.3-slim</span><span class="err">
</span></span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="err"></span><span class="c"># çœç•¥</span><span class="err">
</span></span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="err"></span>...<span class="err">
</span></span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="err"></span><span class="k">COPY</span> --from<span class="o">=</span>builder <span class="nv">$workspace</span> <span class="nv">$workspace</span><span class="err">
</span></span></span></code></pre></div><p>é•œåƒå­˜åœ¨ <code>builder</code> å’Œä¸€ä¸ªç¼ºçœåå­—ï¼ˆé€šå¸¸æ˜¯ <code>stage-N</code>, N æ˜¯æ•°å­—ä» 1 å¼€å§‹ï¼‰ä¸¤ä¸ªé˜¶æ®µï¼Œç¬¬ä¸€é˜¶æ®µæ˜¯æœ€ä¸å®‰å…¨æ–¹å¼çš„å®ç°æ–¹å¼ï¼Œè¿™é‡Œåœ¨æœ€åä¸€ä¸ªé˜¶æ®µé€šè¿‡ä¸€ä¸ªå¹²å‡€å®‰å…¨çš„é•œåƒæŠŠä¸Šä¸€ä¸ªé˜¶æ®µçš„ç»“æœæ–‡ä»¶å¤åˆ¶è¿‡æ¥å°±è¾¾æˆäº†ç¬¬ä¸€ä¸ªé˜¶æ®µä¸­ç§å¯†æ•°æ®æ³„éœ²çš„é—®é¢˜ã€‚</p>
<p>è¿™ç§æ–¹å¼ä¹Ÿæ˜¯å½“å‰å¤§å¤šæ•°äººä¼šåº”ç”¨çš„æ–¹å¼ï¼Œå°¤å…¶åˆ©ç”¨ Github Action çš„ <a href="https://docs.github.com/en/actions/security-guides/encrypted-secrets">Encrypted secrets</a> åŠŸèƒ½ä»æŸç§ç¨‹åº¦ä¸Šæœç»äº†éšç§æ•°æ®çš„æ³„éœ²ã€‚</p>
<h3 id="-åŠ å¼ºç‰ˆ">âœ… åŠ å¼ºç‰ˆ</h3>
<p><a href="https://docs.docker.com/develop/develop-images/build_enhancements/">Buildkit</a> æ˜¯ Docker æ–°ä¸€ä»£é•œåƒæ„å»ºå·¥å…·ï¼Œå¯ç”¨å¯ä»¥é€šè¿‡é…ç½®ç¯å¢ƒå˜é‡ <code>DOCKER_BUILDKIT=1</code> æˆ–åœ¨ Docker é…ç½®æ–‡ä»¶çš„ features å­—å…¸å¢åŠ  <code>&quot;buildkit&quot; : &quot;true&quot;</code>ã€‚</p>
<p>ç”±äºé‡‡ç”¨æ–°çš„æ„å»ºå·¥å…·ï¼Œé¢å¤–è¿˜éœ€è¦åœ¨ Dockerfile å¤´éƒ¨æ˜¾æ€§å£°æ˜æ–°çš„è¯­æ³•ï¼š<code>syntax = docker/dockerfile:1.2</code> é…åˆ
<a href="https://docs.docker.com/develop/develop-images/build_enhancements/#new-docker-build-secret-information">æ–°çš„æ„å»º secret </a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c"># syntax = docker/dockerfile:1.2</span><span class="err">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> ruby:3.0.3</span><span class="err">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="err"></span><span class="k">ARG</span> <span class="nv">workspace</span><span class="o">=</span>/app<span class="err">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="err"></span><span class="k">WORKDIR</span><span class="s"> $workspace</span><span class="err">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="err"></span><span class="c"># çœç•¥</span><span class="err">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="err"></span>...<span class="err">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>master_key,target<span class="o">=</span>config/master.key,required<span class="o">=</span><span class="nb">true</span> <span class="se">\
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="se"></span>    bin/rails assets:precompile<span class="err">
</span></span></span></code></pre></div><p>æ„å»ºå‘½ä»¤æ‰§è¡Œéœ€è¦é€šè¿‡ <a href="https://docs.docker.com/build/buildx/install/">buildx</a> CLI å­å‘½ä»¤æ¥å®Œæˆï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ docker buildx build <span class="se">\
</span></span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="se"></span>  --secret <span class="nv">id</span><span class="o">=</span>master_key,src<span class="o">=</span>config/master.key <span class="se">\
</span></span></span><span class="line"><span class="ln">3</span><span class="cl"><span class="se"></span>  -t app .
</span></span></code></pre></div><p>ç»“åˆ <a href="https://github.com/moby/buildkit/blob/master/frontend/dockerfile/docs/reference.md#run---mounttypesecret">&ndash;mount-type=secret</a> æ”¯æŒçš„å‚æ•°:</p>
<table>
<thead>
<tr>
<th>å‚æ•°å</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>å¯†é’¥çš„å”¯ä¸€ idï¼Œé»˜è®¤æ˜¯ target å‚æ•°çš„å€¼çš„æ–‡ä»¶å</td>
</tr>
<tr>
<td>target</td>
<td>é•œåƒå†…æŒ‚è½½çš„è·¯å¾„ï¼Œé»˜è®¤æ˜¯ <code>/run/secrets/</code> + <code>id</code></td>
</tr>
<tr>
<td>required</td>
<td>è®¾ç½® <code>true</code> å½“å¯†é’¥ä¸å­˜åœ¨æ—¶æŠ¥é”™ï¼Œé»˜è®¤æ˜¯ <code>false</code></td>
</tr>
<tr>
<td>mode</td>
<td>æŒ‚è½½åçš„æ–‡ä»¶æƒé™ï¼Œé»˜è®¤æ˜¯ <code>0400</code></td>
</tr>
<tr>
<td>uid</td>
<td>è®¾ç½®å¯†é’¥æ–‡ä»¶çš„ç”¨æˆ· IDï¼Œé»˜è®¤æ˜¯ <code>0</code></td>
</tr>
<tr>
<td>gid</td>
<td>è®¾ç½®å¯†é’¥æ–‡ä»¶çš„ç”¨æˆ·ç»„ IDï¼Œé»˜è®¤æ˜¯ <code>0</code></td>
</tr>
</tbody>
</table>
<p><code>id</code> å…³è” CLI ä¼ å‚å’Œæ„å»ºé•œåƒä¸­æ‰§è¡Œæ­¥éª¤ï¼ŒCLI å…¥å‚è®¾ç½® secret çš„è¾“å…¥æ–‡ä»¶ï¼Œæ„å»ºé•œåƒåˆ™éœ€è¦æŠŠ secret å¯¼å‡ºåˆ°é•œåƒä¸­å…·ä½“çš„è·¯å¾„ï¼Œå…¶å®å°±æ˜¯è¿™ä¹ˆç®€å•ã€‚æå°‘æ•°æ”¯æŒ Docker
éƒ¨ç½²çš„äº‘æœåŠ¡ï¼Œæ¯”å¦‚ <a href="https://render.com/docs/docker-secrets">Render</a> æ”¯æŒè¿™ç§æ–¹å¼ã€‚éƒ¨ç½²åˆ°äº‘æœåŠ¡ä¸Šè¿˜éœ€è¦é‡æ–°è€ƒé‡ä¸‹ã€‚</p>
<h2 id="æœ¬ç¯‡å°ç»“">æœ¬ç¯‡å°ç»“</h2>
<p>æŠ˜è…¾ä¸€åœˆç»ˆäºè·å¾—äº†ä¸€ä¸ªå¹²å‡€ã€å®‰å…¨çš„é•œåƒï¼Œç­‰åˆ°éƒ¨ç½²æ—¶åˆå‚»çœ¼äº†ã€‚é¢å‘æŠ€æœ¯äººå‘˜æˆ–å…¬å¸çš„é¡¹ç›®å€’è¿˜å¥½ï¼Œåˆå§‹åŒ–æ—¶é€šè¿‡å‘½ä»¤ä¸€é€šæ“ä½œé…ç½®å®Œä¹Ÿä¸éœ€è¦å¤„ç† master key ä¸åŒ¹é…çš„æƒ…å†µã€‚
æ— è®ºä½¿ç”¨ä¸Šé¢æ”¹è¿›ç‰ˆè¿˜æ˜¯åŠ å¼ºç‰ˆéƒ½èƒ½è¿‡é¡ºåˆ©è·‘èµ·æ¥ã€‚å¦‚æœ Docker é•œåƒæ˜¯è¦é¢å‘å®¢æˆ·çš„è¯ï¼Œæ€ä¹ˆè®©ä»–ä»¬åˆå§‹åŒ–ä¸€ä¸ªå±äºä»–ä»¬è‡ªå·±çš„ master key å’ŒåŠ å¯†æ•°æ®å‘¢ï¼Ÿå¼€å§‹æŒ å¤´äº†å§ã€‚</p>
<p><del>æœªå®Œå¾…ç»­&hellip;</del> <a href="https://icyleaf.com/2022/09/perfect-solution-to-steup-rails-encrypted-credentials/">ç¿»çœ‹ç­”æ¡ˆ</a>ã€‚</p>
<h2 id="å‚è€ƒèµ„æº">å‚è€ƒèµ„æº</h2>
<ul>
<li><a href="https://techblog.lclco.com/entry/2021/07/27/110000">Railsã®credentials.yml.encã¨master keyã‚’Dockerã§å®‰å…¨ã«æ‰±ã†</a></li>
<li><a href="https://pythonspeed.com/articles/docker-build-secrets/">Donâ€™t leak your Docker imageâ€™s build secrets</a></li>
</ul>
]]></content:encoded></item><item><title>å¦‚ä½•æ­å»ºå®¶ç”¨ homelab: å…ˆå¯¼ç¯‡</title><link>https://icyleaf.com/2022/02/how-to-homelab-part-0/</link><pubDate>Sat, 12 Feb 2022 20:00:00 +0800</pubDate><guid>https://icyleaf.com/2022/02/how-to-homelab-part-0/</guid><description>æ­å»º homelab ä¹‹å‰éƒ½éœ€è¦äº†è§£å“ªäº›èƒŒæ™¯</description><content:encoded><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2>
<p>è¿™å°†ä¼šæ˜¯ä¸€ä¸ªæŒç»­ç³»åˆ—çš„ä¸»é¢˜æ–‡ç« ï¼Œä½ å°†ä¼šä»æœ€åŸºç¡€çš„å®¶åº­ homelab æ­å»ºå¼€å§‹å¾ªåºæ¸è¿›åˆ°ä¸€äº›è¿›é˜¶çš„ç³»ç»Ÿã€ç½‘ç»œã€æœåŠ¡å±‚é¢çš„å­¦ä¹ ã€‚æˆ‘å°½å¯èƒ½ä»¥æ–°äººçš„è§’è‰²æè¿°ç®€å•æ˜“æ‡‚çš„è¯­è¨€ï¼Œç³»åˆ—æ–‡ç« ä¼šæ¶‰åŠå®¶åº­ç½‘ç»œã€è·¯ç”±å™¨ã€Linuxã€æ•°æ®å‚¨å­˜ã€NASã€æœåŠ¡åŒ–ç­‰ç­‰ï¼Œå¦‚æœä½ åœ¨è¿‡ç¨‹ä¸­åˆé‡åˆ°ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿ç»™æˆ‘ç•™è¨€ã€‚</p>













  
  
    
      <figure data-pswp="4644x3004" data-size="800x"><a href="/tutorials/how-to-homelab/part-0/homelab-diagram-v2.0.png" class="gallery-item" target="_blank" data-pswp-width="4644" data-pswp-height="3004"><img src="/tutorials/how-to-homelab/part-0/homelab-diagram-v2.0_hud6b13e642cdec1b76e4883675cc1f0da_933051_800x0_resize_box_3.png"
      alt="å›¾ç‰‡æ¥æº"/></a><figcaption><p class="source">å›¾ç‰‡æ¥æº<a href="https://twitter.com/icyleaf/status/1472036769742745603">@icyleaf@twitter.com</a>
    </p>

    <p>2021 å¹´åº• v2.0 é•‡æ¥¼ç”¨çš„ç½‘ç»œæ‹“æ‰‘å›¾</p></figcaption></figure>

<h2 id="æ­å»º-homelab-èµ·å› ">æ­å»º homelab èµ·å› </h2>
<blockquote>
<p>homelab: a laboratory of (usually slightly outdated) awesome in the domicile</p>
</blockquote>
<p>ä»è¯­è¨€ç›´è¯‘æ¥çœ‹å¯ä»¥è¯´æ˜¯å®¶åº­ homelabï¼ŒæŠŠè¿™ä¸ªäº‹æƒ…å»¶å±•åˆ°ç½‘ç»œåŠæœåŠ¡ä¸Šé¢é‚£å°±å¯ä»¥å¹²å¾ˆå¤šæœ‰æ„æ€çš„äº‹æƒ…ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li>NAS å­˜å‚¨ï¼šèµ„æºä¸‹è½½ã€å­˜æ”¾ä»»ä½•çš„æ•°æ®ï¼ˆç…§ç‰‡ã€å°å§å§ã€å­¦ä¹ èµ„æ–™ã€ä»£ç ç­‰ï¼‰</li>
<li>å½±è§†åº“ï¼šä»æœ€ç®€å•çš„ç½‘ç»œå…±äº«æ–‡ä»¶å¤¹åˆ°å¯ä»¥æ‰˜ç®¡å½±è§†ç®¡ç†ã€æ’­æ”¾ã€è½¬ç ä¸ºä¸€ä½“çš„ Jellyfinã€Plex æœåŠ¡</li>
<li>ç½‘ç»œç®¡ç†ï¼šè®¾å¤‡é™æµã€æµé‡å®¡è®¡ã€é˜²ç«å¢™ç­–ç•¥</li>
<li>åº”ç”¨å¼€å‘ï¼šåšä¸€äº› side projects éœ€è¦å¼€å‘ç¯å¢ƒã€ç¼“å­˜ã€æ•°æ®å­˜å‚¨ç­‰</li>
<li>DevOpsï¼šansibleã€saltã€k8s æ¥æ“ä½œç»´æŠ¤å¤šä¸ªæœåŠ¡å™¨ã€VM æˆ–è€…æ˜¯ lxc</li>
</ul>
<p>å¦‚æœæ‚¨æ°å¥½æ˜¯ä¸€åè½¯ä»¶åº”ç”¨å¼€å‘è€…ï¼Œhomelab æ˜¯æœ€ä½³çš„æ‰©å±•ä½ çš„æŠ€èƒ½çš„å¾ˆå¥½çš„å®éªŒç”°ï¼Œå­¦ä¹ ç½‘ç»œæ‹“æ‰‘ã€Linux ç³»ç»Ÿã€å®‰å…¨ç®¡ç†ç­‰ã€‚
å¯¹äºå¤§éƒ¨åˆ†äººæ¥è¯´æˆ–è®¸å¤šå¤šå°‘å°‘éƒ½ä¼šå¬è¯´è¿‡ NAS æœåŠ¡å™¨ï¼Œå…¶å®ä»–ä¹Ÿæ˜¯ homelab çš„å®è·µåº”ç”¨ä¹‹ä¸€ã€‚</p>
<p>ä¸è¦è¢«å®ƒçš„åå­—å“åˆ°ï¼Œæœ¬è´¨ä¸Šå®ƒå°±æ˜¯åœ¨ä¸€ä¸ªæ“ä½œç³»ç»Ÿä¸Šé¢è·‘ä¸€å †ä¸Šé¢æåˆ°å’Œæ²¡æåˆ°çš„æœåŠ¡è€Œå·²ã€‚</p>
<h2 id="è‡ªå»ºè€ƒè™‘çš„ç‚¹">è‡ªå»ºè€ƒè™‘çš„ç‚¹</h2>
<p>æ— è®ºä¸Šé¢æåˆ°çš„ç‚¹æœ‰å¤šä¹ˆå¸å¼•ä½ æƒ³è¦ç»„ä»¶è‡ªå·±çš„å®¶åº­ homelabï¼Œæ‚¨è¿˜è¦æ…é‡è€ƒè™‘æ˜¯å¦çœŸçš„éœ€è¦ï¼Œæ¯•ç«ŸçœŸçš„æ•´ä¸€å¥—ä¹Ÿä¼šæŠ•å…¥å¾ˆå¤§çš„ç²¾åŠ›å’Œä¸€äº›èµ„é‡‘ï¼Œåƒä¸‡ä¸è¦æ²¡æœ‰éœ€æ±‚åˆ›é€ éœ€æ±‚ã€‚</p>
<blockquote>
<p>æœ¬ç³»åˆ—çš„å†…å®¹ä¼šä¼˜å…ˆè€ƒè™‘ä½¿ç”¨å¼€æºã€å…è´¹çš„è§£å†³æ–¹æ¡ˆï¼Œå¦‚æœçœŸçš„æ— æ³•æ»¡è¶³ä¼šåˆ†äº«ä¸€äº›å•†ä¸šçš„è§£å†³æ–¹æ¡ˆã€‚</p>
</blockquote>
<h2 id="å•†ä¸šæˆå“æ–¹æ¡ˆ">å•†ä¸šæˆå“æ–¹æ¡ˆ</h2>
<p>å•†ä¸šæˆå“ä¸»è¦æ˜¯å”®å–è½¯ä»¶æœåŠ¡æ¥æä¾›ç±»ç½‘ç»œç®¡ç†ã€æ•°æ®å­˜å‚¨ç­‰çš„è§£å†³æ–¹æ¡ˆï¼Œå¸‚é¢ä¸Šä¸»æµçš„ä¸»è¦æ˜¯ï¼š</p>
<ul>
<li><a href="https://www.synology.com/">ç¾¤æ™–</a>: æ­é…ç¡¬ä»¶å”®å–ï¼Œå„æ–¹é¢éƒ½éå¸¸ä»¤äººæ»¡æ„çš„è½¯ä»¶ç³»ç»Ÿï¼Œå¯¹å°ç™½éå¸¸å‹å¥½</li>
<li><a href="https://www.qnap.com/">å¨è”é€š</a>: æ­é…ç¡¬ä»¶å”®å–çš„è½¯ä»¶ï¼Œä»·æ ¼æ¯”ç¾¤æ™–æœ‰ä¼˜åŠ¿ï¼Œè½¯ä»¶ç³»ç»Ÿç›¸å¯¹ç¾¤æ™–è¦é€Šè‰²ä¸å°‘</li>
<li><a href="https://unraid.net/">UnRaid</a>: ä¸€æ¬¾å•†ä¸šçš„ NAS ç³»ç»Ÿï¼Œä½†æä¾›å¿«é€Ÿæ‰©å®¹ã€Docker å’Œ VM ç®¡ç†</li>
<li><a href="https://store.ui.com/collections/unifi-network-unifi-os-consoles">UniFi OS</a>: ä¸»è¦æ˜¯ Dream Machine æ­è½½çš„ç³»ç»Ÿï¼Œæ•´ä½“ä¸‹æ¥ä»·æ ¼éå¸¸æ˜‚è´µ</li>
</ul>
<p>é€šå¸¸æƒ…å†µä¸‹å•†ä¸šæˆå“æ˜¯ä¸€ç«™å¼çš„è§£å†³æ–¹æ¡ˆï¼Œé‡‡è´­çš„è¯è´¹ç”¨ä¹Ÿä¼šæ¯”è‡ªå»ºè¦æŠ•å…¥æ›´å¤šçš„èµ„é‡‘ï¼Œè¿™ä¸ªå°±ä¸å† homelab çš„è€ƒè™‘èŒƒå›´ï¼Œè¿™é‡Œå°±ä¸€ç¬”å¸¦è¿‡ã€‚</p>
<h2 id="å¼€æºå…è´¹æ–¹æ¡ˆ">å¼€æº&amp;å…è´¹æ–¹æ¡ˆ</h2>
<p>è‡ªå»º homelab å¿…ç„¶ä¼šä»ç¡¬ä»¶ã€è½¯ä»¶ä¸‹æ‰‹ï¼Œå‡†å¤‡å¥½äº†å†å†³å®šç½‘ç»œæ‹“æ‰‘ç»“æ„ã€‚</p>
<h2 id="ç¡¬ä»¶ç­›é€‰">ç¡¬ä»¶ç­›é€‰</h2>
<p>å›½å†…å’Œå›½å¤–çš„ç¡¬ä»¶ç¯å¢ƒæœ‰éå¸¸å¤§çš„ä¸åŒï¼Œå›½å†…æœ‰å¾ˆå¤šçš„æ´‹åƒåœ¾ã€é­”æ”¹ç¡¬ä»¶çš„è®¨è®ºï¼Œæ¯”å¦‚æ‚¨å¯èƒ½å¬è¯´è¿‡çš„ E3/E5 ç¥æ•™ã€åƒåœ¾ä½¬ä¹‹ç±»çš„åè¯ã€‚
è‹¥ä½ æ˜¯è¿™ä¸ªé¢†åŸŸçš„è¡Œå®¶æ­å–œä½ ä¼šçœä¸å°‘é’±ï¼›è‹¥ä½ ä¸æ˜¯ä¹Ÿä¸ç”¨æ²®ä¸§è¸è¸å®å®çš„èŠ±é’±ä¹°æ•°æ®å®‰å…¨ï¼Œåˆ‡è®°ä¹Ÿä¸è¦ç›²ç›®å…¥æ‰‹åƒåœ¾ä½¬çš„ç¡¬ä»¶ï¼Œæ¡åƒåœ¾æœ‰é£é™©ï¼Œæœ‰äº›ç¡¬ä»¶ä¼šè¢«è¶…çš„å¾ˆé«˜è¿™æ ·çš„æ€§ä»·æ¯”ä¹Ÿä¼šå¾ˆä½è€Œä¸å€¼å¾—å…¥æ‰‹ã€‚</p>
<p>æœ€å…³é”®çš„å‡ ä¸ªéƒ¨åˆ†ï¼šCPUã€å†…å­˜ã€ä¸»æ¿ã€ç½‘ç»œå’Œç¡¬ç›˜ã€‚</p>
<ul>
<li>CPU å’Œå†…å­˜å¾ˆå¥½ç†è§£ï¼ŒCPU æ ¸å¿ƒæ•°é‡ã€å†…å­˜å®¹é‡è¶Šå¤šè¶Šèƒ½é€ ï¼Œå¦‚æœå¯¹äºå½±è§†æ’­æ”¾æœ‰è¦æ±‚å°±éœ€è¦ CPU æœ‰å¥½çš„æ ¸å¿ƒæ”¯æŒã€‚</li>
<li>ä¸»æ¿å¯¹ç½‘å£æ•°é‡ã€æ‰©å±•æ§½ä¼šæœ‰ä¾èµ–ï¼Œç½‘å£æ•°é‡å’Œç¡¬ç›˜æ•°é‡æ”¯æŒä¸å¤šå°±è¦é æ‰©å±•æ§½æ¥å‡‘ã€‚</li>
<li>ç½‘ç»œçŠ¶å†µè‡³å…³é‡è¦ï¼ŒWiFi 6 ä¼ è¾“é€Ÿåº¦è¿˜æ˜¯ä¸å¦‚åƒå…†æœ‰çº¿ï¼Œè¯„ä¼°ä¸‹è‡ªå·±å®¶é‡ŒçŒ«å’Œè·¯ç”±å™¨æœ€ä½è¦æ±‚åƒå…†ç½‘ç»œï¼Œæœ‰çº¿ä¹Ÿå°½é‡æ˜¯ CAT5e/CAT6 è§„æ ¼</li>
<li>NAS åº”ç”¨åœºæ™¯å¯¹ç¡¬ç›˜å®¹é‡å’Œè§„æ ¼è¦æ±‚æ¯”è¾ƒé«˜ï¼ŒSSD ä¸æ˜¯å¼ºéœ€æ±‚ï¼Œå¦‚æœä¸å·®é’±å…¨ä¸Š SSD ä¹Ÿä¸æ˜¯ä¸è¡Œã€‚</li>
</ul>
<p>è¿™é‡Œæ¯ä¸€ä¸ªå±•å¼€èŠéƒ½æ˜¯éå¸¸å¤§çš„è¯é¢˜ï¼Œæˆ‘å¯èƒ½ä¼šæ•´ç†ä¸€äº›å¤–éƒ¨èµ„æºä¾›æ‚¨å»è¡¥å……è¿™æ–¹é¢çš„çŸ¥è¯†ã€‚å¸‚é¢ä¸Šä¹Ÿæœ‰ä¸€äº›æˆå“ç¡¬ä»¶çš„è§£å†³æ–¹æ¡ˆï¼Œæ‚¨ä¹Ÿå¯ä»¥è€ƒè™‘ï¼š</p>
<ul>
<li>è‹±ç‰¹å°” NUCï¼šå°å·§çš„æœºå‹å¹¶ä¸ä»£è¡¨ä»–çš„æ€§èƒ½å¾ˆå¼±ï¼Œæœ€æ–° 12 ä»£çš„ NUC ä»å„æ–¹é¢éƒ½æ˜¯å¾ˆå¥½çš„é€‰æ‹©</li>
<li>è”æƒ³ ThinkCentre ç³»åˆ—ï¼šæ¯” NUC ç¨å¾®å¤§ç‚¹ï¼Œè¿™ä¸ªç³»åˆ—ä½“ç³»éå¸¸çš„åºå¤§ä¸”æ‚ ä¹…ï¼Œä¹Ÿæœ‰ä¸å°‘ä»·æ ¼åˆé€‚çš„äºŒæ‰‹å’Œæ”¹è£…ä»¶ï¼Œä½†ä¼šæŠ˜è…¾ä¸€äº›</li>
<li>æƒ æ™® MicroServer Gen ç³»åˆ—ï¼šGen8/Gen10 éƒ½æ˜¯ç›®å‰ä¸»æµçš„ homelab è§£å†³æ–¹æ¡ˆï¼Œæ­£ç»ŸæœåŠ¡å™¨è§„æ ¼å’Œç‰¹æ€§ã€‚ï¼ˆæˆ‘æœ‰ä¸€å° Gen 8 æ­£åœ¨æœå½¹ï¼‰</li>
<li>å„ç§å¼€å‘æ¿ï¼šæ¯”å¦‚æ ‘è“æ´¾ä» 3B å¼€å§‹å®ƒä¹Ÿèƒ½åšä¸€äº› homelab çš„åº”ç”¨åœºæ™¯ï¼Œå›½å†…å¤–èµ„æ–™ä¸°å¯Œï¼Œé…ä»¶ä¼—å¤šã€‚å”¯ä¸€çš„ç¼ºç‚¹å—æ–°å† å½±å“å®ƒçš„ä»·æ ¼åœ¨å›½å†…å±…é«˜ä¸ä¸‹ï¼Œå¯ä»¥è€ƒè™‘ä¸€äº›å…¶ä»–æˆç†Ÿçš„å¼€å‘æ¿ã€‚</li>
<li>å„ç§çŸ¿æ¸£ä¸»æœºï¼šåŒºå—é“¾ç››è¡Œçš„æŒ–çŸ¿è¡Œä¸šå……æ–¥ç€å¾ˆå¤šæŒ–çŸ¿ä¸»æœºï¼Œæ¯”å¦‚æ˜Ÿé™…èœ—ç‰›ã€ç»¿ç›˜ã€èœœç¾è¶…å­˜ç­‰ï¼Œæœ‰äº›ç¡¬ä»¶å‚æ•°è¿˜ä¸é”™åˆ°æ‰‹ä¹‹åéœ€è¦è°ƒèŠ‚æˆ–æ”¹ä¸‹é™éŸ³é£æ‰‡å°±å¯ç”¨ã€‚</li>
</ul>
<p>æœ€ç®€å•çš„ç‰ˆæœ¬å°±æ˜¯å¯ä»¥æ‰¾ä¸€ä¸ªå¯ä»¥é•¿æœŸè¿è¡Œçš„ä¸å†ä½¿ç”¨çš„ç¬”è®°æœ¬ç”µè„‘ã€å°å¼ç”µè„‘å°±èƒ½èµ·æ­¥ï¼ˆåŠŸè€—å¤ªé«˜çš„è¯å°±çœŸçš„ç®—äº†ï¼‰</p>
<h2 id="è½¯ä»¶éƒ¨ç½²æ–¹æ¡ˆ">è½¯ä»¶éƒ¨ç½²æ–¹æ¡ˆ</h2>
<p>ç¡¬ä»¶å‡†å¤‡å®Œå¤‡ä¹‹åï¼Œæˆ‘ä»¬æ¥è€ƒè™‘æ­é…å“ªç§è½¯ä»¶éƒ¨ç½²æ–¹æ¡ˆï¼Œé€šå¸¸ä¼šè¢«åˆ’åˆ†ä¸ºä¸‰å¤§ç±»ï¼š</p>
<ul>
<li>ä¼ ç»Ÿéƒ¨ç½²ï¼ˆTraditional Deploymentï¼‰</li>
<li>è™šæ‹ŸåŒ–éƒ¨ç½²ï¼ˆVirutalization Deploymentï¼‰</li>
<li>å®¹å™¨åŒ–éƒ¨ç½²ï¼ˆContainerd Deploymentï¼‰</li>
</ul>













  
  
    
      <figure data-pswp="1800x650" data-size="800x"><a href="/tutorials/how-to-homelab/part-0/container-evolution.png" class="gallery-item" target="_blank" data-pswp-width="1800" data-pswp-height="650"><img src="/tutorials/how-to-homelab/part-0/container-evolution_hu14ca6c0f8a2e7d8ef8516841ce4ab16c_259692_800x0_resize_box_3.png"
      alt="å›¾ç‰‡æ¥æº"/></a><figcaption><p class="source">å›¾ç‰‡æ¥æº<a href="https://kubernetes.io/zh/docs/concepts/overview/what-is-kubernetes/">Kubernetes æ˜¯ä»€ä¹ˆï¼Ÿ</a>
    </p>

    <p>éƒ¨ç½²æ–¹å¼çš„æ¼”å˜</p></figcaption></figure>

<p>é€šå¸¸åœ¨ç¡¬ä»¶æ€§èƒ½è¿˜ç®—ä¸é”™æƒ…å†µä¸‹éƒ½ä¸ä¼šé‡‡ç”¨ä¼ ç»Ÿéƒ¨ç½²çš„æ–¹æ¡ˆï¼Œå•ä¸»æœºçš„ä¼˜å…ˆçº§ï¼šå®¹å™¨åŒ– &gt; è™šæ‹ŸåŒ– &gt; ä¼ ç»Ÿéƒ¨ç½²ï¼Œæœºå™¨æ€§èƒ½ä¸é”™ä¸”æœ‰æŠ€æœ¯å…´è¶£åº¦çš„ä¼˜å…ˆçº§ï¼šè™šæ‹ŸåŒ– &gt; å®¹å™¨åŒ– &gt; ä¼ ç»Ÿéƒ¨ç½²ã€‚</p>
<h3 id="ä¼ ç»Ÿéƒ¨ç½²">ä¼ ç»Ÿéƒ¨ç½²</h3>
<p>ä¼ ç»Ÿéƒ¨ç½²é€šå¸¸æ˜¯åœ¨ Bare-metal æœºå™¨ä¸Šé¢è¿›è¡Œçš„ï¼Œå› æ­¤æˆ‘æŠŠå®ƒä¿©åˆ’ä¸ºç­‰å·ï¼Œå®ƒä½¿ç”¨ç¡¬ä»¶ä¸»æœºå®‰è£…æ“ä½œç³»ç»Ÿå¦‚ Windowã€macOS å’Œ *nix (Unix/Linux) åç›´æ¥å®‰è£…å’Œéƒ¨ç½²æœåŠ¡ï¼Œå¬èµ·æ¥æ²¡ä»€ä¹ˆç‰¹åˆ«çš„ï¼Œ
å¸‚é¢ä¸Šä¹Ÿä¼šæœ‰å¾ˆå¤šçš„è¿ç»´å·¥å…·ç”¨äºè§£å†³å®‰è£…ç³»ç»Ÿã€é…ç½®ç¯å¢ƒã€åæœŸç»´æŠ¤ã€æ•°æ®å¤‡ä»½çš„å·¥ä½œï¼Œæ¯”å¦‚ Saltã€Ansibleã€Puppet ç­‰æœ‰ä¸€å®šçš„å­¦ä¹ æˆæœ¬ï¼Œæ²¡æ³•åšåˆ°å¼€ç®±å³ç”¨ï¼Œ 100% å‘æŒ¥ç¡¬ä»¶æœºèƒ½ä¹Ÿä¼šæ˜¯ä¸€ä¸ªé—®é¢˜ã€‚</p>













  
  
    
      <figure data-pswp="1920x1080" data-size="800x"><a href="/tutorials/how-to-homelab/part-0/bare-metal.jpg" class="gallery-item" target="_blank" data-pswp-width="1920" data-pswp-height="1080"><img src="/tutorials/how-to-homelab/part-0/bare-metal_hu4b369ced3c986b922f395ae6ff16aca0_920504_800x0_resize_q75_box.jpg"
      alt="å›¾ç‰‡æ¥æº"/></a><figcaption><p class="source">å›¾ç‰‡æ¥æº<a href="https://thecloudgirl.dev/BareMetal.html">The Cloud Girl</a>
    </p>

    <p>Bare metal æ–¹æ¡ˆ</p></figcaption></figure>

<h3 id="è™šæ‹ŸåŒ–éƒ¨ç½²">è™šæ‹ŸåŒ–éƒ¨ç½²</h3>
<ul>
<li><a href="https://www.vmware.com/products/esxi-and-esx.html">ESXi</a>: VMware å…¬å¸å¼€å‘çš„ç¡¬ä»¶è™šæ‹ŸåŒ–è§£å†³æ–¹æ¡ˆï¼Œç•Œé¢ç®€å•æ˜“ç”¨ï¼Œè‡ªèº«åŠŸèƒ½è¾ƒå¼ºï¼Œä»˜è´¹ä½¿ç”¨</li>
<li><a href="https://www.proxmox.com">Proxomx</a>: åŸºäº Debian å¼€å‘ä¼ä¸šçº§è™šæ‹ŸåŒ–ç³»ç»Ÿï¼Œæ”¯æŒç¡¬ä»¶ç›´é€šï¼Œå¯æ‰©å±•é›†ç¾¤ï¼Œä¸Šæ‰‹éš¾åº¦ç•¥é«˜ï¼Œç®€ç§° PVE</li>
</ul>
<p>åŸºäºå¼€æºè§£å†³æ–¹æ¡ˆå®åœ¨æ²¡æœ‰å¤ªå¤šå¯é€‰æ€§ï¼ŒPVE æ˜¯å¸‚é¢ä¸Šæœ€æˆç†Ÿã€ç¤¾åŒºæ´»è·ƒä¹Ÿå¾ˆé«˜çš„æ–¹æ¡ˆï¼Œ
å°±ç®—é‡åˆ°å¥‡å¥‡æ€ªæ€ªçš„é—®é¢˜å–„ç”¨æœç´¢å¼•æ“ä»£æ›¿ä¸Šéƒ½å¯ä»¥è§£å†³ã€‚</p>
<h3 id="å®¹å™¨åŒ–éƒ¨ç½²">å®¹å™¨åŒ–éƒ¨ç½²</h3>
<ul>
<li><a href="https://www.docker.com/">Docker</a>: ç°ä»£å®¹å™¨åŒ–çš„å¼€å±±é¼»ç¥–ï¼Œè‡ªå·±æ¯”è¾ƒä½œå¼•å‘äº†å¤§å›é€ƒå°±æœ‰äº†ä¸‹é¢ä¸¤ä¸ªè§£å†³æ–¹æ¡ˆ</li>
<li><a href="https://containerd.io/">Containerd</a>: å§‹äº Docker æ¯å…¬å¸ï¼Œå£®å¤§åœ¨ CNCF åŸºé‡‘ä¼šï¼Œæä¾› nerdctl ä»£æ›¿ docker CLI</li>
<li><a href="https://podman.io/">Podman</a>: Red Hat å…¬å¸é¢†å¯¼çš„å…¼å®¹ Docker çš„è§£å†³æ–¹æ¡ˆ</li>
</ul>
<p>ä¸€å¥è¯æ€»ç»“æ²¡çœ‹æ‡‚å°±ç”¨ docker å°±è¡Œã€‚</p>
<h2 id="åŸºç¡€ç³»ç»Ÿ">åŸºç¡€ç³»ç»Ÿ</h2>
<p>å¦‚æœé€‰æ‹©ä¼ ç»Ÿéƒ¨ç½²éšä¾¿ç”¨ä¸€ä¸ªä½ ç†Ÿæ‚‰ä¸”æ»¡è¶³ä½ éœ€æ±‚çš„æ“ä½œç³»ç»Ÿå³å¯</p>
<h2 id="åº”ç”¨æœåŠ¡">åº”ç”¨æœåŠ¡</h2>
<p>å®šå¥½è½¯ç¡¬ä»¶çš„åŸºç¡€åæ‚¨éœ€è¦é¢å¯¹éå¸¸åºå¤§çš„åº”ç”¨æœåŠ¡æ¥æ‰©å±•å’Œä¸°å¯Œ homelab</p>
<h3 id="åˆé˜¶æ–¹æ¡ˆ">åˆé˜¶æ–¹æ¡ˆ</h3>
<h4 id="è½¯è·¯ç”±">è½¯è·¯ç”±</h4>
<ul>
<li><a href="https://github.com/openwrt/openwrt">openwrt</a>: å›½å†…æœ€è¿‘ä»Šå¹´éå¸¸ä¸»æµçš„è§£å†³æ–¹æ¡ˆï¼Œå›½å†…æœ‰ä¸ª <a href="https://github.com/immortalwrt/immortalwrt">immortalwrt</a> åˆ†æ”¯ç‰ˆæœ¬</li>
<li><a href="https://www.asuswrt-merlin.net/">æ¢…æ—</a>: åç¡•å¼€æºçš„è·¯ç”±å™¨å›ºä»¶ï¼ŒåŒæ ·å›½å†…æœ‰ä¸ª <a href="https://www.koolcenter.com/">koolcenter</a> æ”¹ç‰ˆ</li>
<li><a href="https://dd-wrt.com/">dd-wrt</a>: åœ¨æµè¡Œåˆ·è·¯ç”±å™¨åˆæœŸçš„æ‡µæ‡‚çš„å›ºä»¶ï¼Œå—é™äºç¡¬ä»¶æ”¯æŒåº¦å’Œæ›´æ–°é¢‘ç‡æ¸è¡Œæ¸è¿œï¼Œå½“æ—¶æ”¯æŒå¤š wan çš„ tomato</li>
</ul>
<h4 id="ç½‘å…³">ç½‘å…³</h4>
<ul>
<li><a href="https://www.nginx.com/">nginx</a>: è€ç‰Œä¼ ç»Ÿç½‘å…³ï¼Œç”¨äºæ‰˜ç®¡æˆ–åå‘ä»£ç†ç½‘ç«™æœåŠ¡</li>
<li><a href="https://caddyserver.com/">caddy v2</a>: ç°ä»£åŒ–è®¾è®¡çš„ HTTP/2 ä¸”æ”¯æŒ <a href="https://letsencrypt.org/">Letâ€™s encrypt</a> çš„ç½‘å…³</li>
</ul>
<h4 id="dns">DNS</h4>
<ul>
<li><a href="https://dnsmasq.org/">dnsmasq</a>: ä¸€åˆ‡çš„åŸºç¡€ï¼Œç”¨äºé…ç½® DNS å’Œ DHCP æœåŠ¡</li>
<li><a href="https://pi-hole.net/">pi-hole</a>: ä¸»æ‰“ä¿æŠ¤éšç§å’Œè¿‡æ»¤å¹¿å‘Šçš„è·¯ç”±ç³»ç»Ÿï¼Œå¸¸ç”¨æµ·å¤–ç”¨æˆ·</li>
<li><a href="https://adguard.com/zh_cn/adguard-home/overview.html">adguard home</a>: ä¸“æ³¨ä¿æŠ¤éšç§å’Œè¿‡æ»¤å¹¿å‘Šå…¨ç½‘å¹¿å‘Šæ‹¦æˆªçš„æœåŠ¡ï¼Œæä¾›ç”¨æˆ·å‹å–„çš„ UI ç•Œé¢</li>
<li><a href="https://github.com/pymumu/smartdns">smartDNS</a>: åŠ é€Ÿ DNS è§£æåˆ†æµçš„ DNS æœåŠ¡</li>
<li><a href="https://github.com/IrineSistiana/mosdns">mosdns</a>: é›† smartDNS å’Œ adguard home ä¼˜ç‚¹å¹¶å­˜çš„ DNS æœåŠ¡ä½†é…ç½®éº»çƒ¦</li>
</ul>
<h4 id="é˜²ç«å¢™">é˜²ç«å¢™</h4>
<ul>
<li><a href="https://www.netfilter.org/projects/iptables/index.html">iptables</a>: Linux å¸¸è§çš„å†…ç½®é˜²ç«å¢™</li>
<li><a href="https://www.netfilter.org/projects/nftables/index.html">nftables</a>: iptables çš„å®˜æ–¹å¢å¼ºç‰ˆï¼Œæœªæ¥çš„è¶‹åŠ¿éƒ½ä¼šæ…¢æ…¢è¿ç§»è¿‡æ¥</li>
<li><a href="https://www.pfsense.org/">pfSense</a>: å›½å¤–æ™®éä½¿ç”¨çš„ä¸€æ¬¾å¼€æºé˜²ç«å¢™</li>
</ul>
<h4 id="nas">NAS</h4>
<ul>
<li><a href="https://www.openmediavault.org/">OpenMediaValut</a>: ç¡¬ä»¶ä¾èµ–ä½é—¨æ§›çš„ç»¼åˆæ€§ NAS ç³»ç»Ÿ</li>
</ul>
<h4 id="æœåŠ¡éƒ¨ç½²">æœåŠ¡éƒ¨ç½²</h4>
<ul>
<li><a href="https://www.portainer.io/">portainer</a>: ç®€å•å®¹æ˜“ä¸Šæ‰‹çš„å®¹å™¨åŒ–éƒ¨ç½²è§£å†³æ–¹æ¡ˆ</li>
</ul>
<h4 id="å½±éŸ³">å½±éŸ³</h4>
<ul>
<li><a href="https://jellyfin.org/">Jellyfin</a>: å½±è§†å‰§ã€ç”µå½±ç­‰åª’ä½“æ’­æ”¾æœåŠ¡ï¼Œæ”¯æŒç‰‡æºèµ„æ–™æœåˆ®å’Œçœ‹è¿‡æ•°æ®åŒæ­¥æœåŠ¡</li>
</ul>
<h4 id="åº”ç”¨">åº”ç”¨</h4>
<ul>
<li><a href="https://bitwarden.com/">Bitwarden</a>: å¼€æºä¸”å®Œå…¨å¯ä»£æ›¿ 1 Password çš„å…¨å¹³å°å¯†ç ç”Ÿæˆç®¡ç†æœåŠ¡ï¼Œæ¨èä½¿ç”¨å¼€å‘è€…ç”¨ Rust é‡å†™çš„ <a href="https://github.com/dani-garcia/vaultwarden">vaultwarden</a></li>
<li><a href="https://zoneminder.com/">ZoneMinder</a>: å¼€æºå¤šè·¯æ‘„åƒå¤´&amp;å½•åƒç®¡ç†æœåŠ¡</li>
</ul>
<p>æ›´å¤šçš„åº”ç”¨å¯ä»¥å…³æ³¨æˆ‘çš„<a href="https://github.com/stars/icyleaf/lists/self-host-services">è‡ªå»ºæœåŠ¡é›†åˆ</a></p>
<h3 id="é«˜çº§è¿›é˜¶">é«˜çº§è¿›é˜¶</h3>
<p>ä¸‹é¢ä»‹ç»çš„ä¹Ÿä»…é™äºæˆ‘ä¸ªäººèƒ½åŠ›èŒƒå›´å†…ç›®å‰æƒ³åˆ°çš„ç‚¹ï¼Œèƒ½åŠ›æœ‰é™ä¹Ÿè¯·æ‰‹ä¸‹ç•™æƒ…ã€‚</p>
<h4 id="ç½‘å…³-1">ç½‘å…³</h4>
<ul>
<li><a href="https://traefik.io/traefik/">traefik</a>: ä¸€æ¬¾å¼€æºçš„åå‘ä»£ç†ä¸è´Ÿè½½å‡è¡¡ç»¼åˆæ€§å·¥å…·</li>
</ul>
<h4 id="nas-1">NAS</h4>
<ul>
<li><a href="https://www.truenas.com/">TrueNAS</a>: å›½å¤–åšæ•°æ®å­˜å‚¨çš„é¦–é€‰ï¼ŒåŸºäº ZFS æ–‡ä»¶ç³»ç»Ÿå†…å­˜å¤§å°å†³å®šç£ç›˜å®¹é‡çš„ä¸Šé™ï¼Œå‰èº«å« FreeNAS</li>
</ul>
<h4 id="æœåŠ¡éƒ¨ç½²-1">æœåŠ¡éƒ¨ç½²</h4>
<ul>
<li><a href="https://kubernetes.io/">Kubernetes</a>: ç°ä»£å®¹å™¨åŒ–ç¼–æ’ç³»ç»Ÿï¼Œæ‰€è°“çš„äº‘ YAML å·¥ç¨‹å¸ˆç»ˆæå·¥å…· ğŸ˜†</li>
</ul>
<h2 id="å°ç»“">å°ç»“</h2>
<p>homelab ç©æ³•çš„å¯èƒ½æ€§æ˜¯æ— é™çš„ï¼Œä¸è¦æŠŠæƒ³è±¡åŠ›å±€é™åœ¨è¿™å‡ å¹´å›½å†…æµè¡Œçš„æ‰€è°“ AIO Boomï¼š
ä½¿ç”¨ pve éƒ¨ç½²ä¸€åˆ‡ï¼Œæ›´ç”šè€…ç”¨ openwrt + docker éƒ¨ç½²å„è‡ªæœåŠ¡å‡ºç°é—®é¢˜å…ˆä¸è¯´ï¼Œ
çœŸé‡åˆ°æœåŠ¡å™¨å®•æœºä¸€æ³¢å…¨å¸¦èµ°ã€‚</p>
<p>å¦å¤–ä¸è¦å¤ªè¿‡äºè®¡è¾ƒæœåŠ¡å™¨çš„åŠŸè€—æƒ…å†µï¼Œåªè¦ä¸æ˜¯ç”µè€—å­ 35W è¿˜æ˜¯ 65W æ²¡çœå¤šå°‘ç”µè´¹ï¼Œ
ä¸‹é¢æ˜¯ä¸€ä¸ªæ­£é¢ä¾‹å­ï¼Œè™½ç„¶ç”¨çš„æ˜¯ X99-T8D + E5 2696V3*2 + é‡‘æ²³ç”° 6100 åŒè·¯ç”µæº
ä½†å¼€å‘è€…ä¸»è¦ç”¨äºé€‚åˆè‡ªå·±åœºæ™¯çš„ä½¿ç”¨ï¼Œé‚£å°±ä¸æ˜¯æµªè´¹ã€‚</p>













  
  
    
      <figure data-pswp="1186x1124" data-size="800x"><a href="/tutorials/how-to-homelab/part-0/twitter-yetone-numa-server.png" class="gallery-item" target="_blank" data-pswp-width="1186" data-pswp-height="1124"><img src="/tutorials/how-to-homelab/part-0/twitter-yetone-numa-server_hu2c6ccebbd6f151ecdcdde6085b274214_838983_800x0_resize_box_3.png"
      alt="å›¾ç‰‡æ¥æº"/></a><figcaption><p class="source">å›¾ç‰‡æ¥æº<a href="https://twitter.com/yetone/status/1540235004495921152">@yetone@twitter</a>
    </p>

    <p>NUMA DIY æœåŠ¡å™¨</p></figcaption></figure>

<p>ä¸‹é¢è¿™ä¸ªå›¾ä¸­çš„ä¾‹å­æ˜¯ä¸€ä¸ªåé¢æ•™æï¼Œè¦ä¹ˆå“—ä¼—å–å® è¦ä¹ˆéè ¢å³åã€‚</p>













  
  
    
      <figure data-pswp="1192x1660" data-size="800x"><a href="/tutorials/how-to-homelab/part-0/twitter-taresky-tpw-100w-nas-server.png" class="gallery-item" target="_blank" data-pswp-width="1192" data-pswp-height="1660"><img src="/tutorials/how-to-homelab/part-0/twitter-taresky-tpw-100w-nas-server_hufb1cbf63551b7d415425d25bb5adf88a_890096_800x0_resize_box_3.png"
      alt="å›¾ç‰‡æ¥æº"/></a><figcaption><p class="source">å›¾ç‰‡æ¥æº<a href="https://twitter.com/taresky/status/1555752846334705666">@taresky@twitter</a>
    </p>

    <p>å¾…æœº 100W çš„ NAS æœåŠ¡å™¨</p></figcaption></figure>

<p>æœ€åçš„å¿ å‘Šï¼Œå›½å†…å„è‡ªä¿¡æ¯å’¨è¯¢ç«™çš„ OpenWrtï¼ŒNAS æ–‡ç« çœ‹çœ‹å°±è¡Œï¼Œåˆ«å¤ªè®¤çœŸã€‚
æœ‰é‚£æ—¶é—´ä¸å¦‚å¤šçœ‹çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œå®˜æ–¹ç¤¾åŒºè®¨è®º :D</p>
]]></content:encoded></item><item><title>å¦‚ä½•ä½¿ç”¨ Docker ç®¡ç† Jenkins</title><link>https://icyleaf.com/2018/04/how-to-manage-jenkins-with-docker/</link><pubDate>Wed, 18 Apr 2018 14:44:32 +0800</pubDate><guid>https://icyleaf.com/2018/04/how-to-manage-jenkins-with-docker/</guid><description>è®©äººå‡ å¤šæ„çš„ Jenkins è¯¥å¦‚ä½•ç®¡ç†æ‰èƒ½çœå¿ƒ</description><content:encoded><![CDATA[<p>å®˜æ–¹çš„ <a href="https://hub.docker.com/_/jenkins">jenkins</a> é•œåƒå·²ç»ä¸å†ç»´æŠ¤ç®¡ç†è€Œæ˜¯ç”± Jenkins Community è¿›è¡Œæ›´æ–°ï¼Œé‰´äº Jenkins çš„æ›´æ–°é¢‘ç‡ç‰¹åˆ«å¿«ç¤¾åŒºç‰ˆæœ¬ä¼šæä¾›ä¸¤ä¸ªç‰ˆæœ¬ï¼š</p>
<ul>
<li><code>lts</code> é•¿æœŸç¨³å®šç‰ˆæœ¬ï¼Œä½†è¿˜æ˜¯ä¼šæœ‰æ–°ç‰ˆæé†’</li>
<li><code>latest</code> æ¯å‘¨æ›´æ–°ç‰ˆæœ¬</li>
</ul>
<p>éƒ½æ˜¯åŸºäº alpine ç³»ç»Ÿå°è£…å› æ­¤é•œåƒçš„ä½“ç§¯ä¼šå¤§å¤§å‡å°å¾ˆå¤šã€‚å¦‚æœä½ æ˜¯å†…ç½‘ä½¿ç”¨å¯ä»¥ä¸ç”¨åœ¨æ„æ›´æ–°é—®é¢˜é•¿æœŸä½¿ç”¨ä¸€ä¸ªç‰ˆæœ¬ä¹Ÿæ²¡å¤ªå¤§é—®é¢˜ã€‚</p>
<h2 id="å®‰è£…">å®‰è£…</h2>
<p>åˆ›å»ºé•œåƒæ—¶éœ€è¦æ³¨æ„å‡ ä¸ªåœ°æ–¹ï¼š</p>
<ol>
<li>å…³è”æœ¬åœ° volumes</li>
<li>è®¾ç½®æ—¶åŒºï¼ˆé»˜è®¤æ˜¯ UTC æ—¶é—´ï¼‰</li>
<li>æ˜ å°„ 50000 ç«¯å£ï¼ˆè¿™ä¸ªæ˜¯ master å’Œ slave çš„é€šè®¯ç«¯å£ï¼‰å’Œ 8000 ç«¯å£ï¼ˆWebï¼‰</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">docker run -d --restart<span class="o">=</span>always
</span></span><span class="line"><span class="ln">2</span><span class="cl">    -p 8000:8080 -p 50000:50000
</span></span><span class="line"><span class="ln">3</span><span class="cl">    -v /var/lib/docker/jenkins:/var/jenkins_home
</span></span><span class="line"><span class="ln">4</span><span class="cl">    -e <span class="nv">JAVA_OPTS</span><span class="o">=</span>-Duser.timezone<span class="o">=</span>Asia/Shanghai
</span></span><span class="line"><span class="ln">5</span><span class="cl">    jenkins/jenkins:lts
</span></span></code></pre></div><p>å¯¹äºè¿›è¡Œè®¾ç½® JAVA çš„å‚æ•°å¯ä»¥å‚è€ƒï¼šhttps://github.com/jenkinsci/docker/issues/45</p>
<h2 id="é…ç½®-jenkins-çš„æ’ä»¶æº">é…ç½® Jenkins çš„æ’ä»¶æº</h2>
<p>ä½¿ç”¨è¿‡å®ƒçš„äººéƒ½çŸ¥é“ç®¡ç†å’Œå®‰è£…æ’ä»¶æ˜¯ä¸€ä¸ªå¥‡æ…¢æ— æ¯”çš„äº‹æƒ…ï¼Œè™½ç„¶æä¾›äº†ä»£ç†æœåŠ¡å™¨ä½†æˆ‘è¿™è¿˜æœ‰ä¸€ä¸ªæ›´å¥½çš„æ–¹æ¡ˆã€‚</p>
<p>æˆ‘åœ¨ç¿»é˜…å›½å†…é•œåƒæºç½‘ç«™çš„æ—¶å€™å‘ç°æ¸…åå¤§å­¦å¼€æºè½¯ä»¶é•œåƒç«™å…¶å®æä¾›äº†å›½å†… Jenkins æ’ä»¶çš„é•œåƒæºä½†ä¸€ç›´å¾ˆä½è°ƒçš„æ²¡æœ‰å…¬å¸ƒï¼Œé€šè¿‡è¿›å…¥<code>ç®¡ç†æ’ä»¶ -&gt; é«˜çº§</code>é¡µé¢æ‹‰åˆ°æœ€åº•éƒ¨æœ‰ä¸ªå‡çº§ç«™ç‚¹çš„è‡ªå®šä¹‰æ¡†ï¼Œå¡«å…¥</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json
</span></span></code></pre></div><p>å®‰è£…æ’ä»¶çš„æ—¶å€™ç³»ç»Ÿé»˜è®¤ä¼šæµ‹è¯•ç½‘ç»œå°±æ˜¯ ping ä¸‹ Google çš„ç½‘ç«™ï¼Œå®ƒä¼šæç¤ºå¤±è´¥ä½†ä¸ç”¨æ‹…å¿ƒå®ƒä¼šç»§ç»­å°è¯•ä¸‹è½½å’Œå®‰è£…æ’ä»¶ã€‚</p>
<h2 id="å‡çº§">å‡çº§</h2>
<p>æ­¤æ–¹æ³•é€‚ç”¨äºæ‰€æœ‰çš„å®¹å™¨çš„å‡çº§æ­¥éª¤ã€‚</p>
<p>é¦–å…ˆéœ€è¦æ‰¾åˆ°å®¹å™¨çš„åå­—ï¼Œè¿™é‡Œæˆ‘æƒ³ä¼šæœ‰ä¸å°‘äººä¼šé—®ä¸ºä»€ä¹ˆä½ åœ¨åˆ›å»ºä¸€ä¸ªå®¹å™¨çš„æ—¶å€™ä¸æŒ‡å®šä¸€ä¸ªåå­—ï¼Œ
é‚£æ˜¯å› ä¸ºåé¢è¿˜éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°ç‰ˆæœ¬çš„å®¹å™¨è€Œåå­—ä¸èƒ½ä¸€æ ·ï¼Œå› æ­¤æˆ‘ç°åœ¨åˆ›å»ºéƒ½è®© docker éšæœºåˆ†é…ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ docker ps
</span></span><span class="line"><span class="ln">2</span><span class="cl">CONTAINER ID  ...   NAMES
</span></span><span class="line"><span class="ln">3</span><span class="cl">8f48718fdd07  ...   naughty_pasteur
</span></span></code></pre></div><p>æ‹¿åˆ°ä¹‹åå…ˆåœæ­¢è¿è¡Œåï¼Œåˆ›å»ºä¸€ä¸ªæ•°æ®å¤‡ä»½å®¹å™¨å†è¿›è¡Œæ‹‰å–æœ€æ–°ç‰ˆæœ¬</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ docker stop naughty_pasteur
</span></span><span class="line"><span class="ln">2</span><span class="cl">$ docker docker create --volumes-from naughty_pasteur --name jenkins-data jenkins/jenkins:lts
</span></span></code></pre></div><p>æ‹‰å–æœ€æ–°ç‰ˆæœ¬åæ¢å¤æ•°æ®ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ docker pull jenkins/jenkins:lts
</span></span><span class="line"><span class="ln">2</span><span class="cl">$ docker run -d --restart<span class="o">=</span>always
</span></span><span class="line"><span class="ln">3</span><span class="cl">    --volumes-from jenkins-data
</span></span><span class="line"><span class="ln">4</span><span class="cl">    -p 8000:8080 -p 50000:50000
</span></span><span class="line"><span class="ln">5</span><span class="cl">    -v /var/lib/docker/jenkins:/var/jenkins_home
</span></span><span class="line"><span class="ln">6</span><span class="cl">    -e <span class="nv">JAVA_OPTS</span><span class="o">=</span>-Duser.timezone<span class="o">=</span>Asia/Shanghai
</span></span><span class="line"><span class="ln">7</span><span class="cl">    jenkins/jenkins:lts
</span></span></code></pre></div><p>ç¡®ä¿é€šè¿‡ web è®¿é—®å’Œ build æ­£å¸¸ååˆ é™¤è€çš„å’Œæ•°æ®å¤‡ä»½çš„å®¹å™¨</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ docker rm naughty_pasteur
</span></span><span class="line"><span class="ln">2</span><span class="cl">$ docker rm jenkins-data
</span></span></code></pre></div><h2 id="ç–‘æƒ‘è§£ç­”">ç–‘æƒ‘è§£ç­”</h2>
<h3 id="1-æˆ‘å¿˜è®°è®¾ç½®æ—¶åŒºä½†æˆ‘è¿›å®ä¾‹ä¿®æ”¹äº†æ—¶åŒºåœ¨-jenkins-é‡Œä¸ç”Ÿæ•ˆ">1. æˆ‘å¿˜è®°è®¾ç½®æ—¶åŒºä½†æˆ‘è¿›å®ä¾‹ä¿®æ”¹äº†æ—¶åŒºåœ¨ Jenkins é‡Œä¸ç”Ÿæ•ˆ</h3>
<p>åœ¨ Jenkins çš„ç³»ç»Ÿè®¾ç½®é¡µé¢æ‰¾åˆ°è„šæœ¬å‘½ä»¤è¡Œè¿è¡Œï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="ln">1</span><span class="cl"><span class="n">System</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="err">&#39;</span><span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">commons</span><span class="o">.</span><span class="na">jelly</span><span class="o">.</span><span class="na">tags</span><span class="o">.</span><span class="na">fmt</span><span class="o">.</span><span class="na">timeZone</span><span class="err">&#39;</span><span class="o">,</span> <span class="err">&#39;</span><span class="n">Asia</span><span class="o">/</span><span class="n">Shanghai</span><span class="err">&#39;</span><span class="o">)</span>
</span></span></code></pre></div><p>æ‰§è¡Œåå³æ—¶ç”Ÿæ•ˆæ— éœ€é‡å¯ï¼Œæ–¹æ³•æ¥è‡ª<a href="https://wiki.jenkins.io/display/JENKINS/Change+time+zone">å®˜æ–¹æ–‡æ¡£</a></p>
<h2 id="å®˜æ–¹æ–‡æ¡£">å®˜æ–¹æ–‡æ¡£</h2>
<p><a href="https://github.com/jenkinsci/docker/blob/master/README.md">https://github.com/jenkinsci/docker/blob/master/README.md</a></p>
]]></content:encoded></item><item><title>Docker æ‘¸çˆ¬æ»šæ‰“å¯¹æŠ— CentOS 6</title><link>https://icyleaf.com/2016/12/docker-with-centos/</link><pubDate>Fri, 30 Dec 2016 17:52:30 +0800</pubDate><guid>https://icyleaf.com/2016/12/docker-with-centos/</guid><description>èƒ½ä¸ç”¨ CentOS å°±åˆ«äº†å§ï¼Œå•Šä¸è¡Œï¼Ÿé‚£å°±ç‚¹è¿›æ¥çœ‹çœ‹å§</description><content:encoded><![CDATA[



<div class="updated">
  <header class="updated-header">
    <h4 class="updated-title">æ›´æ–°</h4>
    
    <p class="updated-meta">Oct 9, 2018</p>
    
  </header>
  <article class="updated-body">
    å›½åº†æœŸé—´æ°å·§æœåŠ¡å™¨ç¡¬ç›˜æ•…éšœä¸”è¿ç»´å¹¶æ²¡æœ‰åš raid å¤‡ä»½ï¼Œç»™æ›´æ¢äº†ä¸€å°æ–°å†…éƒ¨æœåŠ¡å™¨ï¼Œç´¢æ€§å‡çº§åˆ°äº† CentOS 7ï¼Œå› æ­¤é’ˆå¯¹ CentOS 6 å®‰è£… Docker çš„ç­”ç–‘ä¸å†æ›´æ–°ã€‚
  </article>
</div>


<h2 id="å‰è¨€">å‰è¨€</h2>
<p>å‰ä¸ä¹…ç»ˆäºæŠŠæˆ‘ä»¬ç§»åŠ¨å›¢é˜Ÿå†…éƒ¨æœåŠ¡å™¨ä» CentOS 5.x å‡çº§åˆ°äº† 6.8ã€‚æœ¬æ¥æ˜¯æ‹œæ‰˜è®©å‡çº§è‡³ 7.0 ç‰ˆæœ¬èµ·ç èƒ½ç”¨ä¸Š docker 1.12 ç‰ˆæœ¬è¿˜æ˜¯é è°±çš„äº‹æƒ…ã€‚
äº‹æƒ…å¾€å¾€éš¾ä»¥é¢„æ–™çš„è¢«å‘ŠçŸ¥å…¶ä»–å›¢é˜Ÿåœ¨å®‰è£… 7.0 ä¹‹åé€ æˆå†…éƒ¨æœåŠ¡å™¨ç¾¤çš„ç½‘å¡å¤±çµçš„è¯¡å¼‚æ•…éšœåªèƒ½ä½œç½¢ï¼Œæƒ³æƒ³èµ·ç è¿˜æœ‰ä¸ªæ—©æœŸ docker ç‰ˆæœ¬å¯å®‰è£…ä¹Ÿå°±å…ˆè¿™ä¹ˆç€å§ã€‚</p>
<p>è¿™ä¸ªæ˜¯åœ¨ <a href="http://icyleaf.com/2013/09/how-to-install-gitlab-on-centos/">å¦‚ä½•åœ¨CentOS ä¸Šå®‰è£…Gitlab</a> ä¹‹åæœ‰ä¸€ä¸ªæ— å¥ˆçš„ä½¿ç”¨æŒ‡å—ï¼Œ
å› ä¸ºè¿ç»´ä¹Ÿæœ‰ä»–çš„è€ƒè™‘æ–¹é¢ï¼Œå‚è§çŸ¥ä¹è®¨è®ºï¼š<a href="https://www.zhihu.com/question/29191794">å¦‚ä½•è¯´æœè¿ç»´é€‰æ‹© Debian/Ubuntu è€Œä¸æ˜¯ CentOS</a></p>
<h2 id="å®‰è£…-docker">å®‰è£… Docker</h2>
<h3 id="171">1.7.1</h3>
<p>Docker æœ€åä¸€ä¸ªæ”¯æŒ CentOS 6 çš„ç‰ˆæœ¬æ˜¯ 1.7.1 è¿˜å¿…é¡»å®‰è£… epel æºä¹‹åå°±<a href="https://github.com/docker/docker/issues/14365">è¢«å¤§å®¶æ¬¢å¤©å–œåœ°çš„æŠ›å¼ƒäº† 6 çš„æ”¯æŒ</a>ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">sudo rpm -ivh http://download.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm
</span></span><span class="line"><span class="ln">2</span><span class="cl">sudo yum -y remove docker
</span></span><span class="line"><span class="ln">3</span><span class="cl">sudo yum install libselinux-python docker-io
</span></span></code></pre></div><blockquote>
<p>ç”±äº yum å†… docker å·²ç»è¢«å…¶ä»–ä½¿ç”¨ï¼Œä¸ç”¨å®‰è£…é”™è¯¯äº†ã€‚</p>
</blockquote>
<h3 id="171-ä»¥ä¸Šç‰ˆæœ¬">1.7.1 ä»¥ä¸Šç‰ˆæœ¬</h3>
<p><strong>è¯·æœæ–­æ”¾å¼ƒè¿™ç§æƒ³æ³•</strong>ï¼Œè™½ç„¶ä½ å¯èƒ½åœ¨ç½‘ä¸Šæœç´¢æœ‰ä¸ªåˆ«çš„æ–‡ç« è¯´æŠŠå†…æ ¸å‡çº§åˆ° 3.10 åå¯ä»¥å®‰è£… docker 1.9 ç‰ˆæœ¬ï¼Œç»è¿‡æˆ‘ä¸ªäººåå¤æµ‹è¯•æ ¹æœ¬ä¸å¯è¡Œï¼</p>
<p>å½“ç„¶å¦‚æœä½ è¿˜æ˜¯åšæŒæƒ³å°è¯•ï¼Œè¯·å‚è€ƒå¦‚ä¸‹é“¾æ¥ï¼š</p>
<ul>
<li><a href="http://www.pangxie.space/docker/364">http://www.pangxie.space/docker/364</a></li>
<li><a href="http://www.cnblogs.com/dongdongwq/p/5381752.html">http://www.cnblogs.com/dongdongwq/p/5381752.html</a></li>
<li><a href="http://0evin.com/2016/06/17/%5B%E5%8E%9F%E5%88%9B%5DCentOS6.5%E5%AE%89%E8%A3%85Docker1.11.X%E7%89%88%E6%9C%AC/">http://0evin.com/2016/06/17/%5B%E5%8E%9F%E5%88%9B%5DCentOS6.5%E5%AE%89%E8%A3%85Docker1.11.X%E7%89%88%E6%9C%AC/</a></li>
</ul>
<h2 id="é…ç½®-docker">é…ç½® Docker</h2>
<p>å®‰è£…æˆåŠŸåå…ˆä¸è¦é…ç½®å¼€æœºè‡ªå¯åŠ¨å’Œå¯åŠ¨æœåŠ¡ï¼Œdocker çš„å®˜æ–¹é•œåƒåœ¨å›½å†…ä¼—æ‰€å‘¨çŸ¥çš„æ…¢çš„ä¸€å¡Œç³Šæ¶‚ï¼Œå¦‚æœä½ æ˜¯åœ¨å›½å†…æœåŠ¡å™¨ä½¿ç”¨è¯·å‚è€ƒå¦‚ä¸‹é…ç½®ã€‚</p>
<p>æˆ‘è¿™é‡ŒæŠŠæˆ‘ä¸ªäººç§è—å·²ä¹…çš„å¥½ç”¨çš„é•œåƒå‘Šè¯‰å¤§å®¶ï¼Œå¤§å®¶å¯ä¸è¦ä»¥ä¸ºæˆ‘ç”¨çš„æ˜¯é˜¿é‡Œäº‘æˆ–è€… DaoCloud è¿™ç±»æœ‰å¾ˆå¤šé™åˆ¶çš„ç©æ„ï¼š</p>
<ul>
<li>ä¸­å›½ç§‘æŠ€å¤§å­¦é•œåƒï¼šhttps://docker.mirrors.ustc.edu.cn</li>
<li>ç½‘æ˜“èœ‚å·¢é•œåƒï¼šhttp://hub-mirror.c.163.com</li>
</ul>
<p>åŒæ ·éœ€è¦æ³¨æ„çš„æ˜¯ 1.7.1 ç‰ˆæœ¬çš„ docker é…ç½®æ–‡ä»¶æ˜¯åœ¨ <code>/etc/sysconfig/docker</code> è€Œä¸æ˜¯ç½‘ä¸Šå’Œå®˜æ–¹è¯´çš„ <code>/etc/default/docker</code> æ‰“å¼€æ­¤æ–‡ä»¶åœ¨ other_args é…ç½®å¯¹äºçš„æºå³å¯ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1"># /etc/sysconfig/docker</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="c1">#</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="c1"># Other arguments to pass to the docker daemon process</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1"># These will be parsed by the sysv initscript and appended</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="c1"># to the arguments list passed to docker -d</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="c1">#other_args=</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="c1">#other_args=&#34;--registry-mirror=http://hub-mirror.c.163.com&#34;</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="nv">other_args</span><span class="o">=</span><span class="s2">&#34;--registry-mirror=https://docker.mirrors.ustc.edu.cn&#34;</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="nv">DOCKER_CERT_PATH</span><span class="o">=</span>/etc/docker
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="c1"># Resolves: rhbz#1176302 (docker issue #407)</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="nv">DOCKER_NOWARN_KERNEL_VERSION</span><span class="o">=</span><span class="m">1</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="c1"># Location used for temporary files, such as those created by</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="c1"># # docker load and build operations. Default is /var/lib/docker/tmp</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="c1"># # Can be overriden by setting the following environment variable.</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="c1"># # DOCKER_TMPDIR=/var/tmp</span>
</span></span></code></pre></div><p>åé¢å°±æ²¡ä»€ä¹ˆå¥½è¯´çš„äº†ï¼Œå¯åŠ¨æœåŠ¡å’Œè®¾ç½®å¼€æœºè‡ªå¯åŠ¨å°±å®Œäº‹äº†</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">sudo chkconfig docker on
</span></span><span class="line"><span class="ln">2</span><span class="cl">sudo service docker start
</span></span></code></pre></div><p>éªŒè¯ä¸‹å¯åŠ¨çš„æœåŠ¡æ˜¯å¦å·²ç»é…ç½®äº†å›½å†…é•œåƒæº</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ ps aux <span class="p">|</span> grep <span class="s2">&#34;docker -d&#34;</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">
</span></span><span class="line"><span class="ln">3</span><span class="cl">root     <span class="m">16992</span>  0.1  0.1 <span class="m">1239860</span> <span class="m">32276</span> ?       Sl   Dec29   2:02 /usr/bin/docker -d --registry-mirror<span class="o">=</span>https://docker.mirrors.ustc.edu.cn
</span></span><span class="line"><span class="ln">4</span><span class="cl">root     <span class="m">26873</span>  0.0  0.0 <span class="m">103332</span>   <span class="m">876</span> pts/2    S+   18:16   0:00 grep docker -d
</span></span></code></pre></div><h2 id="ç–‘éš¾æ‚ç—‡">ç–‘éš¾æ‚ç—‡</h2>
<h4 id="1-ä½¿ç”¨å›½å†…é•œåƒæº-pull-é•œåƒå¶å°”ä¼šå¤±è´¥åå¤å‡ æ¬¡å°±å¯ä»¥è§£å†³">1. ä½¿ç”¨å›½å†…é•œåƒæº pull é•œåƒå¶å°”ä¼šå¤±è´¥ï¼Œåå¤å‡ æ¬¡å°±å¯ä»¥è§£å†³</h4>
<p>é¢‘æ¬¡ä¸é«˜åŸå› æœªçŸ¥ï¼Œå› æ­¤è¿˜æœªé‡è§†ã€‚</p>
<h4 id="2-docker-web-ç®¡ç†å·¥å…·">2. Docker Web ç®¡ç†å·¥å…·</h4>
<p>æ¨èä½¿ç”¨ <a href="https://github.com/portainer/portainer">portainer</a> ï¼Œå…¼å®¹ 1.7 çš„éƒ¨åˆ†åŠŸèƒ½å¯èƒ½ä¼šå‘ç”Ÿéƒ¨åˆ†åŠŸèƒ½å’Œå‚æ•°æ— æ³•æ˜¾ç¤ºä½†ä¸å½±å“ä½¿ç”¨ã€‚ä¹‹å‰æˆ‘æœ‰æ¨è rancherï¼ˆå¯å‚è€ƒå‰ç¯‡æ–‡ç« ï¼š<a href="http://icyleaf.com/2016/08/how-to-install-rancher-on-osx/">å¦‚ä½•åœ¨ OS X ä¸Šå®‰è£… Rancher
</a>ï¼‰ï¼Œä½† rancher å®˜æ–¹è¦æ±‚ docker æœ€ä½ç‰ˆæœ¬æ˜¯ 1.9+ã€‚</p>
<h4 id="3-docker-è¿›ç¨‹æŒ‚äº†é‡å¯åæ— æ³•æ¢å¤ä¹‹å‰çš„-containers">3. Docker è¿›ç¨‹æŒ‚äº†é‡å¯åæ— æ³•æ¢å¤ä¹‹å‰çš„ containers</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ docker start c39206003c7a
</span></span><span class="line"><span class="ln">2</span><span class="cl">Error: Cannot start container c39206003c7a: Error getting container c39206003c7ae8992a554a9ac2ea130327fc4af1b2c389656c34baf9a56c84b5 from driver devicemapper: Error mounting <span class="s1">&#39;/dev/mapper/docker-253:0-267081-c39206003c7ae8992a554a9ac2ea130327fc4af1b2c389656c34baf9a56c84b5&#39;</span> on <span class="s1">&#39;/var/lib/docker/devicemapper/mnt/c39206003c7ae8992a554a9ac2ea130327fc4af1b2c389656c34baf9a56c84b5&#39;</span>: device or resource busy
</span></span><span class="line"><span class="ln">3</span><span class="cl">2014/05/08 19:14:57 Error: failed to start one or more containers
</span></span></code></pre></div><p>è¿™ç§ä¸€èˆ¬æ˜¯å› ä¸ºæ„å¤–ç»ˆæ­¢è¿›ç¨‹é€ æˆä¸Šæ¬¡çš„ volume æ²¡æœ‰æ­£å¸¸ unmountï¼Œåªéœ€æ‰‹åŠ¨æ“ä½œä¸‹å³å¯ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">unmount /var/lib/docker/devicemapper/mnt/d640aea67108b04c6a5ba14645966b092db1f807f3e3f41dca7a1470f76b68fb
</span></span></code></pre></div><blockquote>
<p><code>d640aea67108b04c6a5ba14645966b092db1f807f3e3f41dca7a1470f76b68fb</code> æ˜¯æ ¹æ®ä¸åŒ container ç”Ÿæˆçš„ï¼Œè¯·æ ¹æ®å®é™…æƒ…å†µå¤åˆ¶å’Œæ‰§è¡Œã€‚</p>
</blockquote>
<p>è¿™ä¸ªçœŸæ²¡åŠæ³•ï¼Œåªèƒ½åœ¨ Dockerfile æˆ–è€…è¿›å®ä¾‹é‡Œé¢è¿›è¡Œä¿®æ”¹æ—¶åŒºï¼Œè¿™ä¸ªæˆ‘å°±ä¸è¿‡å¤šèµ˜è¿°äº†ã€‚</p>
<h4 id="4-å‡çº§è¿è¡Œçš„-container-ç‰ˆæœ¬">4. å‡çº§è¿è¡Œçš„ container ç‰ˆæœ¬</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ docker stop xxxx
</span></span><span class="line"><span class="ln">2</span><span class="cl">$ docker create --volumes-from &lt;container_name_of_original_server&gt; <span class="se">\ </span>--name xxx-data image/name:&lt;tag_of_previous_rancher_server&gt;
</span></span><span class="line"><span class="ln">3</span><span class="cl">$ docker pull image/name:latest
</span></span><span class="line"><span class="ln">4</span><span class="cl">$ docker run -d --volumes-from xxx-data --restart<span class="o">=</span>unless-stopped <span class="se">\ </span>-p 8080:8080 image/namel.:latest
</span></span></code></pre></div><h4 id="5-é-root-ç”¨æˆ·æ‰§è¡Œ-docker">5. é root ç”¨æˆ·æ‰§è¡Œ docker</h4>
<p>åˆ›å»º docker ç”¨æˆ·ç»„å¹¶é‡å¯ docker æœåŠ¡ï¼Œä¹‹åæŠŠä½ æƒ³è¦çš„ç”¨æˆ·åŠ åˆ° docker ç”¨æˆ·ç»„å³å¯ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ groupadd docker
</span></span><span class="line"><span class="ln">2</span><span class="cl">$ service docker restart
</span></span><span class="line"><span class="ln">3</span><span class="cl">$ usermod -a -G docker icyleaf
</span></span></code></pre></div><h4 id="6-å®¿ä¸»æœº-cst-æ—¶é—´ä¼šé€ æˆ-docker-å®ä¾‹æ—¶é—´ä¸å‡†">6. å®¿ä¸»æœº CST æ—¶é—´ä¼šé€ æˆ docker å®ä¾‹æ—¶é—´ä¸å‡†</h4>
<p>è¿™ä¸ªçœŸæ²¡åŠæ³•ï¼Œåªèƒ½åœ¨ Dockerfile æˆ–è€…è¿›å®ä¾‹é‡Œé¢è¿›è¡Œä¿®æ”¹æ—¶åŒºï¼Œè¿™ä¸ªæˆ‘å°±ä¸è¿‡å¤šèµ˜è¿°äº†ã€‚</p>
]]></content:encoded></item><item><title>å¦‚ä½•åœ¨ OS X ä¸Šå®‰è£… Rancher</title><link>https://icyleaf.com/2016/08/how-to-install-rancher-on-osx/</link><pubDate>Fri, 05 Aug 2016 17:21:08 +0800</pubDate><guid>https://icyleaf.com/2016/08/how-to-install-rancher-on-osx/</guid><description>Rancher 0.x ç‰ˆæœ¬éƒ¨ç½²æŒ‡å—</description><content:encoded><![CDATA[



<div class="updated">
  <header class="updated-header">
    <h4 class="updated-title">æ›´æ–°</h4>
    
    <p class="updated-meta">Feb 22, 2022</p>
    
  </header>
  <article class="updated-body">
    ä»¥ä¸‹å†…å®¹å†™äº Rancker 0.x ç‰ˆæœ¬ï¼Œåç»­ç‰ˆæœ¬å˜æ›´æ¯”è¾ƒå¤§æœ¬æ–‡ä¸å†æœ‰æ²¡æœ‰å‚è€ƒã€‚
  </article>
</div>


<p>Rancher æ˜¯ Docker ç¼–æ’è§£å†³æ–¹æ¡ˆçš„ä¸€ç§ï¼Œå¥½å¤„åœ¨äºå¯ä»¥åšå®¹å™¨ç¼–æ’ï¼Œç½‘ç»œï¼Œå­˜å‚¨ï¼Œè´Ÿè½½å‡è¡¡ï¼Œè¿˜èƒ½å¤Ÿæ”¯æŒäº‘æœåŠ¡å™¨ï¼ˆæ¯”å¦‚ Amazon EC2/Azure/DigitalOceanï¼‰ä¹Ÿèƒ½å¤Ÿå…¼å®¹ Docker Swarm/Mesos/Kubernetes ç­‰å…¶ä»–çš„è§£å†³æ–¹æ¡ˆã€‚è‡ªå®ƒè¿˜æ²¡æœ‰å‘å¸ƒ <a href="http://rancher.com/announcing-rancher-1-0-ga/">1.0</a> ç‰ˆæœ¬ä¹‹å‰ä¹Ÿæœ‰æŒç»­çš„å…³æ³¨ã€‚å®ƒè‡ªèº«è¿˜æœ‰ä¸ª <a href="http://www.infoq.com/cn/news/2015/03/rancheros-docker-linux">RancherOS</a> å¯¹äº CoreOS ä¹Ÿæ˜¯ä¸€ä¸ªä¸å°çš„å¨èƒã€‚</p>
<p>ç”±äºå®ƒæä¾›éå¸¸ä¼˜åŒ–çš„åå°ç®¡ç†ç•Œé¢ï¼ŒåŒæ—¶ä¹Ÿæä¾› REST APIï¼Œæ—¥å¸¸å¼€å‘ä½¿ç”¨ä¸­å¼‚å¸¸çš„æ–¹ä¾¿ã€‚å¦‚æœéè¦è¯´å‡ºä¸€ç‚¹ä¸å¥½çš„ï¼Œé‚£å¯èƒ½å°±æ˜¯å®ƒå¯¹å†…å­˜æœ‰ç‚¹å°è¦æ±‚ï¼š<strong>æœ€å° 1GB å†…å­˜</strong>ï¼Œå› æ­¤å¦‚æœæƒ³æ”¾åœ¨è‡ªå·± VPS ä¸Šçš„ç«¥é‹éœ€è¦è¯„ä¼°ä¸‹äº†ã€‚</p>
<h2 id="mac-å®‰è£…">Mac å®‰è£…</h2>
<p>è¿™å—ä¹Ÿè¶ç€ <a href="https://docs.docker.com/docker-for-mac/">Docker for Mac</a> çš„å¥½å¤„ï¼Œç»ˆäºæ‘†è„±çš„ <code>docker-machine</code> çš„æŠ˜ç£¨ï¼Œä¸ç”¨åœ¨ä¾èµ– VirtualBoxï¼Œä¹Ÿä¸åœ¨æ¯æ¬¡è£…è½½ machine çš„å˜é‡å’ŒæŸ¥æ‰¾è™šæ‹Ÿæœºçš„ IPã€‚æ˜ å°„çš„ç«¯å£ç«¯å£éƒ½é€šè¿‡ <code>localhost</code> è®¿é—®ã€‚</p>
<p>Rancher é€šè¿‡ Docker æ¥å®‰è£…æœ¬æ¥è¯´æ˜¯éå¸¸ç®€å•çš„ï¼Œå®ƒåˆ†ä¸ºæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ã€‚æœ¬æ•™ç¨‹ä»¥ <a href="http://docs.rancher.com/rancher/latest/en/installing-rancher/installing-server/">Single Node</a> æ¥è®²è§£ï¼Œä¸è€ƒè™‘ <a href="http://docs.rancher.com/rancher/latest/en/installing-rancher/installing-server/multi-nodes/">Multi Node</a>ã€‚</p>
<p>è¿™å—ç½‘ä¸Šä¸€ç›´æ²¡æœ‰å¤ªå¥½çš„è§£å†³æ–¹æ¡ˆï¼Œæˆ‘çœ‹å¾ˆå¤šå›½å¤–ç»™å‡ºçš„<a href="https://gist.github.com/axnux/09dc375d71398cbbee44ebd23ba35a08">è§£å†³æ–¹æ¡ˆ</a>ä¹Ÿæ¯”è¾ƒéº»çƒ¦ï¼Œä¸»è¦æ˜¯ç”±äº Docker for mac ä½¿ç”¨çš„æ˜¯ xhyve ä½œä¸ºè½»é‡åŒ–çš„è™šæ‹ŸåŒ–æ–¹æ¡ˆï¼Œè€Œ rancher å®‰è£… server ç«¯æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œåœ¨æ·»åŠ ä¸»æœºçš„æ—¶å€™éœ€è¦é€šè¿‡ HTTP æ¥è¿æ¥ server ç«¯è€Œå¤±è´¥ã€‚ä¸‹é¢æˆ‘æ¥å¸¦å¤§å®¶ç”¨æœ€ç®€å•çš„æ–¹æ¡ˆæ¥æ‹†è§£ã€‚æ— éœ€ä»»ä½•ç¬¬ä¸‰æ–¹çš„è¾…åŠ©ã€‚</p>
<h3 id="æœåŠ¡ç«¯">æœåŠ¡ç«¯</h3>
<blockquote>
<p>å¦‚æœç½‘é€Ÿè¿æ¥ docker hub è¿‡æ…¢å¯è€ƒè™‘ä½¿ç”¨ä»£ç†è®¾ç½®æˆ–è€…å›½å†…çš„é•œåƒæœåŠ¡ï¼Œæˆ‘è¿™é‡Œåˆ†äº«ä¸€ä¸ª <code>https://docker.mirrors.ustc.edu.cn</code>ï¼Œå¯åœ¨ Docker -&gt; Preferences&hellip; -&gt; Advanced -&gt; Registry Mirror æ·»åŠ ã€‚</p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ docker run -d --name rancher-server --restart<span class="o">=</span>always -p 8080:8080 rancher/server
</span></span><span class="line"><span class="ln">2</span><span class="cl">$ docker logs -f rancher-server
</span></span><span class="line"><span class="ln">3</span><span class="cl">
</span></span><span class="line"><span class="ln">4</span><span class="cl"><span class="nv">time</span><span class="o">=</span><span class="s2">&#34;2016-08-05T16:48:52Z&#34;</span> <span class="nv">level</span><span class="o">=</span>info <span class="nv">msg</span><span class="o">=</span><span class="s2">&#34;Creating schema machine, roles [service]&#34;</span> <span class="nv">id</span><span class="o">=</span>1ds17
</span></span><span class="line"><span class="ln">5</span><span class="cl"><span class="nv">time</span><span class="o">=</span><span class="s2">&#34;2016-08-05T16:48:53Z&#34;</span> <span class="nv">level</span><span class="o">=</span>info <span class="nv">msg</span><span class="o">=</span><span class="s2">&#34;Creating schema machine, roles [project member owner]&#34;</span> <span class="nv">id</span><span class="o">=</span>1ds18
</span></span><span class="line"><span class="ln">6</span><span class="cl"><span class="nv">time</span><span class="o">=</span><span class="s2">&#34;2016-08-05T16:48:53Z&#34;</span> <span class="nv">level</span><span class="o">=</span>info <span class="nv">msg</span><span class="o">=</span><span class="s2">&#34;Creating schema machine, roles [admin user readAdmin]&#34;</span> <span class="nv">id</span><span class="o">=</span>1ds19
</span></span><span class="line"><span class="ln">7</span><span class="cl"><span class="nv">time</span><span class="o">=</span><span class="s2">&#34;2016-08-05T16:48:53Z&#34;</span> <span class="nv">level</span><span class="o">=</span>info <span class="nv">msg</span><span class="o">=</span><span class="s2">&#34;Creating schema machine, roles [readonly]&#34;</span> <span class="nv">id</span><span class="o">=</span>1ds20
</span></span></code></pre></div><p>çœ‹åˆ°å¦‚ä¸Šç±»ä¼¼çš„æ—¥å¿—è¯´æ˜æœåŠ¡å·²ç»åˆå§‹åŒ–å®Œæ¯•ï¼Œé€šè¿‡æµè§ˆå™¨è®¿é—® <code>http://localhost:8080</code> å°±å¯ä»¥çœ‹åˆ°åå°ç®¡ç†ç•Œé¢ã€‚</p>
<h3 id="å®¢æˆ·ç«¯">å®¢æˆ·ç«¯</h3>
<p>å…ˆä¸ç€æ€¥ç»§ç»­é¡µé¢æ“ä½œï¼Œå›åˆ°ç»ˆç«¯ä¸Šæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤è·å– rancher-server å®¹å™¨çš„ IP åœ°å€å¤‡ç”¨</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ docker inspect --format <span class="s1">&#39;{{ .NetworkSettings.IPAddress }}&#39;</span> rancher-server
</span></span><span class="line"><span class="ln">2</span><span class="cl">172.17.0.2
</span></span></code></pre></div><p>æ¥ç€ä¸Šé¢çš„æ­¥éª¤ï¼Œåœ¨æ‰“å¼€é¡µé¢èƒ½çœ‹åˆ° Add Host æŒ‰é’®å¹¶ç‚¹å‡»å¯¹äºå¼¹å‡º â€œHost Registration URLâ€ é€‰æ‹© â€œSomething else:â€ åœ¨åé¢çš„è¾“å…¥æ¡†å¡«å…¥ä¸Šé¢çš„ IP å’Œç«¯å£å· <code>http://172.17.0.2:8080</code> å¹¶ä¿å­˜ã€‚</p>
<p>ä¹‹åå°±æ˜¯ç»™ä½ ä¸€ä¸ªå®¢æˆ·ç«¯ï¼ˆéƒ¨ç½²ä¸»æœºï¼‰çš„é€‰é¡¹ï¼Œç”±äºæˆ‘ä»¬åªæ·»åŠ æœ¬æœºä½œä¸ºéƒ¨ç½²ä¸»æœºä½¿ç”¨ï¼Œå› æ­¤è¿™é‡Œé€‰æ‹© Customï¼Œå…¶ä»–ä¸ç”¨ä»»ä½•è®¾ç½®ï¼Œç›´æ¥æ»‘å€’æœ€åº•éƒ¨æ‰¾åˆ°ä¸€ä¸ªæ‰§è¡Œ docker å‘½ä»¤çš„åŒºåŸŸï¼š</p>
<p><img loading="lazy" src="http://ww2.sinaimg.cn/large/006tNbRwjw1f6jdkffiqhj31ee150k0c.jpg"
  
  
  alt="add rancher host"></img>
</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ docker run -d --privileged -v /var/run/docker.sock:/var/run/docker.sock -v /var/lib/rancher:/var/lib/rancher rancher/agent:v1.0.2 http://172.17.0.2:8080/v1/scripts/676576FFEC2212A68391:1470416400000:tfqxfdglHL6Qw8dpLVtbOesYY4
</span></span></code></pre></div><p>ä½ ä¼šå‘ç°æ‰§è¡Œå¯èƒ½ä¼šæŠ¥é”™ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">docker: Error response from daemon: Mounts denied:
</span></span><span class="line"><span class="ln">2</span><span class="cl">The path /var/lib/rancher
</span></span><span class="line"><span class="ln">3</span><span class="cl">is not shared from OS X and is not known to Docker.
</span></span><span class="line"><span class="ln">4</span><span class="cl">You can configure shared paths from Docker -&gt; Preferences... -&gt; File Sharing.
</span></span><span class="line"><span class="ln">5</span><span class="cl">See https://docs.docker.com/docker-for-mac/osxfs/#namespaces <span class="k">for</span> more info.
</span></span></code></pre></div><p>ç›®å‰æœ‰å¯èƒ½æ˜¯ä¸€ä¸ª Docker çš„ Bugï¼Œå› ä¸º <code>/var/lib/rancher</code> æ˜¯æŒ‚è½½åˆ°å·²ç»é»˜è®¤æ·»åŠ  <code>/private</code> æ–‡ä»¶å…±äº«ï¼Œä½†æ˜¯å®ƒè¿˜æ˜¯æŠ¥é”™ï¼Œå¦‚æœä½ åœ¨ Docker è®¾ç½®çš„ File Sharing æ·»åŠ çš„è¯å®ƒä¹Ÿä¸ä¼šè®©ä½ æ·»åŠ ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åšä¸€ç‚¹å°ä¿®æ”¹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">$ docker run -d --privileged -v /var/run/docker.sock:/var/run/docker.sock -v <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/docker/rancher/var/lib/rancher:/var/lib/rancher rancher/agent:v1.0.2 http://172.17.0.2:8080/v1/scripts/676576FFEC2212A68391:1470416400000:tfqxfdglHL6Qw8dpLVtbOesYY4
</span></span><span class="line"><span class="ln">2</span><span class="cl">5cf22a10cf28b4182b6e205fa631146e86d67c3c9d86901ff8cf7ab087319a29
</span></span></code></pre></div><p>æœ€åç‚¹å‡»é¡µé¢çš„ Close åä¼šè·³è½¬åˆ° Host çš„åˆ—è¡¨ï¼Œä½ å°±èƒ½æƒŠå–œçš„å‘ç°æ·»åŠ æˆåŠŸäº†ï¼</p>
<p><img loading="lazy" src="http://ww2.sinaimg.cn/large/006tNbRwjw1f6jdidcojkj315y0m4dik.jpg"
  
  
  alt="rancher host"></img>
</p>
<h2 id="ç»“å°¾">ç»“å°¾</h2>
<p>æœ¬ç¯‡åªå…ˆè§£å†³è¿™ä¸€ä¸ªé—®é¢˜ï¼Œæ›´å¤šä½¿ç”¨çš„èµ„æ–™è¯·çœ‹<a href="http://rancher.hidocker.io/">Rancher å®æˆ˜çº¢å®ä¹¦</a>ã€‚</p>
]]></content:encoded></item></channel></rss>