<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/"><channel><title>Javascript on icyleaf</title><link>https://icyleaf.com/tags/javascript/</link><description>Recent content in Javascript on icyleaf</description><language>zh-cn</language><lastBuildDate>Fri, 02 Apr 2010 12:34:56 +0800</lastBuildDate><atom:link href="https://icyleaf.com/tags/javascript/index.xml" rel="self" type="application/rss+xml"/><item><title>如何获取 Element 的 XPath [PHP/Javascript]</title><link>https://icyleaf.com/2010/04/how-to-get-xpath-of-an-element-for-php-and-javascript/</link><pubDate>Fri, 02 Apr 2010 12:34:56 +0800</pubDate><guid>https://icyleaf.com/2010/04/how-to-get-xpath-of-an-element-for-php-and-javascript/</guid><description>这两天研究 HTML 的 DOM 需要寻找某个 Element 元素的完整 XPath 路径，由于使用的是 PHP Simple HTML DOM Parser 开源库，这个库类的使用方法几乎兼容 Javascript 的 DOM 语法并附带 DOM 选择器。虽然功能强...</description><content:encoded><![CDATA[<p>这两天研究 HTML 的 DOM 需要寻找某个 Element 元素的完整 XPath 路径，由于使用的是 <a href="http://simplehtmldom.sourceforge.net/manual.htm">PHP Simple HTML DOM Parser</a> 开源库，这个库类的使用方法几乎兼容 Javascript 的 DOM 语法并附带 DOM 选择器。虽然功能强大但是并不能直接获取 Element 的 XPath。这个怎么办呢，依稀记得 Firebug 有一个功能，选择某个元素在它的控制台可以显示 XPath。嗯，着手实践一下发现不仅可以显示而且还可以复制 XPath。</p>
<p>于是想，如果可以找到 Javascript 版的相关代码就一定可以改成 PHP 版本的，结果在 Google 搜索找到了&hellip;</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kd">var</span> <span class="nx">elt</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;table&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kd">var</span> <span class="nx">xpath</span> <span class="o">=</span> <span class="nx">getElementXPath</span><span class="p">(</span><span class="nx">elt</span><span class="p">);</span><span class="nx">alert</span><span class="p">(</span><span class="nx">xpath</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1">// Get full XPath of an element
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="nx">getElementXPath</span><span class="p">(</span><span class="nx">elt</span><span class="p">){</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">	<span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">	<span class="k">for</span> <span class="p">(;</span> <span class="nx">elt</span> <span class="o">&amp;&amp;</span> <span class="nx">elt</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">==</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">elt</span> <span class="o">=</span> <span class="nx">elt</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">		<span class="nx">idx</span> <span class="o">=</span> <span class="nx">getElementIdx</span><span class="p">(</span><span class="nx">elt</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">		<span class="nx">xname</span> <span class="o">=</span> <span class="nx">elt</span><span class="p">.</span><span class="nx">tagName</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="nx">idx</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="nx">xname</span> <span class="o">+=</span> <span class="s2">&#34;[&#34;</span> <span class="o">+</span> <span class="nx">idx</span> <span class="o">+</span> <span class="s2">&#34;]&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">		<span class="nx">path</span> <span class="o">=</span> <span class="s2">&#34;/&#34;</span> <span class="o">+</span> <span class="nx">xname</span> <span class="o">+</span> <span class="nx">path</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">	<span class="k">return</span> <span class="nx">path</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">
</span></span><span class="line"><span class="ln">17</span><span class="cl"><span class="c1">// Get Idx of an element
</span></span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="nx">getElementIdx</span><span class="p">(</span><span class="nx">elt</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">	<span class="kd">var</span> <span class="nx">count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">	<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">sib</span> <span class="o">=</span> <span class="nx">elt</span><span class="p">.</span><span class="nx">previousSibling</span><span class="p">;</span> <span class="nx">sib</span> <span class="p">;</span> <span class="nx">sib</span> <span class="o">=</span> <span class="nx">sib</span><span class="p">.</span><span class="nx">previousSibling</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">		<span class="k">if</span><span class="p">(</span><span class="nx">sib</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">sib</span><span class="p">.</span><span class="nx">tagName</span> <span class="o">==</span> <span class="nx">elt</span><span class="p">.</span><span class="nx">tagName</span><span class="p">)</span>  <span class="nx">count</span><span class="o">++</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">	<span class="k">return</span> <span class="nx">count</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>PHP 改进版：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="c1">// Use it before import PHP Simple HTML DOM Parser
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="c1"></span><span class="nv">$html</span> <span class="o">=</span> <span class="nx">file_get_html</span><span class="p">(</span><span class="s1">&#39;http://www.google.com/&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1">// find a sample element by id
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="c1"></span><span class="nv">$elt1</span> <span class="o">=</span> <span class="nv">$html</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;#footer&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="c1">// find a sample element by tag name
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="c1"></span><span class="nv">$elt2</span><span class="o">=</span> <span class="nv">$html</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">
</span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="c1">// it will return if found it: [@id=&#34;footer&#34;]
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="c1"></span><span class="nv">$xpath</span> <span class="o">=</span> <span class="nx">getElementXPath</span><span class="p">(</span><span class="nv">$elt1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="c1">// it will return if found it: html/body/div[10]
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1"></span><span class="nv">$xpath</span> <span class="o">=</span> <span class="nx">getElementXPath</span><span class="p">(</span><span class="nv">$elt2</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="k">function</span> <span class="nf">getElementXPath</span><span class="p">(</span><span class="nv">$elt</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">	<span class="nv">$path</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">	<span class="nv">$first</span> <span class="o">=</span> <span class="k">TRUE</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">	<span class="k">for</span><span class="p">(;</span> <span class="p">(</span><span class="nv">$elt</span> <span class="k">AND</span> <span class="nv">$elt</span><span class="o">-&gt;</span><span class="na">nodetype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">);</span> <span class="nv">$elt</span> <span class="o">=</span> <span class="nv">$elt</span><span class="o">-&gt;</span><span class="na">parent</span><span class="p">())</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">		<span class="nv">$xname</span> <span class="o">=</span> <span class="nv">$elt</span><span class="o">-&gt;</span><span class="na">tag</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">		<span class="nv">$idx</span> <span class="o">=</span> <span class="nx">getElementIdx</span><span class="p">(</span><span class="nv">$elt</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="nv">$first</span> <span class="k">AND</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$elt</span><span class="o">-&gt;</span><span class="na">attr</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]))</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">			<span class="nv">$path</span> <span class="o">=</span> <span class="s1">&#39;//*[@id=&#34;&#39;</span> <span class="o">.</span> <span class="nv">$elt</span><span class="o">-&gt;</span><span class="na">attr</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;&#34;]&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">			<span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">
</span></span><span class="line"><span class="ln">29</span><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="nv">$idx</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">			<span class="o">%</span><span class="nx">xname</span> <span class="o">.=</span> <span class="s1">&#39;[&#39;</span> <span class="o">.</span> <span class="nv">$idx</span> <span class="o">.</span> <span class="s1">&#39;]&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">
</span></span><span class="line"><span class="ln">34</span><span class="cl">		<span class="nv">$path</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="nv">$xname</span><span class="o">.</span><span class="nv">$path</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">		<span class="nv">$first</span> <span class="o">=</span> <span class="k">FALSE</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">
</span></span><span class="line"><span class="ln">38</span><span class="cl">	<span class="k">return</span> <span class="nv">$path</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">
</span></span><span class="line"><span class="ln">41</span><span class="cl"><span class="k">function</span> <span class="nf">getElementIdx</span><span class="p">(</span><span class="nv">$elt</span><span class="p">){</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">	<span class="nv">$count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">	<span class="k">for</span><span class="p">(</span><span class="nv">$sib</span> <span class="o">=</span> <span class="nv">$elt</span><span class="o">-&gt;</span><span class="na">prev_sibling</span><span class="p">();</span> <span class="nv">$sib</span> <span class="p">;</span> <span class="nv">$sib</span> <span class="o">=</span> <span class="nv">$sib</span><span class="o">-&gt;</span><span class="na">prev_sibling</span><span class="p">())</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl">		<span class="k">if</span><span class="p">(</span><span class="nv">$sib</span><span class="o">-&gt;</span><span class="na">nodetype</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nv">$sib</span><span class="o">-&gt;</span><span class="na">tag</span> <span class="o">==</span> <span class="nv">$elt</span><span class="o">-&gt;</span><span class="na">tag</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="ln">47</span><span class="cl">			<span class="nv">$count</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="ln">50</span><span class="cl">	<span class="k">return</span> <span class="nv">$count</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">51</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>大家同样可以把上面的代码直接 crack 到 PHP Simple HTML DOM Parser 库中。</p>
]]></content:encoded></item></channel></rss>